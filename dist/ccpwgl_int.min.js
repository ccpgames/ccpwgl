!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ccpwgl_int=t():e.ccpwgl_int=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=52)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(28);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(53);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(32);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(33);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(59);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(60);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(61);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var u=r(62);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var h=r(63);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var f=r(64);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(4);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(16);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(67);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(69);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(23);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(70);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var u=r(20);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var h=r(71);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var f=r(6);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var p=r(72);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var d=r(36);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var v=r(73);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var m=r(22);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var y=r(74);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})});var b=r(75);Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})});var g=r(37);Object.keys(g).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})});var _=r(34);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})});var E=r(76);Object.keys(E).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})});var T=r(38);Object.keys(T).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})});var R=r(11);Object.keys(R).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}})});var S=r(77);Object.keys(S).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})});var w=r(19);Object.keys(w).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}})});var O=r(17);Object.keys(O).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})});var A=r(24);Object.keys(A).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}})});var P=r(94);Object.keys(P).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var M=r(95);Object.keys(M).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return M[e]}})});var D=r(96);Object.keys(D).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return D[e]}})});var I=r(97);Object.keys(I).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}})});var C=r(98);Object.keys(C).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var j=r(25);Object.keys(j).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return j[e]}})});var x=r(12);Object.keys(x).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.device=void 0;var i,n,a,s,o,l,c=r(0),u=r(16),h=r(4),f=r(6),p=r(17),d=r(20),v=r(12),m=r(65);function y(){this.gl=null,this.glVersion=y.WebglVersion.NONE,this.ext=null,this.dt=0,this.frameCounter=0,this.startTime=new Date,this.currentTime=this.startTime,this.previousTime=null,this.eyePosition=c.vec3.create(),this.targetResolution=c.vec4.create(),this.world=c.mat4.create(),this.view=c.mat4.create(),this.viewInverse=c.mat4.create(),this.viewTranspose=c.mat4.create(),this.projection=c.mat4.create(),this.projectionInverse=c.mat4.create(),this.projectionTranspose=c.mat4.create(),this.viewProjection=c.mat4.create(),this.viewProjectionTranspose=c.mat4.create(),this.canvas=null,this.viewportAspect=0,this.viewportWidth=0,this.viewportHeight=0,this.shadowHandles=null,this.wrapModes=[],this.perObjectData=null,this.effectDir="/effect.gles2/",this.debugMode=!1,this.mipLevelSkipCount=0,this.shaderModel="hi",this.enableAnisotropicFiltering=!0,this._scheduled=[],this._quadBuffer=null,this._cameraQuadBuffer=null,this._currentRenderMode=null,this._onResize=null,this.utils=m}y.prototype.CreateDevice=function(e,t){this.gl=null,this.glVersion=y.WebglVersion.NONE,this.effectDir="/effect.gles2/",this.ext={drawElementsInstanced:function(){return!1},drawArraysInstanced:function(){return!1},vertexAttribDivisor:function(){return!1},hasInstancedArrays:function(){return!1}},t&&t.webgl2&&(this.gl=y.CreateContext(e,t,y.Webgl2ContextNames),this.gl&&(this.glVersion=y.WebglVersion.WEBGL2)),this.gl||(this.gl=y.CreateContext(e,t,y.WebglContextNames),this.gl&&(this.glVersion=y.WebglVersion.WEBGL));var r=this.gl;switch(this.glVersion){case y.WebglVersion.WEBGL2:this.ext={drawElementsInstanced:function(e,t,i,n,a){r.drawElementsInstanced(e,t,i,n,a)},drawArraysInstanced:function(e,t,i,n){r.drawArraysInstanced(e,t,i,n)},vertexAttribDivisor:function(e,t){r.vertexAttribDivisor(e,t)},hasInstancedArrays:function(){return!0}};break;case y.WebglVersion.WEBGL:this.GetExtension("OES_standard_derivatives"),this.GetExtension("OES_element_index_uint"),this.GetExtension("OES_texture_float"),this.GetExtension("EXT_shader_texture_lod");var i=this.GetExtension("ANGLE_instanced_arrays");i&&(this.ext={drawElementsInstanced:function(e,t,r,n,a){i.drawElementsInstancedANGLE(e,t,r,n,a)},drawArraysInstanced:function(e,t,r,n){i.drawArraysInstancedANGLE(e,t,r,n)},vertexAttribDivisor:function(e,t){i.vertexAttribDivisorANGLE(e,t)},hasInstancedArrays:function(){return!0}});break;default:return!1}f.emitter.log("webgl",{log:"warn",type:"Context created",value:this.glVersion}),this.ext.CompressedTexture=this.GetExtension("compressed_texture_s3tc"),this.ext.AnisotropicFilter=this.GetExtension("EXT_texture_filter_anisotropic"),this.ext.AnisotropicFilter&&(this.ext.AnisotropicFilter.maxAnisotropy=r.getParameter(this.ext.AnisotropicFilter.MAX_TEXTURE_MAX_ANISOTROPY_EXT));var n=this.GetExtension("CCP_shader_binary");if(n){var a=r.getParameter(this.gl.RENDERER).match(/Mali-(\w+).*/);a&&(this.effectDir="/effect.gles2.mali"+a[1]+"/",this.ext.ShaderBinary=n)}this.debugMode&&(this.gl=this.utils.makeDebugContext(this.gl)),this.alphaBlendBackBuffer=!t||void 0===t.alpha||t.alpha,this.msaaSamples=this.gl.getParameter(this.gl.SAMPLES),this.antialiasing=this.msaaSamples>1,this.canvas=e,this.Resize();return this._quadBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._quadBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),this.gl.STATIC_DRAW),this._cameraQuadBuffer=this.gl.createBuffer(),this._quadDecl=new v.Tw2VertexDeclaration,this._quadDecl.elements.push(new v.Tw2VertexElement(v.Tw2VertexDeclaration.Type.POSITION,0,this.gl.FLOAT,4,0)),this._quadDecl.elements.push(new v.Tw2VertexElement(v.Tw2VertexDeclaration.Type.TEXCOORD,0,this.gl.FLOAT,2,16)),this._quadDecl.RebuildHash(),this.alphaTestState={},this.alphaTestState.states={},this.alphaTestState.states[this.RS_ALPHATESTENABLE]=0,this.alphaTestState.states[this.RS_ALPHAREF]=-1,this.alphaTestState.states[this.RS_ALPHAFUNC]=this.CMP_GREATER,this.alphaTestState.states[this.RS_CLIPPING]=0,this.alphaTestState.states[this.RS_CLIPPLANEENABLE]=0,this.alphaTestState.dirty=!1,this.alphaBlendState={},this.alphaBlendState.states={},this.alphaBlendState.states[this.RS_SRCBLEND]=this.BLEND_SRCALPHA,this.alphaBlendState.states[this.RS_DESTBLEND]=this.BLEND_INVSRCALPHA,this.alphaBlendState.states[this.RS_BLENDOP]=this.BLENDOP_ADD,this.alphaBlendState.states[this.RS_SEPARATEALPHABLENDENABLE]=0,this.alphaBlendState.states[this.RS_BLENDOPALPHA]=this.BLENDOP_ADD,this.alphaBlendState.states[this.RS_SRCBLENDALPHA]=this.BLEND_SRCALPHA,this.alphaBlendState.states[this.RS_DESTBLENDALPHA]=this.BLEND_INVSRCALPHA,this.alphaBlendState.dirty=!1,this.depthOffsetState={},this.depthOffsetState.states={},this.depthOffsetState.states[this.RS_SLOPESCALEDEPTHBIAS]=0,this.depthOffsetState.states[this.RS_DEPTHBIAS]=0,this.depthOffsetState.dirty=!1,this.wrapModes=[],this.wrapModes[0]=0,this.wrapModes[1]=this.gl.REPEAT,this.wrapModes[2]=this.gl.MIRRORED_REPEAT,this.wrapModes[3]=this.gl.CLAMP_TO_EDGE,this.wrapModes[4]=this.gl.CLAMP_TO_EDGE,this.wrapModes[5]=this.gl.CLAMP_TO_EDGE,this._shadowStateBuffer=new Float32Array(24),this._blendTable=[-1,this.gl.ZERO,this.gl.ONE,this.gl.SRC_COLOR,this.gl.ONE_MINUS_SRC_COLOR,this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.DST_ALPHA,this.gl.ONE_MINUS_DST_ALPHA,this.gl.DST_COLOR,this.gl.ONE_MINUS_DST_COLOR,this.gl.SRC_ALPHA_SATURATE,-1,-1,this.gl.CONSTANT_COLOR,this.gl.ONE_MINUS_CONSTANT_COLOR],this.glVersion},y.prototype.Schedule=function(e){this._scheduled[this._scheduled.length]=e},y.prototype.Resize=function(){this.canvas&&(this._onResize?this._onResize(this):(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.viewportWidth=this.canvas.clientWidth,this.viewportHeight=this.canvas.clientHeight),this.viewportAspect=this.viewportWidth/this.viewportHeight)},y.prototype.Tick=function(){this.canvas.clientWidth===this.viewportWidth&&this.canvas.clientHeight===this.viewportHeight||this.Resize();var e=this.Clock.now();this.currentTime=.001*(e-this.startTime),this.dt=null===this.previousTime?0:.001*(e-this.previousTime),this.previousTime=e;var t=u.store.GetVariable("Time").value;t[3]=t[0],t[0]=this.currentTime,t[1]=this.currentTime-Math.floor(this.currentTime),t[2]=this.frameCounter;var r=u.store.GetVariable("ViewportSize").value;r[0]=this.viewportWidth,r[1]=this.viewportHeight,r[2]=this.viewportWidth,r[3]=this.viewportHeight,h.resMan.PrepareLoop(this.dt);for(var i=0;i<this._scheduled.length;++i)this._scheduled[i](this.dt)||(this._scheduled.splice(i,1),--i);this.frameCounter++},y.prototype.SetWorld=function(e){c.mat4.copy(this.world,e)},y.prototype.SetView=function(e){c.mat4.copy(this.view,e),c.mat4.invert(this.viewInverse,this.view),c.mat4.transpose(this.viewTranspose,this.view),c.mat4.getTranslation(this.eyePosition,this.viewInverse),this.UpdateViewProjection()},y.prototype.SetProjection=function(e,t){c.mat4.copy(this.projection,e),c.mat4.transpose(this.projectionTranspose,this.projection),c.mat4.invert(this.projectionInverse,this.projection),this.GetTargetResolution(this.targetResolution),t&&this.UpdateViewProjection()},y.prototype.UpdateViewProjection=function(){c.mat4.multiply(this.viewProjection,this.projection,this.view),c.mat4.transpose(this.viewProjectionTranspose,this.viewProjection),c.mat4.copy(u.store.GetVariable("ViewProjectionMat").value,this.viewProjection)},y.prototype.GetTargetResolution=function(e){var t=this.projection[0]?this.projection[5]/this.projection[0]:0,r=1;t>1.6&&(r=t/1.6);var i=2*Math.atan(r/this.projection[5]);return e[0]=this.viewportWidth,e[1]=this.viewportHeight,e[2]=i,e[3]=i*t,e},y.prototype.GetEyePosition=function(){return this.eyePosition},y.prototype.RenderFullScreenQuad=function(e){if(e&&e.GetEffectRes().IsGood()){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._quadBuffer);for(var t=0;t<e.GetPassCount();++t){if(e.ApplyPass(t),!this._quadDecl.SetDeclaration(e.GetPassInput(t),24))return;this.ApplyShadowState(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}},y.prototype.RenderTexture=(i=null,function(e){if(null===i){(i=new d.Tw2Effect).effectFilePath="res:/graphics/effect/managed/space/system/blit.fx";var t=new p.Tw2TextureParameter;t.name="BlitSource",i.parameters[t.name]=t,i.Initialize()}i.parameters.BlitSource.textureRes=e,this.RenderFullScreenQuad(i)}),y.prototype.RenderCameraSpaceQuad=function(e){if(e&&e.GetEffectRes().IsGood()){for(var t=new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),r=this.projectionInverse,i=0;i<4;++i){var n=t.subarray(6*i,6*i+4);c.vec4.transformMat4(n,n,r),c.vec3.scale(n,n,1/n[3]),n[3]=1}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._cameraQuadBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW);for(var a=0;a<e.GetPassCount();++a){if(e.ApplyPass(a),!this._quadDecl.SetDeclaration(e.GetPassInput(a),24))return;this.ApplyShadowState(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}},y.prototype._DwordToFloat=function(e){var t=(16711680&e)>>16,r=(4278190080&e)>>24,i=(r<<1&255|t>>7)-127,n=(127&t)<<16|(65280&e)>>8<<8|255&e;return 0===n&&-127===i?0:(1-2*(r>>7))*(1+n*Math.pow(2,-23))*Math.pow(2,i)},y.prototype.IsAlphaTestEnabled=function(){return this.alphaTestState.states[this.RS_ALPHATESTENABLE]},y.prototype.SetRenderState=function(e,t){this._currentRenderMode=this.RM_ANY;var r=this.gl;switch(e){case this.RS_ZENABLE:return void(t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST));case this.RS_ZWRITEENABLE:return void r.depthMask(!!t);case this.RS_ALPHATESTENABLE:case this.RS_ALPHAREF:case this.RS_ALPHAFUNC:case this.RS_CLIPPING:case this.RS_CLIPPLANEENABLE:return void(this.alphaTestState[e]!==t&&(this.alphaTestState.states[e]=t,this.alphaTestState.dirty=!0));case this.RS_SRCBLEND:case this.RS_DESTBLEND:case this.RS_BLENDOP:case this.RS_SEPARATEALPHABLENDENABLE:case this.RS_BLENDOPALPHA:case this.RS_SRCBLENDALPHA:case this.RS_DESTBLENDALPHA:return void(this.alphaBlendState[e]!==t&&(this.alphaBlendState.states[e]=t,this.alphaBlendState.dirty=!0));case this.RS_CULLMODE:switch(t){case this.CULL_NONE:return void r.disable(r.CULL_FACE);case this.CULL_CW:return r.enable(r.CULL_FACE),void r.cullFace(r.FRONT);case this.CULL_CCW:return r.enable(r.CULL_FACE),void r.cullFace(r.BACK)}return;case this.RS_ZFUNC:return void r.depthFunc(512+t-1);case this.RS_ALPHABLENDENABLE:return void(t?r.enable(r.BLEND):r.disable(r.BLEND));case this.RS_COLORWRITEENABLE:return void r.colorMask(0!=(1&t),0!=(2&t),0!=(4&t),0!=(8&t));case this.RS_SCISSORTESTENABLE:return void(t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST));case this.RS_SLOPESCALEDEPTHBIAS:case this.RS_DEPTHBIAS:return t=this._DwordToFloat(t),void(this.depthOffsetState[e]!==t&&(this.depthOffsetState.states[e]=t,this.depthOffsetState.dirty=!0))}},y.prototype.ApplyShadowState=function(){if(this.alphaBlendState.dirty){var e=this.gl.FUNC_ADD;this.alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?e=this.gl.FUNC_SUBTRACT:this.alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(e=this.gl.FUNC_REVERSE_SUBTRACT);var t=this._blendTable[this.alphaBlendState.states[this.RS_SRCBLEND]],r=this._blendTable[this.alphaBlendState.states[this.RS_DESTBLEND]];if(this.alphaBlendState.states[this.RS_SEPARATEALPHABLENDENABLE]){var i=this.gl.FUNC_ADD;this.alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?i=this.gl.FUNC_SUBTRACT:this.alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(i=this.gl.FUNC_REVERSE_SUBTRACT);var n=this._blendTable[this.alphaBlendState.states[this.RS_SRCBLENDALPHA]],a=this._blendTable[this.alphaBlendState.states[this.RS_DESTBLENDALPHA]];this.gl.blendEquationSeparate(e,i),this.gl.blendFuncSeparate(t,r,n,a)}else this.gl.blendEquation(e),this.gl.blendFunc(t,r);this.alphaBlendState.dirty=!1}var s,o,l;if(this.depthOffsetState.dirty&&(this.gl.polygonOffset(this.depthOffsetState.states[this.RS_SLOPESCALEDEPTHBIAS],this.depthOffsetState.states[this.RS_DEPTHBIAS]),this.depthOffsetState.dirty=!1),this.shadowHandles&&this.alphaTestState.states[this.RS_ALPHATESTENABLE]){switch(this.alphaTestState.states[this.RS_ALPHAFUNC]){case this.CMP_NEVER:s=0,o=1,l=-256;break;case this.CMP_LESS:s=0,o=-1,l=this.alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_EQUAL:s=1,o=0,l=this.alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_LEQUAL:s=0,o=-1,l=this.alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_GREATER:s=0,o=1,l=-this.alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_GREATEREQUAL:s=0,o=1,l=-this.alphaTestState.states[this.RS_ALPHAREF];break;default:s=0,o=0,l=1}this.gl.uniform4f(this.shadowHandles.shadowStateInt,o,l,s,0)}},y.prototype.SetStandardStates=function(e){if(this._currentRenderMode!==e){switch(this.gl.frontFace(this.gl.CW),e){case this.RM_OPAQUE:case this.RM_PICKABLE:this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_DECAL:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!0),this.SetRenderState(this.RS_ALPHAFUNC,this.CMP_GREATER),this.SetRenderState(this.RS_ALPHAREF,127),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_TRANSPARENT:this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_SRCALPHA),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_INVSRCALPHA),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_ADDITIVE:this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_FULLSCREEN:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ZENABLE,!1),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_ALWAYS),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;default:return}this._currentRenderMode=e}},y.prototype.GetFallbackTexture=(n=null,function(){return null===n&&(n=this.CreateSolidTexture([0,0,0,0])),n}),y.prototype.GetFallbackCubeMap=(a=null,function(){if(null===a){a=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,a);for(var e=0;e<6;++e)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,0]));this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null)}return a}),y.prototype.IsFrameBufferComplete=function(e){return this.gl.checkFramebufferStatus(e)===this.gl.FRAMEBUFFER_COMPLETE},y.prototype.GetExtension=function(e){for(var t in y.WebglVendorPrefixes)if(y.WebglVendorPrefixes.hasOwnProperty(t)){var r=this.gl.getExtension(y.WebglVendorPrefixes[t]+e);if(r)return r}return null},y.prototype.CreateSolidTexture=function(e){e=e||[0,0,0,0];var t=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(e)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t},y.prototype.Clock=Date,y.prototype.RequestAnimationFrame=(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return s||(s=[]),s.push(window.setTimeout(e,1e3/60)),s.length-1},function(e,t){return o(e,t)}),y.prototype.CancelAnimationFrame=(l=window.cancelAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){if(s||(s=[]),void 0!==s[e])return window.clearTimeout(s[e]),s[e]=void 0,!0},function(e){l(e)}),y.CreateContext=function(e,t,r){r=Array.isArray(r)?r:[r];for(var i=0;i<r.length;i++)try{return e.getContext(r[i],t)}catch(e){}return null},y.WebglVendorPrefixes=["","MOZ_","WEBKIT_","WEBGL_"],y.WebglContextNames=["webgl","experimental-webgl"],y.Webgl2ContextNames=["webgl2","experimental-webgl2"],y.WebglVersion={NONE:0,WEBGL:1,WEBGL2:2},y.prototype.RM_ANY=-1,y.prototype.RM_OPAQUE=0,y.prototype.RM_DECAL=1,y.prototype.RM_TRANSPARENT=2,y.prototype.RM_ADDITIVE=3,y.prototype.RM_DEPTH=4,y.prototype.RM_FULLSCREEN=5,y.prototype.RM_PICKABLE=6,y.prototype.RS_ZENABLE=7,y.prototype.RS_FILLMODE=8,y.prototype.RS_SHADEMODE=9,y.prototype.RS_ZWRITEENABLE=14,y.prototype.RS_ALPHATESTENABLE=15,y.prototype.RS_LASTPIXEL=16,y.prototype.RS_SRCBLEND=19,y.prototype.RS_DESTBLEND=20,y.prototype.RS_CULLMODE=22,y.prototype.RS_ZFUNC=23,y.prototype.RS_ALPHAREF=24,y.prototype.RS_ALPHAFUNC=25,y.prototype.RS_DITHERENABLE=26,y.prototype.RS_ALPHABLENDENABLE=27,y.prototype.RS_FOGENABLE=28,y.prototype.RS_SPECULARENABLE=29,y.prototype.RS_FOGCOLOR=34,y.prototype.RS_FOGTABLEMODE=35,y.prototype.RS_FOGSTART=36,y.prototype.RS_FOGEND=37,y.prototype.RS_FOGDENSITY=38,y.prototype.RS_RANGEFOGENABLE=48,y.prototype.RS_STENCILENABLE=52,y.prototype.RS_STENCILFAIL=53,y.prototype.RS_STENCILZFAIL=54,y.prototype.RS_STENCILPASS=55,y.prototype.RS_STENCILFUNC=56,y.prototype.RS_STENCILREF=57,y.prototype.RS_STENCILMASK=58,y.prototype.RS_STENCILWRITEMASK=59,y.prototype.RS_TEXTUREFACTOR=60,y.prototype.RS_WRAP0=128,y.prototype.RS_WRAP1=129,y.prototype.RS_WRAP2=130,y.prototype.RS_WRAP3=131,y.prototype.RS_WRAP4=132,y.prototype.RS_WRAP5=133,y.prototype.RS_WRAP6=134,y.prototype.RS_WRAP7=135,y.prototype.RS_CLIPPING=136,y.prototype.RS_LIGHTING=137,y.prototype.RS_AMBIENT=139,y.prototype.RS_FOGVERTEXMODE=140,y.prototype.RS_COLORVERTEX=141,y.prototype.RS_LOCALVIEWER=142,y.prototype.RS_NORMALIZENORMALS=143,y.prototype.RS_DIFFUSEMATERIALSOURCE=145,y.prototype.RS_SPECULARMATERIALSOURCE=146,y.prototype.RS_AMBIENTMATERIALSOURCE=147,y.prototype.RS_EMISSIVEMATERIALSOURCE=148,y.prototype.RS_VERTEXBLEND=151,y.prototype.RS_CLIPPLANEENABLE=152,y.prototype.RS_POINTSIZE=154,y.prototype.RS_POINTSIZE_MIN=155,y.prototype.RS_POINTSPRITEENABLE=156,y.prototype.RS_POINTSCALEENABLE=157,y.prototype.RS_POINTSCALE_A=158,y.prototype.RS_POINTSCALE_B=159,y.prototype.RS_POINTSCALE_C=160,y.prototype.RS_MULTISAMPLEANTIALIAS=161,y.prototype.RS_MULTISAMPLEMASK=162,y.prototype.RS_PATCHEDGESTYLE=163,y.prototype.RS_DEBUGMONITORTOKEN=165,y.prototype.RS_POINTSIZE_MAX=166,y.prototype.RS_INDEXEDVERTEXBLENDENABLE=167,y.prototype.RS_COLORWRITEENABLE=168,y.prototype.RS_TWEENFACTOR=170,y.prototype.RS_BLENDOP=171,y.prototype.RS_POSITIONDEGREE=172,y.prototype.RS_NORMALDEGREE=173,y.prototype.RS_SCISSORTESTENABLE=174,y.prototype.RS_SLOPESCALEDEPTHBIAS=175,y.prototype.RS_ANTIALIASEDLINEENABLE=176,y.prototype.RS_TWOSIDEDSTENCILMODE=185,y.prototype.RS_CCW_STENCILFAIL=186,y.prototype.RS_CCW_STENCILZFAIL=187,y.prototype.RS_CCW_STENCILPASS=188,y.prototype.RS_CCW_STENCILFUNC=189,y.prototype.RS_COLORWRITEENABLE1=190,y.prototype.RS_COLORWRITEENABLE2=191,y.prototype.RS_COLORWRITEENABLE3=192,y.prototype.RS_BLENDFACTOR=193,y.prototype.RS_SRGBWRITEENABLE=194,y.prototype.RS_DEPTHBIAS=195,y.prototype.RS_SEPARATEALPHABLENDENABLE=206,y.prototype.RS_SRCBLENDALPHA=207,y.prototype.RS_DESTBLENDALPHA=208,y.prototype.RS_BLENDOPALPHA=209,y.prototype.CULL_NONE=1,y.prototype.CULL_CW=2,y.prototype.CULL_CCW=3,y.prototype.CMP_NEVER=1,y.prototype.CMP_LESS=2,y.prototype.CMP_EQUAL=3,y.prototype.CMP_LEQUAL=4,y.prototype.CMP_GREATER=5,y.prototype.CMP_NOTEQUAL=6,y.prototype.CMP_GREATEREQUAL=7,y.prototype.CMP_ALWAYS=8,y.prototype.BLEND_ZERO=1,y.prototype.BLEND_ONE=2,y.prototype.BLEND_SRCCOLOR=3,y.prototype.BLEND_INVSRCCOLOR=4,y.prototype.BLEND_SRCALPHA=5,y.prototype.BLEND_INVSRCALPHA=6,y.prototype.BLEND_DESTALPHA=7,y.prototype.BLEND_INVDESTALPHA=8,y.prototype.BLEND_DESTCOLOR=9,y.prototype.BLEND_INVDESTCOLOR=10,y.prototype.BLEND_SRCALPHASAT=11,y.prototype.BLEND_BOTHSRCALPHA=12,y.prototype.BLEND_BOTHINVSRCALPHA=13,y.prototype.BLEND_BLENDFACTOR=14,y.prototype.BLEND_INVBLENDFACTOR=15,y.prototype.BLENDOP_ADD=1,y.prototype.BLENDOP_SUBTRACT=2,y.prototype.BLENDOP_REVSUBTRACT=3,y.prototype.BLENDOP_MIN=4,y.prototype.BLENDOP_MAX=5;t.device=new y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Curve=t.Tw2CurveKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.Tw2CurveKey=function e(){a(this,e),this._id=n.util.generateID(),this.name="",this.time=0};var s=t.Tw2Curve=function(){function e(){a(this,e),this._id=n.util.generateID(),this.name=""}return i(e,[{key:"Initialize",value:function(){this.Sort()}},{key:"Sort",value:function(){}},{key:"GetLength",value:function(){return 0}},{key:"UpdateValue",value:function(e){}}],[{key:"Compare",value:function(e,t){return e.time<t.time?-1:e.time>t.time?1:0}},{key:"Sort",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.keys;r&&r.length&&(r.sort(e.Compare),t.length=r[r.length-1].time)}},{key:"Sort2",value:function(t){if(t.keys&&t.keys.length){t.keys.sort(e.Compare);var r=t.keys[t.keys.length-1];if(r.time>t.length){var i=t.length,n=t.endValue,a=t.endTangent;t.length=r.time,t.endValue=r.value,t.endTangent=r.leftTangent,i>0&&(r.time=i,r.value=n,r.leftTangent=a)}}}}]),e}();s.inputDimension=null,s.outputDimension=null,s.valueProperty=null,s.curveType=null,s.Key=null,s.Interpolation=null,s.Extrapolation=null,s.Type={CURVE:1,CURVE2:2,CURVE_MAYA:3,CURVE_NO_KEYS:4,SEQUENCER:100,SEQUENCER2:101},s.global={vec3_0:n.vec3.create(),vec4_0:n.vec4.create(),quat_0:n.quat.create(),quat_1:n.quat.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resMan=t.Tw2LoadingObject=void 0;var i=r(6),n=r(11),a=r(34);var s=t.Tw2LoadingObject=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.object=null,e._redContents=null,e._inPrepare=null,e._objects=[],e._constructor=null,e._constructorFunction=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2Resource),t}();s.prototype.AddObject=function(e,t,r){return e._loadCallback=t,e._initialize=r,this._objects.push(e),!1},s.prototype.Prepare=function(e){if(null===e)return i.emitter.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Invalid XML",path:this.path,type:"xml.invalid"}),void this.PrepareFinished(!1);for(null===this._inPrepare&&(this._redContents=e,this._constructor=new a.Tw2ObjectReader(this._redContents),this._constructorFunction=null,this._inPrepare=0);this._inPrepare<this._objects.length;){try{this._objects[this._inPrepare]._loadCallback(this._constructor.Construct())}catch(e){i.emitter.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Error preparing resource",path:this.path,type:"prepare",err:e})}this._inPrepare++}o.motherLode.Remove(this.path),i.emitter.log("res.event",{msg:"Prepared  ",path:this.path,type:"prepared"}),this.PrepareFinished(!0)};var o=t.resMan=new function(){function e(e){return"str:/"===e.substr(0,5)?e:((e=e.toLowerCase()).replace("\\","/"),e)}function t(e){return function(){var t=0;try{t=this.readyState}catch(r){return i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","_DoLoadResource"],msg:"Communication error loading",path:e.path,type:"http.readystate",value:t}),e.LoadFinished(!1),void o._pendingLoads--}if(4===t){if(200===this.status){e.LoadFinished(!0);var r=null,n=null;try{r=this.responseText,n=this.responseXML}catch(e){r=this.response}o._prepareQueue.push([e,r,n])}else i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","_DoLoadResource"],msg:"Communication error loading",path:e.path,type:"http.status",value:this.status}),e.LoadFinished(!1);o._pendingLoads--}}}this.motherLode=new function(){this._loadedObjects={},this.Find=function(e){return e in this._loadedObjects?this._loadedObjects[e]:null},this.Add=function(e,t){this._loadedObjects[e]=t},this.Remove=function(e){delete this._loadedObjects[e]},this.Clear=function(){this._loadedObjects={}},this.UnloadAndClear=function(){for(var e in this._loadedObjects)this._loadedObjects.hasOwnProperty(e)&&this._loadedObjects[e].Unload();this._loadedObjects={}},this.PurgeInactive=function(e,t,r){for(var n in this._loadedObjects)if(this._loadedObjects.hasOwnProperty(n)){var a=this._loadedObjects[n];a.doNotPurge||(a._isPurged&&(i.emitter.log("res.event",{msg:"Unloaded  ",path:a.path,type:"purged"}),delete this._loadedObjects[n]),a._isGood&&(e-a.activeFrame)%t>=r&&a.Unload()&&(i.emitter.log("res.event",{msg:"Unloaded  ",path:a.path,type:"unused"}),delete this._loadedObjects[n]))}}},this.systemMirror=!1,this.maxPrepareTime=.05,this.prepareBudget=0,this.autoPurgeResources=!0,this.activeFrame=0,this.purgeTime=30,this._extensions={},this._resourcePaths={},this._constructors={},this._missingConstructors=[],this._prepareQueue=[],this._purgeTime=0,this._purgeFrame=0,this._purgeFrameLimit=1e3,this._pendingLoads=0,this._noLoadFrames=0,this.IsLoading=function(){return this._noLoadFrames<2},this._CreateHttpRequest=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return e||i.emitter.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Could not create an XMLHTTP instance",type:"http.instance"}),e},this.LogPathString=function(e){return"str:/"===e.substr(0,5)&&e.length>64?e.substr(0,64)+"...":e},this.PrepareLoop=function(e){0===this._prepareQueue.length&&0===this._pendingLoads?this._noLoadFrames<2&&this._noLoadFrames++:this._noLoadFrames=0,o.prepareBudget=o.maxPrepareTime;for(var t,r=Date.now();o._prepareQueue.length;){try{var n=o._prepareQueue[0][0].Prepare(o._prepareQueue[0][1],o._prepareQueue[0][2])}catch(e){throw o._prepareQueue.shift(),e}if(n||(t=Date.now(),i.emitter.log("res.event",{msg:"Prepared  ",path:o._prepareQueue[0][0].path,time:.001*(t-r),type:"prepared"}),o._prepareQueue.shift()),t=Date.now(),o.prepareBudget-=.001*(t-r),o.prepareBudget<0)break}return this._purgeTime+=e,this._purgeTime>1&&(this.activeFrame+=1,this._purgeTime-=Math.floor(this._purgeTime),this._purgeFrame+=1,this._purgeFrame>=5&&this.autoPurgeResources&&this.motherLode.PurgeInactive(this._purgeFrame,this._purgeFrameLimit,this.purgeTime)),!0},this.BuildUrl=function(e){var t=e.indexOf(":/");if(-1===t)return i.emitter.log("res.error",{log:"warn",src:["Tw2ResMan","BuildUrl"],msg:"Invalid path",type:"prefix.undefined",path:e}),e;var r=e.substr(0,t);return r in this._resourcePaths?this._resourcePaths[r]+e.substr(t+2):(i.emitter.log("res.error",{log:"warn",src:["Tw2ResMan","BuildUrl"],msg:"Unregistered path",path:e,type:"prefix.unregistered",value:r}),e)},this._LoadResource=function(e){e._isPurged=!1;var r=e.path;if(this.motherLode.Add(r,e),"DoCustomLoad"in e&&e.DoCustomLoad(r))return e;var n=this._CreateHttpRequest();n.onreadystatechange=t(e),i.emitter.log("res.event",{msg:"Requesting",path:r,type:"request"}),n.open("GET",this.BuildUrl(r)),e.requestResponseType&&(n.responseType=e.requestResponseType),e.LoadStarted();try{n.send(),this._pendingLoads++}catch(e){i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","_LoadResource"],msg:"Error requesting",path:r,type:"http.request",err:e})}},this.ReloadResource=function(e){var t=e.path;i.emitter.log("res.event",{msg:"Reloading ",path:t,type:"reload"});var r=this.motherLode.Find(t);return null===r||r.IsPurged()?(this._LoadResource(e),e):r},this.GetResource=function(t){var r;if(t=e(t),null!==(r=this.motherLode.Find(t)))return r.IsPurged()&&r.Reload(),r;var n=function(e){if("str:/"===e.substr(0,5)){var t=e.indexOf("/",5);return-1===t?null:e.substr(5,t-5)}var r=e.lastIndexOf(".");return-1===r?null:e.substr(r+1)}(t);return null===n?(i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","ReloadResource"],msg:"Undefined extension",type:"extension.undefined",path:this.LogPathString(t)}),null):n in this._extensions?((r=new this._extensions[n]).path=t,this._LoadResource(r),r):(i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","ReloadResource"],msg:"Unregistered extension",type:"extension.unregistered",path:this.LogPathString(t),value:n}),null)},this.GetObject=function(e,t){this._GetObject(e,t,!0)},this.GetObjectNoInitialize=function(e,t){this._GetObject(e,t,!1)},this._GetObject=function(r,n,a){r=e(r);var o={},l=this.motherLode.Find(r);if(null===l){(l=new s).path=r,l.AddObject(o,n,a),this.motherLode.Add(r,l);var c=this._CreateHttpRequest();c.onreadystatechange=t(l),i.emitter.log("res.event",{msg:"Requesting",path:this.BuildUrl(r),_path:r,type:"requesting"}),c.open("GET",this.BuildUrl(r)),c.responseType="arraybuffer",l.LoadStarted(),o._objectLoaded=!1;try{c.send(),this._pendingLoads++}catch(e){i.emitter.log("res.error",{log:"error",src:["Tw2ResMan","_GetObject"],msg:"Error sending object HTTP request",path:this.BuildUrl(r),_path:r,type:"http.request",err:e})}}else l.AddObject(o,n,a)},this.Clear=function(){this.motherLode.Clear()},this.UnloadAndClear=function(){this.motherLode.UnloadAndClear()};var r=function(e,t,r){if(r&&t&&t in e){r=Array.isArray(r)?r:[r];for(var i=0;i<r.length;i++)for(var n in r[i])r[i].hasOwnProperty(n)&&e[t](n,r[i][n]);return!0}return!1};this.RegisterConstructor=function(e,t){return e&&t&&"function"==typeof t?(this._constructors[e]=t,t):null},this.RegisterConstructors=function(e){r(this,"RegisterConstructor",e)},this.GetConstructor=function(e,t){if(e&&e in this._constructors)return this._constructors[e];if(e&&!t){if(-1===this._missingConstructors.indexOf(e)&&this._missingConstructors.push(e),e.includes("Tw2"))return this.GetConstructor(e.replace("Tw2","Tr2"),!0);if(e.includes("Tr2"))return this.GetConstructor(e.replace("Tr2","Tw2"),!0)}return null},this.RegisterExtension=function(e,t){return!(!e||!t||"function"!=typeof t||(this._extensions[e]=t,0))},this.RegisterExtensions=function(e){r(this,"RegisterExtension",e)},this.GetExtension=function(e){return e&&e in this._extensions?this._extensions[e]:null},this.RegisterResourcePath=function(e,t){return!(!e||!t||(this._resourcePaths[e]=t,0))},this.RegisterResourcePaths=function(e){r(this,"RegisterResourcePath",e)},this.GetResourcePath=function(e){return e&&e in this._resourcePaths?this._resourcePaths[e]:null},this.Register=function(e){e&&(this.RegisterConstructors(e.constructors),this.RegisterResourcePaths(e.resourcePaths),this.RegisterExtensions(e.extensions))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"ARRAY_TYPE",function(){return n}),t.setMatrixArrayType=function(e){n=e},t.toRadian=function(e){return e*s},t.equals=function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))};const i=1e-6;t.EPSILON=i;let n="undefined"!=typeof Float32Array?Float32Array:Array;const a=Math.random;t.RANDOM=a;const s=Math.PI/180},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.Tw2EventEmitter=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.Define(this)};i.prototype.on=function(e,t){return e=i.Register(this,e),-1===this._events[e].indexOf(t)&&this._events[e].push(t),this},i.prototype.once=function(e,t){e=i.Register(this,e);var r=this;return this.on(e,function i(){t.apply(void 0,arguments),r.off(e,i)}),this},i.prototype.emit=function(e){e=i.Register(this,e);for(var t=Array.prototype.slice.call(arguments),r=0;r<this._events[e].length;r++)this._events[e][r].apply(void 0,t);return this},i.prototype.off=function(e,t){if(e=e.toLowerCase(),"_events"in this&&e in this._events){var r=this._events[e].indexOf(t);-1!==r&&this._events[e].splice(r,1)}return this},i.prototype.remove=function(){var e=Array.prototype.slice.call(arguments);if(this._events)for(var t=0;t<e.length;t++)i.RemoveListener(this,e[t]);return this},i.Define=function(e){Object.defineProperty(e,"_events",{value:{},writable:!1})},i.Register=function(e,t){return"_events"in e||i.Define(e),(t=t.toLowerCase())in e._events||(e._events[t]=[]),t},i.HasListeners=function(e,t){return"_events"in e&&t in e._events&&e._events[t].length},i.HasListener=function(e,t){var r=[];if("_events"in e)for(var i in e._events){if(e._events.hasOwnProperty(i))-1!==e._events[i].indexOf(t)&&r.push(i)}return r},i.RemoveListener=function(e,t){if("_events"in e)for(var r in e._events)if(e._events.hasOwnProperty(r)){var i=e._events[r].indexOf(t);-1!==i&&e._events[r].splice(i,1)}},i.RemoveEvent=function(e,t){"_events"in e&&(t=t.toLowerCase())in e._events&&delete e._events[t]},i.Inherit=function(e,t,r){return t.on=e.on.bind(e),t.off=e.off.bind(e),t.once=e.once.bind(e),r||(t.emit=e.emit.bind(e)),t};var n=t.emitter=new i;n.consolePrefix="CCPWGL",n.consoleErrors=!0,n.consoleLogs=!0,n.consoleDefault="log",n.log=function(e,t){var r=!0,i=t.log;switch(i){case"throw":i="error",this.consoleErrors||(r=!1);break;case"error":case"warn":this.consoleErrors||(r=!1);break;case"debug":case"log":case"info":this.consoleLogs||(r=!1);break;default:i=this.consoleDefault,this.consoleLogs||(r=!1)}if(r){var n=t,a=this.consolePrefix.concat(": {",e,"}"),s=n.msg||"";n.path&&(s=s.concat(" '",n.path,"'","time"in n?" in "+n.time.toFixed(3)+"secs":"")),!n.type||"error"!==i&&"warn"!==i||(s=s.concat(" (",n.type,void 0!==n.value?":"+n.value:"",")")),"data"in n||"err"in n?(console.group(a),console[i](s),"data"in n&&console.dir(n.data),"err"in n&&console.debug(n.err.stack||n.err.toString()),console.groupEnd()):console[i](a,s)}this.emit(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(14);var a=t.Tw2CurveSequencer=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2Curve),i(t,null,[{key:"Sort",value:function(e){var t=e.functions;if(t&&t.length)for(var r=0;r<t.length;r++)t[r]&&"Sort"in t[r]&&t[r].Sort()}},{key:"Sort2",value:function(e){var t=e.constructor.childProperties;if(t)for(var r=0;r<t.length;r++){var i=e[t[r]];i&&"Sort"in i&&i.Sort()}}}]),t}();a.childProperties=null,a.childArray=null,a.Operator=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=r(54),a=r(55),s=r(29),o=r(56),l=r(57),c=r(58),u=r(30),h=r(31);r.d(t,"glMatrix",function(){return i}),r.d(t,"mat2",function(){return n}),r.d(t,"mat2d",function(){return a}),r.d(t,"mat3",function(){return s}),r.d(t,"mat4",function(){return o}),r.d(t,"quat",function(){return l}),r.d(t,"vec2",function(){return c}),r.d(t,"vec3",function(){return u}),r.d(t,"vec4",function(){return h})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);(t.Tw2ParticleForce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name=""}return i(e,[{key:"ApplyForce",value:function(e,t,r,i,n){}},{key:"Update",value:function(e){}}]),e}()).global={vec3_0:n.vec3.create(),vec3_1:n.vec3.create(),vec4_0:n.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChild=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);var a=t.EveChild=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.useSRT=!0,this.lowestLodVisible=2,this.staticTransform=!1,this.rotation=n.quat.create(),this.translation=n.vec3.create(),this.scaling=n.vec3.fromValues(1,1,1),this.localTransform=n.mat4.create(),this.worldTransform=n.mat4.create(),this.worldTransformLast=n.mat4.create(),this._perObjectData=null,this.isEffectChild=!0}return i(e,[{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e,t){this.useSRT&&(n.quat.normalize(this.rotation,this.rotation),n.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)),n.mat4.copy(this.worldTransformLast,this.worldTransform),n.mat4.multiply(this.worldTransform,t,this.localTransform)}},{key:"GetBatches",value:function(e,t){}}]),e}();a.perObjectDataDecl={FFEData:[{name:"world",size:16},{name:"worldInverseTranspose",size:16}]},a.global={mat4_0:n.mat4.create(),vec3_0:n.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Resource=void 0;var i=r(4);var n=t.Tw2Resource=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path="",this._isLoading=!1,this._isGood=!1,this._isPurged=!1,this._notifications=[],this.activeFrame=0,this.doNotPurge=0,this._onLoadStarted=null,this._onLoadFinished=null,this._onPrepareFinished=null};n.prototype.IsLoading=function(){return this.KeepAlive(),this._isLoading},n.prototype.IsGood=function(){return this.KeepAlive(),this._isGood},n.prototype.IsPurged=function(){return this._isPurged},n.prototype.LoadStarted=function(){this._isLoading=!0;for(var e=0;e<this._notifications.length;++e)this._notifications[e].ReleaseCachedData(this);this._onLoadStarted&&this._onLoadStarted(this)},n.prototype.LoadFinished=function(e){this._isLoading=!1,e||(this._isGood=!1),this._onLoadFinished&&this._onLoadFinished(this,e)},n.prototype.PrepareFinished=function(e){this._isLoading=!1,this._isGood=e;for(var t=0;t<this._notifications.length;++t)this._notifications[t].RebuildCachedData(this);this._onPrepareFinished&&this._onPrepareFinished(this,e)},n.prototype.SetIsGood=function(e){this._isGood=e},n.prototype.Unload=function(){},n.prototype.Reload=function(){this.Unload(),i.resMan.ReloadResource(this)},n.prototype.KeepAlive=function(){this.activeFrame=i.resMan.activeFrame,this._isPurged&&this.Reload()},n.prototype.RegisterNotification=function(e){for(var t=0;t<this._notifications.length;++t)if(this._notifications[t]===e)return;this._notifications[this._notifications.length]=e,this._isGood&&e.RebuildCachedData(this)},n.prototype.UnregisterNotification=function(e){for(var t=0;t<this._notifications.length;++t)if(this._notifications[t]===e)return void this._notifications.splice(t,1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VertexElement=a,t.Tw2VertexDeclaration=s;var i=r(2);function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.usage=e,this.usageIndex=t,this.type=r,this.elements=i,this.offset=n,this.location=null,this.customSetter=null}function s(e,t){this.elements=[],this._elementsSorted=[],void 0!==t&&(this.stride=t),e&&this.DeclareFromArray(e)}s.Type={POSITION:0,COLOR:1,NORMAL:2,TANGENT:3,BINORMAL:4,TEXCOORD:5,BLENDWEIGHT:6,BLENDINDICES:7},s.CompareDeclarationElements=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.usage<t.usage?-1:e.usage>t.usage?1:e.usageIndex+r<t.usageIndex?-1:e.usageIndex+r>t.usageIndex?1:0},s.prototype.RebuildHash=function(){this._elementsSorted=[];for(var e=0;e<this.elements.length;++e)this._elementsSorted[e]=this.elements[e];return this._elementsSorted.sort(s.CompareDeclarationElements),this},s.prototype.FindUsage=function(e,t){for(var r=0;r<this._elementsSorted.length;++r){var i=this._elementsSorted[r];if(i.usage===e){if(i.usageIndex===t)return i;if(i.usageIndex>t)return null}if(i.usage>e)return null}return null},s.prototype.SetDeclaration=function(e,t){for(var r=0,n=0;n<e._elementsSorted.length;++n){var a=e._elementsSorted[n];if(!(a.location<0))for(;;){if(r>=this._elementsSorted.length){i.device.gl.disableVertexAttribArray(a.location),i.device.gl.vertexAttrib4f(a.location,0,0,0,0);break}var o=this._elementsSorted[r],l=s.CompareDeclarationElements(o,a);if(l>0){i.device.gl.disableVertexAttribArray(a.location),i.device.gl.vertexAttrib4f(a.location,0,0,0,0);break}if(0===l){o.customSetter?o.customSetter(a):(i.device.gl.enableVertexAttribArray(a.location),i.device.gl.vertexAttribPointer(a.location,o.elements,o.type,!1,t,o.offset));break}r++}}return!0},s.prototype.SetPartialDeclaration=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=[];n=n||0;for(var o=0,l=0;l<e._elementsSorted.length;++l){var c=e._elementsSorted[l];if(!(c.location<0))for(;;){var u=this._elementsSorted[o],h=s.CompareDeclarationElements(u,c,r);if(0===h){u.customSetter?u.customSetter(c):(i.device.gl.enableVertexAttribArray(c.location),i.device.gl.vertexAttribPointer(c.location,u.elements,u.type,!1,t,u.offset),i.device.ext.vertexAttribDivisor(c.location,n),n&&a.push(c.location));break}if(h>0){n||(i.device.gl.disableVertexAttribArray(c.location),i.device.gl.vertexAttrib4f(c.location,0,0,0,0));break}if(++o>=this._elementsSorted.length)return n||(i.device.gl.disableVertexAttribArray(c.location),i.device.gl.vertexAttrib4f(c.location,0,0,0,0)),a}}return a},s.prototype.ResetInstanceDivisors=function(e){if(e)for(var t=0;t<e.length;++t)i.device.ext.vertexAttribDivisor(e[t],0)},s.prototype.DeclareFromArray=function(e){this.elements.length&&this.elements.splice(0,this.elements.length);for(var t=0;t<e.length;t++){var r=e[t];Array.isArray(r)?this.AddElement.apply(this,n(r)):this.AddElement(r.usage,r.usageIndex,r.type,r.elements,r.offset)}this.RebuildHash()},s.prototype.AddElement=function(e,t,r,n,o){"string"==typeof e&&(e=s.Type[e.toUpperCase()]),"string"==typeof r&&(r=i.device.gl[r.toUpperCase()]),this.elements.push(new a(e,t,r,n,o))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleElementDeclaration=t.Tw2ParticleElement=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(1);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.Tw2ParticleElement=function e(t){a(this,e),this.elementType=t.elementType,this.customName=t.customName,this.dimension=t.GetDimension(),this.usageIndex=t.usageIndex,this.usedByGPU=t.usedByGPU,this.buffer=null,this.startOffset=0,this.offset=0,this.instanceStride=0,this.vertexStride=0,this.dirty=!1};(t.Tw2ParticleElementDeclaration=function(){function e(){a(this,e),this.elementType=4,this.customName="",this.dimension=1,this.usageIndex=0,this.usedByGPU=!0}return i(e,[{key:"GetDimension",value:function(){switch(this.elementType){case e.Type.LIFETIME:return 2;case e.Type.POSITION:case e.Type.VELOCITY:return 3;case e.Type.MASS:return 1}return this.dimension}},{key:"GetDeclaration",value:function(){var t=void 0;switch(this.elementType){case e.Type.LIFETIME:t=n.Tw2VertexDeclaration.Type.TANGENT;break;case e.Type.POSITION:t=n.Tw2VertexDeclaration.Type.POSITION;break;case e.Type.VELOCITY:t=n.Tw2VertexDeclaration.Type.NORMAL;break;case e.Type.MASS:t=n.Tw2VertexDeclaration.Type.BINORMAL;break;default:t=n.Tw2VertexDeclaration.Type.TEXCOORD}return new n.Tw2VertexElement(t,this.usageIndex,n.device.gl.FLOAT,this.GetDimension())}}]),e}()).Type={LIFETIME:0,POSITION:1,VELOCITY:2,MASS:3,CUSTOM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(3);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(99);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(100);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(101);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(102);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(103);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(104);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var u=r(105);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var h=r(106);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var f=r(107);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var p=r(108);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var d=r(109);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var v=r(110);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var m=r(111);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var y=r(112);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveObject=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);(t.EveObject=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0}return i(e,[{key:"Initialize",value:function(){}},{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"UpdateViewDependantData",value:function(){}},{key:"Update",value:function(e){}},{key:"GetBatches",value:function(e,t){}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(4),s=r(6);var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._variables={},this._types={}}return i(e,[{key:"GetVariable",value:function(e){return e&&e in this._variables?this._variables[e]:null}},{key:"HasVariable",value:function(e){return e&&e in this._variables}},{key:"GetType",value:function(e){return(e=e.toLowerCase())&&e in this._types?this._types[e]:null}},{key:"GetTypeFromValue",value:function(e){for(var t in this._types)if(this._types.hasOwnProperty(t)){var r=this._types[t];if(r.is&&r.is(e))return r}return null}},{key:"CreateType",value:function(e,t,r){return r?"string"==typeof r&&(r=this.GetType(r)):r=this.GetTypeFromValue(t),r?new r(e,t):null}},{key:"RegisterVariable",value:function(e,t,r){if(!this.HasVariable(e)){var i=this.CreateType(e,t,r);i&&(this._variables[e]=i,s.emitter.log("store.registered",{log:"debug",msg:"Registered Variable: "+e}))}return e in this._variables?this._variables[e]:null}},{key:"RegisterType",value:function(e,t){return(e=e.toLowerCase())&&"function"==typeof t&&!this._types[e]&&(this._types[e]=t,s.emitter.log("store.registered",{log:"debug",msg:"Registered Type: "+e})),e in this._types?this._types[e]:null}},{key:"RegisterVariables",value:function(t){e.toKeyValue(this,"RegisterVariable",t)}},{key:"RegisterTypes",value:function(t){e.toKeyValue(this,"RegisterType",t)}},{key:"Register",value:function(e){e&&(e.uuid&&(n.util.generateID=n.util.generateUUID),this.RegisterTypes(e.types),this.RegisterVariables(e.variables),a.resMan.Register(e))}}],[{key:"toKeyValue",value:function(e,t,r){if(r&&t&&t in e){r=Array.isArray(r)?r:[r];for(var i=0;i<r.length;i++)for(var n in r[i])r[i].hasOwnProperty(n)&&e[t](n,r[i][n])}}}]),e}();t.store=new o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureParameter=s;var i=r(4),n=r(2),a=r(19);function s(e,t){this.name=void 0!==e?e:"",this.useAllOverrides=!1,this.addressUMode=1,this.addressVMode=1,this.addressWMode=1,this.filterMode=2,this.mipFilterMode=2,this.maxAnisotropy=4,this.textureRes=null,this._sampler=null,void 0!==t?(this.resourcePath=t,this.Initialize()):this.resourcePath=""}s.prototype.GetResource=function(e){return void 0===e&&(e=[]),null!==this.textureRes&&-1===e.indexOf(this.textureRes)&&e.push(this.textureRes),e},s.prototype.SetTexturePath=function(e){this.resourcePath=e,""!==this.resourcePath&&(this.textureRes=i.resMan.GetResource(this.resourcePath))},s.prototype.Initialize=function(){if(""!==this.resourcePath&&(this.textureRes=i.resMan.GetResource(this.resourcePath)),this.useAllOverrides){if(this._sampler=new a.Tw2SamplerState,1===this.filterMode){switch(this.mipFilterMode){case 0:this._sampler.minFilter=n.device.gl.NEAREST;break;case 1:this._sampler.minFilter=n.device.gl.NEAREST_MIPMAP_NEAREST;break;default:this._sampler.minFilter=n.device.gl.NEAREST_MIPMAP_LINEAR}this._sampler.minFilterNoMips=n.device.gl.NEAREST,this._sampler.magFilter=n.device.gl.NEAREST}else{switch(this.mipFilterMode){case 0:this._sampler.minFilter=n.device.gl.LINEAR;break;case 1:this._sampler.minFilter=n.device.gl.LINEAR_MIPMAP_NEAREST;break;default:this._sampler.minFilter=n.device.gl.LINEAR_MIPMAP_LINEAR}this._sampler.minFilterNoMips=n.device.gl.LINEAR,this._sampler.magFilter=n.device.gl.LINEAR}this._sampler.addressU=n.device.wrapModes[this.addressUMode],this._sampler.addressV=n.device.wrapModes[this.addressVMode],this._sampler.addressW=n.device.wrapModes[this.addressWMode],this._sampler.anisotropy=this.maxAnisotropy,this._sampler.ComputeHash()}},s.prototype.Apply=function(e,t,r){this.textureRes&&(this.useAllOverrides&&(this._sampler.samplerType=t.samplerType,this._sampler.isVolume=t.isVolume,this._sampler.registerIndex=t.registerIndex,t=this._sampler),n.device.gl.activeTexture(n.device.gl.TEXTURE0+e),this.textureRes.Bind(t,r))},s.prototype.GetValue=function(){return this.textureRes?this.textureRes.path:this.resourcePath},s.is=function(e){return"string"==typeof e}},function(e,t,r){"use strict";function i(e){this.data=e,this.cursor=0}Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BinaryReader=i,i.prototype.ReadUInt8=function(){return this.data[this.cursor++]},i.prototype.ReadInt8=function(){var e=this.data[this.cursor++];return e>127&&(e=e-255-1),e},i.prototype.ReadUInt16=function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)},i.prototype.ReadInt16=function(){var e=this.data[this.cursor++]+(this.data[this.cursor++]<<8);return e>32767&&(e=e-65535-1),e},i.prototype.ReadUInt32=function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0)},i.prototype.ReadInt32=function(){var e=this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0);return e>2147483647&&(e=e-4294967295-1),e},i.prototype.ReadFloat16=function(){var e=this.data[this.cursor++],t=this.data[this.cursor++],r=(t>>2&31)-15,i=(3&t)<<8|e;return 0===i&&-15===r?0:(1-2*(t>>7))*(1+i*Math.pow(2,-10))*Math.pow(2,r)},i.prototype.ReadFloat32=function(){var e=this.data[this.cursor++],t=this.data[this.cursor++],r=this.data[this.cursor++],i=this.data[this.cursor++],n=(i<<1&255|r>>7)-127,a=(127&r)<<16|t<<8|e;return 0===a&&-127===n?0:(1-2*(i>>7))*(1+a*Math.pow(2,-23))*Math.pow(2,n)},i.prototype.ReadString=function(){for(var e=this.data[this.cursor++],t="",r=0;r<e;++r)t+=String.fromCharCode(this.data[this.cursor++]);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SamplerOverride=function(){this.name="",this.addressU=0,this.addressV=0,this.addressW=0,this.filter=0,this.mipFilter=0,this.lodBias=0,this.maxMipLevel=0,this.maxAnisotropy=0;var e=null;this.GetSampler=function(t){if(!e){if((e=new n).registerIndex=t.registerIndex,e.name=t.name,1===this.filter){switch(this.mipFilter){case 0:e.minFilter=i.device.gl.NEAREST;break;case 1:e.minFilter=i.device.gl.NEAREST_MIPMAP_NEAREST;break;default:e.minFilter=i.device.gl.NEAREST_MIPMAP_LINEAR}e.minFilterNoMips=i.device.gl.NEAREST}else{switch(this.mipFilter){case 0:e.minFilter=i.device.gl.LINEAR;break;case 1:e.minFilter=i.device.gl.LINEAR_MIPMAP_NEAREST;break;default:e.minFilter=i.device.gl.LINEAR_MIPMAP_LINEAR}e.minFilterNoMips=i.device.gl.LINEAR}1===this.filter?e.magFilter=i.device.gl.NEAREST:e.magFilter=i.device.gl.LINEAR;var r=[0,i.device.gl.REPEAT,i.device.gl.MIRRORED_REPEAT,i.device.gl.CLAMP_TO_EDGE,i.device.gl.CLAMP_TO_EDGE,i.device.gl.CLAMP_TO_EDGE];e.addressU=r[this.addressU],e.addressV=r[this.addressV],e.addressW=r[this.addressW],3!==this.filter&&3!==this.mipFilter||(e.anisotropy=Math.max(this.maxAnisotropy,1)),e.samplerType=t.samplerType,e.isVolume=t.isVolume,e.ComputeHash()}return e}},t.Tw2SamplerState=n;var i=r(2);function n(){this.registerIndex=0,this.name="",this.minFilter=i.device.gl.LINEAR,this.maxFilter=i.device.gl.LINEAR,this.minFilterNoMips=i.device.gl.LINEAR,this.addressU=i.device.gl.REPEAT,this.addressV=i.device.gl.REPEAT,this.addressW=i.device.gl.REPEAT,this.anisotropy=1,this.samplerType=i.device.gl.TEXTURE_2D,this.isVolume=!1,this.hash=0}n.prototype.ComputeHash=function(){this.hash=2166136261,this.hash*=16777619,this.hash^=this.minFilter,this.hash*=16777619,this.hash^=this.maxFilter,this.hash*=16777619,this.hash^=this.addressU,this.hash*=16777619,this.hash^=this.addressV,this.hash*=16777619,this.hash^=this.anisotropy},n.prototype.Apply=function(e){var t=this.samplerType,r=i.device,n=r.gl;n.texParameteri(t,n.TEXTURE_WRAP_S,e?this.addressU:n.CLAMP_TO_EDGE),n.texParameteri(t,n.TEXTURE_WRAP_T,e?this.addressV:n.CLAMP_TO_EDGE),n.texParameteri(t,n.TEXTURE_MIN_FILTER,e?this.minFilter:this.minFilterNoMips),n.texParameteri(t,n.TEXTURE_MAG_FILTER,this.magFilter),r.ext.AnisotropicFilter&&r.enableAnisotropicFiltering&&n.texParameterf(t,r.ext.AnisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropy,r.ext.AnisotropicFilter.maxAnisotropy))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Effect=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(4),s=r(2),o=r(16),l=r(17);(t.Tw2Effect=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.effectFilePath="",this.effectRes=null,this.parameters={},this.passes=[],this.samplerOverrides=[],this.autoParameter=!1}return i(e,[{key:"Initialize",value:function(){if(""!==this.effectFilePath){this.effectFilePath=this.effectFilePath.toLowerCase();var t=e.ToEffectResPath(this.effectFilePath);this.effectRes=a.resMan.GetResource(t),this.effectRes.RegisterNotification(this)}}},{key:"IsGood",value:function(){return this.effectRes&&this.effectRes.IsGood()}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var t in this.effectRes&&!e.includes(this.effectRes)&&e.push(this.effectRes),this.parameters)this.parameters.hasOwnProperty(t)&&"GetResources"in this.parameters[t]&&this.parameters[t].GetResources(e);return e}},{key:"GetEffectRes",value:function(){return this.effectRes}},{key:"RebuildCachedData",value:function(e){e.IsGood()&&(this.effectRes=e,this.BindParameters())}},{key:"UnbindParameters",value:function(){for(var e=0;e<this.passes.length;++e)for(var t=0;t<this.passes[e].stages.length;++t)for(var r=0;r<this.passes[e].stages[t].reroutedParameters.length;++r){var i=this.passes[e].stages[t].reroutedParameters[r];i.Unbind&&i.Unbind()}this.passes=[]}},{key:"BindParameters",value:function(){if(this.UnbindParameters(),!this.IsGood())return!1;for(var t=0;t<this.effectRes.passes.length;++t){var r=[];r.stages=[];for(var i=0;i<this.effectRes.passes[t].stages.length;++i){var n=this.effectRes.passes[t].stages[i],a={};a.constantBuffer=new Float32Array(n.constantSize),a.reroutedParameters=[],a.parameters=[],a.textures=[],a.constantBuffer.set(n.constantValues);for(var c=0;c<n.constants.length;++c)if(!e.ConstantIgnore.includes(n.constants[c].name)){var u=n.constants[c],h=u.name;if(h in this.parameters){var f=this.parameters[h];if(f.Bind(a.constantBuffer,u.offset,u.size))a.reroutedParameters.push(f);else{var p={};p.parameter=f,p.constantBuffer=a.constantBuffer,p.offset=u.offset,p.size=u.size,a.parameters.push(p)}}else if(o.store.HasVariable(h)){var d={};d.parameter=o.store.GetVariable(h),d.constantBuffer=a.constantBuffer,d.offset=u.offset,d.size=u.size,a.parameters.push(d)}else if(u.isAutoregister){var v=o.store.RegisterVariable(h,void 0,u.Type);if(v){var m={};m.parameter=v,m.constantBuffer=a.constantBuffer,m.offset=u.offset,m.size=u.size,a.parameters.push(m)}}else if(this.autoParameter&&1===u.elements){var y=n.constantValues.subarray(u.offset,u.offset+u.size),b=o.store.CreateType(h,y,u.Type);if(!b){var g=o.store.GetTypeFromValue(1===u.size?1:new Array(u.size));g&&(b=new g(h))}if(b){console.dir(b),this.parameters[h]=b;var _={};_.parameter=b,_.constantBuffer=a.constantBuffer,_.offset=u.offset,_.size=u.size,a.parameters.push(_)}}}for(var E=0;E<n.textures.length;++E){var T=n.textures[E].name,R=void 0;if(T in this.parameters)R=this.parameters[T];else if(o.store.HasVariable(T))R=o.store.GetVariable(T);else if(n.textures[E].isAutoregister)R=o.store.RegisterVariable(T,void 0,l.Tw2TextureParameter);else{if(!this.autoParameter)continue;this.parameters[T]=new l.Tw2TextureParameter(T),R=this.parameters[T]}var S={};S.parameter=R,S.slot=n.textures[E].registerIndex,S.sampler=null;for(var w=0;w<n.samplers.length;++w)if(n.samplers[w].registerIndex===S.slot){n.samplers[w].name in this.samplerOverrides?S.sampler=this.samplerOverrides[n.samplers[w].name].GetSampler(n.samplers[w]):S.sampler=n.samplers[w];break}0===i&&(S.slot+=12),a.textures.push(S)}r.stages.push(a)}this.passes.push(r)}return s.device.effectObserver&&s.device.effectObserver.OnEffectChanged(this),!0}},{key:"ApplyPass",value:function(e){if(this.IsGood()&&!(e>=this.passes.length)){this.effectRes.ApplyPass(e);for(var t=this.passes[e],r=this.effectRes.passes[e],i=s.device,n=i.IsAlphaTestEnabled()&&r.shadowShaderProgram?r.shadowShaderProgram:r.shaderProgram,a=0;a<2;++a){for(var o=t.stages[a],l=0;l<o.parameters.length;++l){var c=o.parameters[l];c.parameter.Apply(c.constantBuffer,c.offset,c.size)}for(var u=0;u<o.textures.length;++u){var h=o.textures[u];h.parameter.Apply(h.slot,h.sampler,n.volumeSlices[h.sampler.registerIndex])}}var f=n.constantBufferHandles;f[0]&&i.gl.uniform4fv(f[0],t.stages[0].constantBuffer),f[7]&&i.gl.uniform4fv(f[7],t.stages[1].constantBuffer),i.perFrameVSData&&f[1]&&i.gl.uniform4fv(f[1],i.perFrameVSData.data),i.perFramePSData&&f[2]&&i.gl.uniform4fv(f[2],i.perFramePSData.data),i.perObjectData&&i.perObjectData.SetPerObjectDataToDevice(f)}}},{key:"GetPassCount",value:function(){return this.IsGood()?this.passes.length:0}},{key:"GetPassInput",value:function(e){return!this.IsGood()||e>=this.passes.length?null:s.device.IsAlphaTestEnabled()&&this.effectRes.passes[e].shadowShaderProgram?this.effectRes.passes[e].shadowShaderProgram.input:this.effectRes.passes[e].shaderProgram.input}},{key:"Render",value:function(e){for(var t=this.GetPassCount(),r=0;r<t;++r)this.ApplyPass(r),e(this,r)}},{key:"GetTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)if(this.parameters.hasOwnProperty(t)&&this.parameters[t]instanceof l.Tw2TextureParameter){var r=this.parameters[t].GetValue();r&&(e[t]=r)}return e}},{key:"SetTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,r=!1;for(var i in e)e.hasOwnProperty(i)&&(i in this.parameters?this.parameters.SetValue(e[i])&&(t=!0):(this.parameters[i]=new l.Tw2TextureParameter(i,e[i]),t=!0,r=!0));return this.IsGood()&&r&&this.BindParameters(),t}},{key:"GetParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)!this.parameters.hasOwnProperty(t)||this.parameters[t]instanceof l.Tw2TextureParameter||(e[t]=this.parameters[t].GetValue(!0));return e}},{key:"SetParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,r=!1;for(var i in e)if(e.hasOwnProperty(i))if(i in this.parameters)this.parameters[i].SetValue(e[i])&&(t=!0);else{var n=o.store.CreateType(i,e[i]);n&&(this.parameters[i]=n,r=!0,t=!0)}return r&&this.BindParameters(),t}},{key:"SetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)e.hasOwnProperty(r)&&r in this.parameters&&"SetOverrides"in this.parameters[r]&&(this.parameters[r].SetOverrides(e[r]),t=!0);return t}},{key:"GetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)this.parameters.hasOwnProperty(t)&&"GetOverrides"in this.parameters[t]&&this.parameters[t].useAllOverrides&&(e[t]=this.parameters[t].GetOverrides());return e}}],[{key:"ToEffectResPath",value:function(e){return e?e.substr(0,e.lastIndexOf(".")).replace("/effect/",s.device.effectDir)+".sm_"+s.device.shaderModel:""}},{key:"FromEffectResPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fx";return e.substr(0,e.lastIndexOf(".")).replace(s.device.effectDir,"/effect/")+"."+t}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new e;return t.name&&(r.name=t.name),t.effectFilePath&&(r.effectFilePath=t.effectFilePath),t.parameters&&r.SetParameters(t.parameters),t.textures&&r.SetTextures(t.textures),t.overrides&&r.SetOverrides(t.overrides),"autoParameter"in t&&(r.autoParameter=t.autoParameter),r.Initialize(),r}}]),e}()).ConstantIgnore=["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS","PerObjectPSInt"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.Tw2RawData=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nextOffset=0,this.data=null,this.elements={},t&&this.DeclareFromArray(t,r)}return i(e,[{key:"Set",value:function(e,t){var r=this.elements[e];"number"!=typeof t&&t.length>r.size&&(t="subarray"in t?t.subarray(0,r.size):t.splice(0,r.size)),this.data.set(t,r.offset)}},{key:"Get",value:function(e){return this.elements[e].array}},{key:"GetData",value:function(e){return this.data.subarray(this.elements[e].offset,this.elements[e].offset+this.elements[e].array.length)}},{key:"Declare",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.elements[e]={offset:this.nextOffset,size:t,array:null,value:r},this.nextOffset+=t}},{key:"Create",value:function(){for(var e in this.data=new Float32Array(this.nextOffset),this.elements)if(this.elements.hasOwnProperty(e)){var t=this.elements[e];if(t.array=this.data.subarray(t.offset,t.offset+t.size),null!==t.value){if(1===t.size)t.array[0]=t.value;else for(var r=0;r<t.size;r++)t.array[r]=t.value[r];t.value=null}}}},{key:"DeclareFromArray",value:function(e,t){if(e){for(var r=0;r<e.length;r++){var i=e[r];this.Declare(i.name,i.size,i.value)}t||this.Create()}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryRes=t.Tw2GeometryLineBatch=t.Tw2GeometryBatch=void 0,t.Tw2GeometryMeshArea=d,t.Tw2GeometryMeshBinding=v,t.Tw2GeometryModel=m,t.Tw2GeometrySkeleton=y,t.Tw2GeometryBone=b,t.Tw2GeometryAnimation=g,t.Tw2GeometryTrackGroup=_,t.Tw2GeometryTransformTrack=E,t.Tw2GeometryCurve=T,t.Tw2BlendShapeData=R,t.Tw2GeometryMesh=S;var i=r(0),n=r(4),a=r(2),s=r(6),o=r(11),l=r(18),c=r(23),u=r(12);function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(){this.name="",this.start=0,this.count=0,this.minBounds=i.vec3.create(),this.maxBounds=i.vec3.create(),this.boundsSpherePosition=i.vec3.create(),this.boundsSphereRadius=0}function v(){this.mesh=null,this.bones=[]}function m(){this.name="",this.meshBindings=[],this.skeleton=null}function y(){this.bones=[]}function b(){this.name="",this.parentIndex=-1,this.position=i.vec3.create(),this.orientation=i.quat.create(),this.scaleShear=i.mat3.create(),this.localTransform=i.mat4.create(),this.worldTransform=i.mat4.create(),this.worldTransformInv=i.mat4.create()}function g(){this.name="",this.duration=0,this.trackGroups=[]}function _(){this.name="",this.model=null,this.transformTracks=[]}function E(){this.name="",this.position=null,this.orientation=null,this.scaleShear=null}function T(){this.dimension=0,this.degree=0,this.knots=null,this.controls=null}function R(){this.name="",this.declaration=new u.Tw2VertexDeclaration,this.buffers=[],this.indexes=null,this.weightProxy=null}function S(){this.name="",this.declaration=new u.Tw2VertexDeclaration,this.areas=[],this.buffer=null,this.bufferLength=0,this.bufferData=null,this.indexes=null,this.indexData=null,this.indexType=0,this.minBounds=i.vec3.create(),this.maxBounds=i.vec3.create(),this.boundsSpherePosition=i.vec3.create(),this.boundsSphereRadius=0,this.bones=[],this.boneBindings=[]}(t.Tw2GeometryBatch=function(e){function t(){h(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryRes=null,e.meshIx=0,e.start=0,e.count=1,e.effect=null,e}return p(t,c.Tw2RenderBatch),t}()).prototype.Commit=function(e){var t=void 0===e?this.effect:e;this.geometryRes&&t&&this.geometryRes.RenderAreas(this.meshIx,this.start,this.count,t)},(t.Tw2GeometryLineBatch=function(e){function t(){h(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryRes=null,e.meshIx=0,e.start=0,e.count=1,e.effect=null,e}return p(t,c.Tw2RenderBatch),t}()).prototype.Commit=function(e){var t=void 0===e?this.effect:e;this.geometryRes&&t&&this.geometryRes.RenderLines(this.meshIx,this.start,this.count,t)},m.prototype.FindBoneByName=function(e){if(null===this.skeleton)return null;for(var t=0;t<this.skeleton.bones.length;++t)if(this.skeleton.bones[t].name===e)return this.skeleton.bones[t];return null},b.scratch={mat4_0:i.mat4.create()},b.prototype.UpdateTransform=function(){var e=this.localTransform,t=this.scaleShear;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,i.quat.normalize(this.orientation,this.orientation);var r=i.mat4.fromQuat(b.scratch.mat4_0,this.orientation);return i.mat4.multiply(this.localTransform,this.localTransform,r),this.localTransform[12]=this.position[0],this.localTransform[13]=this.position[1],this.localTransform[14]=this.position[2],this.localTransform};var w=t.Tw2GeometryRes=function(e){function t(){h(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.meshes=[],e.minBounds=i.vec3.create(),e.maxBounds=i.vec3.create(),e.boundsSpherePosition=i.vec3.create(),e.boundsSphereRadius=0,e.models=[],e.animations=[],e.systemMirror=n.resMan.systemMirror,e}return p(t,o.Tw2Resource),t}();w.prototype.requestResponseType="arraybuffer",w.prototype.GetInstanceBuffer=function(e){return e<this.meshes.length?this.meshes[e].buffer:void 0},w.prototype.GetInstanceDeclaration=function(e){return this.meshes[e].declaration},w.prototype.GetInstanceStride=function(e){return this.meshes[e].declaration.stride},w.prototype.GetInstanceCount=function(e){return 4*this.meshes[e].bufferLength/this.meshes[e].declaration.stride},w.prototype.Prepare=function(e){var t=new l.Tw2BinaryReader(new Uint8Array(e)),r=this;function n(e){var i,n,o=t.ReadUInt8(),l=0;for(i=0;i<o;++i){var c=new u.Tw2VertexElement;c.usage=t.ReadUInt8(),c.usageIndex=t.ReadUInt8(),c.fileType=t.ReadUInt8(),c.type=a.device.gl.FLOAT,c.elements=1+(c.fileType>>5),c.offset=4*l,e.elements[i]=c,l+=c.elements}e.RebuildHash(),e.stride=4*l;var h=t.ReadUInt32();if(0===h)return null;for(var f=new Float32Array(l*h),p=0,d=0;d<h;++d)for(i=0;i<o;++i){var v=e.elements[i];switch(15&v.fileType){case 0:if(16&v.fileType)for(n=0;n<v.elements;++n)f[p++]=t.ReadInt8()/127;else for(n=0;n<v.elements;++n)f[p++]=t.ReadInt8();break;case 1:if(16&v.fileType)for(n=0;n<v.elements;++n)f[p++]=t.ReadInt8()/32767;else for(n=0;n<v.elements;++n)f[p++]=t.ReadInt16();break;case 2:for(n=0;n<v.elements;++n)f[p++]=t.ReadInt32();break;case 3:for(n=0;n<v.elements;++n)f[p++]=t.ReadFloat16();break;case 4:for(n=0;n<v.elements;++n)f[p++]=t.ReadFloat32();break;case 8:if(16&v.fileType)for(n=0;n<v.elements;++n)f[p++]=t.ReadUInt8()/255;else for(n=0;n<v.elements;++n)f[p++]=t.ReadUInt8();break;case 9:if(16&v.fileType)for(n=0;n<e.elements[i].elements;++n)f[p++]=t.ReadUInt8()/65535;else for(n=0;n<v.elements;++n)f[p++]=t.ReadUInt16();break;case 10:for(n=0;n<v.elements;++n)f[p++]=t.ReadUInt32();break;default:throw s.emitter.log("res.error",{log:"error",src:["Tw2GeometryRes","ReadVertexBuffer"],msg:"Error loading wbg data",path:r.path,type:"geometry.filetype",value:15&v.fileType}),1}}return f}function o(){var e,r,i=t.ReadUInt8(),n=t.ReadUInt32();if(0===i){for(e=new Uint16Array(n),r=0;r<n;++r)e[r]=t.ReadUInt16();return e}for(e=new Uint32Array(n),r=0;r<n;++r)e[r]=t.ReadUInt32();return e}t.ReadUInt8();for(var c=t.ReadUInt8(),h=0;h<c;++h){var f=new S;f.name=t.ReadString();var p,v,O,A=n(f.declaration);A?(f.bufferLength=A.length,f.buffer=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,f.buffer),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,A,a.device.gl.STATIC_DRAW)):f.buffer=null;var P=o();P?(f.indexes=a.device.gl.createBuffer(),f.indexType=2===P.BYTES_PER_ELEMENT?a.device.gl.UNSIGNED_SHORT:a.device.gl.UNSIGNED_INT,a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,f.indexes),a.device.gl.bufferData(a.device.gl.ELEMENT_ARRAY_BUFFER,P,a.device.gl.STATIC_DRAW)):f.indexes=null;var M=t.ReadUInt8();for(p=0;p<M;++p)f.areas[p]=new d,f.areas[p].name=t.ReadString(),f.areas[p].start=t.ReadUInt32()*P.BYTES_PER_ELEMENT,f.areas[p].count=3*t.ReadUInt32(),f.areas[p].minBounds=i.vec3.fromValues(t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32()),f.areas[p].maxBounds=i.vec3.fromValues(t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32());var D=t.ReadUInt8();for(f.boneBindings=[],p=0;p<D;++p)f.boneBindings[p]=t.ReadString();var I=t.ReadUInt16();if((I||this.systemMirror)&&(f.bufferData=A,f.indexData=P),I)for(f.blendShapes=[],p=0;p<I;++p)f.blendShapes[p]=new R,f.blendShapes[p].name=t.ReadString(),f.blendShapes[p].buffer=n(f.blendShapes[p].declaration),f.blendShapes[p].indexes=o();this.meshes[h]=f}for(var C=t.ReadUInt8(),j=0;j<C;++j){var x=new m;x.name=t.ReadString(),x.skeleton=new y;var L=t.ReadUInt8();for(v=0;v<L;++v){var B=new b;B.name=t.ReadString();var F=t.ReadUInt8();if(B.parentIndex=t.ReadUInt8(),255===B.parentIndex&&(B.parentIndex=-1),1&F?i.vec3.set(B.position,t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32()):i.vec3.set(B.position,0,0,0),2&F?i.quat.set(B.orientation,t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32()):i.quat.identity(B.orientation),4&F)for(O=0;O<9;++O)B.scaleShear[O]=t.ReadFloat32();else i.mat3.identity(B.scaleShear);x.skeleton.bones[v]=B}for(v=0;v<x.skeleton.bones.length;++v)x.skeleton.bones[v].UpdateTransform(),-1!==x.skeleton.bones[v].parentIndex?i.mat4.multiply(x.skeleton.bones[v].worldTransform,x.skeleton.bones[x.skeleton.bones[v].parentIndex].worldTransform,x.skeleton.bones[v].localTransform):i.mat4.copy(x.skeleton.bones[v].worldTransform,x.skeleton.bones[v].localTransform),i.mat4.invert(x.skeleton.bones[v].worldTransformInv,x.skeleton.bones[v].worldTransform);var k=t.ReadUInt8();for(v=0;v<k;++v)(f=t.ReadUInt8())<this.meshes.length&&w.BindMeshToModel(this.meshes[f],x);this.models[this.models.length]=x}function N(){if(0===t.ReadUInt8())return null;var e=t.ReadUInt8(),r=new T;r.dimension=e,r.degree=t.ReadUInt8();var i=t.ReadUInt32();r.knots=new Float32Array(i);for(var n=0;n<i;++n)r.knots[n]=t.ReadFloat32();var a=t.ReadUInt32();for(r.controls=new Float32Array(a),n=0;n<a;++n)r.controls[n]=t.ReadFloat32();return r}var G=t.ReadUInt8();for(p=0;p<G;++p){var V=new g;V.name=t.ReadString(),V.duration=t.ReadFloat32();var U=t.ReadUInt8();for(v=0;v<U;++v){var z=new _;z.name=t.ReadString();for(var q=0;q<this.models.length;++q)if(this.models[q].name===z.name){z.model=this.models[q];break}var Y=t.ReadUInt8();for(O=0;O<Y;++O){var H=new E;if(H.name=t.ReadString(),H.orientation=N(),H.position=N(),H.scaleShear=N(),H.orientation)for(var W=0,X=0,K=0,Q=0,Z=0;Z<H.orientation.controls.length;Z+=4){var J=H.orientation.controls[Z],$=H.orientation.controls[Z+1],ee=H.orientation.controls[Z+2],te=H.orientation.controls[Z+3];W*J+X*$+K*ee+Q*te<0&&(H.orientation.controls[Z]=-J,H.orientation.controls[Z+1]=-$,H.orientation.controls[Z+2]=-ee,H.orientation.controls[Z+3]=-te),W=J,X=$,K=ee,Q=te}z.transformTracks[z.transformTracks.length]=H}V.trackGroups[V.trackGroups.length]=z}this.animations[this.animations.length]=V}this.PrepareFinished(!0)},w.BindMeshToModel=function(e,t){var r=new v;r.mesh=e;for(var i=0;i<r.mesh.boneBindings.length;++i){var n=r.mesh.boneBindings[i],a=t.FindBoneByName(n);null===a?s.emitter.log("res.error",{log:"error",src:["Tw2GeometryRes","BindMeshToModel"],msg:"Mesh has invalid bone name for model",path:this.path,type:"geometry.invalidbone",data:{mesh:r.mesh.name,bone:n,model:t.name}}):r.bones[r.bones.length]=a}t.meshBindings[t.meshBindings.length]=r},w.prototype.RenderAreasInstanced=function(e,t,r,i,n,s,o,l){if(this.KeepAlive(),!this._isGood)return!1;if(!i.GetEffectRes()._isGood)return!1;var c=a.device,u=this.meshes[e];c.gl.bindBuffer(c.gl.ELEMENT_ARRAY_BUFFER,u.indexes);for(var h,f,p=i.GetPassCount(),d=0;d<p;++d){i.ApplyPass(d);var v=i.GetPassInput(d);if(0!==v.elements.length){c.gl.bindBuffer(c.gl.ARRAY_BUFFER,u.buffer),u.declaration.SetPartialDeclaration(v,u.declaration.stride),c.gl.bindBuffer(c.gl.ARRAY_BUFFER,n);var m=s.SetPartialDeclaration(v,o,8,1);for(c.ApplyShadowState(),h=0;h<r;++h)if(h+t<u.areas.length){for(var y=(f=u.areas[h+t]).start,b=f.count;h+1<r&&(f=u.areas[h+1+t]).start===y+2*b;)b+=f.count,++h;c.ext.drawElementsInstanced(c.gl.TRIANGLES,b,u.indexType,y,l)}s.ResetInstanceDivisors(m)}}return!0},w.prototype.RenderAreas=function(e,t,r,i,n){if(this.KeepAlive(),!this._isGood)return!1;if(!i.GetEffectRes()._isGood)return!1;var o=a.device,l=this.meshes[e]||this.meshes[0];o.gl.bindBuffer(o.gl.ARRAY_BUFFER,l.buffer),o.gl.bindBuffer(o.gl.ELEMENT_ARRAY_BUFFER,l.indexes);for(var c,u,h=i.GetPassCount(),f=0;f<h;++f){i.ApplyPass(f);var p=i.GetPassInput(f);if(!l.declaration.SetDeclaration(p,l.declaration.stride))return s.emitter.log("res.error",{log:"error",src:["Tw2GeometryRes","RenderLines"],msg:"Error binding mesh to effect",path:this.path,type:"geometry.meshbind",data:{pass:f,passInput:p,meshStride:l.declaration.stride}}),!1;if(o.ApplyShadowState(),void 0!==n){var d=[];for(c=0;c<r;++c)c+t<l.areas.length&&(u=l.areas[c+t],d.push([o.gl.TRIANGLES,u.count,l.indexType,u.start]));n(f,d)}else for(c=0;c<r;++c)if(c+t<l.areas.length){for(var v=(u=l.areas[c+t]).start,m=u.count;c+1<r&&(u=l.areas[c+1+t]).start===v+2*m;)m+=u.count,++c;o.gl.drawElements(o.gl.TRIANGLES,m,l.indexType,v)}}return!0},w.prototype.RenderLines=function(e,t,r,i,n){if(this.KeepAlive(),!this._isGood)return!1;if(!i.GetEffectRes()._isGood)return!1;if(e>=this.meshes.length)return!1;var o=a.device,l=this.meshes[e];o.gl.bindBuffer(o.gl.ARRAY_BUFFER,l.buffer),o.gl.bindBuffer(o.gl.ELEMENT_ARRAY_BUFFER,l.indexes);for(var c,u,h=i.GetPassCount(),f=0;f<h;++f){i.ApplyPass(f);var p=i.GetPassInput(f);if(!l.declaration.SetDeclaration(p,l.declaration.stride))return s.emitter.log("res.error",{log:"error",src:["Tw2GeometryRes","RenderLines"],msg:"Error binding mesh to effect",path:this.path,type:"geometry.meshbind",data:{pass:f,passInput:p,meshStride:l.declaration.stride}}),!1;if(o.ApplyShadowState(),void 0!==n){var d=[];for(c=0;c<r;++c)c+t<l.areas.length&&(u=l.areas[c+t],d.push([o.gl.LINES,u.count,l.indexType,u.start]));n(f,d)}else for(c=0;c<r;++c)if(c+t<l.areas.length){for(var v=(u=l.areas[c+t]).start,m=u.count;c+1<r&&(u=l.areas[c+1+t]).start===v+2*m;)m+=u.count,++c;o.gl.drawElements(o.gl.LINES,m,l.indexType,v)}}return!0},w.prototype.RenderDebugInfo=function(e){if(!this.IsGood())return!1;for(var t=0;t<this.models.length;++t)if(this.models[t].skeleton)for(var r=0;r<this.models[t].skeleton.bones.length;++r){var i=this.models[t].skeleton.bones[r];if(i.parentIndex>=0){var n=this.models[t].skeleton.bones[i.parentIndex];e.AddLine([i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]],[n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]],[0,.7,0,1],[0,.7,0,1])}}},w.prototype.Unload=function(){for(var e=0;e<this.meshes.length;++e)this.meshes[e].buffer&&(a.device.gl.deleteBuffer(this.meshes[e].buffer),this.meshes[e].buffer=null),this.meshes[e].indexes&&(a.device.gl.deleteBuffer(this.meshes[e].indexes),this.meshes[e].indexes=null);return this._isPurged=!0,this._isGood=!1,!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ForwardingRenderBatch=t.Tw2RenderBatch=void 0,t.Tw2BatchAccumulator=a;var i=r(2);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){this.batches=[],this.count=0,this._sortMethod=e||void 0}a.prototype.Commit=function(e){this.batches[this.count++]=e},a.prototype.Clear=function(){this.count=0,this.batches=[]},a.prototype.Render=function(e){void 0!==this._sortMethod&&this.batches.sort(this._sortMethod);for(var t=0;t<this.count;++t)this.batches[t].renderMode!==i.device.RM_ANY&&i.device.SetStandardStates(this.batches[t].renderMode),i.device.perObjectData=this.batches[t].perObjectData,this.batches[t].Commit(e)};var s=t.Tw2RenderBatch=function e(){n(this,e),this.renderMode=i.device.RM_ANY,this.perObjectData=null};(t.Tw2ForwardingRenderBatch=function(e){function t(){n(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryProvider=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s),t}()).prototype.Commit=function(e){this.geometryProvider&&this.geometryProvider.Render(this,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureRes=void 0;var i=r(6),n=r(2),a=r(4),s=r(11);var o=t.Tw2TextureRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texture=null,e.isCube=!1,e.images=[],e.width=0,e.height=0,e._facesLoaded=0,e.hasMipMaps=!1,e._currentSampler=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2Resource),t}();o.prototype.Prepare=function(e){var t=n.device.gl.RGBA;if(this.images[0].ccpGLFormat&&(t=this.images[0].ccpGLFormat),"cube"===e){this.texture=n.device.gl.createTexture(),n.device.gl.bindTexture(n.device.gl.TEXTURE_CUBE_MAP,this.texture);var r=document.createElement("canvas");r.width=r.height=this.images[0].height;for(var i=r.getContext("2d"),a=0;a<6;++a)i.drawImage(this.images[0],a*r.width,0,r.width,r.height,0,0,r.width,r.height),n.device.gl.texImage2D(n.device.gl.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,t,t,n.device.gl.UNSIGNED_BYTE,r);n.device.gl.generateMipmap(n.device.gl.TEXTURE_CUBE_MAP),n.device.gl.bindTexture(n.device.gl.TEXTURE_CUBE_MAP,null),this.width=r.width,this.height=r.height,this.hasMipMaps=!0,this.PrepareFinished(!0)}else this.texture=n.device.gl.createTexture(),n.device.gl.bindTexture(n.device.gl.TEXTURE_2D,this.texture),n.device.gl.texImage2D(n.device.gl.TEXTURE_2D,0,t,t,n.device.gl.UNSIGNED_BYTE,this.images[0]),this.hasMipMaps=this.IsPowerOfTwo(this.images[0].width)&&this.IsPowerOfTwo(this.images[0].height),this.hasMipMaps&&n.device.gl.generateMipmap(n.device.gl.TEXTURE_2D),n.device.gl.bindTexture(n.device.gl.TEXTURE_2D,null),this.width=this.images[0].width,this.height=this.images[0].height,this.PrepareFinished(!0);delete this.images},o.prototype.IsPowerOfTwo=function(e){return 0==(e&e-1)},o.prototype.DoCustomLoad=function(e){var t;this.LoadStarted(),this.images=[];var r=this;e=a.resMan.BuildUrl(e);var s="";return n.device.mipLevelSkipCount>0&&(s="."+n.device.mipLevelSkipCount.toString()),".cube"===e.substr(-5)?(a.resMan._pendingLoads++,this.isCube=!0,this.images[0]=new Image,this.images[0].crossOrigin="anonymous",this.images[0].onerror=function(){a.resMan._pendingLoads--,r.LoadFinished(!1),i.emitter.log("res.error",{log:"error",src:["Tw2TextureRes","DoCustomLoad"],msg:"Error loading resource",type:"http.error",path:r.path}),delete r.images},this.images[0].onload=function(){a.resMan._pendingLoads--,r.LoadFinished(!0),a.resMan._prepareQueue.push([r,"cube",null])},e=e.substr(0,e.length-5)+".png",n.device.mipLevelSkipCount>0&&(t=e.lastIndexOf("."))>=0&&(e=e.substr(0,t-2)+s+e.substr(t)),this.images[0].src=e):(a.resMan._pendingLoads++,this.isCube=!1,this.images[0]=new Image,this.images[0].crossOrigin="anonymous",this.images[0].onerror=function(){a.resMan._pendingLoads--,r.LoadFinished(!1),i.emitter.log("res.error",{log:"error",src:["Tw2TextureRes","DoCustomLoad"],msg:"Error loading resource",type:"http.error",path:r.path}),delete r.images},this.images[0].onload=function(){a.resMan._pendingLoads--,r.LoadFinished(!0),a.resMan._prepareQueue.push([r,"",null])},n.device.mipLevelSkipCount>0&&(t=e.lastIndexOf("."))>=0&&(e=e.substr(0,t-2)+s+e.substr(t)),this.images[0].src=e),!0},o.prototype.Unload=function(){return this.texture&&(n.device.gl.deleteTexture(this.texture),this.texture=null,this.isPurged=!0),this._isPurged=!0,this._isGood=!1,!0},o.prototype.Attach=function(e){this.texture=e,this.LoadFinished(!0),this.PrepareFinished(!0)},o.prototype.Bind=function(e,t){this.KeepAlive();var r=e.samplerType;r===(this.isCube?n.device.gl.TEXTURE_CUBE_MAP:n.device.gl.TEXTURE_2D)&&(null!==this.texture?(e.isVolume&&n.device.gl.uniform1f(t,this.height/this.width),n.device.gl.bindTexture(r,this.texture),e.hash!==this._currentSampler&&(e.Apply(this.hasMipMaps),this._currentSampler=e.hash)):n.device.gl.bindTexture(r,r===n.device.gl.TEXTURE_2D?n.device.GetFallbackTexture():n.device.GetFallbackCubeMap()))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector4Parameter=n;var i=r(0);function n(e,t){this.name="undefined"!==e?e:"",this.value=void 0!==t?i.vec4.clone(t):i.vec4.fromValues(1,1,1),this.constantBuffer=null,this.offset=0}n.prototype.Bind=function(e,t,r){return!(null!==this.constantBuffer||r<4)&&(this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r),!0)},n.prototype.Unbind=function(){this.constantBuffer=null},n.prototype.SetValue=function(e){i.vec4.copy(this.value,e),null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.OnValueChanged=function(){null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.Apply=function(e,t){e.set(this.value,t)},n.prototype.GetValue=function(){return null!==this.constantBuffer?i.vec4.clone(this.constantBuffer.subarray(this.offset,this.offset+this.value.length)):i.vec4.clone(this.value)},n.prototype.GetIndexValue=function(e){if(void 0===this.value[e])throw"Invalid Index";return null!==this.constantBuffer?this.constantBuffer[this.offset+e]:this.value[e]},n.prototype.SetIndexValue=function(e,t){if(void 0===this.value[e])throw"Invalid Index";this.value[e]=t,null!==this.constantBuffer&&(this.constantBuffer[this.offset+e]=t)},n.prototype.FillWith=function(e){this.SetValue([e,e,e,e])},n.is=function(e){return i.util.isArrayLike(e)&&4===e.length}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttributeGenerator=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);(t.Tw2ParticleAttributeGenerator=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name=""}return i(e,[{key:"Bind",value:function(e){return!1}},{key:"Generate",value:function(e,t,r){}}]),e}()).global={vec3_0:n.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceObject=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(15);var o=t.EveSpaceObject=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.visible.effectChildren=!0,e.visible.planeSets=!0,e.visible.spotlightSets=!0,e.visible.decals=!0,e.visible.spriteSets=!0,e.visible.overlayEffects=!0,e.visible.lineSets=!0,e.visible.killmarks=!0,e.visible.customMasks=!0,e.mesh=null,e.animation=new a.Tw2AnimationController,e.locators=[],e.spriteSets=[],e.turretSets=[],e.decals=[],e.spotlightSets=[],e.planeSets=[],e.curveSets=[],e.lineSets=[],e.overlayEffects=[],e.children=[],e.effectChildren=[],e.customMasks=[],e.lod=3,e.killCount=0,e.transform=n.mat4.create(),e.boundingSphereCenter=n.vec3.create(),e.boundingSphereRadius=0,e.shapeEllipsoidRadius=n.vec3.create(),e.shapeEllipsoidCenter=n.vec3.create(),e._perObjectData=new a.Tw2PerObjectData(t.perObjectDataDecl),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveObject),i(t,[{key:"Initialize",value:function(){if(this.mesh){this.animation.SetGeometryResource(this.mesh.geometryResource);for(var e=0;e<this.decals.length;++e)this.decals[e].SetParentGeometry(this.mesh.geometryResource)}}},{key:"ResetLod",value:function(){this.lod=3}},{key:"UpdateLod",value:function(e){var r=n.vec3.transformMat4(t.global.vec3_0,this.boundingSphereCenter,this.transform);e.IsSphereVisible(r,this.boundingSphereRadius)?e.GetPixelSizeAcross(r,this.boundingSphereRadius)<100?this.lod=1:this.lod=2:this.lod=0}},{key:"AddCustomMask",value:function(e,t,r,i,a,s){var o=n.mat4.fromRotationTranslationScale(n.mat4.create(),r,e,t);n.mat4.invert(o,o),n.mat4.transpose(o,o),this.customMasks.push({transform:o,maskData:n.vec4.fromValues(1,i?1:0,0,0),materialID:n.vec4.fromValues(a,0,0,0),targets:s})}},{key:"GetLocatorCount",value:function(e){for(var t=0,r=0;r<this.locators.length;++r)this.locators[r].name.substr(0,e.length)===e&&++t;return t}},{key:"FindLocatorJointByName",value:function(e){var t=this.animation.FindModelForMesh(0);if(t)for(var r=0;r<t.bones.length;++r)if(t.bones[r].boneRes.name===e)return t.bones[r].worldTransform;return null}},{key:"FindLocatorTransformByName",value:function(e){for(var t=0;t<this.locators.length;++t)if(this.locators[t].name===e)return this.locators[t].transform;return null}},{key:"FindLocatorsByPrefix",value:function(e){for(var t=[],r=0;r<this.locators.length;r++)0===this.locators[r].name.indexOf(e)&&t.push(this.locators[r]);return t}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return this.mesh&&this.mesh.GetResources(e),this.animation&&this.animation.GetResources(e),n.util.perArrayChild(this.spriteSets,"GetResources",e),n.util.perArrayChild(this.turretSets,"GetResources",e),n.util.perArrayChild(this.decals,"GetResources",e),n.util.perArrayChild(this.spotlightSets,"GetResources",e),n.util.perArrayChild(this.planeSets,"GetResources",e),n.util.perArrayChild(this.lineSets,"GetResources",e),n.util.perArrayChild(this.overlayEffects,"GetResources",e),n.util.perArrayChild(this.effectChildren,"GetResources",e),t||n.util.perArrayChild(this.children,"GetResources",e),e}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.children.length;++e)this.children[e].UpdateViewDependentData(this.transform);n.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),n.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform);var t=this._perObjectData.perObjectVSData.Get("EllipsoidCenter"),r=this._perObjectData.perObjectVSData.Get("EllipsoidRadii");this.shapeEllipsoidRadius[0]>0?(t[0]=this.shapeEllipsoidCenter[0],t[1]=this.shapeEllipsoidCenter[1],t[2]=this.shapeEllipsoidCenter[2],r[0]=this.shapeEllipsoidRadius[0],r[1]=this.shapeEllipsoidRadius[1],r[2]=this.shapeEllipsoidRadius[2]):this.mesh&&this.mesh.geometryResource&&this.mesh.geometryResource.IsGood()&&(n.vec3.subtract(t,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),n.vec3.scale(t,t,.8660254035),n.vec3.add(r,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),n.vec3.scale(r,r,.5));for(var i=0;i<this.customMasks.length;++i){var a=this.visible.customMasks?this.customMasks[i].targets:[0,0,0,0];this._perObjectData.perObjectVSData.Set(i?"CustomMaskMatrix1":"CustomMaskMatrix0",this.customMasks[i].transform),this._perObjectData.perObjectVSData.Set(i?"CustomMaskData1":"CustomMaskData0",this.customMasks[i].maskData),this._perObjectData.perObjectPSData.Set(i?"CustomMaskMaterialID1":"CustomMaskMaterialID0",this.customMasks[i].materialID),this._perObjectData.perObjectPSData.Set(i?"CustomMaskTarget1":"CustomMaskTarget0",a)}this.animation.animations.length&&this._perObjectData.perObjectVSData.Set("JointMat",this.animation.GetBoneMatrices(0));for(var s=0;s<this.lineSets.length;++s)this.lineSets[s].UpdateViewDependentData(this.transform)}},{key:"Update",value:function(e){if(this.lod>0){for(var t=0;t<this.spriteSets.length;++t)this.spriteSets[t].Update(e);for(var r=0;r<this.planeSets.length;r++)this.planeSets[r].Update(e);for(var i=0;i<this.children.length;++i)this.children[i].Update(e);for(var n=0;n<this.effectChildren.length;++n)this.effectChildren[n].Update(e,this.transform);for(var a=0;a<this.curveSets.length;++a)this.curveSets[a].Update(e);for(var s=0;s<this.overlayEffects.length;++s)this.overlayEffects[s].Update(e);this.animation.Update(e)}}},{key:"GetBatches",value:function(e,t){if(this.display){var r=this.visible;if(r.mesh&&this.mesh&&this.lod>0&&this.mesh.GetBatches(e,t,this._perObjectData),this.lod>1){if(r.spriteSets)for(var i=0;i<this.spriteSets.length;i++)this.spriteSets[i].GetBatches(e,t,this._perObjectData,this.transform);if(r.spotlightSets)for(var n=0;n<this.spotlightSets.length;n++)this.spotlightSets[n].GetBatches(e,t,this._perObjectData);if(r.planeSets)for(var a=0;a<this.planeSets.length;a++)this.planeSets[a].GetBatches(e,t,this._perObjectData);if(r.decals)for(var s=0;s<this.decals.length;s++)this.decals[s].GetBatches(e,t,this._perObjectData,r.killmarks?this.killCount:0);if(r.lineSets)for(var o=0;o<this.lineSets.length;o++)this.lineSets[o].GetBatches(e,t)}if(r.children)for(var l=0;l<this.children.length;l++)this.children[l].GetBatches(e,t,this._perObjectData);if(r.effectChildren)for(var c=0;c<this.effectChildren.length;c++)this.effectChildren[c].GetBatches(e,t,this._perObjectData);if(r.overlayEffects)for(var u=0;u<this.overlayEffects.length;u++)this.overlayEffects[u].GetBatches(e,t,this._perObjectData,this.mesh)}}},{key:"RenderDebugInfo",value:function(e){this.animation.RenderDebugInfo(e)}}]),t}();o.global={vec3_0:n.vec3.create()},o.perObjectDataDecl={VSData:[{name:"WorldMat",size:16},{name:"WorldMatLast",size:16},{name:"Shipdata",size:4,value:[0,1,0,-10]},{name:"Clipdata1",size:4},{name:"EllipsoidRadii",size:4},{name:"EllipsoidCenter",size:4},{name:"CustomMaskMatrix0",size:16,value:n.mat4.create()},{name:"CustomMaskMatrix1",size:16,value:n.mat4.create()},{name:"CustomMaskData0",size:4},{name:"CustomMaskData1",size:4},{name:"JointMat",size:696}],PSData:[{name:"Shipdata",size:4,value:[0,1,0,1]},{name:"Clipdata1",size:4},{name:"Clipdata2",size:4},{name:"ShLighting",size:28},{name:"CustomMaskMaterialID0",size:4},{name:"CustomMaskMaterialID1",size:4},{name:"CustomMaskTarget0",size:4},{name:"CustomMaskTarget1",size:4}]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.num={};i.biCumulative=function(e,t){if(1===t){var r=1-e;return 1-r*r*r}return 2===t?3*e*e-2*e*e*e:e*e*e},i.exponentialDecay=function(e,t,r,i,n){return t*n/i+r*(e*i-t)/(i*i)*(1-Math.pow(Math.E,-i*n/r))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new i.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){let t=new i.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,n,a,s,o,l,c){let u=new i.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=a,u[5]=s,u[6]=o,u[7]=l,u[8]=c,u},t.set=function(e,t,r,i,n,a,s,o,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=c,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*s-o*c,f=-u*a+o*l,p=c*a-s*l,d=r*h+i*f+n*p;if(!d)return null;return d=1/d,e[0]=h*d,e[1]=(-u*i+n*c)*d,e[2]=(o*i-n*s)*d,e[3]=f*d,e[4]=(u*r-n*l)*d,e[5]=(-o*r+n*a)*d,e[6]=p*d,e[7]=(-c*r+i*l)*d,e[8]=(s*r-i*a)*d,e},t.adjoint=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-o*c,e[1]=n*c-i*u,e[2]=i*o-n*s,e[3]=o*l-a*u,e[4]=r*u-n*l,e[5]=n*a-r*o,e[6]=a*c-s*l,e[7]=i*l-r*c,e[8]=r*s-i*a,e},t.determinant=function(e){let t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*(c*a-s*l)+r*(-c*n+s*o)+i*(l*n-a*o)},t.multiply=n,t.translate=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=f*i+p*s+c,e[7]=f*n+p*o+u,e[8]=f*a+p*l+h,e},t.rotate=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=Math.sin(r),p=Math.cos(r);return e[0]=p*i+f*s,e[1]=p*n+f*o,e[2]=p*a+f*l,e[3]=p*s-f*i,e[4]=p*o-f*n,e[5]=p*l-f*a,e[6]=c,e[7]=u,e[8]=h,e},t.scale=function(e,t,r){let i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,c=r*s,u=i*s,h=i*o,f=n*s,p=n*o,d=n*l,v=a*s,m=a*o,y=a*l;return e[0]=1-h-d,e[3]=u-y,e[6]=f+m,e[1]=u+y,e[4]=1-c-d,e[7]=p-v,e[2]=f-m,e[5]=p+v,e[8]=1-c-h,e},t.normalFromMat4=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15],b=r*o-i*s,g=r*l-n*s,_=r*c-a*s,E=i*l-n*o,T=i*c-a*o,R=n*c-a*l,S=u*v-h*d,w=u*m-f*d,O=u*y-p*d,A=h*m-f*v,P=h*y-p*v,M=f*y-p*m,D=b*M-g*P+_*A+E*O-T*w+R*S;if(!D)return null;return D=1/D,e[0]=(o*M-l*P+c*A)*D,e[1]=(l*O-s*M-c*w)*D,e[2]=(s*P-o*O+c*S)*D,e[3]=(n*P-i*M-a*A)*D,e[4]=(r*M-n*O+a*w)*D,e[5]=(i*O-r*P-a*S)*D,e[6]=(v*R-m*T+y*E)*D,e[7]=(m*_-d*R-y*g)*D,e[8]=(d*T-v*_+y*b)*D,e},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=t[0],p=t[1],d=t[2],v=t[3],m=t[4],y=t[5],b=t[6],g=t[7],_=t[8];return Math.abs(r-f)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-p)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-d)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-v)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-m)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-y)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-b)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-g)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-_)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))};var i=r(5);function n(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=r[0],p=r[1],d=r[2],v=r[3],m=r[4],y=r[5],b=r[6],g=r[7],_=r[8];return e[0]=f*i+p*s+d*c,e[1]=f*n+p*o+d*u,e[2]=f*a+p*l+d*h,e[3]=v*i+m*s+y*c,e[4]=v*n+m*o+y*u,e[5]=v*a+m*l+y*h,e[6]=b*i+g*s+_*c,e[7]=b*n+g*o+_*u,e[8]=b*a+g*l+_*h,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}const s=n;t.mul=s;const o=a;t.sub=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new i.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=a,t.fromValues=s,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=o,t.multiply=l,t.divide=c,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},t.distance=u,t.squaredDistance=h,t.squaredLength=f,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=p,t.dot=d,t.cross=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=n*l-a*o,e[1]=a*s-i*l,e[2]=i*o-n*s,e},t.lerp=function(e,t,r,i){let n=t[0],a=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e},t.hermite=function(e,t,r,i,n,a){let s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,c=s*(a-1),u=s*(3-2*a);return e[0]=t[0]*o+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*o+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*o+r[2]*l+i[2]*c+n[2]*u,e},t.bezier=function(e,t,r,i,n,a){let s=1-a,o=s*s,l=a*a,c=o*s,u=3*a*o,h=3*l*s,f=l*a;return e[0]=t[0]*c+r[0]*u+i[0]*h+n[0]*f,e[1]=t[1]*c+r[1]*u+i[1]*h+n[1]*f,e[2]=t[2]*c+r[2]*u+i[2]*h+n[2]*f,e},t.random=function(e,t){t=t||1;let r=2*i.RANDOM()*Math.PI,n=2*i.RANDOM()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e},t.transformMat4=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,e},t.transformMat3=function(e,t,r){let i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*a-l*n,h=c*n+l*i-s*a,f=c*a+s*n-o*i,p=-s*i-o*n-l*a;return e[0]=u*c+p*-s+h*-l-f*-o,e[1]=h*c+p*-o+f*-s-u*-l,e[2]=f*c+p*-l+u*-o-h*-s,e},t.rotateX=function(e,t,r,i){let n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,i){let n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,i){let n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){let r=s(e[0],e[1],e[2]),i=s(t[0],t[1],t[2]);p(r,r),p(i,i);let n=d(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=t[0],o=t[1],l=t[2];return Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-l)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))};var i=r(5);function n(){let e=new i.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function a(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function s(e,t,r){let n=new i.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function u(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function h(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function f(e){let t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function p(e,t){let r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}const v=o;t.sub=v;const m=l;t.mul=m;const y=c;t.div=y;const b=u;t.dist=b;const g=h;t.sqrDist=g;const _=a;t.len=_;const E=f;t.sqrLen=E;const T=function(){let e=n();return function(t,r,i,n,a,s){let o,l;for(r||(r=3),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();t.forEach=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){let t=new i.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,n){let a=new i.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=a,t.multiply=s,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=l,t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},t.distance=c,t.squaredDistance=u,t.length=h,t.squaredLength=f,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=p,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,i){let n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e},t.random=function(e,t){return t=t||1,e[0]=i.RANDOM(),e[1]=i.RANDOM(),e[2]=i.RANDOM(),e[3]=i.RANDOM(),p(e,e),l(e,e,t),e},t.transformMat4=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,e},t.transformQuat=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*a-l*n,h=c*n+l*i-s*a,f=c*a+s*n-o*i,p=-s*i-o*n-l*a;return e[0]=u*c+p*-s+h*-l-f*-o,e[1]=h*c+p*-o+f*-s-u*-l,e[2]=f*c+p*-l+u*-o-h*-s,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-u)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))};var i=r(5);function n(){let e=new i.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function l(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function c(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)}function u(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function h(e){let t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function f(e){let t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function p(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=a*s),e}const d=a;t.sub=d;const v=s;t.mul=v;const m=o;t.div=m;const y=c;t.dist=y;const b=u;t.sqrDist=b;const g=h;t.len=g;const _=f;t.sqrLen=_;const E=function(){let e=n();return function(t,r,i,n,a,s){let o,l;for(r||(r=4),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();t.forEach=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0;var i,n=r(8),a=r(28);t.vec3=n.vec3,n.vec3.cartFromSpherical=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=n*Math.sin(r)*Math.sin(i),e[1]=n*Math.cos(i),e[2]=n*Math.cos(r)*Math.sin(i),e},n.vec3.cartFromSphericalAndCenter=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=a*Math.sin(i)*Math.sin(n)+r[0],e[1]=a*Math.cos(n)+r[1],e[2]=a*Math.cos(i)*Math.sin(n)+r[2],e},n.vec3.exponentialDecay=function(e,t,r,i,n,s){return e[0]=a.num.exponentialDecay(t[0],r[0],i,n,s),e[1]=a.num.exponentialDecay(t[1],r[1],i,n,s),e[2]=a.num.exponentialDecay(t[2],r[2],i,n,s),e},n.vec3.project=function(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=r[0]*n+r[4]*a+r[8]*s+r[12],l=r[1]*n+r[5]*a+r[9]*s+r[13],c=r[3]*n+r[7]*a+r[11]*s+r[15],u=(o/c+1)/2,h=1-(l/c+1)/2;return e[0]=u*i[2]+i[0],e[1]=h*i[3]+i[1],e[2]=c,e},n.vec3.unproject=(i=void 0,function(e,t,r,a){i||(i=n.vec4.create());var s=t[0],o=t[1],l=t[2];if(i[0]=2*(s-a[0])/a[2]-1,i[1]=2*(o-a[1])/a[3]-1,i[2]=2*l-1,i[3]=1,n.vec4.transformMat4(i,i,r),0===i[3])throw e[0]=0,e[1]=0,e[2]=0,new Error("Perspective divide error");return e[0]=i[0]/i[3],e[1]=i[1]/i[3],e[2]=i[2]/i[3],e})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0;var i=r(8);t.vec4=i.vec4},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ObjectReader=s;var i=r(6),n=r(4),a=r(18);function s(e){if(this.xmlNode=e,this._inputStack=null,this._initializeObjects=null,this._ids={},this._reader=null,"binred"===String.fromCharCode.apply(null,new Uint8Array(e).subarray(0,6))){this._reader=new a.Tw2BinaryReader(new Uint8Array(e)),this._reader.cursor+=6,this._stringTable=[];for(var t=this._reader.ReadUInt32(),r=0;r<t;++r){var n=this._reader.ReadUInt16();this._stringTable.push(String.fromCharCode.apply(null,this._reader.data.subarray(this._reader.cursor,this._reader.cursor+n))),this._reader.cursor+=n}this._start=this._reader.cursor}else i.emitter.log("res.error",{log:"error",src:["Tw2ObjectReader","constructor"],msg:"Invalid Binary",path:this.path,type:"redbin.invalid",data:e})}s.ElementRawType={NULL:0,BOOL:1,INT:2,UINT:3,FLOAT:4,STRING:5,ARRAY:6,MAPPING:7,OBJECT:8,TYPED_ARRAY:9,TYPED_MAPPING:10},s.ElementSize={SMALL:0,MEDIUM:16,LARGE:32},s.ID_BIT=64,s.REFERENCE_BIT=128,s.ElementTypes={NULL:s.ElementRawType.NULL|s.ElementSize.SMALL,BOOL:s.ElementRawType.BOOL|s.ElementSize.SMALL,FALSE:s.ElementRawType.BOOL|s.ElementSize.MEDIUM,TRUE:s.ElementRawType.BOOL|s.ElementSize.LARGE,INT8:s.ElementRawType.INT|s.ElementSize.SMALL,UINT8:s.ElementRawType.UINT|s.ElementSize.SMALL,INT16:s.ElementRawType.INT|s.ElementSize.MEDIUM,UINT16:s.ElementRawType.UINT|s.ElementSize.MEDIUM,INT32:s.ElementRawType.INT|s.ElementSize.LARGE,UINT32:s.ElementRawType.UINT|s.ElementSize.LARGE,FLOAT16:s.ElementRawType.FLOAT|s.ElementSize.SMALL,FLOAT32:s.ElementRawType.FLOAT|s.ElementSize.MEDIUM,FLOAT64:s.ElementRawType.FLOAT|s.ElementSize.LARGE,SHORT_STRING:s.ElementRawType.STRING|s.ElementSize.SMALL,MEDIUM_STRING:s.ElementRawType.STRING|s.ElementSize.MEDIUM,LARGE_STRING:s.ElementRawType.STRING|s.ElementSize.LARGE,SHORT_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.SMALL,MEDIUM_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.MEDIUM,LARGE_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.LARGE,SHORT_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.SMALL,MEDIUM_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.MEDIUM,LARGE_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.LARGE,SHORT_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.SMALL,MEDIUM_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.MEDIUM,LARGE_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.LARGE,SHORT_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.SMALL,MEDIUM_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.MEDIUM,LARGE_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.LARGE,SHORT_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.SMALL,MEDIUM_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.MEDIUM,LARGE_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.LARGE},s.TypedArrays={2:Int8Array,3:Uint8Array,18:Int16Array,19:Uint16Array,34:Int32Array,35:Uint32Array,4:Float32Array,20:Float32Array,36:Float64Array},s.prototype._ConstructObject=function(e){var t;if("json"===e.type)return e;try{t=new(n.resMan.GetConstructor(e.type))}catch(t){throw i.emitter.log("res.error",{log:"throw",src:["Tw2ObjectReader","_ConstructObject"],msg:"Object with undefined type",type:"xml.type",value:e.type}),new Error("YAML: object with undefined type '"+e.type+"'")}for(var r in e)if(e.hasOwnProperty(r)&&"type"!==r)if(t[r]&&e[r].constructor===Object)for(var a in e[r])e[r].hasOwnProperty(a)&&(t[r][a]=e[r][a]);else t[r]=e[r];return"Initialize"in t&&t.Initialize(),t},s.prototype._ReadUint=function(e){switch(48&e){case s.ElementSize.SMALL:return this._reader.ReadUInt8();case s.ElementSize.MEDIUM:return this._reader.ReadUInt16();default:return this._reader.ReadUInt32()}},s.prototype._ReadElementData=function(e){var t,r,i,n,a;switch(15&e){case s.ElementRawType.NULL:return null;case s.ElementRawType.BOOL:switch(48&e){case s.ElementSize.SMALL:return 0!==this._reader.ReadUInt8();case s.ElementSize.MEDIUM:return!1;default:return!0}case s.ElementRawType.INT:switch(48&e){case s.ElementSize.SMALL:return this._reader.ReadInt8();case s.ElementSize.MEDIUM:return this._reader.ReadInt16();default:return this._reader.ReadInt32()}case s.ElementRawType.UINT:return this._ReadUint(e);case s.ElementRawType.FLOAT:switch(48&e){case s.ElementSize.SMALL:return this._reader.ReadFloat16();case s.ElementSize.MEDIUM:return this._reader.ReadFloat32();default:throw Error("float64 values are not yet supported")}case s.ElementRawType.STRING:return t=this._ReadUint(e),this._stringTable[t];case s.ElementRawType.ARRAY:for(n=this._ReadUint(e),i=[],r=0;r<n;++r)i.push(this._ReadElement());return i;case s.ElementRawType.MAPPING:for(n=this._ReadUint(e),i={},r=0;r<n;++r)i[this._stringTable[this._ReadUint(e)]]=this._ReadElement();return i;case s.ElementRawType.OBJECT:for(n=this._ReadUint(e),i={},r=0;r<n;++r)i[this._stringTable[this._ReadUint(e)]]=this._ReadElement();return this._ConstructObject(i);case s.ElementRawType.TYPED_ARRAY:for(n=this._ReadUint(e),a=this._reader.ReadUInt8(),i=[],r=0;r<n;++r)i.push(this._ReadElementData(a));return a in s.TypedArrays&&(i=new s.TypedArrays[a](i)),i;case s.ElementRawType.TYPED_MAPPING:for(n=this._ReadUint(e),a=this._reader.ReadUInt8(),i={},r=0;r<n;++r)i[this._stringTable[this._ReadUint(e)]]=this._ReadElementData(a);return i}},s.prototype._ReadElement=function(){var e,t=this._reader.ReadUInt8();if(t===s.REFERENCE_BIT)return this._ids[this._reader.ReadUInt16()];0!=(t&s.ID_BIT)&&(e=this._reader.ReadUInt16());var r=this._ReadElementData(63&t);return 0!=(t&s.ID_BIT)&&(this._ids[e]=r),r},s.prototype.Construct=function(){return this._reader.cursor=this._start,this._ReadElement()},s.prototype.ConstructFromNode=function(e,t){for(var r=Date.now();this._inputStack.length;){var a=Date.now();if(t&&n.resMan.prepareBudget<.001*(a-r))return!1;var s=this._inputStack.pop(),o=s[0],l=s[1],c=s[2];if(null!==o){var u=o.attributes.getNamedItem("ref");if(u){var h=this._ids[u.value];l[c]=h}else{var f=o.attributes.getNamedItem("type");if(f){h=null;if("dict"===f.value)h={};else try{h=new(n.resMan.GetConstructor(f.value))}catch(e){throw i.emitter.log("res.error",{log:"throw",src:["Tw2ObjectReader","ConstructFromNode"],msg:"Object with undefined type",type:"xml.type",value:f.value}),new Error("YAML: object with undefined type '"+f.value+"'")}this._inputStack.push([null,h,null]);for(var p=0;p<o.childNodes.length;++p){"#text"!==(m=o.childNodes[o.childNodes.length-1-p]).nodeName&&("dict"===f.value||void 0!==h[m.nodeName]?this._inputStack.push([m,h,m.nodeName]):i.emitter.log("res.error",{log:"warn",src:["Tw2ObjectReader","ConstructFromNode"],msg:'Object "'+f.value+'" missing property: '+m.nodeName,value:m.nodeName,type:"xml.property"}))}(y=o.attributes.getNamedItem("id"))&&(this._ids[y.value]=h),l[c]=h}else{if(o.attributes.getNamedItem("list")){h=[];var d=0;this._inputStack.push([null,h,null]);for(p=0;p<o.childNodes.length;++p){"#text"!==(m=o.childNodes[o.childNodes.length-1-p]).nodeName&&d++}for(p=0;p<o.childNodes.length;++p){"#text"!==(m=o.childNodes[o.childNodes.length-1-p]).nodeName&&this._inputStack.push([m,h,--d])}(y=o.attributes.getNamedItem("id"))&&(this._ids[y.value]=h),l[c]=h}else{var v="";for(p=0;p<o.childNodes.length;++p){var m;"#text"===(m=o.childNodes[p]).nodeName&&(v+=m.data)}if(o.attributes.getNamedItem("json")){try{l[c]=JSON.parse(v)}catch(e){throw i.emitter.log("res.error",{log:"throw",src:["Tw2ObjectReader","ConstructFromNode"],msg:"Invalid JSON property",type:"xml.json",value:v,data:e}),new Error("YAML: property '"+v+"' is not a valid JSON property")}if(!o.attributes.getNamedItem("notnum"))try{l[c]=new Float32Array(l[c])}catch(e){}var y;(y=o.attributes.getNamedItem("id"))&&(this._ids[y.value]=l[c])}else{var b=/^(\-?\d+\.\d+(?:e|E\-?\d+)?)/.exec(v);b?l[c]=parseFloat(b[1]):(b=/^(\-?\d+)/.exec(v))?l[c]=parseInt(b[1],10):(b=/^\b(enabled|true|yes|on)\b/.exec(v))?l[c]=!0:(b=/^\b(disabled|false|no|off)\b/.exec(v),l[c]=!b&&v)}}}}}else e&&void 0!==l.Initialize&&this._initializeObjects.push(l)}for(;this._initializeObjects.length;){a=Date.now();if(t&&n.resMan.prepareBudget<.001*(a-r))return!1;(h=this._initializeObjects.shift()).Initialize()}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerObjectData=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(2),a=r(21);t.Tw2PerObjectData=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.perObjectVSData=null,this.perObjectPSData=null,t&&this.DeclareFromObject(t,r)}return i(e,[{key:"SetPerObjectDataToDevice",value:function(e){this.perObjectVSData&&e[3]&&n.device.gl.uniform4fv(e[3],this.perObjectVSData.data),this.perObjectPSData&&e[4]&&n.device.gl.uniform4fv(e[4],this.perObjectPSData.data)}},{key:"DeclareFromObject",value:function(e,t){e.VSData&&(this.perObjectVSData=new a.Tw2RawData(e.VSData,t)),e.PSData&&(this.perObjectPSData=new a.Tw2RawData(e.PSData,t))}}]),e}()},function(e,t,r){"use strict";function i(e,t){this.name=void 0!==e?e:"",void 0!==t?t.constructor.name.toUpperCase().includes("ARRAY")?this.value=t[0]:this.value=t:this.value=1,this.constantBuffer=null,this.offset=null}Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2FloatParameter=i,i.prototype.Bind=function(e,t,r){if(null!==this.constantBuffer||r<1)return!1;this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r)},i.prototype.Unbind=function(){this.constantBuffer=null},i.prototype.OnValueChanged=function(){null!==this.constantBuffer&&(this.constantBuffer[this.offset]=this.value)},i.prototype.Apply=function(e,t){e[t]=this.value},i.prototype.GetValue=function(){return null!==this.constantBuffer?this.constantBuffer[this.offset]:this.value},i.prototype.SetValue=function(e){this.value=e,null!==this.constantBuffer&&(this.constantBuffer[this.offset]=this.value)},i.is=function(e){return"number"==typeof e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Mesh=void 0,t.Tw2MeshArea=s,t.Tw2MeshLineArea=o;var i=r(4),n=r(2),a=r(22);function s(){this.name="",this.effect=null,this.meshIndex=0,this.index=0,this.count=1,this.display=!0}function o(){this.name="",this.effect=null,this.meshIndex=0,this.index=0,this.count=1,this.display=!0}s.batchType=a.Tw2GeometryBatch,o.batchType=a.Tw2GeometryLineBatch;var l=t.Tw2Mesh=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.meshIndex=0,this.geometryResPath="",this.lowDetailGeometryResPath="",this.geometryResource=null,this.opaqueAreas=[],this.transparentAreas=[],this.additiveAreas=[],this.pickableAreas=[],this.decalAreas=[],this.depthAreas=[],this.display=!0,this.visible={},this.visible.opaqueAreas=!0,this.visible.transparentAreas=!0,this.visible.additiveAreas=!0,this.visible.pickableAreas=!0,this.visible.decalAreas=!0,this.visible.depthAreas=!0};l.prototype.Initialize=function(){""!==this.geometryResPath&&(this.geometryResource=i.resMan.GetResource(this.geometryResPath))},l.prototype.GetResources=function(e){for(var t in void 0===e&&(e=[]),-1===e.indexOf(this.geometryResource)&&e.push(this.geometryResource),this.visible)if(this.visible.hasOwnProperty(t)&&this[t].length)for(var r=0;r<this[t].length;r++)this[t][r].effect.GetResources(e);return e},l.prototype._GetAreaBatches=function(e,t,r,i){for(var n=0;n<e.length;++n){var a=e[n];if(null!==a.effect&&a.display){var s=new a.constructor.batchType;s.renderMode=t,s.perObjectData=i,s.geometryRes=this.geometryResource,s.meshIx=this.meshIndex,s.start=a.index,s.count=a.count,s.effect=a.effect,r.Commit(s)}}},l.prototype.GetBatches=function(e,t,r){return null!==this.geometryResource&&(this.display&&(e===n.device.RM_OPAQUE&&this.visible.opaqueAreas?this._GetAreaBatches(this.opaqueAreas,e,t,r):e===n.device.RM_DECAL&&this.visible.decalAreas?this._GetAreaBatches(this.decalAreas,e,t,r):e===n.device.RM_TRANSPARENT&&this.visible.transparentAreas?this._GetAreaBatches(this.transparentAreas,e,t,r):e===n.device.RM_ADDITIVE&&this.visible.additiveAreas?this._GetAreaBatches(this.additiveAreas,e,t,r):e===n.device.RM_PICKABLE&&this.visible.pickableAreas&&this._GetAreaBatches(this.pickableAreas,e,t,r)),!0)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RenderTarget=a;var i=r(2),n=r(24);function a(){this.texture=null,this._frameBuffer=null,this._renderBuffer=null,this.width=null,this.height=null,this.hasDepth=null}a.prototype.Destroy=function(){this.texture&&(i.device.gl.deleteTexture(this.texture.texture),this.texture=null),this._renderBuffer&&(i.device.gl.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),this._frameBuffer&&(i.device.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null)},a.prototype.Create=function(e,t,r){this.Destroy(),this.texture=new n.Tw2TextureRes,this.texture.Attach(i.device.gl.createTexture()),this._frameBuffer=i.device.gl.createFramebuffer(),i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,this._frameBuffer),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.texImage2D(i.device.gl.TEXTURE_2D,0,i.device.gl.RGBA,e,t,0,i.device.gl.RGBA,i.device.gl.UNSIGNED_BYTE,null),i.device.gl.texParameteri(i.device.gl.TEXTURE_2D,i.device.gl.TEXTURE_MAG_FILTER,i.device.gl.LINEAR),i.device.gl.texParameteri(i.device.gl.TEXTURE_2D,i.device.gl.TEXTURE_MIN_FILTER,i.device.gl.LINEAR),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),this._renderBuffer=null,r&&(this._renderBuffer=i.device.gl.createRenderbuffer(),i.device.gl.bindRenderbuffer(i.device.gl.RENDERBUFFER,this._renderBuffer),i.device.gl.renderbufferStorage(i.device.gl.RENDERBUFFER,i.device.gl.DEPTH_COMPONENT16,e,t)),i.device.gl.framebufferTexture2D(i.device.gl.FRAMEBUFFER,i.device.gl.COLOR_ATTACHMENT0,i.device.gl.TEXTURE_2D,this.texture.texture,0),r&&i.device.gl.framebufferRenderbuffer(i.device.gl.FRAMEBUFFER,i.device.gl.DEPTH_ATTACHMENT,i.device.gl.RENDERBUFFER,this._renderBuffer),i.device.gl.bindRenderbuffer(i.device.gl.RENDERBUFFER,null),i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),this.texture.width=this.width=e,this.texture.height=this.height=t,this.hasDepth=r},a.prototype.Set=function(){i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,this._frameBuffer),i.device.gl.viewport(0,0,this.width,this.height)},a.prototype.Unset=function(){i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),i.device.gl.viewport(0,0,i.device.viewportWidth,i.device.viewportHeight)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(78);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(81);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(88);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(92);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(93);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(13);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleEmitter=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);t.Tw2ParticleEmitter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.particleSystem=null}return i(e,[{key:"Initialize",value:function(){}},{key:"Update",value:function(e){}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(14);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(113);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(122);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(125);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildMesh=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(10);t.EveChildMesh=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.useSpaceObjectData=!0,e.mesh=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveChild),i(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"GetBatches",value:function(e,t,r){this.display&&this.mesh&&(this.useSpaceObjectData?(this._perObjectData||(this._perObjectData=new a.Tw2PerObjectData,this._perObjectData.perObjectVSData=new a.Tw2RawData,this._perObjectData.perObjectVSData.data=new Float32Array(r.perObjectVSData.data.length),this._perObjectData.perObjectVSData.data[33]=1,this._perObjectData.perObjectVSData.data[35]=1,this._perObjectData.perObjectPSData=new a.Tw2RawData,this._perObjectData.perObjectPSData.data=new Float32Array(r.perObjectPSData.data.length),this._perObjectData.perObjectPSData.data[1]=1,this._perObjectData.perObjectPSData.data[3]=1),this._perObjectData.perObjectVSData.data.set(r.perObjectVSData.data),this._perObjectData.perObjectPSData.data.set(r.perObjectPSData.data),n.mat4.transpose(this._perObjectData.perObjectVSData.data,this.worldTransform),n.mat4.transpose(this._perObjectData.perObjectVSData.data.subarray(16),this.worldTransformLast)):(this._perObjectData||(this._perObjectData=new a.Tw2BasicPerObjectData(s.EveChild.perObjectDataDecl)),n.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),n.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform)),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTransform=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(15);var o=t.EveTransform=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.mesh=null,e.curveSets=[],e.children=[],e.particleSystems=[],e.particleEmitters=[],e.modifier=t.Modifier.NONE,e.sortValueMultiplier=1,e.distanceBasedScaleArg1=.2,e.distanceBasedScaleArg2=.63,e.useDistanceBasedScale=!1,e.scaling=n.vec3.fromValues(1,1,1),e.translation=n.vec3.create(),e.rotation=n.quat.create(),e.localTransform=n.mat4.create(),e.worldTransform=n.mat4.create(),e._perObjectData=new a.Tw2BasicPerObjectData(t.perObjectDataDecl),t.init(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveObject),i(t,[{key:"Initialize",value:function(){n.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(this.mesh&&this.mesh.GetResources(e),!t)for(var r=0;r<this.children;r++)this.children[r].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(e){var r=t.global,i=r.vec3_0,s=r.vec3_1,o=r.vec3_2,l=a.device.viewInverse;switch(n.quat.normalize(this.rotation,this.rotation),n.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling),n.mat4.getScaling(s,e),this.modifier){case t.Modifier.BILLBOARD:case t.Modifier.SIMPLE_HALO:var c=r.vec3_3;if(n.mat4.multiply(this.worldTransform,e,this.localTransform),n.vec3.multiply(i,this.scaling,s),this.modifier===t.Modifier.SIMPLE_HALO){n.vec3.subtract(o,a.device.GetEyePosition(),this.worldTransform.subarray(12)),n.vec3.normalize(c,this.worldTransform.subarray(8)),n.vec3.normalize(o,o);var u=n.vec3.dot(o,c);u<0&&(u=0),n.vec3.scale(i,i,u*u)}this.worldTransform[0]=l[0]*i[0],this.worldTransform[1]=l[1]*i[0],this.worldTransform[2]=l[2]*i[0],this.worldTransform[4]=l[4]*i[1],this.worldTransform[5]=l[5]*i[1],this.worldTransform[6]=l[6]*i[1],this.worldTransform[8]=l[8]*i[2],this.worldTransform[9]=l[9]*i[2],this.worldTransform[10]=l[10]*i[2];break;case t.Modifier.EVE_CAMERA_ROTATION:var h=r.vec3_3;n.vec3.transformMat4(h,this.translation,e),n.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,h,this.scaling),n.mat4.multiply(this.worldTransform,l,this.localTransform),this.worldTransform[12]=this.localTransform[12],this.worldTransform[13]=this.localTransform[13],this.worldTransform[14]=this.localTransform[14];break;case t.Modifier.EVE_CAMERA_ROTATION_ALIGNED:case t.Modifier.EVE_SIMPLE_HALO:var f=a.device.GetEyePosition(),p=r.vec3_3,d=r.vec3_4,v=r.vec3_5,m=r.vec3_6,y=r.vec3_7,b=r.mat4_0,g=r.mat4_1,_=r.mat4_2;if(n.mat4.translate(this.worldTransform,e,this.translation),n.mat4.transpose(b,e),o[0]=f[0]-this.worldTransform[12],o[1]=f[1]-this.worldTransform[13],o[2]=f[2]-this.worldTransform[14],n.vec3.copy(p,o),n.vec3.transformMat4(p,p,b),n.vec3.divide(p,p,s),n.vec3.normalize(p,p),n.vec3.set(d,a.device.view[0],a.device.view[4],a.device.view[8]),n.vec3.transformMat4(d,d,b),n.vec3.normalize(d,d),n.vec3.cross(v,p,d),n.vec3.normalize(v,v),n.vec3.cross(d,v,p),g[0]=d[0],g[1]=d[1],g[2]=d[2],g[4]=v[0],g[5]=v[1],g[6]=v[2],g[8]=p[0],g[9]=p[1],g[10]=p[2],g[15]=1,n.mat4.fromQuat(_,this.rotation),n.mat4.multiply(g,g,_),this.modifier===t.Modifier.EVE_SIMPLE_HALO){n.vec3.normalize(m,this.worldTransform.subarray(8)),n.vec3.normalize(y,o);var E=-n.vec3.dot(y,m);E<0&&(E=0),n.mat4.multiply(this.worldTransform,this.worldTransform,g),n.mat4.scale(this.worldTransform,this.worldTransform,[this.scaling[0]*E,this.scaling[1]*E,this.scaling[2]*E])}else n.mat4.scale(this.worldTransform,this.worldTransform,this.scaling),n.mat4.multiply(this.worldTransform,this.worldTransform,g);break;case t.Modifier.LOOK_AT_CAMERA:var T=r.mat4_0;n.mat4.multiply(this.worldTransform,e,this.localTransform),n.mat4.lookAt(T,l.subarray(12),this.worldTransform.subarray(12),[0,1,0]),n.mat4.transpose(T,T),n.vec3.multiply(i,this.scaling,s),this.worldTransform[0]=T[0]*i[0],this.worldTransform[1]=T[1]*i[0],this.worldTransform[2]=T[2]*i[0],this.worldTransform[4]=T[4]*i[1],this.worldTransform[5]=T[5]*i[1],this.worldTransform[6]=T[6]*i[1],this.worldTransform[8]=T[8]*i[2],this.worldTransform[9]=T[9]*i[2],this.worldTransform[10]=T[10]*i[2];break;default:n.mat4.multiply(this.worldTransform,e,this.localTransform)}for(var R=0;R<this.children.length;++R)this.children[R].UpdateViewDependentData(this.worldTransform)}},{key:"Update",value:function(e){for(var t=0;t<this.children.length;++t)this.children[t].Update(e);for(var r=0;r<this.particleEmitters.length;++r)this.particleEmitters[r].Update(e);for(var i=0;i<this.particleSystems.length;++i)this.particleSystems[i].Update(e);for(var n=0;n<this.curveSets.length;++n)this.curveSets[n].Update(e)}},{key:"GetBatches",value:function(e,t,r){if(this.display&&(this.visible.mesh&&this.mesh&&(n.mat4.transpose(this._perObjectData.perObjectFFEData.Get("World"),this.worldTransform),n.mat4.invert(this._perObjectData.perObjectFFEData.Get("WorldInverseTranspose"),this.worldTransform),r&&(this._perObjectData.perObjectVSData=r.perObjectVSData,this._perObjectData.perObjectPSData=r.perObjectPSData),this.mesh.GetBatches(e,t,this._perObjectData)),this.visible.children))for(var i=0;i<this.children.length;++i)this.children[i].GetBatches(e,t,r)}}],[{key:"Multiply3x3",value:function(e,t,r){r||(r=t);var i=t[0],n=t[1];return t=t[2],r[0]=e[0]*i+e[4]*n+e[8]*t,r[1]=e[1]*i+e[5]*n+e[9]*t,r[2]=e[2]*i+e[6]*n+e[10]*t,r}},{key:"init",value:function(){t.global||(t.global={vec3_0:n.vec3.create(),vec3_1:n.vec3.create(),vec3_2:n.vec3.create(),vec3_3:n.vec3.create(),vec3_4:n.vec3.create(),vec3_5:n.vec3.create(),vec3_6:n.vec3.create(),vec3_7:n.vec3.create(),mat4_0:n.mat4.create(),mat4_1:n.mat4.create(),mat4_2:n.mat4.create()})}}]),t}();o.global=null,o.Modifier={NONE:0,BILLBOARD:1,TRANSLATE_WITH_CAMERA:2,LOOK_AT_CAMERA:3,SIMPLE_HALO:4,EVE_CAMERA_ROTATION_ALIGNED:100,EVE_BOOSTER:101,EVE_SIMPLE_HALO:102,EVE_CAMERA_ROTATION:103},o.perObjectDataDecl={FFEData:[{name:"World",size:16},{name:"WorldInverseTranspose",size:16}]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveShip=t.EveTurretSetLocatorInfo=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0},a=r(27);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=t.EveTurretSetLocatorInfo=function e(){s(this,e),this.isJoint=!1,this.locatorTransforms=[]};t.EveShip=function(e){function t(){s(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible.turretSets=!0,e.visible.boosters=!0,e.boosters=null,e.turretSets=[],e._turretSetsLocatorInfo=[],e.boosterGain=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EveSpaceObject),i(t,[{key:"Initialize",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),this.boosters&&this.RebuildBoosterSet()}},{key:"RebuildBoosterSet",value:function(){if(this.boosters){this.boosters.Clear();for(var e=this.FindLocatorsByPrefix("locator_booster"),t=0;t<e.length;++t)this.boosters.Add(e[t].transform,e[t].atlasIndex0,e[t].atlasIndex1,e[t].name);this.boosters.Rebuild()}}},{key:"RebuildTurretPositions",value:function(){this._turretSetsLocatorInfo=[];for(var e=0;e<this.turretSets.length;++e){for(var t=this.turretSets[e].locatorName,r=this.GetLocatorCount(t),i=new o,n=0;n<r;++n){var a=t+String.fromCharCode("a".charCodeAt(0)+n),s=this.FindLocatorJointByName(a);null!==s?i.isJoint=!0:s=this.FindLocatorTransformByName(a),null!==s&&(this.turretSets[e].SetLocalTransform(n,s,a),i.locatorTransforms.push(s))}this._turretSetsLocatorInfo.push(i)}}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetResources",this).call(this,e,r);for(var i=0;i<this.turretSets.length;i++)this.turretSets[i].GetResources(e);return this.boosters&&this.boosters.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"UpdateViewDependentData",this).call(this);for(var e=0;e<this.turretSets.length;++e)this.turretSets[e].UpdateViewDependentData()}},{key:"Update",value:function(e){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e),this.boosters&&(this.boosters.rebuildPending&&this.RebuildBoosterSet(),this.boosters.Update(e,this.transform));for(var r=0;r<this.turretSets.length;++r)if(r<this._turretSetsLocatorInfo.length&&this._turretSetsLocatorInfo[r].isJoint)for(var i=this._turretSetsLocatorInfo[r],a=0;a<i.locatorTransforms.length;++a)this.turretSets[r].SetLocalTransform(a,i.locatorTransforms[a]);for(var s=0;s<this.turretSets.length;++s)this.turretSets[s].Update(e,this.transform)}},{key:"GetBatches",value:function(e,r){if(this.display){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetBatches",this).call(this,e,r),this._perObjectData.perObjectVSData.Get("Shipdata")[0]=this.boosterGain,this._perObjectData.perObjectPSData.Get("Shipdata")[0]=this.boosterGain;for(var i=0;i<this.turretSets.length;++i)this.lod>1&&this.visible.turretSets?this.turretSets[i].GetBatches(e,r,this._perObjectData,this.visible.turretEffects):this.visible.turretEffects&&this.turretSets[i].GetEffectBatches(e,r,this._perObjectData);this.boosters&&this.visible.boosters&&this.boosters.GetBatches(e,r,this._perObjectData)}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveOccluder=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1);(t.EveOccluder=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.value=1,this.sprites=[],e.init()}return i(e,[{key:"UpdateValue",value:function(t,r){if(this.display&&a.device.alphaBlendBackBuffer){var i=e.global,s=i.mat4_0,o=i.vec4_0;i.accumulator.Clear();for(var l=0;l<this.sprites.length;++l)this.sprites[l].UpdateViewDependentData(t),this.sprites[l].GetBatches(a.device.RM_DECAL,i.accumulator);a.store.GetVariable("OccluderValue").value.set([(1<<2*r)/255,(2<<2*r)/255,0,0]),i.accumulator.Render(),n.mat4.multiply(s,a.device.viewProjection,this.sprites[0].worldTransform),n.vec4.transformMat4(o,[0,0,0,1],s);var c=.5*(o[0]/o[3]+1),u=.5*(o[1]/o[3]+1);n.vec4.set(o,.5,.5,0,1),n.vec4.transformMat4(o,o,s);var h=.5*(o[0]/o[3]+1),f=.5*(o[1]/o[3]+1);o[0]=c,o[1]=u,o[2]=h-c,o[3]=f-u,i.effect.parameters.OccluderPosition.SetValue(o)}}}],[{key:"CollectSamples",value:function(e,t,r,i){var n=this.global,s=n.effect,o=n.vertexBuffer,l=n.decl;if(!s.IsGood())return!1;s.parameters.BackBuffer.textureRes=e,s.parameters.OccluderIndex.SetValue([t,r,i]),a.device.SetStandardStates(a.device.RM_ADDITIVE),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,o);for(var c=0;c<s.GetPassCount();++c){if(s.ApplyPass(c),l.SetDeclaration(s.GetPassInput(c),16))return!1;a.device.ApplyShadowState(),a.device.gl.drawArrays(a.device.gl.TRIANGLES,0,1530)}return!0}},{key:"init",value:function(){if(!e.global){var t=e.global={};t.mat4_0=n.mat4.create(),t.vec4_0=n.vec4.create(),t.accumulator=new a.Tw2BatchAccumulator,t.effect=a.Tw2Effect.create({name:"Occluder sampler collector",effectFilePath:"res:/graphics/effect/managed/space/specialfx/lensflares/collectsamples.fx",parameters:{OccluderPosition:n.vec4.fromValues(1,1,1,1),OccluderIndex:n.vec3.fromValues(1,1,1)},textures:{BackBuffer:""}}),t.vertexBuffer=null,t.decl=new a.Tw2VertexDeclaration([["POSITION",0,"FLOAT",2,0],["TEXCOORD",0,"FLOAT",2,8]]);for(var r=new Float32Array(6120),i=0,s=0;s<16;++s)for(var o=0;o<16;++o){var l=(s+Math.random())/16*2-1,c=(o+Math.random())/16*2-1;r[i++]=1,r[i++]=1,r[i++]=l,r[i++]=c,r[i++]=-1,r[i++]=1,r[i++]=l,r[i++]=c,r[i++]=1,r[i++]=-1,r[i++]=l,r[i++]=c,r[i++]=-1,r[i++]=1,r[i++]=l,r[i++]=c,r[i++]=1,r[i++]=-1,r[i++]=l,r[i++]=c,r[i++]=-1,r[i++]=-1,r[i++]=l,r[i++]=c}t.vertexBuffer=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,t.vertexBuffer),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,r,a.device.gl.STATIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,null)}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveBoosterBatch=a,t.EveBoosterSet=s;var i=r(0),n=r(1);function a(){this.renderMode=n.device.RM_ANY,this.perObjectData=null,this.boosters=null}function s(){this.display=!0,this.effect=null,this.glows=null,this.glowScale=1,this.glowColor=i.vec4.create(),this.warpGlowColor=i.vec4.create(),this.warpHaloColor=i.vec4.create(),this.symHaloScale=1,this.haloScaleX=1,this.haloScaleY=1,this.maxVel=250,this.haloColor=i.vec4.create(),this.alwaysOn=!0,this.trailColor=i.vec4.create(),this.trailSize=i.vec4.create(),this._parentTransform=i.mat4.create(),this._wavePhase=i.mat4.create(),this._boosterTransforms=[],this._positions=n.device.gl.createBuffer(),this._decl=new n.Tw2VertexDeclaration,this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,2,12)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,4,20)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,4,36)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,3,n.device.gl.FLOAT,4,52)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,4,n.device.gl.FLOAT,4,68)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,5,n.device.gl.FLOAT,4,84)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,6,n.device.gl.FLOAT,1,100)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,7,n.device.gl.FLOAT,2,104)),this._decl.RebuildHash(),this._perObjectData=new n.Tw2PerObjectData,this._perObjectData.perObjectVSData=new n.Tw2RawData,this._perObjectData.perObjectVSData.Declare("WorldMat",16),this._perObjectData.perObjectVSData.Declare("Shipdata",4),this._perObjectData.perObjectVSData.Create(),this.rebuildPending=!1}a.prototype.Commit=function(e){this.boosters.Render(e)},s.prototype.Initialize=function(){this.rebuildPending=!0},s.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.effect&&this.effect.GetResources(e),null!==this.glows&&null!==this.glows.effect&&this.glows.effect.GetResources(e),e},s.prototype.Clear=function(){this._boosterTransforms=[],this._wavePhase=i.mat4.create(),this.glows&&this.glows.Clear()},s.scratch={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create()},s.prototype.Add=function(e,t,r,n){var a=s.scratch;if(this._boosterTransforms[this._boosterTransforms.length]={name:n,transform:i.mat4.clone(e),atlas0:t,atlas1:r},this._wavePhase[this._wavePhase.length]=Math.random(),this.glows){var o=i.vec3.set(a.vec3_0,e[12],e[13],e[14]),l=i.vec3.set(a.vec3_1,e[8],e[9],e[10]),c=Math.max(i.vec3.length([e[0],e[1],e[2]]),i.vec3.length([e[4],e[5],e[6]]));i.vec3.normalize(l,l),c<3&&i.vec3.scale(l,l,c/3);var u=.7*Math.random(),h=a.vec3_2;i.vec3.subtract(h,o,i.vec3.scale(h,l,2.5)),this.glows.Add(h,u,u,c*this.glowScale,c*this.glowScale,0,this.glowColor,this.warpGlowColor),i.vec3.subtract(h,o,i.vec3.scale(h,l,3)),this.glows.Add(h,u,1+u,c*this.symHaloScale,c*this.symHaloScale,0,this.haloColor,this.warpGlowColor),i.vec3.subtract(h,o,i.vec3.scale(h,l,3.01)),this.glows.Add(h,u,1+u,c*this.haloScaleX,c*this.haloScaleY,0,this.haloColor,this.warpGlowColor)}},s.prototype.Rebuild=function(){for(var e=new Float32Array(this._boosterTransforms.length*s._box.length*6*28),t=[0,3,1,3,2,1],r=0,i=0;i<this._boosterTransforms.length;++i)for(var a=0;a<s._box.length;++a)for(var o=0;o<t.length;++o)e[r++]=s._box[a][t[o]][0],e[r++]=s._box[a][t[o]][1],e[r++]=s._box[a][t[o]][2],e[r++]=0,e[r++]=0,e.set(this._boosterTransforms[i].transform,r),r+=16,e[r++]=0,e[r++]=1,e[r++]=1,e[r++]=1,e[r++]=this._wavePhase[i],e[r++]=this._boosterTransforms[i].atlas0,e[r++]=this._boosterTransforms[i].atlas1;n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._positions),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,e,n.device.gl.STATIC_DRAW),this.rebuildPending=!1,this.glows&&this.glows.RebuildBuffers()},s.prototype.Update=function(e,t){this.glows&&this.glows.Update(e),this._parentTransform=t},s.prototype.GetBatches=function(e,t,r){if(this.display&&e===n.device.RM_ADDITIVE){if(this.effect&&this._boosterTransforms.length){var s=new a;i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this._parentTransform),this._perObjectData.perObjectVSData.Set("Shipdata",r.perObjectVSData.Get("Shipdata")),this._perObjectData.perObjectPSData=r.perObjectPSData,s.perObjectData=this._perObjectData,s.boosters=this,s.renderMode=n.device.RM_ADDITIVE,t.Commit(s)}this.glows&&this.glows.GetBoosterGlowBatches(e,t,r,this._parentTransform,r.perObjectVSData.Get("Shipdata")[0],0)}},s.prototype.Render=function(e){var t=void 0===e?this.effect:e;if(!t.GetEffectRes().IsGood())return!1;n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._positions);for(var r=0;r<t.GetPassCount();++r){if(t.ApplyPass(r),!this._decl.SetDeclaration(t.GetPassInput(r),112))return!1;n.device.ApplyShadowState(),n.device.gl.drawArrays(n.device.gl.TRIANGLES,0,12*this._boosterTransforms.length*3)}return!0},s._box=[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],[[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,-1,-1]],[[-1,-1,0],[-1,1,0],[-1,1,-1],[-1,-1,-1]],[[1,-1,0],[1,-1,-1],[1,1,-1],[1,1,0]],[[-1,-1,0],[-1,-1,-1],[1,-1,-1],[1,-1,0]],[[-1,1,0],[1,1,0],[1,1,-1],[-1,1,-1]]]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLocator=void 0;var i=r(0);t.EveLocator=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.atlasIndex0=null,this.atlasIndex1=null,this.transform=i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlaneSetBatch=a,t.EvePlaneSetItem=function(){this.display=!0,this.name="",this.position=i.vec3.create(),this.scaling=i.vec3.fromValues(1,1,1),this.rotation=i.quat.create(),this.color=i.vec4.fromValues(1,1,1,1),this.layer1Transform=i.vec4.fromValues(1,1,0,0),this.layer2Transform=i.vec4.fromValues(1,1,0,0),this.layer1Scroll=i.quat.create(),this.layer2Scroll=i.quat.create(),this.boneIndex=0,this.groupIndex=-1,this.maskAtlasID=0},t.EvePlaneSet=s;var i=r(0),n=r(1);function a(){this.renderMode=n.device.RM_ANY,this.perObjectData=null,this.planeSet=null}function s(){this.name="",this.planes=[],this.effect=null,this.display=!0,this.hideOnLowQuality=!1,this._time=0,this._vertexBuffer=null,this._indexBuffer=null,this._decl=new n.Tw2VertexDeclaration,this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,4,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,4,16)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,4,32)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,4,48)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,3,n.device.gl.FLOAT,4,64)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,4,n.device.gl.FLOAT,4,80)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,5,n.device.gl.FLOAT,4,96)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,6,n.device.gl.FLOAT,4,112)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,7,n.device.gl.FLOAT,3,128)),this._decl.RebuildHash()}a.prototype.Commit=function(e){this.planeSet.Render(e)},s.prototype.Initialize=function(){this.RebuildBuffers()},s.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.effect&&this.effect.GetResources(e),e},s.prototype.RebuildBuffers=function(){for(var e=[],t=s.scratch.mat4_0,r=0;r<this.planes.length;r++)this.planes[r].display&&e.push(this.planes[r]);for(var a=new Float32Array(4*e.length*35),o=0;o<e.length;++o){a[(h=4*o*35)+35-3]=0,a[h+35+35-3]=1,a[h+70+35-3]=2,a[h+105+35-3]=3;for(var l=i.mat4.fromRotationTranslationScale(t,e[o].rotation,e[o].position,e[o].scaling),c=0;c<4;++c)a[(f=h+35*c)+0]=l[0],a[f+1]=l[4],a[f+2]=l[8],a[f+3]=l[12],a[f+4]=l[1],a[f+5]=l[5],a[f+6]=l[9],a[f+7]=l[13],a[f+8]=l[2],a[f+9]=l[6],a[f+10]=l[10],a[f+11]=l[14],a[f+12]=e[o].color[0],a[f+13]=e[o].color[1],a[f+14]=e[o].color[2],a[f+15]=e[o].color[3],a[f+16]=e[o].layer1Transform[0],a[f+17]=e[o].layer1Transform[1],a[f+18]=e[o].layer1Transform[2],a[f+19]=e[o].layer1Transform[3],a[f+20]=e[o].layer2Transform[0],a[f+21]=e[o].layer2Transform[1],a[f+22]=e[o].layer2Transform[2],a[f+23]=e[o].layer2Transform[3],a[f+24]=e[o].layer1Scroll[0],a[f+25]=e[o].layer1Scroll[1],a[f+26]=e[o].layer1Scroll[2],a[f+27]=e[o].layer1Scroll[3],a[f+28]=e[o].layer2Scroll[0],a[f+29]=e[o].layer2Scroll[1],a[f+30]=e[o].layer2Scroll[2],a[f+31]=e[o].layer2Scroll[3],a[f+33]=e[o].boneIndex,a[f+34]=e[o].maskAtlasID}this._vertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,a,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,null);var u=new Uint16Array(6*e.length);for(o=0;o<e.length;++o){var h,f=4*o;u[h=6*o]=f,u[h+1]=f+2,u[h+2]=f+1,u[h+3]=f+0,u[h+4]=f+3,u[h+5]=f+2}this._indexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.device.gl.bufferData(n.device.gl.ELEMENT_ARRAY_BUFFER,u,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*e.length},s.prototype.GetBatches=function(e,t,r){if(this.display&&e===n.device.RM_ADDITIVE){var i=new a;i.renderMode=n.device.RM_ADDITIVE,i.planeSet=this,i.perObjectData=r,t.Commit(i)}},s.prototype.Render=function(e){var t=e||this.effect;if(t&&this._vertexBuffer&&t.GetEffectRes().IsGood()){n.device.SetStandardStates(n.device.RM_ADDITIVE),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var r=0;r<t.GetPassCount();++r){if(t.ApplyPass(r),!this._decl.SetDeclaration(t.GetPassInput(r),140))return;n.device.ApplyShadowState(),n.device.gl.drawElements(n.device.gl.TRIANGLES,this._indexBuffer.count,n.device.gl.UNSIGNED_SHORT,0)}}},s.prototype.Update=function(e){this._time+=e},s.prototype.Clear=function(){this.planes=[]},s.scratch={mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceObjectDecal=a;var i=r(0),n=r(1);function a(){this.display=!0,this.decalEffect=null,this.pickEffect=null,this.name="",this.groupIndex=-1,this.pickable=!0,this.position=i.vec3.create(),this.rotation=i.quat.create(),this.scaling=i.vec3.create(),this.decalMatrix=i.mat4.create(),this.invDecalMatrix=i.mat4.create(),this.parentGeometry=null,this.indexBuffer=[],this._indexBuffer=null,this.parentBoneIndex=-1,this._perObjectData=new n.Tw2PerObjectData,this._perObjectData.perObjectVSData=new n.Tw2RawData,this._perObjectData.perObjectVSData.Declare("worldMatrix",16),this._perObjectData.perObjectVSData.Declare("invWorldMatrix",16),this._perObjectData.perObjectVSData.Declare("decalMatrix",16),this._perObjectData.perObjectVSData.Declare("invDecalMatrix",16),this._perObjectData.perObjectVSData.Declare("parentBoneMatrix",16),this._perObjectData.perObjectVSData.Create(),this._perObjectData.perObjectPSData=new n.Tw2RawData,this._perObjectData.perObjectPSData.Declare("displayData",4),this._perObjectData.perObjectPSData.Declare("shipData",12),this._perObjectData.perObjectPSData.Create(),i.mat4.identity(this._perObjectData.perObjectVSData.Get("parentBoneMatrix"))}a.prototype.Initialize=function(){var e=new Uint16Array(this.indexBuffer);this._indexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.device.gl.bufferData(n.device.gl.ELEMENT_ARRAY_BUFFER,e,n.device.gl.STATIC_DRAW),i.mat4.fromRotationTranslationScale(this.decalMatrix,this.rotation,this.position,this.scaling),i.mat4.invert(this.invDecalMatrix,this.decalMatrix)},a.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.parentGeometry&&-1===e.indexOf(this.parentGeometry)&&e.push(this.parentGeometry),null!==this.decalEffect&&this.decalEffect.GetResources(e),e},a.prototype.SetParentGeometry=function(e){this.parentGeometry=e},a.prototype.GetBatches=function(e,t,r,a){switch(e){case n.device.RM_DECAL:if(!this.decalEffect)return;break;case n.device.RM_PICKABLE:if(!this.pickEffect||!this.pickable)return;break;default:return}if(this.display&&this.indexBuffer.length&&this.parentGeometry&&this.parentGeometry.IsGood()){var s=new n.Tw2ForwardingRenderBatch;if(this._perObjectData.perObjectVSData.Set("worldMatrix",r.perObjectVSData.Get("WorldMat")),this.parentBoneIndex>=0){var o=r.perObjectVSData.Get("JointMat"),l=12*this.parentBoneIndex;if(o[l+0]||o[l+4]||o[l+8]){var c=this._perObjectData.perObjectVSData.Get("parentBoneMatrix");c[0]=o[l+0],c[1]=o[l+4],c[2]=o[l+8],c[3]=0,c[4]=o[l+1],c[5]=o[l+5],c[6]=o[l+9],c[7]=0,c[8]=o[l+2],c[9]=o[l+6],c[10]=o[l+10],c[11]=0,c[12]=o[l+3],c[13]=o[l+7],c[14]=o[l+11],c[15]=1,i.mat4.transpose(c,c)}}i.mat4.invert(this._perObjectData.perObjectVSData.Get("invWorldMatrix"),this._perObjectData.perObjectVSData.Get("worldMatrix")),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("decalMatrix"),this.decalMatrix),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("invDecalMatrix"),this.invDecalMatrix),this._perObjectData.perObjectPSData.Get("displayData")[0]=a||0,this._perObjectData.perObjectPSData.Set("shipData",r.perObjectPSData.data),s.perObjectData=this._perObjectData,s.geometryProvider=this,s.renderMode=e,t.Commit(s)}},a.prototype.Render=function(e,t){var r=this.parentGeometry.meshes[0].indexes,a=this.parentGeometry.meshes[0].areas[0].start,s=this.parentGeometry.meshes[0].areas[0].count,o=this.parentGeometry.meshes[0].indexType;i.mat4.copy(n.store.GetVariable("u_DecalMatrix").value,this.decalMatrix),i.mat4.copy(n.store.GetVariable("u_InvDecalMatrix").value,this.invDecalMatrix),this.parentGeometry.meshes[0].indexes=this._indexBuffer,this.parentGeometry.meshes[0].areas[0].start=0,this.parentGeometry.meshes[0].areas[0].count=this.indexBuffer.length,this.parentGeometry.meshes[0].indexType=n.device.gl.UNSIGNED_SHORT,this.parentGeometry.RenderAreas(0,0,1,t||(e.renderMode===n.device.RM_DECAL?this.decalEffect:this.pickEffect)),this.parentGeometry.meshes[0].indexes=r,this.parentGeometry.meshes[0].areas[0].start=a,this.parentGeometry.meshes[0].areas[0].count=s,this.parentGeometry.meshes[0].indexType=o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpotlightSetItem=function(){this.display=!0,this.name="",this.transform=i.mat4.create(),this.coneColor=i.vec4.create(),this.spriteColor=i.vec4.create(),this.flareColor=i.vec4.create(),this.spriteScale=i.vec3.create(),this.boosterGainInfluence=!1,this.boneIndex=0,this.groupIndex=-1,this.coneIntensity=1,this.spriteIntensity=1,this.flareIntensity=1},t.EveSpotlightSet=a,t.EveSpotlightSetBatch=s;var i=r(0),n=r(1);function a(){this.name="",this.display=!0,this.coneEffect=null,this.glowEffect=null,this.spotlightItems=[],this._coneVertexBuffer=null,this._spriteVertexBuffer=null,this._indexBuffer=null,this._decl=new n.Tw2VertexDeclaration,this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,4,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,4,16)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,4,32)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,4,48)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,3,n.device.gl.FLOAT,3,64)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,4,n.device.gl.FLOAT,3,76)),this._decl.RebuildHash()}function s(){this.renderMode=n.device.RM_ANY,this.perObjectData=null,this.spotlightSet=null}a.prototype.Initialize=function(){this.RebuildBuffers()},a.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.coneEffect&&this.coneEffect.GetResources(e),null!==this.glowEffect&&this.glowEffect.GetResources(e),e},a.prototype.RebuildBuffers=function(){for(var e=[],t=0;t<this.spotlightItems.length;t++)this.spotlightItems[t].display&&e.push(this.spotlightItems[t]);var r=e.length;if(0!==r){var i=new Float32Array(22*(4*r*4)),a=[1,0,2,3];for(t=0;t<r;++t)for(var s=e[t],o=0;o<4;++o)for(var l=0;l<4;++l){i[(c=22*(4*t*4+4*o+l))+0]=s.coneColor[0]*s.coneIntensity,i[c+1]=s.coneColor[1]*s.coneIntensity,i[c+2]=s.coneColor[2]*s.coneIntensity,i[c+3]=s.coneColor[3],i[c+4]=s.transform[0],i[c+5]=s.transform[4],i[c+6]=s.transform[8],i[c+7]=s.transform[12],i[c+8]=s.transform[1],i[c+9]=s.transform[5],i[c+10]=s.transform[9],i[c+11]=s.transform[13],i[c+12]=s.transform[2],i[c+13]=s.transform[6],i[c+14]=s.transform[10],i[c+15]=s.transform[14],i[c+16]=1,i[c+17]=1,i[c+18]=1,i[c+19]=4*o+a[l],i[c+20]=s.boneIndex,i[c+21]=s.boosterGainInfluence?255:0}this._coneVertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._coneVertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,i,n.device.gl.STATIC_DRAW),this._coneVertexBuffer.count=4*r*6;i=new Float32Array(22*(2*r*4));for(a=[1,0,2,3],t=0;t<r;++t)for(s=e[t],o=0;o<2;++o)for(l=0;l<4;++l){var c=22*(2*t*4+4*o+l);o%2==0?(i[c+0]=s.spriteColor[0]*s.spriteIntensity,i[c+1]=s.spriteColor[1]*s.spriteIntensity,i[c+2]=s.spriteColor[2]*s.spriteIntensity,i[c+3]=s.spriteColor[3],i[c+16]=s.spriteScale[0],i[c+17]=1,i[c+18]=1):(i[c+0]=s.flareColor[0]*s.flareIntensity,i[c+1]=s.flareColor[1]*s.flareIntensity,i[c+2]=s.flareColor[2]*s.flareIntensity,i[c+3]=s.flareColor[3],i[c+16]=1,i[c+17]=s.spriteScale[1],i[c+18]=s.spriteScale[2]),i[c+4]=s.transform[0],i[c+5]=s.transform[4],i[c+6]=s.transform[8],i[c+7]=s.transform[12],i[c+8]=s.transform[1],i[c+9]=s.transform[5],i[c+10]=s.transform[9],i[c+11]=s.transform[13],i[c+12]=s.transform[2],i[c+13]=s.transform[6],i[c+14]=s.transform[10],i[c+15]=s.transform[14],i[c+19]=4*o+a[l],i[c+20]=s.boneIndex,i[c+21]=s.boosterGainInfluence?255:0}this._spriteVertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._spriteVertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,i,n.device.gl.STATIC_DRAW),this._spriteVertexBuffer.count=2*r*6;for(a=new Uint16Array(4*r*6),t=0;t<4*r;++t){var u=4*t;a[c=6*t]=u,a[c+1]=u+1,a[c+2]=u+2,a[c+3]=u+2,a[c+4]=u+3,a[c+5]=u+0}this._indexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.device.gl.bufferData(n.device.gl.ELEMENT_ARRAY_BUFFER,a,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,null)}},s.prototype.Commit=function(e){this.spotlightSet.RenderCones(e),this.spotlightSet.RenderGlow(e)},a.prototype.GetBatches=function(e,t,r){if(this.display&&e===n.device.RM_ADDITIVE){var i=new s;i.renderMode=n.device.RM_ADDITIVE,i.spotlightSet=this,i.perObjectData=r,t.Commit(i)}},a.prototype.RenderCones=function(e){var t=e||this.coneEffect;this._Render(t,this._coneVertexBuffer)},a.prototype.RenderGlow=function(e){var t=e||this.glowEffect;this._Render(t,this._spriteVertexBuffer)},a.prototype._Render=function(e,t){if(e&&t&&this._indexBuffer&&e.GetEffectRes().IsGood()){n.device.SetStandardStates(n.device.RM_ADDITIVE),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,t);n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var r=0;r<e.GetPassCount();++r){if(e.ApplyPass(r),!this._decl.SetDeclaration(e.GetPassInput(r),88))return;n.device.ApplyShadowState(),n.device.gl.drawElements(n.device.gl.TRIANGLES,t.count,n.device.gl.UNSIGNED_SHORT,0)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpriteSetItem=a,t.EveSpriteSetBatch=s,t.EveSpriteSet=o;var i=r(0),n=r(1);function a(){this.display=!0,this.name="",this.position=i.vec3.create(),this.blinkRate=0,this.blinkPhase=0,this.minScale=1,this.maxScale=1,this.falloff=0,this.color=i.vec4.create(),this.warpColor=i.vec4.create(),this.boneIndex=0,this.groupIndex=-1}function s(){this.renderMode=n.device.RM_ANY,this.perObjectData=null,this.boosterGlow=!1,this.spriteSet=null,this.world=null,this.boosterGain=0,this.warpIntensity=0}function o(e,t){this.name="",this.sprites=[],this.effect=null,this.display=!0,this._time=0,this.useQuads=e,this.isSkinned=t,this._vertexBuffer=null,this._indexBuffer=null,this._instanceBuffer=null,this._decl=new n.Tw2VertexDeclaration,e?(this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,4,12)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,2,28)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,4,36)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,1,n.device.gl.FLOAT,4,52))):(this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,5,n.device.gl.FLOAT,2,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,8)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,3,20)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,1,32)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,1,36)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,1,40)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,3,n.device.gl.FLOAT,1,44)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,4,n.device.gl.FLOAT,1,48))),this._decl.RebuildHash(),this._vdecl=new n.Tw2VertexDeclaration,this._vdecl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,5,n.device.gl.FLOAT,1,0)),this._vdecl.RebuildHash()}s.prototype.Commit=function(e){this.boosterGlow?this.spriteSet.RenderBoosterGlow(e,this.world,this.boosterGain,this.warpIntensity):this.spriteSet.Render(e,this.world,this.perObjectData)},o.prototype.Initialize=function(){this.RebuildBuffers()},o.prototype.UseQuads=function(e,t){this.useQuads!==e&&(this.useQuads=e,this.isSkinned=t,this._decl.elements.splice(0,this._decl.elements.length),e?(this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,4,12)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,2,28)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,4,36)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,1,n.device.gl.FLOAT,4,52))):(this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,5,n.device.gl.FLOAT,2,0)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,8)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,3,20)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,1,32)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,1,36)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,1,40)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,3,n.device.gl.FLOAT,1,44)),this._decl.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,4,n.device.gl.FLOAT,1,48))),this._decl.RebuildHash(),this.RebuildBuffers())},o.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.effect&&this.effect.GetResources(e),e},o.prototype.RebuildBuffers=function(){if(this.useQuads)return this._vertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,new Float32Array([0,1,2,2,3,0]),n.device.gl.STATIC_DRAW),void(this._instanceBuffer=n.device.gl.createBuffer());for(var e,t,r=[],i=0;i<this.sprites.length;i++)this.sprites[i].display&&r.push(this.sprites[i]);var a=new Float32Array(4*r.length*13);for(i=0;i<r.length;++i){a[e=4*i*13]=0,a[e+13]=1,a[e+26]=2,a[e+39]=3;for(var s=0;s<4;++s)a[(t=e+13*s)+1]=r[i].boneIndex,a[t+2]=r[i].position[0],a[t+3]=r[i].position[1],a[t+4]=r[i].position[2],a[t+5]=r[i].color[0],a[t+6]=r[i].color[1],a[t+7]=r[i].color[2],a[t+8]=r[i].blinkPhase,a[t+9]=r[i].blinkRate,a[t+10]=r[i].minScale,a[t+11]=r[i].maxScale,a[t+12]=r[i].falloff}this._vertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,a,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,null);var o=new Uint16Array(6*r.length);for(i=0;i<r.length;++i)t=4*i,o[e=6*i]=t,o[e+1]=t+2,o[e+2]=t+1,o[e+3]=t+0,o[e+4]=t+3,o[e+5]=t+2;this._indexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.device.gl.bufferData(n.device.gl.ELEMENT_ARRAY_BUFFER,o,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*r.length},o.prototype.GetBatches=function(e,t,r,i){if(this.display&&e===n.device.RM_ADDITIVE){var a=new s;a.world=i,a.renderMode=n.device.RM_ADDITIVE,a.spriteSet=this,a.perObjectData=r,t.Commit(a)}},o.prototype.GetBoosterGlowBatches=function(e,t,r,i,a,o){if(this.display&&e===n.device.RM_ADDITIVE){var l=new s;l.boosterGlow=!0,l.world=i,l.boosterGain=a,l.warpIntensity=o,l.renderMode=n.device.RM_ADDITIVE,l.spriteSet=this,l.perObjectData=r,t.Commit(l)}},o.prototype.Render=function(e,t,r){if(this.useQuads)return this.RenderQuads(e,t,r);var i=void 0===e?this.effect:e;if(i&&this._vertexBuffer&&i.GetEffectRes().IsGood()){n.device.SetStandardStates(n.device.RM_ADDITIVE),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bindBuffer(n.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var a=0;a<i.GetPassCount();++a){if(i.ApplyPass(a),!this._decl.SetDeclaration(i.GetPassInput(a),52))return;n.device.ApplyShadowState(),n.device.gl.drawElements(n.device.gl.TRIANGLES,this._indexBuffer.count,n.device.gl.UNSIGNED_SHORT,0)}}},o.scratch={vec3_0:i.vec3.create()},o.prototype.RenderBoosterGlow=function(e,t,r,a){var s=void 0===e?this.effect:e;if(s&&this._vertexBuffer&&s.GetEffectRes().IsGood()){n.device.SetStandardStates(n.device.RM_ADDITIVE);for(var l=new Float32Array(17*this.sprites.length),c=0,u=o.scratch.vec3_0,h=0;h<this.sprites.length;++h)i.vec3.transformMat4(u,this.sprites[h].position,t),l[c++]=u[0],l[c++]=u[1],l[c++]=u[2],l[c++]=t[8],l[c++]=this.sprites[h].blinkPhase,l[c++]=t[9],l[c++]=this.sprites[h].minScale,l[c++]=this.sprites[h].maxScale,l[c++]=t[10],l[c++]=this.sprites[h].color[0],l[c++]=this.sprites[h].color[1],l[c++]=this.sprites[h].color[2],l[c++]=r,l[c++]=this.sprites[h].warpColor[0],l[c++]=this.sprites[h].warpColor[1],l[c++]=this.sprites[h].warpColor[2],l[c++]=a;n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._instanceBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,l,n.device.gl.DYNAMIC_DRAW);for(var f=0;f<s.GetPassCount();++f){s.ApplyPass(f);var p=s.GetPassInput(f);n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(p,4),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._instanceBuffer);var d=this._decl.SetPartialDeclaration(p,68,0,1);n.device.ApplyShadowState(),n.device.ext.drawArraysInstanced(n.device.gl.TRIANGLES,0,6,this.sprites.length),this._decl.ResetInstanceDivisors(d)}}},o.prototype.RenderQuads=function(e,t,r){var a=void 0===e?this.effect:e;if(a&&this._vertexBuffer&&a.GetEffectRes().IsGood()){n.device.SetStandardStates(n.device.RM_ADDITIVE);for(var s,l=new Float32Array(17*this.sprites.length),c=0,u=o.scratch.vec3_0,h=r.perObjectVSData.Get("JointMat"),f=0;f<this.sprites.length;++f){if(s=this.sprites[f],this.isSkinned){var p=12*s.boneIndex;u[0]=h[p]*s.position[0]+h[p+1]*s.position[1]+h[p+2]*s.position[2]+h[p+3],u[1]=h[p+4]*s.position[0]+h[p+5]*s.position[1]+h[p+6]*s.position[2]+h[p+7],u[2]=h[p+8]*s.position[0]+h[p+9]*s.position[1]+h[p+10]*s.position[2]+h[p+11],i.vec3.transformMat4(u,u,t)}else i.vec3.transformMat4(u,s.position,t);l[c++]=u[0],l[c++]=u[1],l[c++]=u[2],l[c++]=1,l[c++]=s.blinkPhase,l[c++]=s.blinkRate,l[c++]=s.minScale,l[c++]=s.maxScale,l[c++]=s.falloff,l[c++]=s.color[0],l[c++]=s.color[1],l[c++]=s.color[2],l[c++]=1,l[c++]=s.warpColor[0],l[c++]=s.warpColor[1],l[c++]=s.warpColor[2],l[c++]=1}n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._instanceBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,l,n.device.gl.DYNAMIC_DRAW);for(var d=0;d<a.GetPassCount();++d){a.ApplyPass(d);var v=a.GetPassInput(d);n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(v,4),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._instanceBuffer);var m=this._decl.SetPartialDeclaration(v,68,0,1);n.device.ApplyShadowState(),n.device.ext.drawArraysInstanced(n.device.gl.TRIANGLES,0,6,this.sprites.length),this._decl.ResetInstanceDivisors(m)}}},o.prototype.Update=function(e){this._time+=e},o.prototype.Clear=function(){this.sprites=[]},o.prototype.Add=function(e,t,r,n,s,o,l){var c=new a;c.display=!0,i.vec3.copy(c.position,e),c.blinkRate=t,c.blinkPhase=r,c.minScale=n,c.maxScale=s,c.falloff=o,i.vec4.copy(c.color,l),this.sprites.push(c)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.math=void 0;var i=r(1);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(41);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(130);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(39);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=f(r(0)),l=f(i),c=f(n),u=f(a),h=f(s);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var p=o.vec4,d=o.mat4;i.store.Register({uuid:!1,resourcePaths:{res:"https://developers.eveonline.com/ccpwgl/assetpath/1097993/"},extensions:{sm_hi:l.Tw2EffectRes,sm_lo:l.Tw2EffectRes,wbg:l.Tw2GeometryRes,png:l.Tw2TextureRes,cube:l.Tw2TextureRes},constructors:[l,c,u,h],types:{float:l.Tw2FloatParameter,vector2:l.Tw2Vector2Parameter,vector3:l.Tw2Vector3Parameter,vector4:l.Tw2Vector4Parameter,matrix4:l.Tw2MatrixParameter,texture:l.Tw2TextureParameter},variables:{u_DecalMatrix:d.create(),u_InvDecalMatrix:d.create(),EveSpaceSceneEnvMap:"",EnvMap1:"",EnvMap2:"",EnvMap3:"",ShadowLightness:0,LensflareFxDirectionScale:p.create(),LensflareFxOccScale:p.fromValues(1,1,0,0),OccluderValue:p.create(),WorldMat:d.create(),ViewMat:d.create(),ProjectionMat:d.create(),ViewProjectionMat:d.create(),ViewportSize:p.create(),Time:p.create()}}),t.math=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0;var i=r(8);t.vec2=i.vec2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new i.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){let t=new i.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,n){let a=new i.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.transpose=function(e,t){if(e===t){let r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=r*a-n*i;if(!s)return null;return s=1/s,e[0]=a*s,e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e},t.adjoint=function(e,t){let r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=n,t.rotate=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*o,e[1]=n*l+s*o,e[2]=i*-o+a*l,e[3]=n*-o+s*l,e},t.scale=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],l=r[1];return e[0]=i*o,e[1]=n*o,e[2]=a*l,e[3]=s*l,e},t.fromRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=a,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-u)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e};var i=r(5);function n(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*o+a*l,e[1]=n*o+s*l,e[2]=i*c+a*u,e[3]=n*c+s*u,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}const s=n;t.mul=s;const o=a;t.sub=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new i.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){let t=new i.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,n,a,s){let o=new i.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=a,o[5]=s,o},t.set=function(e,t,r,i,n,a,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e},t.invert=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=r*a-i*n;if(!l)return null;return l=1/l,e[0]=a*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*o-a*s)*l,e[5]=(i*s-r*o)*l,e},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=n,t.rotate=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+a*c,e[1]=n*u+s*c,e[2]=i*-c+a*u,e[3]=n*-c+s*u,e[4]=o,e[5]=l,e},t.scale=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=a*u,e[3]=s*u,e[4]=o,e[5]=l,e},t.translate=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=i*c+a*u+o,e[5]=n*c+s*u+l,e},t.fromRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=t[0],u=t[1],h=t[2],f=t[3],p=t[4],d=t[5];return Math.abs(r-c)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-f)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-d)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(d))};var i=r(5);function n(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=r[0],u=r[1],h=r[2],f=r[3],p=r[4],d=r[5];return e[0]=i*c+a*u,e[1]=n*c+s*u,e[2]=i*h+a*f,e[3]=n*h+s*f,e[4]=i*p+a*d+o,e[5]=n*p+s*d+l,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const s=n;t.mul=s;const o=a;t.sub=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new i.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){let t=new i.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,n,a,s,o,l,c,u,h,f,p,d,v,m){let y=new i.ARRAY_TYPE(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=n,y[4]=a,y[5]=s,y[6]=o,y[7]=l,y[8]=c,y[9]=u,y[10]=h,y[11]=f,y[12]=p,y[13]=d,y[14]=v,y[15]=m,y},t.set=function(e,t,r,i,n,a,s,o,l,c,u,h,f,p,d,v,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=m,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15],b=r*o-i*s,g=r*l-n*s,_=r*c-a*s,E=i*l-n*o,T=i*c-a*o,R=n*c-a*l,S=u*v-h*d,w=u*m-f*d,O=u*y-p*d,A=h*m-f*v,P=h*y-p*v,M=f*y-p*m,D=b*M-g*P+_*A+E*O-T*w+R*S;if(!D)return null;return D=1/D,e[0]=(o*M-l*P+c*A)*D,e[1]=(n*P-i*M-a*A)*D,e[2]=(v*R-m*T+y*E)*D,e[3]=(f*T-h*R-p*E)*D,e[4]=(l*O-s*M-c*w)*D,e[5]=(r*M-n*O+a*w)*D,e[6]=(m*_-d*R-y*g)*D,e[7]=(u*R-f*_+p*g)*D,e[8]=(s*P-o*O+c*S)*D,e[9]=(i*O-r*P-a*S)*D,e[10]=(d*T-v*_+y*b)*D,e[11]=(h*_-u*T-p*b)*D,e[12]=(o*w-s*A-l*S)*D,e[13]=(r*A-i*w+n*S)*D,e[14]=(v*g-d*E-m*b)*D,e[15]=(u*E-h*g+f*b)*D,e},t.adjoint=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15];return e[0]=o*(f*y-p*m)-h*(l*y-c*m)+v*(l*p-c*f),e[1]=-(i*(f*y-p*m)-h*(n*y-a*m)+v*(n*p-a*f)),e[2]=i*(l*y-c*m)-o*(n*y-a*m)+v*(n*c-a*l),e[3]=-(i*(l*p-c*f)-o*(n*p-a*f)+h*(n*c-a*l)),e[4]=-(s*(f*y-p*m)-u*(l*y-c*m)+d*(l*p-c*f)),e[5]=r*(f*y-p*m)-u*(n*y-a*m)+d*(n*p-a*f),e[6]=-(r*(l*y-c*m)-s*(n*y-a*m)+d*(n*c-a*l)),e[7]=r*(l*p-c*f)-s*(n*p-a*f)+u*(n*c-a*l),e[8]=s*(h*y-p*v)-u*(o*y-c*v)+d*(o*p-c*h),e[9]=-(r*(h*y-p*v)-u*(i*y-a*v)+d*(i*p-a*h)),e[10]=r*(o*y-c*v)-s*(i*y-a*v)+d*(i*c-a*o),e[11]=-(r*(o*p-c*h)-s*(i*p-a*h)+u*(i*c-a*o)),e[12]=-(s*(h*m-f*v)-u*(o*m-l*v)+d*(o*f-l*h)),e[13]=r*(h*m-f*v)-u*(i*m-n*v)+d*(i*f-n*h),e[14]=-(r*(o*m-l*v)-s*(i*m-n*v)+d*(i*l-n*o)),e[15]=r*(o*f-l*h)-s*(i*f-n*h)+u*(i*l-n*o),e},t.determinant=function(e){let t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return(t*s-r*a)*(h*m-f*v)-(t*o-i*a)*(u*m-f*d)+(t*l-n*a)*(u*v-h*d)+(r*o-i*s)*(c*m-f*p)-(r*l-n*s)*(c*v-h*p)+(i*l-n*o)*(c*d-u*p)},t.multiply=n,t.translate=function(e,t,r){let i,n,a,s,o,l,c,u,h,f,p,d,v=r[0],m=r[1],y=r[2];t===e?(e[12]=t[0]*v+t[4]*m+t[8]*y+t[12],e[13]=t[1]*v+t[5]*m+t[9]*y+t[13],e[14]=t[2]*v+t[6]*m+t[10]*y+t[14],e[15]=t[3]*v+t[7]*m+t[11]*y+t[15]):(i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=i*v+o*m+h*y+t[12],e[13]=n*v+l*m+f*y+t[13],e[14]=a*v+c*m+p*y+t[14],e[15]=s*v+u*m+d*y+t[15]);return e},t.scale=function(e,t,r){let i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,n){let a,s,o,l,c,u,h,f,p,d,v,m,y,b,g,_,E,T,R,S,w,O,A,P,M=n[0],D=n[1],I=n[2],C=Math.sqrt(M*M+D*D+I*I);if(Math.abs(C)<i.EPSILON)return null;M*=C=1/C,D*=C,I*=C,a=Math.sin(r),s=Math.cos(r),o=1-s,l=t[0],c=t[1],u=t[2],h=t[3],f=t[4],p=t[5],d=t[6],v=t[7],m=t[8],y=t[9],b=t[10],g=t[11],_=M*M*o+s,E=D*M*o+I*a,T=I*M*o-D*a,R=M*D*o-I*a,S=D*D*o+s,w=I*D*o+M*a,O=M*I*o+D*a,A=D*I*o-M*a,P=I*I*o+s,e[0]=l*_+f*E+m*T,e[1]=c*_+p*E+y*T,e[2]=u*_+d*E+b*T,e[3]=h*_+v*E+g*T,e[4]=l*R+f*S+m*w,e[5]=c*R+p*S+y*w,e[6]=u*R+d*S+b*w,e[7]=h*R+v*S+g*w,e[8]=l*O+f*A+m*P,e[9]=c*O+p*A+y*P,e[10]=u*O+d*A+b*P,e[11]=h*O+v*A+g*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e},t.rotateX=function(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=a*n+c*i,e[5]=s*n+u*i,e[6]=o*n+h*i,e[7]=l*n+f*i,e[8]=c*n-a*i,e[9]=u*n-s*i,e[10]=h*n-o*i,e[11]=f*n-l*i,e},t.rotateY=function(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*n-c*i,e[1]=s*n-u*i,e[2]=o*n-h*i,e[3]=l*n-f*i,e[8]=a*i+c*n,e[9]=s*i+u*n,e[10]=o*i+h*n,e[11]=l*i+f*n,e},t.rotateZ=function(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*n+c*i,e[1]=s*n+u*i,e[2]=o*n+h*i,e[3]=l*n+f*i,e[4]=c*n-a*i,e[5]=u*n-s*i,e[6]=h*n-o*i,e[7]=f*n-l*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){let n,a,s,o=r[0],l=r[1],c=r[2],u=Math.sqrt(o*o+l*l+c*c);if(Math.abs(u)<i.EPSILON)return null;return o*=u=1/u,l*=u,c*=u,n=Math.sin(t),a=Math.cos(t),s=1-a,e[0]=o*o*s+a,e[1]=l*o*s+c*n,e[2]=c*o*s-l*n,e[3]=0,e[4]=o*l*s-c*n,e[5]=l*l*s+a,e[6]=c*l*s+o*n,e[7]=0,e[8]=o*c*s+l*n,e[9]=l*c*s-o*n,e[10]=c*c*s+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromXRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=i+i,l=n+n,c=a+a,u=i*o,h=i*l,f=i*c,p=n*l,d=n*c,v=a*c,m=s*o,y=s*l,b=s*c;return e[0]=1-(p+v),e[1]=h+b,e[2]=f-y,e[3]=0,e[4]=h-b,e[5]=1-(u+v),e[6]=d+m,e[7]=0,e[8]=f+y,e[9]=d-m,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(a*a+s*s+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e},t.getRotation=function(e,t){let r=t[0]+t[5]+t[10],i=0;r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i);return e},t.fromRotationTranslationScale=function(e,t,r,i){let n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,c=a+a,u=s+s,h=n*l,f=n*c,p=n*u,d=a*c,v=a*u,m=s*u,y=o*l,b=o*c,g=o*u,_=i[0],E=i[1],T=i[2];return e[0]=(1-(d+m))*_,e[1]=(f+g)*_,e[2]=(p-b)*_,e[3]=0,e[4]=(f-g)*E,e[5]=(1-(h+m))*E,e[6]=(v+y)*E,e[7]=0,e[8]=(p+b)*T,e[9]=(v-y)*T,e[10]=(1-(h+d))*T,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){let a=t[0],s=t[1],o=t[2],l=t[3],c=a+a,u=s+s,h=o+o,f=a*c,p=a*u,d=a*h,v=s*u,m=s*h,y=o*h,b=l*c,g=l*u,_=l*h,E=i[0],T=i[1],R=i[2],S=n[0],w=n[1],O=n[2];return e[0]=(1-(v+y))*E,e[1]=(p+_)*E,e[2]=(d-g)*E,e[3]=0,e[4]=(p-_)*T,e[5]=(1-(f+y))*T,e[6]=(m+b)*T,e[7]=0,e[8]=(d+g)*R,e[9]=(m-b)*R,e[10]=(1-(f+v))*R,e[11]=0,e[12]=r[0]+S-(e[0]*S+e[4]*w+e[8]*O),e[13]=r[1]+w-(e[1]*S+e[5]*w+e[9]*O),e[14]=r[2]+O-(e[2]*S+e[6]*w+e[10]*O),e[15]=1,e},t.fromQuat=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,c=r*s,u=i*s,h=i*o,f=n*s,p=n*o,d=n*l,v=a*s,m=a*o,y=a*l;return e[0]=1-h-d,e[1]=u+y,e[2]=f-m,e[3]=0,e[4]=u-y,e[5]=1-c-d,e[6]=p+v,e[7]=0,e[8]=f+m,e[9]=p-v,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,i,n,a,s){let o=1/(r-t),l=1/(n-i),c=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(s+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*c,e[15]=0,e},t.perspective=function(e,t,r,i,n){let a=1/Math.tan(t/2),s=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*s,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,i){let n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),c=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-o)*l*.5,e[9]=(n-a)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},t.ortho=function(e,t,r,i,n,a,s){let o=1/(t-r),l=1/(i-n),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*c,e[15]=1,e},t.lookAt=function(e,t,r,n){let a,s,o,l,c,u,h,f,p,d,v=t[0],m=t[1],y=t[2],b=n[0],g=n[1],_=n[2],E=r[0],T=r[1],R=r[2];if(Math.abs(v-E)<i.EPSILON&&Math.abs(m-T)<i.EPSILON&&Math.abs(y-R)<i.EPSILON)return mat4.identity(e);h=v-E,f=m-T,p=y-R,d=1/Math.sqrt(h*h+f*f+p*p),a=g*(p*=d)-_*(f*=d),s=_*(h*=d)-b*p,o=b*f-g*h,(d=Math.sqrt(a*a+s*s+o*o))?(a*=d=1/d,s*=d,o*=d):(a=0,s=0,o=0);l=f*o-p*s,c=p*a-h*o,u=h*s-f*a,(d=Math.sqrt(l*l+c*c+u*u))?(l*=d=1/d,c*=d,u*=d):(l=0,c=0,u=0);return e[0]=a,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=f,e[7]=0,e[8]=o,e[9]=u,e[10]=p,e[11]=0,e[12]=-(a*v+s*m+o*y),e[13]=-(l*v+c*m+u*y),e[14]=-(h*v+f*m+p*y),e[15]=1,e},t.targetTo=function(e,t,r,i){let n=t[0],a=t[1],s=t[2],o=i[0],l=i[1],c=i[2],u=n-r[0],h=a-r[1],f=s-r[2],p=u*u+h*h+f*f;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,f*=p);let d=l*f-c*h,v=c*u-o*f,m=o*h-l*u;return e[0]=d,e[1]=v,e[2]=m,e[3]=0,e[4]=h*m-f*v,e[5]=f*d-u*m,e[6]=u*v-h*d,e[7]=0,e[8]=u,e[9]=h,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){let r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],p=e[10],d=e[11],v=e[12],m=e[13],y=e[14],b=e[15],g=t[0],_=t[1],E=t[2],T=t[3],R=t[4],S=t[5],w=t[6],O=t[7],A=t[8],P=t[9],M=t[10],D=t[11],I=t[12],C=t[13],j=t[14],x=t[15];return Math.abs(r-g)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-_)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-E)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-T)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(o-R)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(l-S)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-w)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-O)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(h-A)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-P)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(p-M)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-D)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(v-I)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(m-C)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(y-j)<=i.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-x)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(x))};var i=r(5);function n(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],m=t[13],y=t[14],b=t[15],g=r[0],_=r[1],E=r[2],T=r[3];return e[0]=g*i+_*o+E*h+T*v,e[1]=g*n+_*l+E*f+T*m,e[2]=g*a+_*c+E*p+T*y,e[3]=g*s+_*u+E*d+T*b,g=r[4],_=r[5],E=r[6],T=r[7],e[4]=g*i+_*o+E*h+T*v,e[5]=g*n+_*l+E*f+T*m,e[6]=g*a+_*c+E*p+T*y,e[7]=g*s+_*u+E*d+T*b,g=r[8],_=r[9],E=r[10],T=r[11],e[8]=g*i+_*o+E*h+T*v,e[9]=g*n+_*l+E*f+T*m,e[10]=g*a+_*c+E*p+T*y,e[11]=g*s+_*u+E*d+T*b,g=r[12],_=r[13],E=r[14],T=r[15],e[12]=g*i+_*o+E*h+T*v,e[13]=g*n+_*l+E*f+T*m,e[14]=g*a+_*c+E*p+T*y,e[15]=g*s+_*u+E*d+T*b,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}const s=n;t.mul=s;const o=a;t.sub=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=l,t.getAxisAngle=function(e,t){let r=2*Math.acos(t[3]),i=Math.sin(r/2);0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0);return r},t.multiply=c,t.rotateX=function(e,t,r){r*=.5;let i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=s*l-i*o,e},t.rotateY=function(e,t,r){r*=.5;let i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*o,e[1]=n*l+s*o,e[2]=a*l+i*o,e[3]=s*l-n*o,e},t.rotateZ=function(e,t,r){r*=.5;let i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e},t.calculateW=function(e,t){let r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},t.slerp=u,t.invert=function(e,t){let r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=h,t.fromEuler=function(e,t,r,i){let n=.5*Math.PI/180;t*=n,r*=n,i*=n;let a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=a*l*u-s*o*c,e[1]=s*o*u+a*l*c,e[2]=s*l*c-a*o*u,e[3]=s*l*u+a*o*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var i=r(5),n=r(29),a=r(30),s=r(31);function o(){let e=new i.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function l(e,t,r){r*=.5;let i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function c(e,t,r){let i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+s*o+n*c-a*l,e[1]=n*u+s*l+a*o-i*c,e[2]=a*u+s*c+i*l-n*o,e[3]=s*u-i*o-n*l-a*c,e}function u(e,t,r,i){let n,a,s,o,l,c=t[0],u=t[1],h=t[2],f=t[3],p=r[0],d=r[1],v=r[2],m=r[3];return(a=c*p+u*d+h*v+f*m)<0&&(a=-a,p=-p,d=-d,v=-v,m=-m),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-i)*n)/s,l=Math.sin(i*n)/s):(o=1-i,l=i),e[0]=o*c+l*p,e[1]=o*u+l*d,e[2]=o*h+l*v,e[3]=o*f+l*m,e}function h(e,t){let r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}const f=s.clone;t.clone=f;const p=s.fromValues;t.fromValues=p;const d=s.copy;t.copy=d;const v=s.set;t.set=v;const m=s.add;t.add=m;const y=c;t.mul=y;const b=s.scale;t.scale=b;const g=s.dot;t.dot=g;const _=s.lerp;t.lerp=_;const E=s.length;t.length=E;const T=E;t.len=T;const R=s.squaredLength;t.squaredLength=R;const S=R;t.sqrLen=S;const w=s.normalize;t.normalize=w;const O=s.exactEquals;t.exactEquals=O;const A=s.equals;t.equals=A;const P=function(){let e=a.create(),t=a.fromValues(1,0,0),r=a.fromValues(0,1,0);return function(i,n,s){let o=a.dot(n,s);return o<-.999999?(a.cross(e,t,n),a.len(e)<1e-6&&a.cross(e,r,n),a.normalize(e,e),l(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(a.cross(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,w(i,i))}}();t.rotationTo=P;const M=function(){let e=o(),t=o();return function(r,i,n,a,s,o){return u(e,i,s,o),u(t,n,a,o),u(r,e,t,2*o*(1-o)),r}}();t.sqlerp=M;const D=function(){let e=n.create();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],w(t,h(t,e))}}();t.setAxes=D},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){let t=new i.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){let r=new i.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=a,t.multiply=s,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},t.distance=l,t.squaredDistance=c,t.length=u,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n);return e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},t.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*i.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},t.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},t.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},t.transformMat4=function(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){let r=e[0],n=e[1],a=t[0],s=t[1];return Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))};var i=r(5);function n(){let e=new i.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function c(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function u(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function h(e){var t=e[0],r=e[1];return t*t+r*r}const f=u;t.len=f;const p=a;t.sub=p;const d=s;t.mul=d;const v=o;t.div=v;const m=l;t.dist=m;const y=c;t.sqrDist=y;const b=h;t.sqrLen=b;const g=function(){let e=n();return function(t,r,i,n,a,s){let o,l;for(r||(r=2),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}();t.forEach=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var i=r(8);t.quat=i.quat,i.quat.exp=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return r?(e[0]=Math.sin(r)*t[0]/r,e[1]=Math.sin(r)*t[1]/r,e[2]=Math.sin(r)*t[2]/r,e[3]=Math.cos(r)):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e},i.quat.ln=function(e,t){var r=i.quat.length(t);if(r>1.0001||r<.99999)e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0;else if(r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])){var n=Math.atan2(r,t[3])/r;e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=0}else e[0]=0,e[1]=0,e[2]=0,e[3]=0;return e},i.quat.pow=function(e,t,r){return 1===r?i.quat.copy(e,t):(i.quat.ln(e,t),e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,i.quat.exp(e,e),e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0;var i=r(8);t.mat3=i.mat3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0;var i,n=r(8);t.mat4=n.mat4,n.mat4.arcFromForward=(i=void 0,function(e,t){i||(i=n.vec3.create());var r=n.vec3.normalize(i,t);if(n.mat4.identity(e),r[2]<-.99999)return e;if(r[2]>.99999)return e[5]=-1,e[10]=-1,e;var a=(1+r[2])/(r[0]*r[0]+r[1]*r[1]);return e[0]=a*r[1]*r[1]-r[2],e[1]=-a*r[0]*r[1],e[2]=r[0],e[4]=e[1],e[5]=a*r[0]*r[0]-r[2],e[6]=r[1],e[8]=-r[0],e[9]=-r[1],e[10]=-r[2],e}),n.mat4.copyTranslation=function(e,t){return e[12]=t[12],e[13]=t[13],e[14]=t[14],e},n.mat4.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,e},n.mat4.lookAtGL=function(){var e=void 0,t=void 0,r=void 0;return function(i,a,s,o){return e||(e=n.vec3.create(),t=n.vec3.create(),r=n.vec3.create()),n.vec3.subtract(r,a,s),0===n.vec3.squaredLength(r)&&(r[2]=1),n.vec3.normalize(r,r),n.vec3.cross(e,o,r),0===n.vec3.squaredLength(e)&&(r[2]+=1e-4,n.vec3.cross(e,o,r)),n.vec3.normalize(e,e),n.vec3.cross(t,r,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[4]=t[0],i[5]=t[1],i[6]=t[2],i[8]=r[0],i[9]=r[1],i[10]=r[2],i}}(),n.mat4.perspectiveGL=function(e,t,r,i,a){var s=Math.tan(t/360*Math.PI)*i,o=s*r;n.mat4.frustum(e,-o,o,-s,s,i,a)},n.mat4.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},n.mat4.setTranslationFromValues=function(e,t,r,i){return e[12]=t,e[13]=r,e[14]=i,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noise=void 0;var i=r(32),n=r(33),a=t.noise={};a.turbulence=function(){var e=[],t=[],r=[],a=!1;return function(s,o,l,c,u,h){a||function(){for(var s=0;s<256;s++)e[s]=n.vec4.fromValues(Math.random()-.5,Math.random()-.5,Math.random()-.5,Math.random()-.5),t[s]=s;for(var o=256;--o;){var l=t[o],c=Math.floor(256*Math.random());t[o]=t[c],t[c]=l}for(var u=0;u<256;u++)t[256+u]=t[u],e[256+u]=e[u],e[512+u]=e[u];for(var h=0;h<15;++h)r[h]=i.vec3.create();a=!0}(),o+=4096,l+=4096,c+=4096,u+=4096;var f=Math.floor(o),p=Math.floor(l),d=Math.floor(c),v=Math.floor(u),m=o-f,y=l-p,b=c-d,g=u-v,_=(f&=255)+1,E=(p&=255)+1,T=(d&=255)+1,R=(v&=255)+1,S=t[f],w=t[_],O=t[S+p],A=t[w+p],P=t[S+E],M=t[w+E],D=i.vec3.lerp(r[0],e[O+d+v],e[A+d+v],m),I=i.vec3.lerp(r[1],e[P+d+v],e[M+d+v],m),C=i.vec3.lerp(r[2],e[O+T+v],e[A+T+v],m),j=i.vec3.lerp(r[3],e[O+T+v],e[A+T+v],m),x=i.vec3.lerp(r[4],D,I,y),L=i.vec3.lerp(r[5],C,j,y),B=i.vec3.lerp(r[6],x,L,b);D=i.vec3.lerp(r[7],e[O+d+R],e[A+d+R],m),I=i.vec3.lerp(r[8],e[P+d+R],e[M+d+R],m),C=i.vec3.lerp(r[9],e[O+T+R],e[A+T+R],m),j=i.vec3.lerp(r[10],e[O+T+R],e[A+T+R],m),x=i.vec3.lerp(r[11],D,I,y),L=i.vec3.lerp(r[12],C,j,y);var F=i.vec3.lerp(r[13],x,L,b),k=i.vec3.lerp(r[14],B,F,g);return s[0]+=k[0]*h,s[1]+=k[1]*h,s[2]+=k[2]*h,s}}(),a.perlin1=function(){var e=!1,t=256,r=null,i=null;return function(n){e||function(){r=new Array(t+t+2),i=new Array(t+t+2);var n=0,a=0,s=0;for(n=0;n<t;n++)r[n]=n,i[n]=2*Math.random()-1;for(;--n;)s=r[n],r[n]=r[a=Math.floor(Math.random()*t)],r[a]=s;for(n=0;n<t+2;n++)r[t+n]=r[n],i[t+n]=i[n];e=!0}();var a=n+4096,s=255&Math.floor(a),o=s+1&255,l=a-Math.floor(a),c=l-1,u=l*l*(3-2*l),h=l*i[r[s]];return h+u*(c*i[r[o]]-h)}}(),a.perlin1D=function(e,t,r,i){for(var n=0,s=e,o=1,l=0;l<i;++l)n+=a.perlin1(s)/o,o*=t,s*=r;return n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.curve={};i.evaluate=function(e,t,r,i,n){for(var a=e.knots.length,s=a-1,o=0,l=0;l<e.knots.length;++l)if(e.knots[l]>t){s=l;break}if(0===e.degree)for(var c=0;c<e.dimension;++c)r[c]=e.controls[s*e.dimension+c];else if(1===e.degree){var u=i?(s+a-1)%a:0===s?0:s-1,h=e.knots[s]-e.knots[u];h<0&&(h+=n),h>0&&(o=(t-e.knots[e.knots.length-1])/h);for(var f=0;f<e.dimension;++f)r[f]=e.controls[u*e.dimension+f]*(1-o)+e.controls[s*e.dimension+f]*o}else{var p=i?(s+a-2)%a:0===s?0:s-2,d=i?(s+a-1)%a:0===s?0:s-1,v=p*e.dimension,m=d*e.dimension,y=s*e.dimension,b=e.knots[p],g=e.knots[d],_=e.knots[s],E=e.knots[(s+1)%a];b>_&&(_+=n,E+=n,t+=n),g>_&&(_+=n,E+=n,t+=n),E<_&&(E+=n);var T=t-g,R=T/(_-g),S=(t-b)/(_-b),w=S+R-R*S,O=R*(T/(E-g)),A=w-O;w=1-w;for(var P=0;P<e.dimension;++P)r[P]=w*e.controls[v+P]+A*e.controls[m+P]+O*e.controls[y+P]}},i.ag_horner1=function(e,t,r){for(var i=e[t];--t>=0;)i=r*i+e[t];return i},i.ag_zeroin2=function(e,t,r,n,a,s){var o=void 0,l=void 0,c=void 0,u=void 0,h=void 0,f=void 0,p=void 0,d=void 0,v=void 0,m=void 0;for(var y=!0;y&&(o=e,u=r,c=l=t-e),Math.abs(u)<Math.abs(n)&&(e=t,t=o,o=e,r=n,n=u,u=r),y=!1,h=2.384185792e-7*Math.abs(t)+.5*a,f=.5*(o-t),Math.abs(f)>h&&0!==n;)Math.abs(c)<h||Math.abs(r)<=Math.abs(n)?c=l=f:(m=n/r,e===o?(p=2*f*m,d=1-m):(p=m*(2*f*(d=r/u)*(d-(v=n/u))-(t-e)*(v-1)),d=(d-1)*(v-1)*(m-1)),p>0?d=-d:p=-p,m=c,c=l,2*p<3*f*d-Math.abs(h*d)&&p<Math.abs(.5*m*d)?l=p/d:c=l=f),e=t,r=n,Math.abs(l)>h?t+=l:f>0?t+=h:t-=h,(n=i.ag_horner1(s.p,s.deg,t))*(u/Math.abs(u))>0&&(y=!0);return t},i.ag_zeroin=function(e,t,r,n){var a,s;return a=i.ag_horner1(n.p,n.deg,e),Math.abs(a)<1.192092896e-7?e:(s=i.ag_horner1(n.p,n.deg,t),Math.abs(s)<1.192092896e-7?t:i.ag_zeroin2(e,t,a,s,r,n))},i.polyZeroes=function(e,t,r,n,a,s,o){var l,c,u=void 0,h=void 0,f=void 0,p=void 0,d=void 0,v=void 0,m=void 0,y=void 0,b=void 0,g=void 0,_=void 0,E=void 0,T=new Array(22),R=void 0,S=new Array(22),w=new Array(22),O={p:[],deg:0};for(m=g=0,y=0,u=0;u<t+1;++u)y+=Math.abs(e[u]);if(y<=(l=(Math.abs(r)+Math.abs(a))*(t+1)*1.192092896e-7))return-1;for(E=T,R=S,c=w,u=0;u<t+1;++u)E[u]=1/y*e[u];for(;Math.abs(E[t])<l;)t--;if(p=0,0===t)return p;if(1===t)return o[0]=-E[0]/E[1],h=n?r<o[0]+l:r<o[0]-l,f=s?a>o[0]-l:a>o[0]+l,(p=h&&f?1:0)&&(n&&o[0]<r?o[0]=r:s&&o[0]>a&&(o[0]=a)),p;for(O.p=E,O.deg=t,u=1;u<=t;u++)R[u-1]=u*E[u];if(0===(d=i.polyZeroes(R,t-1,r,0,a,0,c)).length)return 0;for(u=v=0;u<=d;u++){if(p>t)return p;0===u?(b=r,_=i.ag_horner1(E,t,b),Math.abs(_)<=l&&n&&(o[p++]=r)):(b=m,_=g),u===d?(m=a,v=0):m=c[u],g=i.ag_horner1(E,t,m),v?v=0:Math.abs(g)<l?(u!==d||s)&&(o[p++]=m,v=1):(_<0&&g>0||_>0&&g<0)&&(o[p++]=i.ag_zeroin(b,m,0,O),p>1&&o[p-2]>=o[p-1]-l&&(o[p-2]=.5*(o[p-2]+o[p-1]),p--))}return p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=t.util={};n.generateUUID=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),n.generateObjectID=(i=0,function(){return i++}),n.generateID=n.generateObjectID,n.get=function(e,t,r){return e&&t in e?e[t]:r},n.assignIfExists=function(e,t,r){t&&void 0!==t[r]&&(e[r]=t[r])},n.toArray=function(e){return Array.isArray(e)?e:[e]},n.isArray=Array.isArray,n.isTyped=function(e){return e&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT},n.isVector=function(e){if(e){if(n.isTyped(e))return!0;if(n.isArray(e)){for(var t=0;t<e.length;t++)if("number"!=typeof e[t])return!1;return!0}}return!1},n.isArrayLike=function(e){return e&&n.isArray(e)||n.isTyped(e)},n.perArrayChild=function(e,t){for(var r=e.length,i=arguments.length,n=Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];for(var s=0;s<r;s++){var o;t in e&&(o=e[s])[t].apply(o,n)}}},function(e,t,r){(function(t){WebGLDebugUtils=function(){var e;void 0===e&&(e=t);var r=function(t){e.console&&e.console.error?e.console.error(t):function(t){e.console&&e.console.log&&e.console.log(t)}(t)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},n=null,a=null;function s(e){if(null==n)for(var t in n={},a={},e)"number"==typeof e[t]&&(n[e[t]]=t,a[t]=e[t])}function o(){if(null==n)throw"WebGLDebugUtils.init(ctx) not called"}function l(e){o();var t=n[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function c(e,t,r,n){var s;if(void 0!==(s=i[e])&&(void 0!==(s=s[t])&&s[r])){if("object"==typeof s[r]&&void 0!==s[r].enumBitwiseOr){for(var o=s[r].enumBitwiseOr,c=0,u=[],h=0;h<o.length;++h){var f=a[o[h]];0!=(n&f)&&(c|=f,u.push(l(f)))}return c===n?u.join(" | "):l(n)}return l(n)}return null===n?"null":void 0===n?"undefined":n.toString()}function u(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function h(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var r=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var n=0;n<r;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0),t&&e.vertexAttribDivisor(n,0);e.deleteBuffer(i);var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<a;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(n,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var s=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(n=0;n<s;++n)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,null);var o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(n=0;n<o;++n)e.bindBufferBase(e.UNIFORM_BUFFER,n,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:s,mightBeEnum:function(e){return o(),void 0!==n[e]},glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:function(e,t){for(var r="",i=t.length,n=0;n<i;++n)r+=(0==n?"":", ")+c(e,i,n,t[n]);return r},makeDebugContext:function e(t,i,n,a){a=a||t,s(t),i=i||function(e,t,i){for(var n="",a=i.length,s=0;s<a;++s)n+=(0==s?"":", ")+c(t,a,s,i[s]);r("WebGL error "+l(e)+" in "+t+"("+n+")")};var o={};function h(e,t){return function(){n&&n(t,arguments);var r=e[t].apply(e,arguments),s=a.getError();return 0!=s&&(o[s]=!0,i(s,t,arguments)),r}}var f={};for(var p in t)if("function"==typeof t[p])if("getExtension"!=p)f[p]=h(t,p);else{var d=h(t,p);f[p]=function(){var r=d.apply(t,arguments);return r?e(r,i,n,a):null}}else u(f,t,p);return f.getError=function(){for(var e in o)if(o.hasOwnProperty(e)&&o[e])return o[e]=!1,e;return t.NO_ERROR},f},makeLostContextSimulatingCanvas:function(t){var r,i,n,a=[],s=[],o={},l=1,c=!1,f=[],p=0,d=0,v=!1,m=0,y={};function b(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}t.getContext=(n=t.getContext,function(){var a=n.apply(t,arguments);if(a instanceof WebGLRenderingContext||e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext){if(a!=r){if(r)throw"got different context";i=e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,o=function(e){for(var t in e)"function"==typeof e[t]?o[t]=T(e,t):u(o,e,t);o.getError=function(){if(E(),!c)for(;e=r.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return o.NO_ERROR};var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];i&&n.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var a=0;a<n.length;++a){var s=n[a];o[s]=function(t){return function(){if(E(),c)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=l,f.push(r),r}}(e[s])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];i&&h.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var a=0;a<h.length;++a){var s=h[a];o[s]=function(t){return function(){return E(),c?null:t.apply(e,arguments)}}(o[s])}var p,d=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];i&&d.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var a=0;a<d.length;++a){var s=d[a];o[s]=function(t){return function(){return E(),!c&&t.apply(e,arguments)}}(o[s])}return o.checkFramebufferStatus=(p=o.checkFramebufferStatus,function(){return E(),c?o.FRAMEBUFFER_UNSUPPORTED:p.apply(e,arguments)}),o.getAttribLocation=function(t){return function(){return E(),c?-1:t.apply(e,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(t){return function(){return E(),c?0:t.apply(e,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return c},i&&(o.getFragDataLocation=function(t){return function(){return E(),c?-1:t.apply(e,arguments)}}(o.getFragDataLocation),o.clientWaitSync=function(t){return function(){return E(),c?o.WAIT_FAILED:t.apply(e,arguments)}}(o.clientWaitSync),o.getUniformBlockIndex=function(t){return function(){return E(),c?o.INVALID_INDEX:t.apply(e,arguments)}}(o.getUniformBlockIndex)),o}(r=a)}return o}return a});var g=function(e){a.push(b(e))},_=function(e){s.push(b(e))};function E(){++d,c||p==d&&t.loseContext()}function T(e,t){var r=e[t];return function(){if(E(),!c)return r.apply(e,arguments)}}function R(e){return{statusMessage:e,preventDefault:function(){v=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":g(i);break;case"webglcontextrestored":_(i);break;default:t.apply(e,arguments)}}}(t),t.loseContext=function(){if(!c){for(c=!0,p=0,++l;r.getError(););!function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e[t]]}(),y[r.CONTEXT_LOST_WEBGL]=!0;var e=R("context lost"),i=a.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);m>=0&&setTimeout(function(){t.restoreContext()},m)},0)}},t.restoreContext=function(){c&&s.length&&setTimeout(function(){if(!v)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<f.length;++e){var t=f[e];t instanceof WebGLBuffer?r.deleteBuffer(t):t instanceof WebGLFramebuffer?r.deleteFramebuffer(t):t instanceof WebGLProgram?r.deleteProgram(t):t instanceof WebGLRenderbuffer?r.deleteRenderbuffer(t):t instanceof WebGLShader?r.deleteShader(t):t instanceof WebGLTexture?r.deleteTexture(t):i&&(t instanceof WebGLQuery?r.deleteQuery(t):t instanceof WebGLSampler?r.deleteSampler(t):t instanceof WebGLSync?r.deleteSync(t):t instanceof WebGLTransformFeedback?r.deleteTransformFeedback(t):t instanceof WebGLVertexArrayObject&&r.deleteVertexArray(t))}}(),h(r),c=!1,d=0,v=!1;for(var e=s.slice(),t=R("context restored"),n=0;n<e.length;++n)e[n](t)},0)},t.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";p=d+e},t.getNumCalls=function(){return d},t.setRestoreTimeout=function(e){m=e},t},resetToInitialState:h}}(),e.exports=WebGLDebugUtils}).call(t,r(66))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(21);Object.defineProperty(t,"Tw2RawData",{enumerable:!0,get:function(){return i.Tw2RawData}});var n=r(35);Object.defineProperty(t,"Tw2PerObjectData",{enumerable:!0,get:function(){return n.Tw2PerObjectData}});var a=r(68);Object.defineProperty(t,"Tw2BasicPerObjectData",{enumerable:!0,get:function(){return a.Tw2BasicPerObjectData}}),Object.defineProperty(t,"EveBasicPerObjectData",{enumerable:!0,get:function(){return a.Tw2BasicPerObjectData}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BasicPerObjectData=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0},a=r(2),s=r(35),o=r(21);t.Tw2BasicPerObjectData=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.perObjectFFEData=null,e&&i.DeclareFromObject(e,r),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2PerObjectData),i(t,[{key:"SetPerObjectDataToDevice",value:function(e){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"SetPerObjectDataToDevice",this).call(this,e),this.perObjectFFEData&&e[5]&&a.device.gl.uniform4fv(e[5],this.perObjectFFEData.data)}},{key:"DeclareFromObject",value:function(e,r){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"DeclareFromObject",this).call(this,e,r),e.FFEData&&(this.perObjectFFEData=new o.Tw2RawData(e.FFEData,r))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Track=a,t.Tw2TrackGroup=s,t.Tw2Animation=o,t.Tw2Bone=l,t.Tw2Model=c,t.Tw2AnimationController=u;var i=r(0),n=r(22);function a(){this.trackRes=null,this.bone=null}function s(){this.trackGroupRes=null,this.model=null,this.transformTracks=[]}function o(){this.animationRes=null,this.time=0,this.timeScale=1,this.cycle=!1,this.isPlaying=!1,this.callback=null,this.trackGroups=[]}function l(){this.boneRes=null,this.localTransform=i.mat4.create(),this.worldTransform=i.mat4.create(),this.offsetTransform=i.mat4.create()}function c(){this.modelRes=null,this.bones=[],this.bonesByName={}}function u(e){this.geometryResources=[],this.models=[],this.animations=[],this.meshBindings=[],this.loaded=!1,this.update=!0,this._geometryResource=null,this.pendingCommands=[],this.onPendingCleared=null,void 0!==e&&this.SetGeometryResource(e)}o.prototype.IsFinished=function(){return!this.cycle&&this.time>=this.animationRes.duration},u.scratch={vec3_0:i.vec3.create(),quat_0:i.quat.create(),mat3_0:i.mat3.create(),mat4_0:i.mat4.create()},u.prototype.GetResources=function(e){void 0===e&&(e=[]);for(var t=0;t<this.geometryResources.length;t++)-1===e.indexOf(this.geometryResources[t])&&e.push(this.geometryResources[t]);return e},u.prototype.SetGeometryResource=function(e){this.models=[],this.animations=[],this.meshBindings=[];for(var t=0;t<this.geometryResources.length;++t)this.geometryResources[t].UnregisterNotification(this);this.loaded=!1,this.geometryResources=[],e&&(this.geometryResources.push(e),e.RegisterNotification(this))},u.prototype.AddGeometryResource=function(e){for(var t=0;t<this.geometryResources.length;++t)if(this.geometryResources[t]===e)return;this.geometryResources.push(e),e.RegisterNotification(this)},u.prototype.AddAnimationsFromRes=function(e){for(var t=0;t<e.animations.length;++t){for(var r=null,i=0;i<this.animations.length;++i)if(this.animations[i].animationRes===e.animations[t]){r=this.animations[t];break}r||((r=new o).animationRes=e.animations[t],this.animations.push(r));for(i=0;i<r.animationRes.trackGroups.length;++i){for(var n=!1,l=0;l<r.trackGroups.length;++l)if(r.trackGroups[l].trackGroupRes===r.animationRes.trackGroups[i]){n=!0;break}if(!n){var c=null;for(l=0;l<this.models.length;++l)if(this.models[l].modelRes.name===r.animationRes.trackGroups[i].name){c=this.models[l];break}if(null!==c){var u=new s;u.trackGroupRes=r.animationRes.trackGroups[i];for(l=0;l<u.trackGroupRes.transformTracks.length;++l)for(var h=0;h<c.bones.length;++h)if(c.bones[h].boneRes.name===u.trackGroupRes.transformTracks[l].name){var f=new a;f.trackRes=u.trackGroupRes.transformTracks[l],f.bone=c.bones[h],u.transformTracks.push(f);break}r.trackGroups.push(u)}}}}},u.prototype._AddModel=function(e){for(var t=0;t<this.models.length;++t)if(this.models[t].modelRes.name===e.name)return null;var r=new c;r.modelRes=e;var i=e.skeleton;if(null!==i)for(var n=0;n<i.bones.length;++n){var a=new l;a.boneRes=i.bones[n],r.bones.push(a),r.bonesByName[a.boneRes.name]=a}return this.models.push(r),r},u.prototype._FindMeshBindings=function(e){for(var t=0;t<this.meshBindings.length;++t)if(this.meshBindings[t].resource===e)return this.meshBindings[t];return null},u.prototype.RebuildCachedData=function(e){for(var t=!1,r=0;r<this.geometryResources.length;++r)if(this.geometryResources[r]===e){t=!0;break}if(t){for(r=0;r<this.geometryResources.length;++r)if(!this.geometryResources[r].IsGood())return;for(r=0;r<this.geometryResources.length;++r)this._DoRebuildCachedData(this.geometryResources[r])}},u.prototype._DoRebuildCachedData=function(e){var t=[];if(e.meshes.length)for(var r=0;r<e.models.length;++r){(i=this._AddModel(e.models[r]))&&t.push(i)}for(r=0;r<this.geometryResources.length;++r)this.AddAnimationsFromRes(this.geometryResources[r],this.models);if(0===e.models.length){for(r=0;r<e.meshes.length;++r)n.Tw2GeometryRes.BindMeshToModel(e.meshes[r],this.geometryResources[0].models[0]);e.models.push(this.geometryResources[0].models[0])}for(r=0;r<e.models.length;++r){for(var i=null,a=0;a<this.models.length;++a)if(this.models[a].modelRes.name===e.models[r].name){i=this.models[a];break}if(null!==i)for(a=0;a<e.models[r].meshBindings.length;++a){var s=e.meshes.indexOf(e.models[r].meshBindings[a].mesh),o=this._FindMeshBindings(e);null===o&&((o=[]).resource=e,this.meshBindings.push(o)),o[s]=new Float32Array(12*e.models[r].meshBindings[a].bones.length);for(var l=0;l<e.models[r].meshBindings[a].bones.length;++l)for(var c=0;c<i.bones.length;++c)if(i.bones[c].boneRes.name===e.models[r].meshBindings[a].bones[l].name){i.bones[c].bindingArrays||(i.bones[c].bindingArrays=[]);var u={array:o[s],offset:12*l};i.bones[c].bindingArrays[i.bones[c].bindingArrays.length]=u;break}}}if(e.meshes.length&&e.models.length&&this.ResetBoneTransforms(e.models),this.loaded=!0,this.animations.length){if(this.pendingCommands.length)for(r=0;r<this.pendingCommands.length;++r)this.pendingCommands[r].args?this.pendingCommands[r].func.apply(this,this.pendingCommands[r].args):this.pendingCommands[r].func.apply(this);this.pendingCommands=[],this.onPendingCleared&&this.onPendingCleared(this)}},u.prototype.GetAnimation=function(e){for(var t=0;t<this.animations.length;t++)if(this.animations[t].animationRes.name===e)return this.animations[t];return null},u.prototype.ResetAnimation=function(e){var t=this.GetAnimation(e);if(t)return t.time=0,t.isPlaying=!1,t.callback=null,!0},u.prototype.PlayAnimation=function(e,t,r){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimation,args:[e,t,r]}),!0;var i=this.GetAnimation(e);return i?(i.time=0,i.isPlaying=!0,void 0!==t&&(i.cycle=t),void 0!==r&&(i.callback=r),!0):void 0},u.prototype.PlayAnimationFrom=function(e,t,r,i){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimationFrom,args:[e,t,r,i]}),!0;var n=this.GetAnimation(e);return n?(t=t<=n.animationRes.duration?t:n.animationRes.duration,n.time=t<0?0:t,n.isPlaying=!0,void 0!==r&&(n.cycle=r),void 0!==i&&(n.callback=i),!0):void 0},u.prototype.GetPlayingAnimations=function(){for(var e=[],t=0;t<this.animations.length;t++)this.animations[t].isPlaying&&e.push(this.animations[t].animationRes.name);return e},u.prototype.StopAnimation=function(e){if(0!==this.animations.length){("string"==typeof e||e instanceof String)&&(e=[e]);for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;for(var i=0;i<this.animations.length;++i)this.animations[i].animationRes.name in t&&(this.animations[i].isPlaying=!1)}else this.pendingCommands.push({func:this.StopAnimation,args:e})},u.prototype.StopAllAnimations=function(){if(0!==this.animations.length)for(var e=0;e<this.animations.length;++e)this.animations[e].isPlaying=!1;else this.pendingCommands.push({func:this.StopAllAnimations,args:null})},u.prototype.StopAllAnimationsExcept=function(e){if(0!==this.animations.length){("string"==typeof e||e instanceof String)&&(e=[e]);for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;for(var i=0;i<this.animations.length;++i)this.animations[i].animationRes.name in t||(this.animations[i].isPlaying=!1)}else this.pendingCommands.push({func:this.StopAllAnimationsExcept,args:e})},u.prototype.ResetBoneTransforms=function(e){for(var t=0;t<this.models.length;++t)for(var r=0;r<this.models[t].bones.length;++r){var n=this.models[t].bones[r],a=n.boneRes;i.mat4.copy(n.localTransform,a.localTransform),-1!==a.parentIndex?i.mat4.multiply(n.worldTransform,n.localTransform,this.models[t].bones[n.boneRes.parentIndex].worldTransform):i.mat4.set(n.worldTransform,n.localTransform),i.mat4.identity(n.offsetTransform)}var s=i.mat4.create();for(t=0;t<this.meshBindings.length;++t)for(r=0;r<this.meshBindings[t].length;++r)for(var o=0;16*o<this.meshBindings[t][r].length;++o)for(var l=0;l<16;++l)this.meshBindings[t][r][16*o+l]=s[l]},u.EvaluateCurve=function(e,t,r,i,n){for(var a=e.knots.length,s=a-1,o=0,l=0;l<e.knots.length;++l)if(e.knots[l]>t){s=l;break}if(0===e.degree)for(l=0;l<e.dimension;++l)r[l]=e.controls[s*e.dimension+l];else if(1===e.degree){var c=i?(s+a-1)%a:0===s?0:s-1,u=e.knots[s]-e.knots[c];u<0&&(u+=n),u>0&&(o=(t-e.knots[l-1])/u);for(l=0;l<e.dimension;++l)r[l]=e.controls[c*e.dimension+l]*(1-o)+e.controls[s*e.dimension+l]*o}else{var h=i?(s+a-2)%a:0===s?0:s-2,f=i?(s+a-1)%a:0===s?0:s-1,p=h*e.dimension,d=f*e.dimension,v=s*e.dimension,m=e.knots[h],y=e.knots[f],b=e.knots[s],g=e.knots[(s+1)%a];m>b&&(b+=n,g+=n,t+=n),y>b&&(b+=n,g+=n,t+=n),g<b&&(g+=n);var _=t-y,E=_/(b-y),T=(t-m)/(b-m),R=T+E-E*T,S=E*(_/(g-y)),w=R-S;R=1-R;for(l=0;l<e.dimension;++l)r[l]=R*e.controls[p+l]+w*e.controls[d+l]+S*e.controls[v+l]}},u.prototype.Update=function(e){if(null!==this.models&&this.update){for(var t=0;t<this.geometryResources.length;++t)this.geometryResources[t].KeepAlive();var r=u.scratch,n=r.mat4_0;for(t=0;t<this.animations.length;++t){var a=this.animations[t];if(a.isPlaying){var s=a.animationRes;a.time+=e*a.timeScale,a.time>s.duration&&(null!==a.callback&&a.callback(this,a),a.cycle?a.time=a.time%s.duration:(a.isPlaying=!1,a.time=s.duration));for(var o=r.quat_0,l=r.mat3_0,c=r.vec3_0,h=0;h<a.trackGroups.length;++h)for(var f=0;f<a.trackGroups[h].transformTracks.length;++f){var p=a.trackGroups[h].transformTracks[f];p.trackRes.position?u.EvaluateCurve(p.trackRes.position,a.time,c,a.cycle,s.duration):c[0]=c[1]=c[2]=0,p.trackRes.orientation?(u.EvaluateCurve(p.trackRes.orientation,a.time,o,a.cycle,s.duration),i.quat.normalize(o,o)):i.quat.identity(o),p.trackRes.scaleShear?u.EvaluateCurve(p.trackRes.scaleShear,a.time,l,a.cycle,s.duration):i.mat3.identity(l);var d=p.bone.localTransform;d[0]=l[0],d[1]=l[1],d[2]=l[2],d[4]=l[3],d[5]=l[4],d[6]=l[5],d[8]=l[6],d[9]=l[7],d[10]=l[8],d[3]=d[7]=d[11]=d[12]=d[13]=d[14]=0,d[15]=1,i.mat4.multiply(p.bone.localTransform,p.bone.localTransform,i.mat4.fromQuat(n,o)),p.bone.localTransform[12]=c[0],p.bone.localTransform[13]=c[1],p.bone.localTransform[14]=c[2],!0}}}for(t=0;t<this.models.length;++t)for(h=0;h<this.models[t].bones.length;++h){var v=this.models[t].bones[h];if(-1!==v.boneRes.parentIndex?i.mat4.multiply(v.worldTransform,this.models[t].bones[v.boneRes.parentIndex].worldTransform,v.localTransform):i.mat4.copy(v.worldTransform,v.localTransform),i.mat4.multiply(v.offsetTransform,v.worldTransform,v.boneRes.worldTransformInv),v.bindingArrays)for(var m=0;m<v.bindingArrays.length;++m)v.bindingArrays[m].array[v.bindingArrays[m].offset+0]=v.offsetTransform[0],v.bindingArrays[m].array[v.bindingArrays[m].offset+1]=v.offsetTransform[4],v.bindingArrays[m].array[v.bindingArrays[m].offset+2]=v.offsetTransform[8],v.bindingArrays[m].array[v.bindingArrays[m].offset+3]=v.offsetTransform[12],v.bindingArrays[m].array[v.bindingArrays[m].offset+4]=v.offsetTransform[1],v.bindingArrays[m].array[v.bindingArrays[m].offset+5]=v.offsetTransform[5],v.bindingArrays[m].array[v.bindingArrays[m].offset+6]=v.offsetTransform[9],v.bindingArrays[m].array[v.bindingArrays[m].offset+7]=v.offsetTransform[13],v.bindingArrays[m].array[v.bindingArrays[m].offset+8]=v.offsetTransform[2],v.bindingArrays[m].array[v.bindingArrays[m].offset+9]=v.offsetTransform[6],v.bindingArrays[m].array[v.bindingArrays[m].offset+10]=v.offsetTransform[10],v.bindingArrays[m].array[v.bindingArrays[m].offset+11]=v.offsetTransform[14]}}},u.prototype.RenderDebugInfo=function(e){for(var t=0;t<this.models.length;++t)for(var r=0;r<this.models[t].bones.length;++r){var i=this.models[t].bones[r];if(i.boneRes.parentIndex>=0){var n=this.models[t].bones[i.boneRes.parentIndex];e.AddLine([i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]],[n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]])}}},u.prototype.GetBoneMatrices=function(e,t){if(0===this.geometryResources.length)return new Float32Array;void 0===t&&(t=this.geometryResources[0]);var r=this._FindMeshBindings(t);return r&&e<r.length?r[e]:new Float32Array},u.prototype.FindModelForMesh=function(e,t){if(0===this.geometryResources.length)return null;if(void 0===t&&(t=this.geometryResources[0]),!t.IsGood())return null;for(var r=t.meshes[e],i=0;i<this.models.length;++i)for(;0<this.models[i].modelRes.meshBindings.length;++i)if(this.models[i].modelRes.meshBindings[0].mesh===r)return this.models[i];return null}},function(e,t,r){"use strict";function i(){this.name="",this.curves=[],this.bindings=[],this.scale=1,this.playOnLoad=!0,this.isPlaying=!1,this.scaledTime=0}Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSet=i,i.prototype.Initialize=function(){this.playOnLoad&&this.Play()},i.prototype.Play=function(){this.isPlaying=!0,this.scaledTime=0},i.prototype.PlayFrom=function(e){this.isPlaying=!0,this.scaledTime=e},i.prototype.Stop=function(){this.isPlaying=!1},i.prototype.Update=function(e){if(this.isPlaying){this.scaledTime+=e*this.scale;for(var t=this.scaledTime,r=this.curves,i=0;i<r.length;++i)r[i].UpdateValue(t);for(var n=this.bindings,a=0;a<n.length;++a)n[a].CopyValue()}},i.prototype.GetMaxCurveDuration=function(){for(var e=0,t=0;t<this.curves.length;++t)"GetLength"in this.curves[t]&&(e=Math.max(e,this.curves[t].GetLength()));return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EffectRes=void 0;var i=r(0),n=r(2),a=r(6),s=r(11),o=r(18),l=r(19),c=r(12);var u=t.Tw2EffectRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.passes=[],e.annotations={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2Resource),t}();u.prototype.requestResponseType="arraybuffer",u.prototype.Prepare=function(e){this.passes=[],this.annotations={};var t=new o.Tw2BinaryReader(new Uint8Array(e)),r="";function s(){for(var e=t.ReadUInt32(),i=e;r.charCodeAt(i);)++i;return r.substr(e,i-e)}function u(e,t,r,i){var s=n.device.gl.createShader(0===e?n.device.gl.VERTEX_SHADER:n.device.gl.FRAGMENT_SHADER);if(n.device.ext.ShaderBinary)n.device.ext.ShaderBinary.shaderBinary(s,r);else{var o=t+("string"==typeof r?r:String.fromCharCode.apply(null,r));o=o.substr(0,o.length-1),n.device.gl.shaderSource(s,o),n.device.gl.compileShader(s)}return n.device.gl.getShaderParameter(s,n.device.gl.COMPILE_STATUS)?s:(a.emitter.log("res.error",{log:"error",src:["Tw2EffectRes","CompileShader"],msg:"Error compiling shader",path:i,type:"shader.compile",value:0===e?"VERTEX":"FRAGMENT",data:n.device.gl.getShaderInfoLog(s)}),null)}function h(e,t,r,i){var s={};if(s.program=n.device.gl.createProgram(),n.device.gl.attachShader(s.program,e),n.device.gl.attachShader(s.program,t),n.device.gl.linkProgram(s.program),!n.device.gl.getProgramParameter(s.program,n.device.gl.LINK_STATUS))return a.emitter.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"Error linking shaders",path:i,type:"shader.linkstatus",data:n.device.gl.getProgramInfoLog(s.program)}),null;n.device.gl.useProgram(s.program),s.constantBufferHandles=[];for(var o=0;o<16;++o)s.constantBufferHandles[o]=n.device.gl.getUniformLocation(s.program,"cb"+o);s.samplerHandles=[];for(o=0;o<16;++o)s.samplerHandles[o]=n.device.gl.getUniformLocation(s.program,"s"+o),n.device.gl.uniform1i(s.samplerHandles[o],o);for(o=0;o<16;++o)s.samplerHandles[o+12]=n.device.gl.getUniformLocation(s.program,"vs"+o),n.device.gl.uniform1i(s.samplerHandles[o+12],o+12);s.input=new c.Tw2VertexDeclaration;for(o=0;o<r.stages[0].inputDefinition.elements.length;++o){var l=n.device.gl.getAttribLocation(s.program,"attr"+o);if(l>=0){var u=new c.Tw2VertexElement(r.stages[0].inputDefinition.elements[o].usage,r.stages[0].inputDefinition.elements[o].usageIndex);u.location=l,s.input.elements.push(u)}}s.input.RebuildHash(),s.shadowStateInt=n.device.gl.getUniformLocation(s.program,"ssi"),s.shadowStateFloat=n.device.gl.getUniformLocation(s.program,"ssf"),s.shadowStateYFlip=n.device.gl.getUniformLocation(s.program,"ssyf"),n.device.gl.uniform3f(s.shadowStateYFlip,0,0,1),s.volumeSlices=[];for(o=0;o<r.stages[1].samplers.length;++o)r.stages[1].samplers[o].isVolume&&(s.volumeSlices[r.stages[1].samplers[o].registerIndex]=n.device.gl.getUniformLocation(s.program,"s"+r.stages[1].samplers[o].registerIndex+"sl"));return s}var f,p,d=t.ReadUInt32();if(d<2||d>5)return a.emitter.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"Invalid version of effect file",type:"shader.effectversion",path:this.path,value:d}),void this.PrepareFinished(!1);var v=0;if(d<5){if(0===(f=t.ReadUInt32()))return a.emitter.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"File contains no compiled effects",path:this.path,type:"shader.effectheadersize",value:0}),void this.PrepareFinished(!1);t.ReadUInt32();var m=t.ReadUInt32();t.cursor=8+3*f*4,p=t.ReadUInt32(),r=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+p)),t.cursor=m}else{p=t.ReadUInt32(),v=t.cursor,r=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+p)),t.cursor+=p;for(var y=t.ReadUInt8(),b=0;b<y;++b){t.ReadUInt32(),t.ReadUInt8(),t.ReadUInt32();for(var g=t.ReadUInt8(),_=0;_<g;++_)t.ReadUInt32()}if(0===(f=t.ReadUInt32()))return a.emitter.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"File contains no compiled effects",path:this.path,type:"shader.effectheadersize",value:0}),void this.PrepareFinished(!1);t.ReadUInt32(),t.cursor=t.ReadUInt32()}for(var E=t.ReadUInt8(),T=0;T<E;++T){for(var R={stages:[{},{}]},S=t.ReadUInt8(),w=!0,O=0;O<S;++O){var A={};A.inputDefinition=new c.Tw2VertexDeclaration,A.constants=[],A.textures=[],A.samplers=[];for(var P,M,D,I,C=t.ReadUInt8(),j=t.ReadUInt8(),x=0;x<j;++x){var L=t.ReadUInt8();t.ReadUInt8();var B=t.ReadUInt8();t.ReadUInt8(),A.inputDefinition.elements[x]=new c.Tw2VertexElement(L,B,0)}if(A.inputDefinition.RebuildHash(),d<5)P=t.ReadUInt32(),M=t.data.subarray(t.cursor,t.cursor+P),t.cursor+=P,D=t.ReadUInt32(),I=t.data.subarray(t.cursor,t.cursor+D),t.cursor+=D;else{P=t.ReadUInt32();var F=t.ReadUInt32();M=r.substr(F,P),D=t.ReadUInt32(),F=t.ReadUInt32(),I=r.substr(F,D)}if(A.shader=u(C,"",M,this.path),null===A.shader)return void this.PrepareFinished(!1);w?(A.shadowShader=0===D?u(C,"\n#define PS\n",M,this.path):u(C,"",I,this.path),null===A.shadowShader&&(w=!1)):A.shadowShader=null,d>=3&&(t.ReadUInt32(),t.ReadUInt32(),t.ReadUInt32()),A.constantSize=0;for(var k=t.ReadUInt32(),N=0;N<k;++N){var G={};if(G.name=s(),G.offset=t.ReadUInt32()/4,G.size=t.ReadUInt32()/4,G.type=t.ReadUInt8(),G.dimension=t.ReadUInt8(),G.elements=t.ReadUInt32(),G.isSRGB=t.ReadUInt8(),G.isAutoregister=t.ReadUInt8(),A.constants[N]=G,"PerFrameVS"!==G.name&&"PerObjectVS"!==G.name&&"PerFramePS"!==G.name&&"PerObjectPS"!==G.name){var V=G.offset+G.size;V>A.constantSize&&(A.constantSize=V)}}var U=t.ReadUInt32()/4;if(A.constantValues=new Float32Array(U),d<5)for(var z=0;z<U;++z)A.constantValues[z]=t.ReadFloat32();else{var q=t.ReadUInt32(),Y=t.cursor;t.cursor=v+q;for(z=0;z<U;++z)A.constantValues[z]=t.ReadFloat32();t.cursor=Y}A.constantSize=Math.max(A.constantSize,U);for(var H=t.ReadUInt8(),W=0;W<H;++W){var X=t.ReadUInt8(),K={};K.registerIndex=X,K.name=s(),K.type=t.ReadUInt8(),K.isSRGB=t.ReadUInt8(),K.isAutoregister=t.ReadUInt8(),A.textures.push(K)}for(var Q=t.ReadUInt8(),Z=0;Z<Q;++Z){X=t.ReadUInt8();var J="";d>=4&&(J=s()),t.ReadUInt8();var $=t.ReadUInt8(),ee=t.ReadUInt8(),te=t.ReadUInt8(),re=t.ReadUInt8(),ie=t.ReadUInt8(),ne=t.ReadUInt8(),ae=(t.ReadFloat32(),t.ReadUInt8());t.ReadUInt8();var se=i.quat.create();se[0]=t.ReadFloat32(),se[1]=t.ReadFloat32(),se[2]=t.ReadFloat32(),se[3]=t.ReadFloat32();t.ReadFloat32(),t.ReadFloat32();d<4&&t.ReadUInt8();var oe=new l.Tw2SamplerState;if(oe.registerIndex=X,oe.name=J,1===$){switch(te){case 0:oe.minFilter=n.device.gl.NEAREST;break;case 1:oe.minFilter=n.device.gl.NEAREST_MIPMAP_NEAREST;break;default:oe.minFilter=n.device.gl.NEAREST_MIPMAP_LINEAR}oe.minFilterNoMips=n.device.gl.NEAREST}else{switch(te){case 0:oe.minFilter=n.device.gl.LINEAR;break;case 1:oe.minFilter=n.device.gl.LINEAR_MIPMAP_NEAREST;break;default:oe.minFilter=n.device.gl.LINEAR_MIPMAP_LINEAR}oe.minFilterNoMips=n.device.gl.LINEAR}oe.magFilter=1===ee?n.device.gl.NEAREST:n.device.gl.LINEAR;var le=[0,n.device.gl.REPEAT,n.device.gl.MIRRORED_REPEAT,n.device.gl.CLAMP_TO_EDGE,n.device.gl.CLAMP_TO_EDGE,n.device.gl.CLAMP_TO_EDGE];oe.addressU=le[re],oe.addressV=le[ie],oe.addressW=le[ne],3!==$&&3!==ee&&3!==te||(oe.anisotropy=Math.max(ae,1));for(var ce=0;ce<A.textures.length;++ce)if(A.textures[ce].registerIndex===oe.registerIndex){oe.samplerType=4===A.textures[ce].type?n.device.gl.TEXTURE_CUBE_MAP:n.device.gl.TEXTURE_2D,oe.isVolume=3===A.textures[ce].type;break}oe.ComputeHash(),A.samplers.push(oe)}d>=3&&t.ReadUInt8(),R.stages[C]=A}R.states=[];for(var ue=t.ReadUInt8(),he=0;he<ue;++he){var fe=t.ReadUInt32(),pe=t.ReadUInt32();R.states.push({state:fe,value:pe})}if(R.shaderProgram=h(R.stages[0].shader,R.stages[1].shader,R,this.path),null===R.shaderProgram)return void this.PrepareFinished(!1);w?(R.shadowShaderProgram=h(R.stages[0].shadowShader,R.stages[1].shadowShader,R,this.path),null===R.shadowShaderProgram&&(R.shadowShaderProgram=R.shaderProgram)):R.shadowShaderProgram=R.shaderProgram,this.passes[T]=R}for(var de=t.ReadUInt16(),ve=0;ve<de;++ve){for(var me=s(),ye=[],be=t.ReadUInt8(),ge=0;ge<be;++ge)switch(ye[ge]={},ye[ge].name=s(),ye[ge].type=t.ReadUInt8(),ye[ge].type){case 0:ye[ge].value=0!==t.ReadUInt32();break;case 1:ye[ge].value=t.ReadInt32();break;case 2:ye[ge].value=t.ReadFloat32();break;default:ye[ge].value=s()}this.annotations[me]=ye}this.PrepareFinished(!0)},u.prototype.ApplyPass=function(e){e=this.passes[e];for(var t=0;t<e.states.length;++t)n.device.SetRenderState(e.states[t].state,e.states[t].value);n.device.IsAlphaTestEnabled()?(n.device.gl.useProgram(e.shadowShaderProgram.program),n.device.shadowHandles=e.shadowShaderProgram):(n.device.gl.useProgram(e.shaderProgram.program),n.device.shadowHandles=null)},u.prototype.IsValidParameter=function(e){return e in this.annotations},u.prototype.GetParametersByGroup=function(e){var t=[];for(var r in this.annotations)if(this.annotations.hasOwnProperty(r))for(var i=0;i<this.annotations[r].length;i++)"group"===this.annotations[r][i].name.toLowerCase()&&this.annotations[r][i].value.toLowerCase()===e.toLowerCase()&&t.push(r);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Float=function(){this.value=0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Frustum=n;var i=r(0);function n(){this.planes=[i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create()],this.viewPos=i.vec3.create(),this.viewDir=i.vec3.create(),this.halfWidthProjection=1}n.scratch={mat4_0:i.mat4.create(),vec3_0:i.vec3.create()},n.prototype.Initialize=function(e,t,r,a,s){var o=n.scratch.mat4_0,l=a||i.mat4.invert(o,e);this.viewPos.set(l.subarray(12,14)),this.viewDir.set(l.subarray(8,10)),this.halfWidthProjection=t[0]*r*.5;var c=s||i.mat4.multiply(o,t,e);this.planes[0][0]=c[2],this.planes[0][1]=c[6],this.planes[0][2]=c[10],this.planes[0][3]=c[14],this.planes[1][0]=c[3]+c[0],this.planes[1][1]=c[7]+c[4],this.planes[1][2]=c[11]+c[8],this.planes[1][3]=c[15]+c[12],this.planes[2][0]=c[3]-c[1],this.planes[2][1]=c[7]-c[5],this.planes[2][2]=c[11]-c[9],this.planes[2][3]=c[15]-c[13],this.planes[3][0]=c[3]-c[0],this.planes[3][1]=c[7]-c[4],this.planes[3][2]=c[11]-c[8],this.planes[3][3]=c[15]-c[12],this.planes[4][0]=c[3]+c[1],this.planes[4][1]=c[7]+c[5],this.planes[4][2]=c[11]+c[9],this.planes[4][3]=c[15]+c[13],this.planes[5][0]=c[3]-c[2],this.planes[5][1]=c[7]-c[6],this.planes[5][2]=c[11]-c[10],this.planes[5][3]=c[15]-c[14];for(var u=0;u<6;++u){var h=i.vec3.length(this.planes[u]);this.planes[u][0]/=h,this.planes[u][1]/=h,this.planes[u][2]/=h,this.planes[u][3]/=h}},n.prototype.IsSphereVisible=function(e,t){for(var r=0;r<6;++r)if(this.planes[r][0]*e[0]+this.planes[r][1]*e[1]+this.planes[r][2]*e[2]+this.planes[r][3]<-t)return!1;return!0},n.prototype.GetPixelSizeAcross=function(e,t){var r=i.vec3.subtract(n.scratch.vec3_0,this.viewPos,e),a=i.vec3.dot(this.viewDir,r);return a<1e-5&&(a=1e-5),t<1e-5?0:t/a*this.halfWidthProjection*2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2InstancedMeshBatch=t.Tw2InstancedMesh=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(4),s=r(37),o=r(23);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.Tw2InstancedMesh=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceGeometryResource=null,e.instanceGeometryResPath="",e.instanceMeshIndex=0,e.minBounds=n.vec3.create(),e.maxBounds=n.vec3.create(),e}return u(t,s.Tw2Mesh),i(t,[{key:"Initialize",value:function(){(function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),""!==this.instanceGeometryResPath&&(this.instanceGeometryResource=a.resMan.GetResource(this.instanceGeometryResPath))}}]),t}();h.prototype._GetAreaBatches=function(e,t,r,i){for(var n=0;n<e.length;++n){var a=e[n];if(null!==a.effect&&!a.debugIsHidden){var s=new f;s.renderMode=t,s.perObjectData=i,s.instanceMesh=this,s.meshIx=a.meshIndex,s.start=a.index,s.count=a.count,s.effect=a.effect,r.Commit(s)}}},h.prototype.RenderAreas=function(e,t,r,i){if(this.geometryResource&&this.geometryResource.KeepAlive(),this.instanceGeometryResource&&this.instanceGeometryResource.KeepAlive&&this.instanceGeometryResource.KeepAlive(),this.geometryResource&&this.instanceGeometryResource){if(!this.geometryResource.IsGood())return;var n=this.instanceGeometryResource.GetInstanceBuffer(this.instanceMeshIndex);n&&this.geometryResource.RenderAreasInstanced(e,t,r,i,n,this.instanceGeometryResource.GetInstanceDeclaration(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceStride(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceCount(this.instanceMeshIndex))}};var f=t.Tw2InstancedMeshBatch=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceMesh=null,e.geometryRes=null,e.meshIx=0,e.start=0,e.count=1,e.effect=null,e}return u(t,o.Tw2RenderBatch),t}();f.prototype.Commit=function(e){var t=void 0===e?this.effect:e;this.instanceMesh&&t&&this.instanceMesh.RenderAreas(this.meshIx,this.start,this.count,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MatrixParameter=n;var i=r(0);function n(e,t){this.name=void 0!==e?e:"",this.value=void 0!==t?i.mat4.clone(t):i.mat4.create(),this.constantBuffer=null,this.offset=0}n.prototype.Bind=function(e,t,r){if(null!==this.constantBuffer||r<16)return!1;this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r)},n.prototype.Unbind=function(){this.constantBuffer=null},n.prototype.SetValue=function(e){i.mat4.copy(this.value,e),null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.GetValue=function(){return null!==this.constantBuffer?i.mat4.clone(this.constantBuffer.subarray(this.offset,this.offset+this.value.length)):i.mat4.clone(this.value)},n.prototype.Apply=function(e,t){e.set(this.value,t)},n.prototype.OnValueChanged=function(){null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.is=function(e){return i.util.isArrayLike(e)&&16===e.length}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PostProcess=u;var i=r(2),n=r(38),a=r(20),s=r(17),o=r(25),l=r(36),c=r(24);function u(){this.width=0,this.height=0,this.texture=null,this.quadRT0=new n.Tw2RenderTarget,this.quadRT1=new n.Tw2RenderTarget,this.steps=[],this.steps[0]=new a.Tw2Effect,this.steps[0]={effect:new a.Tw2Effect,rt:this.quadRT1,inputs:{BlitCurrent:null}},this.steps[0].effect.effectFilePath="res:/Graphics/Effect/Managed/Space/PostProcess/ColorDownFilter4.fx",this.steps[0].effect.Initialize(),this.steps[0].effect.parameters.BlitCurrent=new s.Tw2TextureParameter("BlitCurrent"),this.steps[0].effect.parameters.g_texelSize=new o.Tw2Vector4Parameter("g_texelSize"),this.steps[1]=new a.Tw2Effect,this.steps[1]={effect:new a.Tw2Effect,rt:this.quadRT0,inputs:{BlitCurrent:this.quadRT1}},this.steps[1].effect.effectFilePath="res:/Graphics/Effect/Managed/Space/PostProcess/ColorHighPassFilter.fx",this.steps[1].effect.Initialize(),this.steps[1].effect.parameters.BlitCurrent=new s.Tw2TextureParameter("BlitCurrent"),this.steps[1].effect.parameters.LuminanceThreshold=new l.Tw2FloatParameter("LuminanceThreshold",.85),this.steps[1].effect.parameters.LuminanceScale=new l.Tw2FloatParameter("LuminanceScale",2),this.steps[2]=new a.Tw2Effect,this.steps[2]={effect:new a.Tw2Effect,rt:this.quadRT1,inputs:{BlitCurrent:this.quadRT0}},this.steps[2].effect.effectFilePath="res:/Graphics/Effect/Managed/Space/PostProcess/ColorExpBlurHorizontalBig.fx",this.steps[2].effect.Initialize(),this.steps[2].effect.parameters.BlitCurrent=new s.Tw2TextureParameter("BlitCurrent"),this.steps[2].effect.parameters.g_texelSize=new o.Tw2Vector4Parameter("g_texelSize"),this.steps[3]=new a.Tw2Effect,this.steps[3]={effect:new a.Tw2Effect,rt:this.quadRT0,inputs:{BlitCurrent:this.quadRT1}},this.steps[3].effect.effectFilePath="res:/Graphics/Effect/Managed/Space/PostProcess/ColorExpBlurVerticalBig.fx",this.steps[3].effect.Initialize(),this.steps[3].effect.parameters.BlitCurrent=new s.Tw2TextureParameter("BlitCurrent"),this.steps[3].effect.parameters.g_texelSize=new o.Tw2Vector4Parameter("g_texelSize"),this.steps[4]=new a.Tw2Effect,this.steps[4]={effect:new a.Tw2Effect,rt:null,inputs:{BlitCurrent:this.quadRT0,BlitOriginal:null}},this.steps[4].effect.effectFilePath="res:/Graphics/Effect/Managed/Space/PostProcess/ColorUpFilter4_Add.fx",this.steps[4].effect.Initialize(),this.steps[4].effect.parameters.BlitCurrent=new s.Tw2TextureParameter("BlitCurrent"),this.steps[4].effect.parameters.BlitOriginal=new s.Tw2TextureParameter("BlitOriginal"),this.steps[4].effect.parameters.g_texelSize=new o.Tw2Vector4Parameter("g_texelSize"),this.steps[4].effect.parameters.ScalingFactor=new l.Tw2FloatParameter("ScalingFactor",1)}u.prototype.Render=function(){var e,t,r=i.device.viewportWidth,n=i.device.viewportHeight;if(!(r<=0||n<=0)){if(null===this.texture&&(this.texture=new c.Tw2TextureRes,this.texture.Attach(i.device.gl.createTexture())),r!==this.width||n!==this.height)for(i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.texImage2D(i.device.gl.TEXTURE_2D,0,i.device.gl.RGBA,r,n,0,i.device.gl.RGBA,i.device.gl.UNSIGNED_BYTE,null),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),this.quadRT0.Create(r/4,n/4,!1),this.quadRT1.Create(r/4,n/4,!1),this.width=r,this.height=n,t=0;t<this.steps.length;++t){for(var a in(e=this.steps[t]).inputs)e.inputs.hasOwnProperty(a)&&(e.inputs[a]?e.effect.parameters[a].textureRes=e.inputs[a].texture:e.effect.parameters[a].textureRes=this.texture);if("g_texelSize"in e.effect.parameters&&"BlitCurrent"in e.inputs){var s=e.effect.parameters.g_texelSize,o=e.inputs.BlitCurrent;o?(s.value[0]=1/o.width,s.value[1]=1/o.width):(s.value[0]=1/r,s.value[1]=1/r),s.OnValueChanged()}}for(i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.copyTexImage2D(i.device.gl.TEXTURE_2D,0,i.device.alphaBlendBackBuffer?i.device.gl.RGBA:i.device.gl.RGB,0,0,r,n,0),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),i.device.SetStandardStates(i.device.RM_OPAQUE),t=0;t<this.steps.length;++t)null!==(e=this.steps[t]).rt?e.rt.Set():(i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),i.device.gl.viewport(0,0,r,n)),i.device.RenderFullScreenQuad(e.effect)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RuntimeInstanceData=function(){this.name="",this.count=0;var e=null,t=null,r=0,s=0,o=null,l=!0;this.GetMaxInstanceCount=function(){return o?o.length:1},this.SetElementLayout=function(s){t&&(i.device.gl.deleteBuffer(t),t=null),r=0,e=new n.Tw2VertexDeclaration;for(var o=0;o<s.length;++o){var l=new a.Tw2ParticleElementDeclaration;l.elementType=s[o][0],l.dimension=s[o][2],l.usageIndex=s[o][1];var c=l.GetDeclaration();c.offset=4*r,e.elements.push(c),r+=l.dimension}e.RebuildHash()},this.SetData=function(t){e&&(s=(o=t).length,l=!0,this.UpdateData())},this.SetItemElement=function(t,r,i){if(e.elements[r].elements>1)for(var n=0;n<e.elements[r].elements;++n)o[t][r][n]=i[n];else o[t][r]=i;l=!0},this.SetItemElementRef=function(e,t,r){o[e][t]=r,l=!0},this.GetItemElement=function(e,t){return o[e][t]},this.UpdateData=function(){if(l&&e){var n,a,s,c=new Float32Array(o.length*r),u=0;for(n=0;n<o.length;++n)for(a=0;a<e.elements.length;++a)if(1===e.elements[a].elements)c[u++]=o[n][a];else for(s=0;s<e.elements[a].elements;++s)c[u++]=o[n][a][s];t||(t=i.device.gl.createBuffer()),i.device.gl.bindBuffer(i.device.gl.ARRAY_BUFFER,t),i.device.gl.bufferData(i.device.gl.ARRAY_BUFFER,c,i.device.gl.STATIC_DRAW),i.device.gl.bindBuffer(i.device.gl.ARRAY_BUFFER,null),l=!1}},this.Unload=function(){t&&(i.device.gl.deleteBuffer(t),t=null)},this.GetInstanceBuffer=function(){return t},this.GetInstanceDeclaration=function(){return e},this.GetInstanceStride=function(){return 4*r},this.GetInstanceCount=function(){return s}};var i=r(2),n=r(12),a=r(39)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(79);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(80);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2StaticEmitter=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(1),a=r(40);t.Tw2StaticEmitter=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.particleSystem=null,e.geometryResourcePath="",e.geometryResource=null,e.geometryIndex=0,e._spawned=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleEmitter),i(t,[{key:"Initialize",value:function(){""!==this.geometryResourcePath&&(this.geometryResource=n.resMan.GetResource(this.geometryResourcePath),this.geometryResource.systemMirror=!0,this.geometryResource.RegisterNotification(this)),this._spawned=!1}},{key:"RebuildCachedData",value:function(){this.geometryResource&&this.geometryResource.meshes.length&&(this.geometryResource.meshes[0].bufferData||(this.geometryResource.systemMirror=!0,this.geometryResource.Reload()))}},{key:"Update",value:function(){if(!this._spawned&&this.particleSystem&&this.geometryResource&&this.geometryResource.IsGood()&&this.geometryResource.meshes.length>this.geometryIndex&&this.geometryResource.meshes[this.geometryIndex].bufferData){this._spawned=!0;for(var e=this.geometryResource.meshes[this.geometryIndex],t=this.particleSystem.elements,r=new Array(t.length),i=0;i<t.length;++i){var a=t[i].GetDeclaration(),s=e.declaration.FindUsage(a.usage,a.usageIndex-8);if(null===s)return void n.emitter.log("res.error",{log:"error",src:["Tw2StaticEmitter","Update"],msg:"Input geometry mesh lacks element required by particle system",path:this.geometryResource.path,type:"geometry.elements",data:{elementUsage:a.usage,elementUsageIndex:a.usageIndex}});if(s.elements<a.elements)return void n.emitter.log("res.error",{log:"error",src:["Tw2StaticEmitter","Update"],msg:"Input geometry mesh elements do not have the required number of components",path:this.geometryResource.path,type:"geometry.elementcomponents",data:{inputCount:s.elements,elementCount:a.elements,elementUsage:a.usage,elementUsageIndex:a.usageIndex}});r[i]=s.offset/4}for(var o=e.bufferData.length/e.declaration.stride*4,l=0;l<o;++l){var c=this.particleSystem.BeginSpawnParticle();if(null===c)break;for(var u=0;u<this.particleSystem._elements.length;++u)for(var h=this.particleSystem._elements[u],f=0;f<h.dimension;++f)h.buffer[h.instanceStride*c+h.startOffset+f]=e.bufferData[r[u]+f+l*e.declaration.stride/4];this.particleSystem.EndSpawnParticle()}}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2DynamicEmitter=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(40);t.Tw2DynamicEmitter=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rate=0,e.isValid=!1,e._accumulatedRate=0,e.generators=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2ParticleEmitter),i(t,[{key:"Initialize",value:function(){this.Rebind()}},{key:"Update",value:function(e){this.SpawnParticles(null,null,Math.min(e,.1))}},{key:"Rebind",value:function(){if(this.isValid=!1,this.particleSystem){for(var e=0;e<this.generators.length;++e)if(!this.generators[e].Bind(this.particleSystem))return;this.isValid=!0}}},{key:"SpawnParticles",value:function(e,t,r){if(this.isValid){this._accumulatedRate+=this.rate*r;var i=Math.floor(this._accumulatedRate);this._accumulatedRate-=i;for(var n=0;n<i;++n){var a=this.particleSystem.BeginSpawnParticle();if(null===a)break;for(var s=0;s<this.generators.length;++s)this.generators[s].Generate(e,t,a);this.particleSystem.EndSpawnParticle()}}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(82);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(83);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(84);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(85);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(86);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(87);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttractorForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(9);t.Tw2ParticleAttractorForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.magnitude=0,e.position=n.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r){var i=a.Tw2ParticleForce.global.vec3_0;i[0]=this.position[0]-e.buffer[e.offset],i[1]=this.position[1]-e.buffer[e.offset+1],i[2]=this.position[2]-e.buffer[e.offset+2],n.vec3.normalize(i,i),n.vec3.scale(i,i,this.magnitude),n.vec3.add(r,r,i)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDirectForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(9);t.Tw2ParticleDirectForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.force=n.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r){n.vec3.add(r,r,this.force)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDragForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(9);t.Tw2ParticleDragForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r){r[0]+=t.buffer[t.offset]*-this.drag,r[1]+=t.buffer[t.offset+1]*-this.drag,r[2]+=t.buffer[t.offset+2]*-this.drag}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleFluidDragForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(9);t.Tw2ParticleFluidDragForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r,i,s){var o=a.Tw2ParticleForce.global.vec3_0,l=a.Tw2ParticleForce.global.vec3_1,c=Math.sqrt(t.buffer[t.offset]*t.buffer[t.offset]+t.buffer[t.offset+1]*t.buffer[t.offset+1]+t.buffer[t.offset+2]*t.buffer[t.offset+2]);o[0]=t.buffer[t.offset]*-c*this.drag,o[1]=t.buffer[t.offset+1]*-c*this.drag,o[2]=t.buffer[t.offset+2]*-c*this.drag,n.vec3.scale(l,o,i*s),l[0]+=t.buffer[t.offset],l[1]+=t.buffer[t.offset+1],l[2]+=t.buffer[t.offset+2],t.buffer[t.offset]*l[0]+t.buffer[t.offset+1]*l[1]+t.buffer[t.offset+2]*l[2]<0?(r[0]=-t.buffer[t.offset]/i/s,r[1]=-t.buffer[t.offset+1]/i/s,r[2]=-t.buffer[t.offset+2]/i/s):n.vec3.copy(r,o)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSpring=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(9);t.Tw2ParticleSpring=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.springConstant=0,e.position=n.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r){r[0]+=(this.position[0]-e.buffer[e.offset])*this.springConstant,r[1]+=(this.position[1]-e.buffer[e.offset+1])*this.springConstant,r[2]+=(this.position[2]-e.buffer[e.offset+2])*this.springConstant}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleTurbulenceForce=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(9);t.Tw2ParticleTurbulenceForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.noiseLevel=3,e.noiseRatio=.5,e.amplitude=n.vec3.fromValues(1,1,1),e.frequency=n.vec4.fromValues(1,1,1,1),e._time=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),i(t,[{key:"ApplyForce",value:function(e,t,r){if(0!==this.noiseLevel){for(var i=e.buffer[e.offset]*this.frequency[0],s=e.buffer[e.offset+1]*this.frequency[1],o=e.buffer[e.offset+2]*this.frequency[2],l=this._time*this.frequency[3],c=0,u=.5,h=1/this.noiseRatio,f=n.vec4.set(a.Tw2ParticleForce.global.vec4_0,0,0,0,0),p=0;p<this.noiseLevel;++p)n.noise.turbulence(f,i,s,o,l,u),c+=u,i*=h,s*=h,o*=h,l*=h,u*=this.noiseRatio;r[0]+=f[0]*this.amplitude[0]*c,r[1]+=f[1]*this.amplitude[1]*c,r[2]+=f[2]*this.amplitude[2]*c}}},{key:"Update",value:function(e){this._time+=e}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(89);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(90);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(91);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomIntegerAttributeGenerator=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(13),s=r(26);t.Tw2RandomIntegerAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=n.vec4.create(),e.maxRange=n.vec4.create(),e._element=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2ParticleAttributeGenerator),i(t,[{key:"Bind",value:function(e){for(var t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,r){for(var i=0;i<this._element.dimension;++i)this._element.buffer[this._element.instanceStride*r+this._element.startOffset+i]=Math.floor(this.minRange[i]+Math.random()*(this.maxRange[i]-this.minRange[i])+.5)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomUniformAttributeGenerator=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(13),s=r(26);t.Tw2RandomUniformAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=n.vec4.create(),e.maxRange=n.vec4.create(),e._element=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2ParticleAttributeGenerator),i(t,[{key:"Bind",value:function(e){for(var t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,r){for(var i=0;i<this._element.dimension;++i)this._element.buffer[this._element.instanceStride*r+this._element.startOffset+i]=this.minRange[i]+Math.random()*(this.maxRange[i]-this.minRange[i])}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SphereShapeAttributeGenerator=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(13),s=r(26);t.Tw2SphereShapeAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.minRadius=0,e.maxRadius=0,e.minPhi=0,e.maxPhi=360,e.minTheta=0,e.maxTheta=360,e.controlPosition=!0,e.controlVelocity=!0,e.minSpeed=0,e.maxSpeed=0,e.parentVelocityFactor=1,e.position=n.vec3.create(),e.rotation=n.quat.create(),e._position=null,e._velocity=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2ParticleAttributeGenerator),i(t,[{key:"Bind",value:function(e){this._position=null,this._velocity=null;for(var t=0;t<e._elements.length;++t)e._elements[t].elementType===a.Tw2ParticleElementDeclaration.Type.POSITION&&this.controlPosition?this._position=e._elements[t]:e._elements[t].elementType===a.Tw2ParticleElementDeclaration.Type.VELOCITY&&this.controlVelocity&&(this._velocity=e._elements[t]);return!(this.controlPosition&&null===this._position||this.controlVelocity&&null===this._velocity)}},{key:"Generate",value:function(e,t,r){var i=(this.minPhi+Math.random()*(this.maxPhi-this.minPhi))/180*Math.PI,a=(this.minTheta+Math.random()*(this.maxTheta-this.minTheta))/180*Math.PI,o=s.Tw2ParticleAttributeGenerator.global.vec3_0;if(o[0]=Math.sin(i)*Math.cos(a),o[1]=-Math.cos(i),o[2]=Math.sin(i)*Math.sin(a),n.vec3.transformQuat(o,o,this.rotation),this._velocity){var l=this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed),c=this._velocity.instanceStride*r+this._velocity.startOffset;this._velocity.buffer[c]=o[0]*l,this._velocity.buffer[c+1]=o[1]*l,this._velocity.buffer[c+2]=o[2]*l,t&&(this._velocity.buffer[c]+=t.buffer[t.offset]*this.parentVelocityFactor,this._velocity.buffer[c+1]+=t.buffer[t.offset+1]*this.parentVelocityFactor,this._velocity.buffer[c+2]+=t.buffer[t.offset+2]*this.parentVelocityFactor)}if(this._position){n.vec3.scale(o,o,this.minRadius+Math.random()*(this.maxRadius-this.minRadius)),n.vec3.add(o,o,this.position),e&&(o[0]+=e.buffer[e.offset],o[1]+=e.buffer[e.offset+1],o[2]+=e.buffer[e.offset+2]);var u=this._position.instanceStride*r+this._position.startOffset;this._position.buffer[u]=o[0],this._position.buffer[u+1]=o[1],this._position.buffer[u+2]=o[2]}}}]),t}()},function(e,t,r){"use strict"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSystem=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(13);(t.Tw2ParticleSystem=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.aliveCount=0,this.maxParticleCount=0,this.emitParticleOnDeathEmitter=null,this.emitParticleDuringLifeEmitter=null,this.elements=[],this.isValid=!1,this.requiresSorting=!1,this.updateSimulation=!0,this.applyForce=!0,this.applyAging=!0,this.isGlobal=!1,this.forces=[],this.constraints=[],this.updateBoundingBox=!1,this.aabbMin=n.vec3.create(),this.aabbMax=n.vec3.create(),this.peakAliveCount=0,this.bufferDirty=!1,this._vb=null,this._declaration=null,this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[null,null],this.vertexStride=[null,null],this.buffers=[null,null],e.init()}return i(e,[{key:"Initialize",value:function(){this.UpdateElementDeclaration()}},{key:"UpdateElementDeclaration",value:function(){if(this.isValid=!1,this._vb&&(a.device.gl.deleteBuffer(this._vb),this._vb=null),this._declaration=null,this.aliveCount=0,0!==this.elements.length){this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[0,0],this.vertexStride=[0,0],this._declaration=new a.Tw2VertexDeclaration,this.buffers=[null,null];for(var e=0;e<this.elements.length;++e){var t=this.elements[e].usedByGPU?0:1,r=new s.Tw2ParticleElement(this.elements[e]);if(r.startOffset=this.vertexStride[t],r.offset=r.startOffset,this.elements[e].elementType!==s.Tw2ParticleElementDeclaration.Type.CUSTOM&&(this._stdElements[this.elements[e].elementType]=r),this.vertexStride[t]+=r.dimension,this._elements.push(r),0===t){var i=this.elements[e].GetDeclaration();i.offset=4*r.startOffset,this._declaration.elements.push(i)}}this._declaration.RebuildHash();for(var n=0;n<this._elements.length;++n){var o=this._elements[n].usedByGPU?0:1;this._elements[n].vertexStride=this.vertexStride[o]}this.instanceStride[0]=4*this.vertexStride[0],this.instanceStride[1]=4*this.vertexStride[1];for(var l=0;l<this._elements.length;++l){var c=this._elements[l].usedByGPU?0:1;this._elements[l].instanceStride=this.instanceStride[c]}this.buffers=[null,null],this.instanceStride[0]&&this.maxParticleCount&&(this.buffers[0]=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._vb=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vb),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,this.buffers[0].length,a.device.gl.DYNAMIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,null)),this.instanceStride[1]&&(this.buffers[1]=new Float32Array(this.instanceStride[1]*this.maxParticleCount));for(var u=0;u<this._elements.length;++u){var h=this._elements[u].usedByGPU?0:1;this._elements[u].buffer=this.buffers[h]}this.requiresSorting&&(this._sortedIndexes=new Array(this.maxParticleCount),this._sortedBuffer=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._distancesBuffer=new Float32Array(this.maxParticleCount)),this.isValid=!0,this.bufferDirty=!0}}},{key:"HasElement",value:function(e){return null!==this._stdElements[e]}},{key:"GetElement",value:function(e){return this._stdElements[e]&&(this._stdElements[e].offset=this._stdElements[e].startOffset),this._stdElements[e]}},{key:"BeginSpawnParticle",value:function(){return!this.isValid||this.aliveCount>=this.maxParticleCount?null:this.aliveCount++}},{key:"EndSpawnParticle",value:function(){this.bufferDirty=!0}},{key:"Update",value:function(t){if(t=Math.min(t,.1),this.applyAging&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.LIFETIME)){for(var r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.LIFETIME),i=this.emitParticleOnDeathEmitter?this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION):null,a=this.emitParticleOnDeathEmitter?this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY):null,o=0;o<this.aliveCount;++o)if(r.buffer[r.offset]+=t/r.buffer[r.offset+1],r.buffer[r.offset]>1){if(this.emitParticleOnDeathEmitter&&this.emitParticleOnDeathEmitter.SpawnParticles(i,a,1),this.aliveCount--,o<this.aliveCount){for(var l=0;l<2;++l)this.buffers[l]&&this.buffers[l].set(this.buffers[l].subarray(this.instanceStride[l]*this.aliveCount,this.instanceStride[l]*this.aliveCount+this.instanceStride[l]),o*this.instanceStride[l]);--o,this.bufferDirty=!0}}else r.offset+=r.instanceStride,i&&(i.offset+=i.instanceStride),a&&(a.offset+=a.instanceStride);r.dirty=!0}var c=e.global.vec3_0;if(this.updateSimulation&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY)){for(var u=this.applyForce&&this.forces.length,h=0;h<this.forces.length;++h)this.forces[h].Update(t);for(var f=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),p=this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY),d=u?this.GetElement(s.Tw2ParticleElementDeclaration.Type.MASS):null,v=0;v<this.aliveCount;++v){if(u){for(var m=d?d.buffer[d.offset]:1,y=n.vec3.set(c,0,0,0),b=0;b<this.forces.length;++b)this.forces[b].ApplyForce(f,p,y,t,m);d&&n.vec3.scale(y,y,1/d.buffer[d.offset]),p.buffer[p.offset]+=y[0]*t,p.buffer[p.offset+1]+=y[1]*t,p.buffer[p.offset+2]+=y[2]*t}f.buffer[f.offset]+=p.buffer[p.offset]*t,f.buffer[f.offset+1]+=p.buffer[p.offset+1]*t,f.buffer[f.offset+2]+=p.buffer[p.offset+2]*t,this.emitParticleDuringLifeEmitter&&this.emitParticleDuringLifeEmitter.SpawnParticles(f,p,t),f.offset+=f.instanceStride,p.offset+=p.instanceStride,d&&(d.offset+=d.instanceStride)}f.dirty=!0,p.dirty=!0}if(this.updateSimulation&&this.constraints.length)for(var g=0;g<this.constraints.length;++g)this.constraints[g].ApplyConstraint(this.buffers,this.instanceStride,this.aliveCount,t);if(this.updateBoundingBox&&this.GetBoundingBox(this.aabbMin,this.aabbMax),this.emitParticleDuringLifeEmitter&&(!this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)||!this.HasElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY))&&this.updateSimulation)for(var _=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),E=this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY),T=0;T<this.aliveCount;++T)this.emitParticleDuringLifeEmitter.SpawnParticles(_,E,1),_&&(_.offset+=_.instanceStride),E&&(E.offset+=E.instanceStride);for(var R=0;R<this._elements.length;++R){var S=this._elements[R];S.offset=S.startOffset,S.dirty&&(this.bufferDirty=!0,S.dirty=!1)}}},{key:"GetBoundingBox",value:function(e,t){if(this.aliveCount&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)){var r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION);e[0]=r.buffer[r.offset],e[1]=r.buffer[r.offset+1],e[2]=r.buffer[r.offset+2],t[0]=r.buffer[r.offset],t[1]=r.buffer[r.offset+1],t[2]=r.buffer[r.offset+2];for(var i=0;i<this.aliveCount;++i)e[0]=Math.min(e[0],r.buffer[r.offset]),e[1]=Math.min(e[1],r.buffer[r.offset+1]),e[2]=Math.min(e[2],r.buffer[r.offset+2]),t[0]=Math.max(t[0],r.buffer[r.offset]),t[1]=Math.max(t[1],r.buffer[r.offset+1]),t[2]=Math.max(t[2],r.buffer[r.offset+2]),r.offset+=r.instanceStride;return!0}return!1}},{key:"_Sort",value:function(){for(var t=n.mat4.multiply(e.global.mat4_0,a.device.projection,a.device.view),r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),i=this.aliveCount,o=this._distancesBuffer,l=0;l<i;++l){var c=r.offset+r.instanceStride*l,u=r.buffer[c]-t[12],h=u*u;h+=(u=r.buffer[c+1]-t[13])*u,h+=(u=r.buffer[c+2]-t[14])*u,o[l]=h}for(var f=0;f<this.maxParticleCount;++f)this._sortedIndexes[f]=f;this._sortedIndexes.sort(function(e,t){if(e>=i&&t>=i)return e<t?-1:e>t?1:0;if(e>=i)return 1;if(t>=i)return-1;var r=o[e],n=o[t];return r<n?1:r>n?-1:0})}},{key:"GetInstanceBuffer",value:function(){if(0!==this.aliveCount){var e=a.device;if(this.requiresSorting&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)&&this.buffers){this._Sort();for(var t=this.instanceStride[0],r=this.buffers[0],i=0;i<this.aliveCount;++i)for(var n=i*t,o=this._sortedIndexes[i]*t,l=0;l<t;++l)this._sortedBuffer[n+l]=r[l+o];e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this._vb),e.gl.bufferSubData(e.gl.ARRAY_BUFFER,0,this._sortedBuffer.subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1}else this.bufferDirty&&(e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this._vb),e.gl.bufferSubData(e.gl.ARRAY_BUFFER,0,this.buffers[0].subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1);return this._vb}}},{key:"GetInstanceDeclaration",value:function(){return this._declaration}},{key:"GetInstanceStride",value:function(){return this.instanceStride[0]}},{key:"GetInstanceCount",value:function(){return this.aliveCount}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:n.vec3.create(),mat4_0:n.mat4.create()})}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformParameter=n;var i=r(0);function n(e){this.name=void 0!==e?e:"",this.scaling=i.vec3.fromValues(1,1,1),this.rotationCenter=i.vec3.create(),this.rotation=i.quat.create(),this.translation=i.vec3.create(),this.worldTransform=i.mat4.create()}n.prototype.Initialize=function(){this.OnModified()},n.prototype.OnModified=function(){i.mat4.fromRotationTranslationScaleOrigin(this.worldTransform,this.rotation,this.translation,this.scaling,this.rotationCenter),i.mat4.transpose(this.worldTransform,this.worldTransform)},n.prototype.Bind=function(e,t,r){if(null!==this.constantBuffer||r<16)return!1;this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r)},n.prototype.OnValueChanged=function(){this.OnModified()},n.prototype.Apply=function(e,t,r){r>=16?e.set(this.worldTransform,t):e.set(this.worldTransform.subarray(0,r),t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.Tw2ValueBinding=s;var n=r(0),a=r(25);function s(){this.name="",this.sourceObject=null,this.sourceAttribute="",this._sourceElement=null,this.sourceIsArray=null,this.destinationObject=null,this.destinationAttribute="",this._destinationElement=null,this.destinationIsArray=null,this.scale=1,this.offset=n.quat.create(),this._copyFunc=null}s.prototype.Initialize=function(){if(this.sourceObject&&""!==this.sourceAttribute&&this.destinationObject&&""!==this.destinationAttribute){var e=!1,t=!1,r=this.sourceAttribute.substr(-2);".x"===r||".r"===r?(e=!0,this._sourceElement=0,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".y"===r||".g"===r?(e=!0,this._sourceElement=1,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".z"===r||".b"===r?(e=!0,this._sourceElement=2,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".w"===r||".a"===r?(e=!0,this._sourceElement=3,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):this.sourceObject instanceof a.Tw2Vector4Parameter&&("v1"===this.sourceAttribute?(e=!0,this._sourceElement=0,this.sourceAttribute="value"):"v2"===this.sourceAttribute?(e=!0,this._sourceElement=1,this.sourceAttribute="value"):"v3"===this.sourceAttribute?(e=!0,this._sourceElement=2,this.sourceAttribute="value"):"v4"===this.sourceAttribute&&(e=!0,this._sourceElement=3,this.sourceAttribute="value"));var n=this.destinationAttribute.substr(-2);if(".x"===n||".r"===n?(t=!0,this._destinationElement=0,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".y"===n||".g"===n?(t=!0,this._destinationElement=1,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".z"===n||".b"===n?(t=!0,this._destinationElement=2,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".w"===n||".a"===n?(t=!0,this._destinationElement=3,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):this.destinationObject instanceof a.Tw2Vector4Parameter&&("v1"===this.destinationAttribute?(t=!0,this._destinationElement=0,this.destinationAttribute="value"):"v2"===this.destinationAttribute?(t=!0,this._destinationElement=1,this.destinationAttribute="value"):"v3"===this.destinationAttribute?(t=!0,this._destinationElement=2,this.destinationAttribute="value"):"v4"===this.destinationAttribute&&(t=!0,this._destinationElement=3,this.destinationAttribute="value")),this.sourceAttribute in this.sourceObject&&this.destinationAttribute in this.destinationObject)if(this.sourceIsArray=this.sourceObject[this.sourceAttribute]instanceof Float32Array||Array.isArray(this.sourceObject[this.sourceAttribute]),this.destinationIsArray=this.destinationObject[this.destinationAttribute]instanceof Float32Array||Array.isArray(this.destinationObject[this.destinationAttribute]),this.sourceIsArray===this.destinationIsArray&&i(this.sourceObject[this.sourceAttribute])===i(this.destinationObject[this.destinationAttribute]))if(this.sourceIsArray)if(e)this._copyFunc=t?this._CopyElementToElement:this._ReplicateElement;else if(this.sourceObject[this.sourceAttribute].length<=this.destinationObject[this.destinationAttribute].length)this._copyFunc=this._CopyArray;else{if(16!==this.sourceObject[this.sourceAttribute].length)return;this._copyFunc=this._ExtractPos}else this._copyFunc=this._CopyValueToValue;else if(this.sourceIsArray&&e&&"number"==typeof this.destinationObject[this.destinationAttribute])this._copyFunc=this._CopyElementToValue;else if(this.destinationIsArray&&"number"==typeof this.sourceObject[this.sourceAttribute])this._copyFunc=t?this._CopyValueToElement:this._ReplicateValue;else{if("number"!=typeof this.sourceObject[this.sourceAttribute]||"boolean"!=typeof this.destinationObject[this.destinationAttribute])return;this._copyFunc=this._CopyFloatToBoolean}}},s.prototype.CopyValue=function(){this._copyFunc&&(this._copyFunc.call(this),"OnValueChanged"in this.destinationObject&&this.destinationObject.OnValueChanged())},s.prototype._CopyValueToValue=function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]},s.prototype._CopyArray=function(){for(var e=Math.min(this.destinationObject[this.destinationAttribute].length,this.sourceObject[this.sourceAttribute].length),t=0;t<e;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute][t]*this.scale+this.offset[t]},s.prototype._CopyElementToElement=function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]},s.prototype._ReplicateValue=function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[e]},s.prototype._ReplicateElement=function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[e]},s.prototype._ExtractPos=function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][e+12]*this.scale+this.offset[e]},s.prototype._CopyElementToValue=function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]},s.prototype._CopyValueToElement=function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]},s.prototype._CopyFloatToBoolean=function(){this.destinationObject[this.destinationAttribute]=0!==this.sourceObject[this.sourceAttribute]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VariableParameter=n;var i=r(16);function n(e,t){this.name=void 0!==e?e:"",this.variableName=void 0!==t?t:""}n.prototype.Bind=function(){return!1},n.prototype.Apply=function(e,t,r){i.store.HasVariable(this.variableName)&&i.store.GetVariable(this.variableName).Apply(e,t,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Parameter=n;var i=r(0);function n(e,t){this.name="undefined"!==e?e:"",this.value=void 0!==t?i.vec2.clone(t):i.vec2.fromValues(1,1),this.constantBuffer=null,this.offset=0}n.prototype.Bind=function(e,t,r){return!(null!==this.constantBuffer||r<2)&&(this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r),!0)},n.prototype.Unbind=function(){this.constantBuffer=null},n.prototype.SetValue=function(e){i.vec2.copy(this.value,e),null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.OnValueChanged=function(){null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.Apply=function(e,t){e.set(this.value,t)},n.prototype.GetValue=function(){return null!==this.constantBuffer?i.vec2.clone(this.constantBuffer.subarray(this.offset,this.offset+this.value.length)):i.vec2.clone(this.value)},n.prototype.GetIndexValue=function(e){if(void 0===this.value[e])throw"Invalid Index";return null!==this.constantBuffer?this.constantBuffer[this.offset+e]:this.value[e]},n.prototype.SetIndexValue=function(e,t){if(void 0===this.value[e])throw"Invalid Index";this.value[e]=t,null!==this.constantBuffer&&(this.constantBuffer[this.offset+e]=t)},n.prototype.FillWith=function(e){this.SetValue([e,e])},n.is=function(e){return i.util.isArrayLike(e)&&2===e.length}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Parameter=n;var i=r(0);function n(e,t){this.name="undefined"!==e?e:"",this.value=void 0!==t?i.vec3.clone(t):i.vec3.fromValues(1,1,1),this.constantBuffer=null,this.offset=0}n.prototype.Bind=function(e,t,r){return!(null!==this.constantBuffer||r<3)&&(this.constantBuffer=e,this.offset=t,this.Apply(this.constantBuffer,this.offset,r),!0)},n.prototype.Unbind=function(){this.constantBuffer=null},n.prototype.SetValue=function(e){i.vec3.copy(this.value,e),null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.OnValueChanged=function(){null!==this.constantBuffer&&this.constantBuffer.set(this.value,this.offset)},n.prototype.Apply=function(e,t){e.set(this.value,t)},n.prototype.GetValue=function(){return null!==this.constantBuffer?i.vec3.clone(this.constantBuffer.subarray(this.offset,this.offset+this.value.length)):i.vec3.clone(this.value)},n.prototype.GetIndexValue=function(e){if(void 0===this.value[e])throw"Invalid Index";return null!==this.constantBuffer?this.constantBuffer[this.offset+e]:this.value[e]},n.prototype.SetIndexValue=function(e,t){if(void 0===this.value[e])throw"Invalid Index";this.value[e]=t,null!==this.constantBuffer&&(this.constantBuffer[this.offset+e]=t)},n.prototype.FillWith=function(e){this.SetValue([e,e,e])},n.is=function(e){return i.util.isArrayLike(e)&&3===e.length}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve=t.Tw2ColorKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2ColorKey=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec4.create(),e.left=n.vec4.create(),e.right=n.vec4.create(),e.interpolation=0,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2ColorCurve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.vec4.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return n.vec4.copy(r,this.value);var i=this.keys[0],a=this.keys[this.keys.length-1];if(e>=a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.vec4.copy(r,this.value);case t.Extrapolation.CONSTANT:return n.vec4.copy(r,a.value);case t.Extrapolation.GRADIENT:return n.vec4.scaleAndAdd(r,a.value,a.right,e-a.time);default:e%=a.time}else if(e<0||e<i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.vec4.copy(r,this.value);case t.Extrapolation.GRADIENT:return n.vec4.scaleAndAdd(r,i.value,i.left,e*this.length-a.time);default:return n.vec4.copy(r,i.value)}for(var s=this.keys[this._currentKey],o=this.keys[this._currentKey-1];e>=s.time||e<o.time;)e<o.time&&(this._currentKey=0),this._currentKey++,s=this.keys[this._currentKey],o=this.keys[this._currentKey-1];var l=(e-o.time)/(s.time-o.time);switch(o.interpolation){case t.Interpolation.CONSTANT:return n.vec4.copy(r,o.value);default:return r[0]=o.value[0]*(1-l)+s.value[0]*l,r[1]=o.value[1]*(1-l)+s.value[1]*l,r[2]=o.value[2]*(1-l)+s.value[2]*l,r[3]=o.value[3]*(1-l)+s.value[3]*l,r}}}]),t}();u.inputDimension=4,u.ouputDimension=4,u.valueProperty="value",u.curveType=a.Tw2Curve.Type.CURVE,u.Key=c,u.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},u.Interpolation={NONE:0,CONSTANT:1,LINEAR:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve2=t.Tw2ColorKey2=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2ColorKey2=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec4.create(),e.leftTangent=n.vec4.create(),e.rightTangent=n.vec4.create(),e.interpolation=1,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2ColorCurve2=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=n.vec4.fromValues(0,0,0,1),e.currentValue=n.vec4.fromValues(0,0,0,1),e.endValue=n.vec4.fromValues(0,0,0,1),e.startTangent=n.vec4.create(),e.endTangent=n.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return n.vec4.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?n.vec4.copy(t,this.startValue):n.vec4.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],i=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],i=this.keys[a+1],!(r.time<=e&&i.time>e));++a);return this.Interpolate(e,r,i,t)}},{key:"Interpolate",value:function(e,r,i,a){n.vec4.copy(a,this.startValue);var s=this.startValue,o=this.endValue,l=this.interpolation,c=this.length;switch(null!==r&&(l=r.interpolation,e-=r.time),l){case t.Interpolation.LINEAR:return r&&i?(s=r.value,o=i.value,c=i.time-r.time):i?(o=i.value,c=i.time):r&&(s=r.value,c=this.length-r.time),a[0]=s[0]+(o[0]-s[0])*(e/c),a[1]=s[1]+(o[1]-s[1])*(e/c),a[2]=s[2]+(o[2]-s[2])*(e/c),a[3]=s[3]+(o[3]-s[3])*(e/c),a;default:return a}}}]),t}();u.inputDimension=4,u.outputDimension=4,u.valueProperty="currentValue",u.curveType=a.Tw2Curve.Type.CURVE2,u.Key=c,u.Interpolation={CONSTANT:0,LINEAR:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EventCurve=t.Tw2EventKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(3);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2EventKey=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e}return o(t,n.Tw2CurveKey),t}(),c=t.Tw2EventCurve=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e.keys=[],e.extrapolation=0,e._time=0,e._currentKey=0,e._length=0,e}return o(t,n.Tw2Curve),i(t,[{key:"Sort",value:function(){this.keys.length&&(this.keys.sort(n.Tw2Curve.Compare),this._length=this.keys[this.keys.length-1].time)}},{key:"GetLength",value:function(){return this._length}},{key:"UpdateValue",value:function(e){if(this._length<=0)return this.value;var r=this._time;if(this._time=e,this._time<r&&(this._currentKey=0),this.extrapolation===t.Extrapolation.CYCLE){var i=this._time%this._length;i<r&&(this._currentKey=0),this._time=i}for(;this._currentKey<this.keys.length&&this._time>=this.keys[this._currentKey].time;)this.value=this.keys[this._currentKey].value,++this._currentKey}}]),t}();c.dimension=1,c.outputDimension=1,c.valueProperty="value",c.curveType=n.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CYCLE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerlinCurve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);var s=t.Tw2PerlinCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.start=0,e.speed=1,e.alpha=1.1,e.beta=2,e.offset=0,e.scale=1,e.N=3,e._startOffset=100*Math.random(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),i(t,[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return e-=this._startOffset,(n.noise.perlin1D(e*this.speed,this.alpha,this.beta,this.N)+1)/2*this.scale+this.offset}}]),t}();s.outputDimension=1,s.valueProperty="value",s.curveType=a.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionCurve=t.Tw2QuaternionKey2=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2QuaternionKey2=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.quat.create(),e.leftTangent=n.vec4.create(),e.rightTangent=n.vec4.create(),e.interpolation=1,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2QuaternionCurve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=n.quat.create(),e.currentValue=n.quat.create(),e.endValue=n.quat.create(),e.startTangent=n.vec4.create(),e.endTangent=n.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t;if(e>this.length){if(!this.cycle)return this.reversed?(t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t):(t[0]=this.endValue[0],t[1]=this.endValue[1],t[2]=this.endValue[2],t);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],i=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(var n=0;n+1<this.keys.length&&(r=this.keys[n],i=this.keys[n+1],!(r.time<=e&&i.time>e));++n);return this.Interpolate(e,r,i,t)}},{key:"Interpolate",value:function(e,r,i,a){a[0]=this.startValue[0],a[1]=this.startValue[1],a[2]=this.startValue[2];var s=this.startValue,o=this.endValue,l=this.interpolation,c=this.length;switch(null!==r&&(l=r.interpolation,e-=r.time),l){case t.Interpolation.SPHERICAL_LINEAR:return r&&i?(s=r.value,o=i.value,c=i.time-r.time):i?(o=i.value,c=i.time):r&&(s=r.value,c=this.length-r.time),n.quat.slerp(a,s,o,e/c),a;default:return a}}}]),t}();u.inputDimension=4,u.outputDimension=4,u.valueProperty="currentValue",u.curveType=a.Tw2Curve.Type.CURVE2,u.Key=c,u.Interpolation={CONSTANT:0,SPHERICAL_LINEAR:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomConstantCurve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(3);var a=t.Tw2RandomConstantCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.min=0,e.max=1,e.hold=!0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2Curve),i(t,[{key:"UpdateValue",value:function(){this.value=this.GetValueAt()}},{key:"GetValueAt",value:function(){return this.hold?this.value:this.min+(this.max-this.min)*Math.random()}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=n.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RigidOrientation=t.Tw2Torque=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2Torque=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rot0=n.quat.create(),e.omega0=n.vec3.create(),e.torque=n.vec3.create(),e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2RigidOrientation=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="",e.I=1,e.drag=1,e.value=n.quat.create(),e.start=0,e.states=[],e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this,this.states)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){if(0===this.states.length||e<0||e<this.states[0].time)return n.quat.copy(t,this.value);var r=0;if(e>=this.states[this.states.length-1].time)r=this.states.length-1;else for(;r+1<this.states.length&&!(e>=this.states[r].time&&e<this.states[r+1].time);++r);var i=a.Tw2Curve.global.vec3_0,s=a.Tw2Curve.global.quat_0,o=this.states[r];return n.vec3.exponentialDecay(i,o.omega0,o.torque,this.I,this.drag,e-o.time),n.quat.exp(s,i),n.quat.multiply(t,this.states[r].rot0,s),t}}]),t}();u.inputDimension=4,u.outputDimension=4,u.valueProperty="value",u.curveType=a.Tw2Curve.Type.CURVE,u.Key=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RotationCurve=t.Tw2QuaternionKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2QuaternionKey=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.quat.create(),e.left=n.vec4.create(),e.right=n.vec4.create(),e.interpolation=5,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2RotationCurve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.quat.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return n.quat.copy(r,this.value);var i=a.Tw2Curve.global,s=this.keys[0],o=this.keys[this.keys.length-1];if(e>=o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.quat.copy(r,this.value);case t.Extrapolation.CONSTANT:return n.quat.copy(r,o.value);default:e%=o.time}else if(e<0||e<s.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.quat.copy(r,this.value);default:return n.quat.copy(r,s.value)}for(var l=this.keys[this._currentKey],c=this.keys[this._currentKey-1];e>=l.time||e<c.time;)e<c.time&&(this._currentKey=0),this._currentKey++,l=this.keys[this._currentKey],c=this.keys[this._currentKey-1];var u=(e-c.time)/(l.time-c.time);switch(c.interpolation){case t.Interpolation.CONSTANT:return n.quat.copy(r,c.value);case t.Interpolation.LINEAR:return r[0]=c.value[0]*(1-u)+l.value[0]*u,r[1]=c.value[1]*(1-u)+l.value[1]*u,r[2]=c.value[2]*(1-u)+l.value[2]*u,r[3]=c.value[3]*(1-u)+l.value[3]*u,r;case t.Interpolation.HERMITE:for(var h=n.quat.identity(i.quat_0),f=[c.value,c.right,l.left,l.value],p=3;p>0;p--){var d=n.num.biCumulative(u,p);d>1&&n.quat.multiply(r,h,f[p]),r[0]=-f[p-1][0],r[1]=-f[p-1][1],r[2]=-f[p-1][2],r[3]=f[p-1][3],n.quat.multiply(r,r,f[p]),n.quat.pow(r,r,d),n.quat.multiply(h,h,r)}return n.quat.multiply(r,h,c.value);case t.Interpolation.SLERP:return n.quat.slerp(r,c.value,l.value,u);default:return n.quat.sqlerp(r,c.value,c.right,l.left,l.value,u)}}}]),t}();u.outputDimention=4,u.inputDimension=4,u.valueProperty="value",u.curveType=a.Tw2Curve.Type.CURVE,u.Child=c,u.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},u.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,SLERP:5,SQUAD:6}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve=t.Tw2ScalarKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(3);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ScalarKey=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.left=0,e.right=0,e.interpolation=0,e}return o(t,n.Tw2CurveKey),t}(),c=t.Tw2ScalarCurve=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.timeScale=1,e.timeOffset=0,e.value=0,e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return o(t,n.Tw2Curve),i(t,[{key:"Sort",value:function(){n.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale-this.timeOffset,0===this.length)return this.value;var r=this.keys[0],i=this.keys[this.keys.length-1];if(e>=i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.CONSTANT:return i.value;case t.Extrapolation.GRADIENT:return i.value+(e-i.time)*i.right;default:e%=i.time}else if(e<0||e<r.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.GRADIENT:return r.value+(e*this.length-i.time)*r.left;default:return r.value}for(var n=this.keys[this._currentKey],a=this.keys[this._currentKey-1];e>=n.time||e<a.time;)e<a.time&&(this._currentKey=0),this._currentKey++,n=this.keys[this._currentKey],a=this.keys[this._currentKey-1];var s=(e-a.time)/(n.time-a.time);switch(a.interpolation){case t.Interpolation.CONSTANT:return a.value;case t.Interpolation.LINEAR:return a.value*(1-s)+n.value*s;case t.Interpolation.HERMITE:var o=-2*s*s*s+3*s*s,l=s*s*s-2*s*s+s,c=s*s*s-s*s;return(2*s*s*s-3*s*s+1)*a.value+o*n.value+l*a.right+c*n.left;default:var u=1+(Math.sqrt(a.value/n.value)-1)*Math.exp(-e/a.right);return u*u*n.value}}}]),t}();c.inputDimension=1,c.outputDimension=1,c.valueProperty="value",c.curveType=n.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,CATMULROM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve2=t.Tw2ScalarKey2=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(3);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ScalarKey2=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.leftTangent=0,e.rightTangent=0,e.interpolation=1,e}return o(t,n.Tw2CurveKey),t}(),c=t.Tw2ScalarCurve2=function(e){function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=0,e.currentValue=0,e.endValue=0,e.startTangent=0,e.endTangent=0,e.interpolation=1,e.keys=[],e.length=0,e}return o(t,n.Tw2Curve),i(t,[{key:"Sort",value:function(){n.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.currentValue=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return this.startValue;if(e>this.length){if(!this.cycle)return this.reversed?this.startValue:this.endValue;e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null);var t=this.keys[0],r=this.keys[this.keys.length-1];if(e<=t.time)return this.Interpolate(e,null,t);if(e>=r.time)return this.Interpolate(e,r,null);for(var i=0;i+1<this.keys.length&&(t=this.keys[i],r=this.keys[i+1],!(t.time<=e&&r.time>e));++i);return this.Interpolate(e,t,r)}},{key:"Interpolate",value:function(e,r,i){var n=this.startValue,a=this.endValue,s=this.interpolation,o=this.length;switch(null!==r&&(s=r.interpolation,e-=r.time),s){case t.Interpolation.LINEAR:return r&&i?(n=r.value,a=i.value,o=i.time-r.time):i?(a=i.value,o=i.time):r&&(n=r.value,o=this.length-r.time),n+e/o*(a-n);case t.Interpolation.HERMITE:var l=this.startTangent,c=this.endTangent;r&&i?(n=r.value,l=r.rightTangent,a=i.value,c=i.leftTangent,o=i.time-r.time):i?(a=i.value,c=i.leftTangent,o=i.time):r&&(n=r.value,l=r.rightTangent,o=this.length-r.time);var u=e/o,h=u*u,f=h*u,p=-2*f+3*h,d=f-h;return n*(1-p)+a*p+l*(u+d-h)+c*d;default:return this.startValue}}}]),t}();c.inputDimension=1,c.outputDimension=1,c.valueProperty="currentValue",c.curveType=n.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SineCurve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(3);var a=t.Tw2SineCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.offset=0,e.scale=1,e.speed=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2Curve),i(t,[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return Math.sin(e*Math.PI*2*this.speed)*this.scale+this.offset}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=n.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Curve=t.Tw2Vector2Key=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2Vector2Key=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec2.create(),e.leftTangent=n.vec2.create(),e.rightTangent=n.vec2.create(),e.interpolation=1,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2Vector2Curve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=n.vec2.create(),e.currentValue=n.vec2.create(),e.endValue=n.vec2.create(),e.startTangent=n.vec2.create(),e.endTangent=n.vec2.create(),e.interpolation=1,e.keys=[],e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return n.vec2.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?n.vec2.copy(t,this.startValue):n.vec2.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],i=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],i=this.keys[a+1],!(r.time<=e&&i.time>e));++a);return this.Interpolate(e,r,i,t)}},{key:"Interpolate",value:function(e,r,i,a){n.vec2.copy(a,this.startValue);var s=this.startValue,o=this.endValue,l=this.interpolation,c=this.length;switch(null!==r&&(l=r.interpolation,e-=r.time),l){case t.Interpolation.LINEAR:return r&&i?(s=r.value,o=i.value,c=i.time-r.time):i?(o=i.value,c=i.time):r&&(s=r.value,c=this.length-r.time),a[0]=s[0]+(o[0]-s[0])*(e/c),a[1]=s[1]+(o[1]-s[1])*(e/c),a;case t.Interpolation.HERMITE:var u=this.startTangent,h=this.endTangent;r&&i?(s=r.value,u=r.rightTangent,o=i.value,h=i.leftTangent,c=i.time-r.time):i?(o=i.value,h=i.leftTangent,c=i.time):r&&(s=r.value,u=r.rightTangent,c=this.length-r.time);var f=e/c,p=f*f,d=p*f,v=-2*d+3*p,m=1-v,y=d-p,b=f+y-p;return a[0]=s[0]*m+o[0]*v+u[0]*b+h[0]*y,a[1]=s[1]*m+o[1]*v+u[1]*b+h[1]*y,a;default:return a}}}]),t}();u.inputDimension=2,u.outputDimension=2,u.valueProperty="value",u.curveType=a.Tw2Curve.Type.CURVE2,u.Key=c,u.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Curve=t.Tw2Vector3Key=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2Vector3Key=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec3.create(),e.leftTangent=n.vec3.create(),e.rightTangent=n.vec3.create(),e.interpolation=1,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2Vector3Curve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=n.vec3.create(),e.currentValue=n.vec3.create(),e.endValue=n.vec3.create(),e.startTangent=n.vec3.create(),e.endTangent=n.vec3.create(),e.interpolation=1,e.keys=[],e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return n.vec3.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?n.vec3.copy(t,this.startValue):n.vec3.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],i=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],i=this.keys[a+1],!(r.time<=e&&i.time>e));++a);return this.Interpolate(e,r,i,t)}},{key:"Interpolate",value:function(e,r,i,a){n.vec3.copy(a,this.startValue);var s=this.startValue,o=this.endValue,l=this.interpolation,c=this.length;switch(null!==r&&(l=r.interpolation,e-=r.time),l){case t.Interpolation.LINEAR:return r&&i?(s=r.value,o=i.value,c=i.time-r.time):i?(o=i.value,c=i.time):r&&(s=r.value,c=this.length-r.time),a[0]=s[0]+(o[0]-s[0])*(e/c),a[1]=s[1]+(o[1]-s[1])*(e/c),a[2]=s[2]+(o[2]-s[2])*(e/c),a;case t.Interpolation.HERMITE:var u=this.startTangent,h=this.endTangent;r&&i?(s=r.value,u=r.rightTangent,o=i.value,h=i.leftTangent,c=i.time-r.time):i?(o=i.value,h=i.leftTangent,c=i.time):r&&(s=r.value,u=r.rightTangent,c=this.length-r.time);var f=e/c,p=f*f,d=p*f,v=-2*d+3*p,m=1-v,y=d-p,b=f+y-p;return a[0]=s[0]*m+o[0]*v+u[0]*b+h[0]*y,a[1]=s[1]*m+o[1]*v+u[1]*b+h[1]*y,a[2]=s[2]*m+o[2]*v+u[2]*b+h[2]*y,a;default:return a}}}]),t}();u.inputDimension=3,u.outputDimension=3,u.valueProperty="currentValue",u.curveType=a.Tw2Curve.Type.CURVE2,u.Key=c,u.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorCurve=t.Tw2VectorKey=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.Tw2VectorKey=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec3.create(),e.left=n.vec3.create(),e.right=n.vec3.create(),e.interpolation=0,e}return l(t,a.Tw2CurveKey),t}(),u=t.Tw2VectorCurve=function(e){function t(){s(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.vec3.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return l(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return n.vec3.copy(r,this.value);var i=this.keys[0],a=this.keys[this.keys.length-1];if(e>=a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.vec3.copy(r,this.value);case t.Extrapolation.CONSTANT:return n.vec3.copy(r,a.value);case t.Extrapolation.GRADIENT:return n.vec3.scaleAndAdd(r,a.value,a.right,e-a.time);default:e%=a.time}else if(e<0||e<i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return n.vec3.copy(r,this.value);case t.Extrapolation.GRADIENT:return n.vec3.scaleAndAdd(r,i.value,i.left,e*this.length-a.time);default:return n.vec3.copy(r,i.value)}for(var s=this.keys[this._currentKey],o=this.keys[this._currentKey-1];e>=s.time||e<o.time;)e<o.time&&(this._currentKey=0),this._currentKey++,s=this.keys[this._currentKey],o=this.keys[this._currentKey-1];var l=(e-o.time)/(s.time-o.time);switch(o.interpolation){case t.Interpolation.CONSTANT:return n.vec3.copy(r,o.value);case t.Interpolation.LINEAR:return r[0]=o.value[0]*(1-l)+s.value[0]*l,r[1]=o.value[1]*(1-l)+s.value[1]*l,r[2]=o.value[2]*(1-l)+s.value[2]*l,r;case t.Interpolation.HERMITE:var c=2*l*l*l-3*l*l+1,u=-2*l*l*l+3*l*l,h=l*l*l-2*l*l+l,f=l*l*l-l*l;return r[0]=c*o.value[0]+u*s.value[0]+h*o.right[0]+f*s.left[0],r[1]=c*o.value[1]+u*s.value[1]+h*o.right[1]+f*s.left[1],r[2]=c*o.value[2]+u*s.value[2]+h*o.right[2]+f*s.left[2],r;default:return r}}}]),t}();u.inputDimension=3,u.outputDimension=3,u.valueProperty="value",u.curveType=a.Tw2Curve.Type.CURVE,u.Key=c,u.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},u.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(114);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(115);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(116);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(117);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(118);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(119);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(120);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var u=r(121);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2ColorSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.vec4.create(),e.operator=0,e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){var i=a.Tw2CurveSequencer.global.vec4_0;switch(this.operator){case t.Operator.MULTIPLY:n.vec4.set(r,1,1,1,1);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(e,i),n.vec4.multiply(r,r,i);return r;default:n.vec4.set(r,0,0,0,0);for(var o=0;o<this.functions.length;++o)this.functions[o].GetValueAt(e,i),n.vec4.add(r,r,i);return r}}}]),t}();s.inputDimension=4,s.outputDimension=4,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,s.childArray="functions",s.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EulerRotation=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2EulerRotation=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.yawCurve=null,e.pitchCurve=null,e.rollCurve=null,e.currentValue=n.quat.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.yawCurve&&"GetLength"in this.yawCurve&&(e=this.yawCurve.GetLength()),this.pitchCurve&&"GetLength"in this.pitchCurve&&(e=Math.max(e,this.pitchCurve.GetLength())),this.rollCurve&&"GetLength"in this.rollCurve&&(e=Math.max(e,this.rollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){var r=this.yawCurve?this.yawCurve.GetValueAt(e):0,i=this.pitchCurve?this.pitchCurve.GetValueAt(e):0,n=this.rollCurve?this.rollCurve.GetValueAt(e):0,a=Math.sin(r/2),s=Math.cos(r/2),o=Math.sin(i/2),l=Math.cos(i/2),c=Math.sin(n/2),u=Math.cos(n/2);return t[0]=a*l*c+s*o*u,t[1]=a*l*u-s*o*c,t[2]=s*l*c-a*o*u,t[3]=s*l*u+a*o*c,t}}]),t}();s.inputDimension=1,s.outputDimension=3,s.valueProperty="currentValue",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,s.childProperties=["yawCurve","pitchCurve","rollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2QuaternionSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.quat.create(),e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){n.quat.identity(t);for(var r=a.Tw2CurveSequencer.global.quat_0,i=0;i<this.functions.length;++i)this.functions[i].GetValueAt(e,r),n.quat.multiply(t,t,r);return t}}]),t}();s.inputDimension=4,s.outputDimension=4,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,s.childArray="functions"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RGBAScalarSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2RGBAScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec4.create(),e.RedCurve=null,e.GreenCurve=null,e.BlueCurve=null,e.AlphaCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.RedCurve&&"GetLength"in this.RedCurve&&(e=this.RedCurve.GetLength()),this.GreenCurve&&"GetLength"in this.GreenCurve&&(e=Math.max(e,this.GreenCurve.GetLength())),this.BlueCurve&&"GetLength"in this.BlueCurve&&(e=Math.max(e,this.BlueCurve.GetLength())),this.AlphaCurve&&"GetLength"in this.AlphaCurve&&(e=Math.max(e,this.AlphaCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.RedCurve?this.RedCurve.GetValueAt(e):0,t[1]=this.GreenCurve?this.GreenCurve.GetValueAt(e):0,t[2]=this.BlueCurve?this.BlueCurve.GetValueAt(e):0,t[3]=this.AlphaCurve?this.AlphaCurve.GetValueAt(e):0,t}}]),t}();s.inputDimension=1,s.outputDimension=4,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,s.childProperties=["RedCurve","GreenCurve","BlueCurve","AlphaCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(7);var a=t.Tw2ScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.operator=0,e.functions=[],e.inMinClamp=0,e.inMaxClamp=1,e.outMinClamp=0,e.outMaxClamp=1,e.clamping=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){n.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){var r=void 0;switch(this.operator){case t.Operator.MULTIPLY:r=1;for(var i=0;i<this.functions.length;++i){var n=this.functions[i].GetValueAt(e);this.clamping&&(n=Math.min(Math.max(n,this.inMinClamp),this.inMaxClamp)),r*=n}break;default:r=0;for(var a=0;a<this.functions.length;++a){var s=this.functions[a].GetValueAt(e);this.clamping&&(s=Math.min(Math.max(s,this.inMinClamp),this.inMaxClamp)),r+=s}}return this.clamping&&(r=Math.min(Math.max(r,this.outMinClamp),this.outMaxClamp)),r}}]),t}();a.inputDimension=1,a.outputDimension=1,a.valueProperty="value",a.curveType=n.Tw2CurveSequencer.Type.SEQUENCER,a.childArray="functions",a.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2VectorSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=n.vec3.create(),e.operator=0,e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){var i=a.Tw2CurveSequencer.global.vec3_0;switch(this.operator){case t.Operator.MULTIPLY:n.vec3.set(r,1,1,1);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(e,i),n.vec3.multiply(r,r,i);return r;default:n.vec3.set(r,0,0,0);for(var o=0;o<this.functions.length;++o)this.functions[o].GetValueAt(e,i),n.vec3.add(r,r,i);return r}}}]),t}();s.inputDimension=3,s.outputDimension=3,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,s.childArray="functions",s.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2XYZScalarSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2XYZScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.vec3.create(),e.XCurve=null,e.YCurve=null,e.ZCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.XCurve&&"GetLength"in this.XCurve&&(e=this.XCurve.GetLength()),this.YCurve&&"GetLength"in this.YCurve&&(e=Math.max(e,this.YCurve.GetLength())),this.ZCurve&&"GetLength"in this.ZCurve&&(e=Math.max(e,this.ZCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.XCurve?this.XCurve.GetValueAt(e):0,t[1]=this.YCurve?this.YCurve.GetValueAt(e):0,t[2]=this.ZCurve?this.ZCurve.GetValueAt(e):0,t}}]),t}();s.inputDimension=1,s.outputDimension=3,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,s.childProperties=["XCurve","YCurve","ZCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2YPRSequencer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(7);var s=t.Tw2YPRSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=n.quat.create(),e.YawPitchRoll=n.vec3.create(),e.YawCurve=null,e.PitchCurve=null,e.RollCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),i(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.YawCurve&&"GetLength"in this.YawCurve&&(e=this.YawCurve.GetLength()),this.PitchCurve&&"GetLength"in this.PitchCurve&&(e=Math.max(e,this.PitchCurve.GetLength())),this.RollCurve&&"GetLength"in this.RollCurve&&(e=Math.max(e,this.RollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){this.YawCurve&&(this.YawPitchRoll[0]=this.YawCurve.GetValueAt(e)),this.PitchCurve&&(this.YawPitchRoll[1]=this.PitchCurve.GetValueAt(e)),this.RollCurve&&(this.YawPitchRoll[2]=this.RollCurve.GetValueAt(e));var r=Math.sin(this.YawPitchRoll[0]/180*Math.PI/2),i=Math.cos(this.YawPitchRoll[0]/180*Math.PI/2),n=Math.sin(this.YawPitchRoll[1]/180*Math.PI/2),a=Math.cos(this.YawPitchRoll[1]/180*Math.PI/2),s=Math.sin(this.YawPitchRoll[2]/180*Math.PI/2),o=Math.cos(this.YawPitchRoll[2]/180*Math.PI/2);return t[0]=r*a*s+i*n*o,t[1]=r*a*o-i*n*s,t[2]=i*a*s-r*n*o,t[3]=i*a*o+r*n*s,t}}]),t}();s.inputDimension=1,s.outputDimension=4,s.valueProperty="value",s.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,s.childProperties=["YawCurve","PitchCurve","RollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(123);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(124);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2WbgTrack=a,t.Tw2WbgTransformTrack=s;var i=r(0),n=r(1);function a(){this._id=i.util.generateID(),this.name="",this.geometryResPath="",this.geometryRes=null,this.group="",this.duration=0,this.cycle=!1,this.Initialize=function(){if(this.geometryResPath){this.geometryRes=n.resMan.GetResource(this.geometryResPath);var e=this,t={RebuildCachedData:function(){!function(e){if(e.name&&e.group&&e.geometryRes)for(var t=0;t<e.geometryRes.animations.length;++t)for(var r=e.geometryRes.animations[t],i=0;i<r.trackGroups.length;++i)r.trackGroups[i].name===e.group&&e._ApplyTracks(r.trackGroups[i],r.duration)}(e)}};this.geometryRes.RegisterNotification(t)}},this.UpdateValue=function(e){this._TracksReady()&&(this.cycle&&(e%=this.duration),e<=this.duration&&e>=0&&this._UpdateValue(e))}}function s(){this._id=i.util.generateID(),this.translation=i.vec3.create(),this.rotation=i.quat.create(),this.rotation[3]=1,this.scale=i.vec3.create();var e=null,t=null,r=null,n=i.mat4.create();this._TracksReady=function(){return e||t||r},this._ApplyTracks=function(i,n){for(var a=0;a<i.transformTracks.length;++a){var s=i.transformTracks[a];s.name===this.name&&(this.duration=n,e=s.position,t=s.orientation,r=s.scaleShear)}this.UpdateValue(0)},this._UpdateValue=function(a){e&&i.curve.evaluate(e,a,this.translation,this.cycle,this.duration),t&&(i.curve.evaluate(t,a,this.rotation,this.cycle,this.duration),i.quat.normalize(this.rotation,this.rotation)),r&&i.curve.evaluate(r,a,n,this.cycle,this.duration),this.scale[0]=n[0],this.scale[1]=n[5],this.scale[2]=n[10]}}s.prototype=new a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformTrack=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1);t.Tw2TransformTrack=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.resPath="",this.res=null,this.group="",this.cycle=!1,this.duration=0,this.translation=n.vec3.create(),this.rotation=n.quat.create(),this.scale=n.vec3.fromValues(0,0,0),this.scaleShear=n.mat4.create(),this.positionCurve=null,this.orientationCurve=null,this.scaleCurve=null}return i(e,[{key:"Initialize",value:function(){""!==this.resPath&&(this.res=a.resMan.GetResource(this.resPath))}},{key:"GetLength",value:function(){return this.duration}},{key:"UpdateValue",value:function(e){this.res&&this.res.IsGood()&&(this.positionCurve||this.FindTracks(),this.positionCurve&&(this.cycle&&(e%=this.duration),e>this.duration||e<0||(n.curve.evaluate(this.positionCurve,e,this.translation,this.cycle,this.duration),n.curve.evaluate(this.orientationCurve,e,this.rotation,this.cycle,this.duration),n.quat.normalize(this.rotation,this.rotation),n.curve.evaluate(this.scaleCurve,e,this.scaleShear,this.cycle,this.duration),n.mat4.getScaling(this.scale,this.scaleCurve))))}},{key:"FindTracks",value:function(){for(var e=null,t=0;t<this.res.animations.length;++t)for(var r=0;r<this.res.animations[t].trackGroups.length;++r)if(this.res.animations[t].trackGroups[r].name===this.group){this.duration=this.res.animations[t].duration,e=this.res.animations[t].trackGroups[r];break}if(e)for(var i=0;i<e.transformTracks.length;++i)if(this.name===e.transformTracks[i].name){this.positionCurve=e.transformTracks[i].position,this.orientationCurve=e.transformTracks[i].orientation,this.scaleCurve=e.transformTracks[i].scaleShear;break}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(126);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(127);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(128);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(129);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaEulerRotationCurve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(14);var s=t.Tw2MayaEulerRotationCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.eulerValue=n.vec3.create(),e.updateQuaternion=!1,e.quatValue=n.quat.create(),e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){if(this.animationEngine&&(this.xIndex&&(this.eulerValue[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.eulerValue[1]=this.eulerValue[0]:this.eulerValue[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.eulerValue[2]=this.eulerValue[0]:this.eulerValue[2]=this.animationEngine.Evaluate(this.zIndex,e)),this.updateQuaternion)){var t=Math.sin(this.eulerValue[0]/2),r=Math.cos(this.eulerValue[0]/2),i=Math.sin(this.eulerValue[1]/2),n=Math.cos(this.eulerValue[1]/2),a=Math.sin(this.eulerValue[2]/2),s=Math.cos(this.eulerValue[2]/2);this.quatValue[0]=t*n*a+r*i*s,this.quatValue[1]=t*n*s-r*i*a,this.quatValue[2]=r*n*a-t*i*s,this.quatValue[3]=r*n*s+t*i*a}}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}();s.outputDimension=3,s.valueProperty="eulerValue",s.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaScalarCurve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(14);var a=t.Tw2MayaScalarCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.index=-1,e.animationEngine=null,e.value=0,e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Tw2Curve),i(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.value=this.animationEngine.Evaluate(this.index,e))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&this.index>=0&&(this.length=this.animationEngine.GetLength(this.index))}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=n.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaVector3Curve=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(14);var s=t.Tw2MayaVector3Curve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.value=n.vec3.create(),e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),i(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.xIndex&&(this.value[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.value[1]=this.value[0]:this.value[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.value[2]=this.value[0]:this.value[2]=this.animationEngine.Evaluate(this.zIndex,e)))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}();s.outputDimension=3,s.valueProperty="value",s.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaAnimationEngine=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);var a=t.Tw2MayaAnimationEngine=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.curves=[],this.hermiteSegments=[],this.bezierSegments=[],this._currentCurveIndex=0,this._evalCache=null}return i(e,[{key:"Evaluate",value:function(t,r){if(this.curves.length<=t)return 0;if(this._currentCurveIndex=t,!this._evalCache){this._evalCache=new Array(this.curves.length);for(var i=0;i<this._evalCache.length;++i)this._evalCache[i]=-1}var n=this.curves[t],a=n[e.AnimCurveFields.SEGMENT_OFFSET],s=null;return r<(s=n[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments:this.hermiteSegments)[a][e.AnimSegment.TIME]?n[e.AnimCurveFields.PRE_INFINITY]===e.INFINITY?s[a][e.AnimSegment.VALUE]:this._EvaluateInfinities(n,s,a,r,!0):r>n[e.AnimCurveFields.END_TIME]?n[e.AnimCurveFields.POST_INFINITY]===e.INFINITY?n[e.AnimCurveFields.END_VALUE]:this._EvaluateInfinities(n,s,a,r,!1):this._EvaluateImpl(n,s,a,r)}},{key:"_EvaluateImpl",value:function(t,r,i,n){var a=!1,s=null,o=null,l=void 0;if(this._evalCache[this._currentCurveIndex]>=0)if(o=i+this._evalCache[this._currentCurveIndex],this._evalCache[this._currentCurveIndex]<t[e.AnimCurveFields.NUM_SEGMENTS-1]&&n>r[o][e.AnimSegment.TIME]){if(n===r[s=i+this._evalCache[this._currentCurveIndex]+1][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]++,r[s][e.AnimSegment.VALUE];n<r[s][e.AnimSegment.TIME]?(l=this._evalCache[this._currentCurveIndex]+1,a=!0):s=null}else if(this._evalCache[this._currentCurveIndex]>0&&n<r[o][e.AnimSegment.TIME]){var c=i+this._evalCache[this._currentCurveIndex]-1;if(n>r[c][e.AnimSegment.TIME])l=this._evalCache[this._currentCurveIndex],a=!0;else if(n===r[c][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]--,r[c][e.AnimSegment.VALUE]}if(!a){var u=this._Find(t,n,r,i);if(l=u[1],u[0]||0===l)return l===t[e.AnimCurveFields.NUM_SEGMENTS]?(l--,this._evalCache[this._currentCurveIndex]=l,t[e.AnimCurveFields.END_VALUE]):(this._evalCache[this._currentCurveIndex]=l,r[i+l][e.AnimSegment.VALUE]);if(l===t[e.AnimCurveFields.NUM_SEGMENTS]+1)return this._evalCache[this._currentCurveIndex]=0,t[e.AnimCurveFields.END_VALUE]}if(this._evalCache[this._currentCurveIndex]!==l-1&&(this._evalCache[this._currentCurveIndex]=l-1,o=i+this._evalCache[this._currentCurveIndex],null===s&&(s=i+l)),t[e.AnimCurveFields.IS_WEIGHTED]){var h=r[o];if(h[e.BezierSegment.IS_STEP])return h[e.BezierSegment.VALUE];if(h[e.BezierSegment.IS_STEP_NEXT])return null===s?t[e.AnimCurveFields.END_VALUE]:r[s][e.BezierSegment.VALUE];var f=t[e.AnimCurveFields.END_TIME];return this._evalCache[this._currentCurveIndex]+1<t[e.AnimCurveFields.NUM_SEGMENTS]&&(f=r[s][e.BezierSegment.TIME]),this._EvaluateBezier(h,n,f)}var p=r[o];return p[e.HermiteSegment.IS_STEP]?p[e.HermiteSegment.VALUE]:p[e.HermiteSegment.IS_STEP_NEXT]?null===s?t[e.AnimCurveFields.END_VALUE]:r[s][e.HermiteSegment.VALUE]:this._EvaluateHermite(p,n)}},{key:"_EvaluateInfinities",value:function(e,t,r,i,n){throw new Error("_EvaluateInfinities not implemented")}},{key:"_EvaluateHermite",value:function(t,r){var i=r-t[e.HermiteSegment.TIME],n=t[e.HermiteSegment.COEFF];return i*(i*(i*n[0]+n[1])+n[2])+n[3]}},{key:"_EvaluateBezier",value:function(t,r,i){var a,s=void 0;if(a=(r-t[e.BezierSegment.TIME])/(i-t[e.BezierSegment.TIME]),t[e.BezierSegment.IS_LINEAR])s=a;else{var o=n.vec4.create();o[3]=t[e.BezierSegment.COEFF][3],o[2]=t[e.BezierSegment.COEFF][2],o[1]=t[e.BezierSegment.COEFF][1],o[0]=t[e.BezierSegment.COEFF][0]-a;var l=[];s=1===n.curve.polyZeroes(o,3,0,1,1,1,l)?l[0]:0}var c=t[e.BezierSegment.POLYY];return s*(s*(s*c[3]+c[2])+c[1])+c[0]}},{key:"_Find",value:function(t,r,i,n){var a,s=void 0,o=void 0,l=void 0,c=0,u=0;if((a=t[e.AnimCurveFields.NUM_SEGMENTS]+1)>0){o=0,l=a-1;do{if(r<(u=(s=o+l>>1)<a-1?i[n+s][e.AnimSegment.TIME]:t[e.AnimCurveFields.END_TIME]))l=s-1;else{if(!(r>u))return[!0,c=s];o=s+1}}while(o<=l);c=o}return[!1,c]}},{key:"GetNumberOfCurves",value:function(){return this.curves.length}},{key:"GetLength",value:function(t){if(t<0||t>=this.curves.length)return 0;var r=this.curves[t],i=void 0;return i=r[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]]:this.hermiteSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]],r[e.AnimCurveFields.END_TIME]-i[e.AnimSegment.TIME]}}]),e}();a.AnimCurveFields={NUM_SEGMENTS:0,SEGMENT_OFFSET:1,END_TIME:2,END_VALUE:3,IN_TANGENT:4,OUT_TANGENT:5,PRE_INFINITY:6,POST_INFINITY:7,IS_WEIGHTED:8},a.AnimSegment={TIME:0,VALUE:1},a.HermiteSegment={TIME:0,VALUE:1,COEFF:2,IS_STEP:3,IS_STEP_NEXT:4},a.BezierSegment={TIME:0,VALUE:1,COEFF:2,POLYY:3,IS_STEP:4,IS_STEP_NEXT:5,IS_LINEAR:6},a.INFINITY=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(131);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(136);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(140);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(145);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(148);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(149);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(132);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(133);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(134);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(42);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(135);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildBillboard=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(10);t.EveChildBillboard=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e._perObjectData=new a.Tw2BasicPerObjectData(s.EveChild.perObjectDataDecl),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveChild),i(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,r){(function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);var i=s.EveChild.global.mat4_0,o=s.EveChild.global.vec3_0;n.mat4.lookAt(i,a.device.eyePosition,this.worldTransform.subarray(12),[0,1,0]),n.mat4.transpose(i,i),n.mat4.getScaling(o,r),n.vec3.multiply(o,o,this.scaling),this.worldTransform[0]=i[0]*o[0],this.worldTransform[1]=i[1]*o[0],this.worldTransform[2]=i[2]*o[0],this.worldTransform[4]=i[4]*o[1],this.worldTransform[5]=i[5]*o[1],this.worldTransform[6]=i[6]*o[1],this.worldTransform[8]=i[8]*o[2],this.worldTransform[9]=i[9]*o[2],this.worldTransform[10]=i[10]*o[2]}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(n.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),n.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildContainer=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(10);t.EveChildContainer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.objects=[],e.curveSets=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.EveChild),i(t,[{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.objects.length;t++)"GetResources"in this.objects[t]&&this.objects[t].GetResources(e);return e}},{key:"Update",value:function(e,r){(function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);for(var i=0;i<this.curveSets.length;i++)this.curveSets[i].Update(e);for(var n=0;n<this.objects.length;n++)this.objects[n].Update(e,this.worldTransform)}},{key:"GetBatches",value:function(e,t,r){if(this.display)for(var i=0;i<this.objects.length;i++)this.objects[i].GetBatches(e,t,r)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildExplosion=void 0;var i=r(10);t.EveChildExplosion=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EveChild),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildParticleSystem=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(10);t.EveChildParticleSystem=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.particleEmitters=[],e.particleSystems=[],e.mesh=null,e._perObjectData=new a.Tw2BasicPerObjectData(s.EveChild.perObjectDataDecl),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveChild),i(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,r){(function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);for(var i=0;i<this.particleEmitters.length;++i)this.particleEmitters[i].Update(e);for(var n=0;n<this.particleSystems.length;++n)this.particleSystems[n].Update(e)}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(n.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),n.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(137);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(138);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(139);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(44);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(27);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(43);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})}),Object.defineProperty(t,"EveStation",{enumerable:!0,get:function(){return o.EveSpaceObject}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveEffectRoot=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(15);(t.EveEffectRoot=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.curveSets=[],e.effectChildren=[],e.duration=0,e.scaling=n.vec3.fromValues(1,1,1),e.rotation=n.quat.create(),e.translation=n.vec3.create(),e.localTransform=n.mat4.create(),e.rotationTransform=n.mat4.create(),e.boundingSphereCenter=n.vec3.create(),e.boundingSphereRadius=0,e._perObjectData=new a.Tw2PerObjectData(t.perObjectDataDecl),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveObject),i(t,[{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.effectChildren.length;++t)this.effectChildren[t].GetResources(e);return e}},{key:"Update",value:function(e){n.quat.normalize(this.rotation,this.rotation),n.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling);for(var t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e);for(var r=0;r<this.effectChildren.length;++r)this.effectChildren[r].Update(e,this.localTransform)}},{key:"GetBatches",value:function(e,t){if(this.display)for(var r=0;r<this.effectChildren.length;++r)this.effectChildren[r].GetBatches(e,t,this._perObjectData)}},{key:"Start",value:function(){for(var e=0;e<this.curveSets.length;++e)this.curveSets[e].Play()}},{key:"Stop",value:function(){for(var e=0;e<this.curveSets.length;++e)this.curveSets[e].Stop()}}]),t}()).perObjectDataDecl={VSData:[{name:"WorldMat",size:16},{name:"WorldMatLast",size:16},{name:"Shipdata",size:4},{name:"Clipdata1",size:4},{name:"EllipsoidRadii",size:4},{name:"EllipsoidCenter",size:4},{name:"CustomMaskMatrix0",size:16},{name:"CustomMaskMatrix1",size:16},{name:"CustomMaskData0",size:4},{name:"CustomMaskData1",size:4},{name:"JointMat",size:696}],PSData:[{name:"Shipdata",size:4},{name:"Clipdata1",size:4},{name:"Clipdata2",size:4},{name:"ShLighting",size:28},{name:"CustomMaskMaterialID0",size:4},{name:"CustomMaskMaterialID1",size:4},{name:"CustomMaskTarget0",size:4},{name:"CustomMaskTarget1",size:4}]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMissile=t.EveMissileWarhead=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(15);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=t.EveMissileWarhead=function(e){function t(){o(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.spriteSet=null,e.state=t.State.READY,e.time=0,e.durationEjectPhase=0,e.startEjectVelocity=0,e.acceleration=1,e.maxExplosionDistance=40,e.impactSize=0,e.impactDuration=.6,e.pathOffset=n.vec3.create(),e.transform=n.mat4.create(),e.velocity=n.vec3.create(),e._perObjectData=new a.Tw2PerObjectData(t.perObjectDataDecl),c.init(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveObject),i(t,[{key:"Initialize",value:function(){this.spriteSet&&this.spriteSet.UseQuads(!0)}},{key:"Launch",value:function(e){n.mat4.copy(this.transform,e),this.velocity[0]=e[8]*this.startEjectVelocity,this.velocity[1]=e[9]*this.startEjectVelocity,this.velocity[2]=e[10]*this.startEjectVelocity,this.time=0,this.state=t.State.IN_FLIGHT}},{key:"Clone",value:function(){var e=new t;return e.mesh=this.mesh,e.spriteSet=this.spriteSet,e}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e),this.spriteSet&&this.spriteSet.GetResources(e)}},{key:"UpdateViewDependentData",value:function(){this.display&&this.state!==t.State.DEAD&&(n.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),n.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform))}},{key:"Update",value:function(e,r,i){if(this.state===t.State.IN_FLIGHT){var a=c.global,s=n.mat4.getTranslation(a.vec3_0,this.transform),o=a.vec3_1,l=a.vec3_2,u=a.vec3_3;this.time+=e,this.time>this.durationEjectPhase?(n.vec3.subtract(s,this.velocity,r),n.vec3.lerp(s,s,r,1-Math.exp(.9999*-e)),n.mat4.setTranslation(this.transform,s),n.vec3.subtract(o,i,s),n.vec3.length(o)<this.maxExplosionDistance&&(console.log(s,o),this.state=t.State.DEAD)):(n.vec3.scale(o,this.velocity,e),this.transform[12]+=o[0],this.transform[13]+=o[1],this.transform[14]+=o[2]);var h=n.vec3.normalize(o,this.velocity);Math.abs(h[0])<.99?n.vec3.cross(l,h,[1,0,0]):n.vec3.cross(l,h,[0,1,0]),n.vec3.normalize(l,l),n.vec3.cross(u,l,h),this.transform[0]=l[0],this.transform[1]=l[1],this.transform[2]=l[2],this.transform[4]=u[0],this.transform[5]=u[1],this.transform[6]=u[2],this.transform[8]=h[0],this.transform[9]=h[1],this.transform[10]=h[2]}this.spriteSet&&this.spriteSet.Update(e)}},{key:"GetBatches",value:function(e,r){this.display&&this.mesh&&this.state!==t.State.DEAD&&(this.mesh&&this.mesh.GetBatches(e,r,this._perObjectData),this.spriteSet&&this.spriteSet.GetBatches(e,r,this._perObjectData,this.transform))}}]),t}();l.perObjectDataDecl={VSData:[{name:"WorldMat",size:16},{name:"WorldMatLast",size:16},{name:"Shipdata",size:4,value:[0,1,0,-10]},{name:"Clipdata1",size:4}],PSData:[{name:"Shipdata",size:4,value:[0,1,0,1]},{name:"Clipdata1",size:4},{name:"Clipdata2",size:4}]},l.State={READY:0,IN_FLIGHT:1,DEAD:2};var c=t.EveMissile=function(){function e(){o(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.warheads=[],this.curveSets=[],this.speed=1,this.position=n.vec3.create(),this.target=n.vec3.create(),this.boundingSphereCenter=n.vec3.create(),this.boundingSphereRadius=0,this.warheadExplosionCallback=null,this.missileFinishedCallback=null,e.init()}return i(e,[{key:"Launch",value:function(e,t,r){if(n.vec3.copy(this.position,e),n.vec3.copy(this.target,r),this.warheads.length>t.length)this.warheads.splice(t.length);else for(;this.warheads.length<t.length;)this.warheads.push(this.warheads[0].Clone());for(var i=0;i<this.warheads.length;++i)this.warheads[0].Launch(t[i])}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.warheads.length;++t)this.warheads[t].GetResources(e)}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.warheads.length;++e)this.warheads[e].UpdateViewDependentData()}},{key:"Update",value:function(t){var r=n.vec3.subtract(e.global.vec3_0,this.target,this.position),i=n.vec3.length(r);i>.1&&(n.vec3.normalize(r,r),n.vec3.scale(r,r,Math.min(t*this.speed,i)),n.vec3.add(this.position,this.position,r));for(var a=0;a<this.curveSets.length;++a)this.curveSets[a].Update(t);for(var s=!1,o=0;o<this.warheads.length;++o){var c=this.warheads[o].state;this.warheads[o].Update(t,this.position,this.target),c!==l.State.DEAD&&this.warheads[o].state===l.State.DEAD&&(this.warheadExplosionCallback&&this.warheadExplosionCallback(this.warheads[o]),s=!0)}if(s&&this.missileFinishedCallback){for(var u=0;u<this.warheads.length;++u)if(this.warheads[u].state!==l.State.DEAD)return;this.missileFinishedCallback(this)}}},{key:"GetBatches",value:function(e,t){if(this.display)for(var r=0;r<this.warheads.length;++r)this.warheads[r].GetBatches(e,t)}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:n.vec3.create(),vec3_1:n.vec3.create(),vec3_2:n.vec3.create(),vec3_3:n.vec3.create()})}}]),e}();c.global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlanet=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(1),s=r(43),o=r(15);t.EvePlanet=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.highDetail=new s.EveTransform,e.effectHeight=new a.Tw2Effect,e.heightMap=new a.Tw2RenderTarget,e.zOnlyModel=null,e.itemID=0,e.heightMapResPath1="",e.heightMapResPath2="",e.heightDirty=!1,e.lockedResources=[],e.watchedResources=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EveObject),n(t,[{key:"Create",value:function(e,r,i,n,s){var o=this;this.itemID=e,this.heightMapResPath1=n,this.heightMapResPath2=s,this.highDetail.children=[],this.heightDirty=!0,a.resMan.GetObject(r,function(e){return t.MeshLoaded(o,e)}),a.resMan.GetObject("res:/dx9/model/worldobject/planet/planetzonly.red",function(e){return o.zOnlyModel=e}),i&&a.resMan.GetObject(i,function(e){return o.highDetail.children.push(e)})}},{key:"GetPlanetResources",value:function(e,t,r){if(!t.includes(e))if(t.push(e),e&&"undefined"!==i(e.doNotPurge))r.push(e);else for(var n in e)e.hasOwnProperty(n)&&"object"===i(e[n])&&this.GetPlanetResources(e[n],t,r)}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.highDetail&&this.highDetail.GetResources(e),this.effectHeight&&this.effectHeight.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(e){this.highDetail.UpdateViewDependentData(e),this.zOnlyModel&&(this.zOnlyModel.translation=this.highDetail.translation,this.zOnlyModel.scaling=this.highDetail.scaling,this.zOnlyModel.UpdateViewDependentData(e))}},{key:"Update",value:function(e){this.highDetail.Update(e)}},{key:"GetBatches",value:function(e,t){if(this.display&&this.heightDirty&&this.watchedResources.length&&""!==this.heightMapResPath1){for(var r=0;r<this.watchedResources.length;++r)if(this.watchedResources[r]&&!this.watchedResources[r].IsGood())return;this.watchedResources=[],this.heightMap.Set(),a.device.SetStandardStates(a.device.RM_FULLSCREEN),a.device.gl.clearColor(0,0,0,0),a.device.gl.clear(a.device.gl.COLOR_BUFFER_BIT),a.device.RenderFullScreenQuad(this.effectHeight),this.heightMap.Unset(),this.heightDirty=!1;for(var i=0;i<this.lockedResources.length;++i)this.lockedResources[i].doNotPurge--;var n=this.highDetail.children[0].mesh,s=null;n.transparentAreas.length?s=n.transparentAreas[0].effect:n.opaqueAreas.length&&(s=n.opaqueAreas[0].effect),s&&(s.parameters.HeightMap.textureRes=this.heightMap.texture)}this.display&&this.highDetail.GetBatches(e,t)}},{key:"GetZOnlyBatches",value:function(e,t){this.display&&this.zOnlyModel&&this.zOnlyModel.GetBatches(e,t)}}],[{key:"MeshLoaded",value:function(e,t){e.highDetail.children.unshift(t),e.lockedResources=[],e.GetPlanetResources(e.highDetail,[],e.lockedResources);var r=e.highDetail.children[0].mesh,i=null,n=void 0;for(var s in n=(n=r.transparentAreas.length?(i=r.transparentAreas[0].effect).effectFilePath:r.opaqueAreas.length?(i=r.opaqueAreas[0].effect).effectFilePath:"res:/Graphics/Effect/Managed/Space/Planet/EarthlikePlanet.fx").replace(".fx","BlitHeight.fx"),e.watchedResources=[],i.parameters)i.parameters.hasOwnProperty(s)&&(e.effectHeight.parameters[s]=i.parameters[s],"textureRes"in i.parameters[s]&&e.watchedResources.push(i.parameters[s].textureRes));for(var o=0;o<e.highDetail.children[0].children.length;++o)if(r=e.highDetail.children[0].children[o].mesh){if(i=null,r.transparentAreas.length)i=r.transparentAreas[0].effect;else{if(!r.opaqueAreas.length)continue;i=r.opaqueAreas[0].effect}for(var l in i.parameters)i.parameters.hasOwnProperty(l)&&(e.effectHeight.parameters[l]=i.parameters[l],"textureRes"in i.parameters[l]&&e.watchedResources.push(i.parameters[l].textureRes))}var c=new a.Tw2TextureParameter("NormalHeight1",e.heightMapResPath1);c.Initialize(),e.watchedResources.push(c.textureRes),e.lockedResources.push(c.textureRes),e.effectHeight.parameters.NormalHeight1=c;var u=new a.Tw2TextureParameter("NormalHeight2",e.heightMapResPath2);u.Initialize(),e.watchedResources.push(u.textureRes),e.lockedResources.push(u.textureRes),e.effectHeight.parameters.NormalHeight2=u,e.effectHeight.parameters.Random=new a.Tw2FloatParameter("Random",e.itemID%100),e.effectHeight.parameters.TargetTextureHeight=new a.Tw2FloatParameter("TargetTextureHeight",1024),e.effectHeight.effectFilePath=n,e.effectHeight.Initialize(),e.heightDirty=!0,e.heightMap.Create(2048,1024,!1),e.watchedResources.push(e.effectHeight.effectRes);for(var h=0;h<e.lockedResources.length;++h)e.lockedResources[h].doNotPurge++,e.lockedResources[h].IsPurged()&&e.lockedResources[h].Reload()}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(141);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(142);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(45);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(143);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(144);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLensflare=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1),s=r(45);(t.EveLensflare=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.update=!0,this.doOcclusionQueries=!0,this.cameraFactor=20,this.position=n.vec3.create(),this.flares=[],this.occluders=[],this.backgroundOccluders=[],this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,this.distanceToEdgeCurves=[],this.distanceToCenterCurves=[],this.radialAngleCurves=[],this.xDistanceToCenter=[],this.yDistanceToCenter=[],this.bindings=[],this.curveSets=[],this.mesh=null,this._direction=n.vec3.create(),this._transform=n.mat4.create(),this._backBuffer=null,e.init()}return i(e,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e);for(var t=0;t<this.flares.length;t++)this.flares[t].GetResources(e);return s.EveOccluder.global&&s.EveOccluder.global.effect&&!e.includes(s.EveOccluder.global.effect)&&e.push(s.EveOccluder.global.effect),e}},{key:"UpdateOccluders",value:function(){if(this.doOcclusionQueries){var t=e.global;if(!t.occluderLevels[0].texture||t.occluderLevels[0].width<2*this.occluders.length)for(var r=0;r<t.occluderLevels.length;++r)t.occluderLevels[r].Create(2*this.occluders.length,1,!1);for(var i=0;i<this.flares.length;++i)"_backBuffer"in this.flares[i]&&(this.flares[i]._backBuffer.textureRes=t.occluderLevels.texture);this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,t.occluderLevels[t.occludedLevelIndex].Set(),a.device.SetStandardStates(a.device.RM_OPAQUE),a.device.gl.clearColor(0,0,0,1),a.device.gl.clear(a.device.gl.COLOR_BUFFER_BIT),t.occluderLevels[t.occludedLevelIndex].Unset();var o=1;a.device.antialiasing&&(o=a.device.msaaSamples,a.device.gl.sampleCoverage(1/o,!1));for(var l=0;l<this.occluders.length;++l)a.device.SetRenderState(a.device.RS_COLORWRITEENABLE,8),a.device.gl.colorMask(!1,!1,!1,!0),a.device.gl.clearColor(0,0,0,0),a.device.gl.clear(a.device.gl.COLOR_BUFFER_BIT),a.device.antialiasing&&(a.device.gl.enable(a.device.gl.SAMPLE_COVERAGE),a.device.gl.sampleCoverage(.25,!1)),this.occluders[l].UpdateValue(this._transform,l),a.device.antialiasing&&a.device.gl.disable(a.device.gl.SAMPLE_COVERAGE),t.backBuffer.texture||t.backBuffer.Attach(a.device.gl.createTexture()),a.device.gl.bindTexture(a.device.gl.TEXTURE_2D,t.backBuffer.texture),t.backBuffer.width===a.device.viewportWidth&&t.backBuffer.height===a.device.viewportHeight||(a.device.gl.texImage2D(a.device.gl.TEXTURE_2D,0,a.device.gl.RGBA,a.device.viewportWidth,a.device.viewportHeight,0,a.device.gl.RGBA,a.device.gl.UNSIGNED_BYTE,null),a.device.gl.texParameteri(a.device.gl.TEXTURE_2D,a.device.gl.TEXTURE_MAG_FILTER,a.device.gl.LINEAR),a.device.gl.texParameteri(a.device.gl.TEXTURE_2D,a.device.gl.TEXTURE_MIN_FILTER,a.device.gl.LINEAR),t.backBuffer.width=a.device.viewportWidth,t.backBuffer.height=a.device.viewportHeight),a.device.gl.copyTexImage2D(a.device.gl.TEXTURE_2D,0,a.device.alphaBlendBackBuffer?a.device.gl.RGBA:a.device.gl.RGB,0,0,t.backBuffer.width,t.backBuffer.height,0),a.device.gl.bindTexture(a.device.gl.TEXTURE_2D,null),t.occluderLevels[t.occludedLevelIndex].Set(),s.EveOccluder.CollectSamples(t.backBuffer,l,t.occluderLevels[0].width/2,o),t.occluderLevels[t.occludedLevelIndex].Unset();a.device.antialiasing&&a.device.gl.sampleCoverage(1,!1),t.occluderLevels[(t.occludedLevelIndex+1)%t.occluderLevels.length].Set();var c=new Uint8Array(4*t.occluderLevels[0].width);a.device.gl.readPixels(0,0,2,1,a.device.gl.RGBA,a.device.gl.UNSIGNED_BYTE,c),t.occluderLevels[(t.occludedLevelIndex+1)%t.occluderLevels.length].Unset(),this.occlusionIntensity=1;for(var u=0;u<2*t.occluderLevels[0].width;u+=4)this.occlusionIntensity*=c[u+1]?c[u]/c[u+1]:1;this.backgroundOcclusionIntensity=this.occlusionIntensity,n.vec3.set(a.store.GetVariable("LensflareFxOccScale").value,this.occlusionIntensity,this.occlusionIntensity,0,0),t.occludedLevelIndex=(t.occludedLevelIndex+1)%t.occluderLevels.length}}},{key:"GetBatches",value:function(t,r,i){if(this.display){var s=n.vec4.set(e.global.vec4_0,0,0,1,0);if(n.vec4.transformMat4(s,s,a.device.viewInverse),n.vec3.dot(s,this._direction)<0)return;for(var o=0;o<this.flares.length;++o)this.flares[o].GetBatches(t,r,i);this.mesh&&this.mesh.GetBatches(t,r,i)}}},{key:"PrepareRender",value:function(){if(this.display){var t=e.global,r=t.vec4_0,i=t.vec3_0,s=n.mat4.identity(t.mat4_0),o=t.vec3_2,l=t.vec3_3,c=t.vec3_1,u=t.vec4_1;n.vec3.transformMat4(i,[0,0,0],a.device.viewInverse),0===n.vec3.length(this.position)?n.vec3.negate(c,i):(n.vec3.negate(c,this.position),n.vec3.normalize(this._direction,c)),n.vec4.transformMat4(r,[0,0,1,0],a.device.viewInverse),n.vec3.scaleAndAdd(o,i,r,-this.cameraFactor),n.vec3.negate(l,this._direction),n.mat4.arcFromForward(this._transform,l),n.mat4.setTranslation(this._transform,o),n.mat4.scale(s,s,[this.occlusionIntensity,this.occlusionIntensity,1]);var h=this._direction;n.vec4.set(a.store.GetVariable("LensflareFxDirectionScale").value,h[0],h[1],h[2],1),n.vec4.set(u,h[0],h[1],h[2],0),n.vec4.transformMat4(u,u,a.device.view),n.vec4.transformMat4(u,u,a.device.projection),u[0]/=u[3],u[1]/=u[3];for(var f=1-Math.min(1-Math.abs(u[0]),1-Math.abs(u[1])),p=Math.sqrt(u[0]*u[0]+u[1]*u[1]),d=Math.atan2(u[1],u[0])+Math.PI,v=0;v<this.distanceToEdgeCurves.length;++v)this.distanceToEdgeCurves[v].UpdateValue(f);for(var m=0;m<this.distanceToCenterCurves.length;++m)this.distanceToCenterCurves[m].UpdateValue(p);for(var y=0;y<this.radialAngleCurves.length;++y)this.radialAngleCurves[y].UpdateValue(d);for(var b=0;b<this.xDistanceToCenter.length;++b)this.xDistanceToCenter[b].UpdateValue(u[0]+10);for(var g=0;g<this.yDistanceToCenter.length;++g)this.yDistanceToCenter[g].UpdateValue(u[1]+10);for(var _=0;_<this.bindings.length;++_)this.bindings[_].CopyValue();for(var E=0;E<this.flares.length;++E)this.flares[E].UpdateViewDependentData(this._transform)}}}],[{key:"init",value:function(){if(!e.global){var t=e.global={};t.vec3_0=n.vec3.create(),t.vec3_1=n.vec3.create(),t.vec3_2=n.vec3.create(),t.vec3_3=n.vec3.create(),t.vec4_0=n.vec4.create(),t.vec4_1=n.mat4.create(),t.mat4_0=n.mat4.create(),t.backBuffer=new a.Tw2TextureRes,t.backBuffer.width=0,t.backBuffer.height=0,t.backBuffer.hasMipMaps=!1,t.occludedLevelIndex=0,t.occluderLevels=[new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget]}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMeshOverlayEffect=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(1),a=r(0);t.EveMeshOverlayEffect=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.opaqueEffects=!0,this.visible.decalEffects=!0,this.visible.transparentEffects=!0,this.visible.additiveEffects=!0,this.visible.distortionEffects=!1,this.update=!0,this.curveSet=null,this.opaqueEffects=[],this.decalEffects=[],this.transparentEffects=[],this.additiveEffects=[],this.distortionEffects=[]}return i(e,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.util.perArrayChild(this.opaqueEffects,"GetResources",e),a.util.perArrayChild(this.decalEffects,"GetResources",e),a.util.perArrayChild(this.transparentEffects,"GetResources",e),a.util.perArrayChild(this.additiveEffects,"GetResources",e),a.util.perArrayChild(this.distortionEffects,"GetResources",e),e}},{key:"Update",value:function(e){this.update&&this.curveSet&&this.curveSet.Update(e)}},{key:"GetBatches",value:function(e,t,r,i){if(this.display&&i&&i.geometryResource)for(var a=this.GetEffects(e),s=0;s<a.length;s++){var o=new n.Tw2GeometryBatch;o.renderMode=e,o.perObjectData=r,o.geometryRes=i.geometryResource,o.meshIx=i.meshIndex,o.start=0,o.count=i.geometryResource.meshes[i.meshIndex].areas.length,o.effect=a[s],t.Commit(o)}}},{key:"GetEffects",value:function(e){if(this.display)switch(e){case n.device.RM_OPAQUE:if(this.visible.opaqueEffects)return this.opaqueEffects;break;case n.device.RM_TRANSPARENT:if(this.visible.transparentEffects)return this.transparentEffects;break;case n.device.RM_ADDITIVE:if(this.visible.additiveEffects)return this.additiveEffects;break;case n.device.RM_DECAL:if(this.visible.decalEffects)return this.decalEffects}return[]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveStretch=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1);(t.EveStretch=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.update=!0,this.curveSets=[],this.source=null,this.dest=null,this.sourceObject=null,this.destObject=null,this.stretchObject=null,this.length=new a.Tw2Float,this._time=0,this._useTransformsForStretch=!1,this._sourcePosition=n.vec3.create(),this._destinationPosition=n.vec3.create(),this._displaySourceObject=!0,this._sourceTransform=null,this._displayDestObject=!0,this._useTransformsForStretch=!1,this._isNegZForward=!1,e.init()}return i(e,[{key:"Update",value:function(t){for(var r=0;r<this.curveSets.length;++r)this.curveSets[r].Update(t);this._time+=t,this.source?this.source.GetValueAt(this._time,this._sourcePosition):this._useTransformsForStretch&&(this._sourcePosition[0]=this._sourceTransform[12],this._sourcePosition[1]=this._sourceTransform[13],this._sourcePosition[2]=this._sourceTransform[14]),this.dest&&this.source.GetValueAt(this._time,this._destinationPosition);var i=n.vec3.subtract(e.global.vec3_0,this._destinationPosition,this._sourcePosition);this.length.value=n.vec3.length(i),n.vec3.normalize(i,i),this.sourceObject&&this._displaySourceObject&&this.sourceObject.Update(t),this.stretchObject&&this.stretchObject.Update(t),this.destObject&&this._displayDestObject&&this.destObject.Update(t)}},{key:"UpdateViewDependentData",value:function(){if(this.display){var t=e.global,r=n.vec3.subtract(t.vec3_0,this._destinationPosition,this._sourcePosition),i=n.mat4.identity(t.mat4_0),a=n.vec3.set(t.vec3_1,0,0,0),s=n.vec3.set(t.vec3_2,0,0,0),o=n.mat4.identity(t.mat4_1),l=n.vec3.length(r);n.vec3.normalize(r,r),this._useTransformsForStretch?(n.mat4.rotateX(i,i,-Math.PI/2),n.mat4.multiply(i,this._sourceTransform,i)):(Math.abs(r[1])>.9?s[2]=1:s[1]=1,n.vec3.cross(a,s,r),n.vec3.normalize(a,a),n.vec3.cross(s,r,a),i[0]=a[0],i[1]=a[1],i[2]=a[2],i[4]=-r[0],i[5]=-r[1],i[6]=-r[2],i[8]=s[0],i[9]=s[1],i[10]=s[2]),this.destObject&&this._displayDestObject&&(n.mat4.setTranslation(i,this._destinationPosition),this.destObject.UpdateViewDependentData(i)),this.sourceObject&&this._displaySourceObject&&(this._useTransformsForStretch?(n.mat4.identity(i),n.mat4.rotateX(i,i,-Math.PI/2),n.mat4.multiply(i,this._sourceTransform,i)):n.mat4.setTranslation(i,this._sourcePosition),this.sourceObject.UpdateViewDependentData(i)),this.stretchObject&&(this._useTransformsForStretch?(n.mat4.identity(i),n.mat4.scale(i,i,[1,1,l]),n.mat4.multiply(i,this._sourceTransform,i)):(i[0]=a[0],i[1]=a[1],i[2]=a[2],i[4]=s[0],i[5]=s[1],i[6]=s[2],i[8]=-r[0],i[9]=-r[1],i[10]=-r[2],this._isNegZForward&&(l=-l),n.mat4.scale(o,o,[1,1,l]),n.mat4.multiply(i,i,o)),this.stretchObject.UpdateViewDependentData(i))}}},{key:"GetBatches",value:function(e,t,r){this.display&&(this.sourceObject&&this._displaySourceObject&&this.sourceObject.GetBatches(e,t,r),this.destObject&&this._displayDestObject&&this.destObject.GetBatches(e,t,r),this.stretchObject&&this.stretchObject.GetBatches(e,t,r))}},{key:"SetSourcePosition",value:function(e){this._useTransformsForStretch=!1,this._sourcePosition=e}},{key:"SetDestinationPosition",value:function(e){this._destinationPosition=e}},{key:"SetSourceTransform",value:function(e){this._useTransformsForStretch=!0,this._sourceTransform=e}},{key:"SetIsNegZForward",value:function(e){this._isNegZForward=e}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:n.vec3.create(),vec3_1:n.vec3.create(),vec3_2:n.vec3.create(),mat4_0:n.mat4.create(),mat4_1:n.mat4.create()})}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretFiringFX=t.EvePerMuzzleData=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=t.EvePerMuzzleData=function e(){a(this,e),this._id=n.util.generateID(),this.started=!1,this.readyToStart=!1,this.muzzlePositionBone=null,this.muzzleTransform=n.mat4.create(),this.muzzlePosition=this.muzzleTransform.subarray(12,15),this.currentStartDelay=0,this.constantDelay=0,this.elapsedTime=0};t.EveTurretFiringFX=function(){function e(){a(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.stretch=[],this.useMuzzleTransform=!1,this.isFiring=!1,this.isLoopFiring=!1,this.firingDelay1=0,this.firingDelay2=0,this.firingDelay3=0,this.firingDelay4=0,this.firingDelay5=0,this.firingDelay6=0,this.firingDelay7=0,this.firingDelay8=0,this.endPosition=n.vec3.create(),this._firingDuration=0,this._perMuzzleData=[]}return i(e,[{key:"Initialize",value:function(){this._firingDuration=this.GetCurveDuration();for(var e=0;e<this.stretch.length;++e)this._perMuzzleData[e]=new s;this._perMuzzleData.length>0&&(this._perMuzzleData[0].constantDelay=this.firingDelay1),this._perMuzzleData.length>1&&(this._perMuzzleData[1].constantDelay=this.firingDelay2),this._perMuzzleData.length>2&&(this._perMuzzleData[2].constantDelay=this.firingDelay3),this._perMuzzleData.length>3&&(this._perMuzzleData[3].constantDelay=this.firingDelay4),this._perMuzzleData.length>4&&(this._perMuzzleData[4].constantDelay=this.firingDelay5),this._perMuzzleData.length>5&&(this._perMuzzleData[5].constantDelay=this.firingDelay6),this._perMuzzleData.length>6&&(this._perMuzzleData[6].constantDelay=this.firingDelay7),this._perMuzzleData.length>7&&(this._perMuzzleData[7].constantDelay=this.firingDelay8)}},{key:"GetCurveDuration",value:function(){for(var e=0,t=0;t<this.stretch.length;++t)for(var r=this.stretch[t],i=0;i<r.curveSets.length;++i)e=Math.max(e,r.curveSets[i].GetMaxCurveDuration());return e}},{key:"GetPerMuzzleEffectCount",value:function(){return this.stretch.length}},{key:"SetMuzzleBoneID",value:function(e,t){this._perMuzzleData[e].muzzlePositionBone=t}},{key:"GetMuzzleTransform",value:function(e){return this._perMuzzleData[e].muzzleTransform}},{key:"PrepareFiring",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=0;r<this.stretch.length;++r)t<0||t===r?(this._perMuzzleData[r].currentStartDelay=e+this._perMuzzleData[r].constantDelay,this._perMuzzleData[r].started=!1,this._perMuzzleData[r].readyToStart=!1,this._perMuzzleData[r].elapsedTime=0):(this._perMuzzleData[r].currentStartDelay=Number.MAX_VALUE,this._perMuzzleData[r].started=!1,this._perMuzzleData[r].readyToStart=!1,this._perMuzzleData[r].elapsedTime=0);this.isFiring=!0}},{key:"StartMuzzleEffect",value:function(e){for(var t=this.stretch[e],r=0;r<t.curveSets.length;++r){var i=t.curveSets[r];switch(i.name){case"play_start":case"play_loop":i.PlayFrom(-this._perMuzzleData[e].currentStartDelay);break;case"play_stop":i.Stop()}}this._perMuzzleData[e].started=!0,this._perMuzzleData[e].readyToStart=!1}},{key:"StopFiring",value:function(){for(var e=0;e<this.stretch.length;++e){for(var t=this.stretch[e],r=0;r<t.curveSets.length;++r){var i=t.curveSets[r];switch(i.name){case"play_start":case"play_loop":i.Stop();break;case"play_stop":i.Play()}}this._perMuzzleData[e].started=!1,this._perMuzzleData[e].readyToStart=!1,this._perMuzzleData[e].currentStartDelay=0,this._perMuzzleData[e].elapsedTime=0}this.isFiring=!1}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.stretch.length;t++)this.stretch[t].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.stretch.length;++e)this.stretch[e].UpdateViewDependentData()}},{key:"Update",value:function(e){for(var t=0;t<this.stretch.length;++t)this._perMuzzleData[t].started&&(this._perMuzzleData[t].elapsedTime+=e),(this._perMuzzleData[t].elapsedTime<this._firingDuration||this.isLoopFiring)&&this.isFiring&&(this._perMuzzleData[t].started?(this.useMuzzleTransform?this.stretch[t].SetSourceTransform(this._perMuzzleData[t].muzzleTransform):this.stretch[t].SetSourcePosition(this._perMuzzleData[t].muzzlePosition),this.stretch[t].SetDestinationPosition(this.endPosition),this.stretch[t].SetIsNegZForward(!0)):(this._perMuzzleData[t].readyToStart?(this.StartMuzzleEffect(t),this._perMuzzleData[t].currentStartDelay=0,this._perMuzzleData[t].elapsedTime=0):this._perMuzzleData[t].currentStartDelay-=e,this._perMuzzleData[t].currentStartDelay<=0&&(this._perMuzzleData[t].readyToStart=!0))),this.stretch[t].Update(e)}},{key:"GetBatches",value:function(e,t,r){if(this.display&&this.isFiring)for(var i=0;i<this.stretch.length;++i)this._perMuzzleData[i].started&&(this._firingDuration>=this._perMuzzleData[i].elapsedTime||this.isLoopFiring)&&this.stretch[i].GetBatches(e,t,r)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(46);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(146);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var a=r(47);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(48);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(49);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=r(50);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(51);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var u=r(147);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveCurveLineSet=a;var i=r(0),n=r(1);function a(){this.name="",this.display=!0,this.disableDepth=!1,this.lineWidthFactor=1,this.lines=[],this.emptyLineID=[],this.translation=i.vec3.create(),this.rotation=i.quat.create(),this.scaling=i.vec3.fromValues(1,1,1),this.transform=i.mat4.create(),this.lineEffect=new n.Tw2Effect,this.lineEffect.effectFilePath="res:/Graphics/Effect/Managed/Space/SpecialFX/Lines3D.fx",this.lineEffect.parameters.TexMap=new n.Tw2TextureParameter("TexMap","res:/texture/global/white.dds.0.png"),this.lineEffect.parameters.OverlayTexMap=new n.Tw2TextureParameter("OverlayTexMap","res:/texture/global/white.dds.0.png"),this.lineEffect.Initialize(),this.pickEffect=null,this.additive=!1,this.pickable=!0,this.perObjectData=new n.Tw2PerObjectData,this.perObjectData.perObjectVSData=new n.Tw2RawData,this.perObjectData.perObjectVSData.Declare("WorldMat",16),this.perObjectData.perObjectVSData.Create(),this.perObjectData.perObjectPSData=new n.Tw2RawData,this.perObjectData.perObjectPSData.Declare("WorldMat",16),this.perObjectData.perObjectPSData.Create(),this._vertexSize=26,this._vertexBuffer=null,this._vertexBufferSize=0,this.declaration=new n.Tw2VertexDeclaration,this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.POSITION,0,n.device.gl.FLOAT,3,0)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,0,n.device.gl.FLOAT,4,12)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,4,28)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,2,n.device.gl.FLOAT,3,44)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,0,n.device.gl.FLOAT,4,56)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,1,n.device.gl.FLOAT,4,72)),this.declaration.elements.push(new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.COLOR,2,n.device.gl.FLOAT,4,88)),this.declaration.stride=4*this._vertexSize,this.declaration.RebuildHash()}a.prototype.Initialize=function(){i.mat4.fromRotationTranslationScale(this.transform,this.rotation,this.translation,this.scaling)},a.prototype._addLine=function(e){if(this.emptyLineID.length){var t=this.emptyLineID.pop();return this.lines[t]=e,t}return this.lines.push(e),this.lines.length-1},a.prototype.AddStraightLine=function(e,t,r,n,s){var o={type:a.LINETYPE_STRAIGHT,position1:i.vec3.clone(e),color1:i.vec4.clone(t),position2:i.vec3.clone(r),color2:i.vec4.clone(n),intermediatePosition:i.vec3.create(),width:s,multiColor:i.vec4.create(),multiColorBorder:-1,overlayColor:i.vec4.create(),animationSpeed:0,animationScale:1,numOfSegments:1};return this._addLine(o)},a.prototype.AddCurvedLineCrt=function(e,t,r,n,s,o){var l={type:a.LINETYPE_CURVED,position1:i.vec3.clone(e),color1:i.vec4.clone(t),position2:i.vec3.clone(r),color2:i.vec4.clone(n),intermediatePosition:i.vec3.clone(s),width:o,multiColor:i.vec4.create(),multiColorBorder:-1,overlayColor:i.vec4.create(),animationSpeed:0,animationScale:1,numOfSegments:20};return this._addLine(l)},a.prototype.AddCurvedLineSph=function(e,t,r,n,s,o,l){return this.AddCurvedLineCrt(a.cartFromSphericalAndCenter(i.vec3.create(),e,s),t,a.cartFromSphericalAndCenter(i.vec3.create(),r,s),n,a.cartFromSphericalAndCenter(i.vec3.create(),o,s),l)},a.prototype.AddSpheredLineCrt=function(e,t,r,n,s,o){var l={type:a.LINETYPE_SPHERED,position1:i.vec3.clone(e),color1:i.vec4.clone(t),position2:i.vec3.clone(r),color2:i.vec4.clone(n),intermediatePosition:i.vec3.clone(s),width:o,multiColor:i.vec4.create(),multiColorBorder:-1,overlayColor:i.vec4.create(),animationSpeed:0,animationScale:1,numOfSegments:20};return this._addLine(l)},a.prototype.AddSpheredLineSph=function(e,t,r,n,s,o){return this.AddSpheredLineCrt(a.cartFromSphericalAndCenter(i.vec3.create(),e,s),t,a.cartFromSphericalAndCenter(i.vec3.create(),r,s),n,s,o)},a.prototype.ChangeLineColor=function(e,t,r){this.lines[e].color1=t,this.lines[e].color2=r},a.prototype.ChangeLineWidth=function(e,t){this.lines[e].width=t},a.prototype.ChangeLinePositionCrt=function(e,t,r){this.lines[e].position1=t,this.lines[e].position2=r},a.prototype.ChangeLinePositionSph=function(e,t,r,n){this.ChangeLinePositionCrt(e,a.cartFromSphericalAndCenter(i.vec3.create(),t,n),a.cartFromSphericalAndCenter(i.vec3.create(),r,n))},a.prototype.ChangeLineIntermediateCrt=function(e,t){this.lines[e].intermediatePosition=t},a.prototype.ChangeLineIntermediateSph=function(e,t,r){a.cartFromSphericalAndCenter(this.lines[e].intermediatePosition,t,r)},a.prototype.ChangeLineMultiColor=function(e,t,r){this.lines[e].multiColor=t,this.lines[e].multiColorBorder=r},a.prototype.ChangeLineAnimation=function(e,t,r,i){this.lines[e].overlayColor=t,this.lines[e].animationSpeed=r,this.lines[e].animationScale=i},a.prototype.ChangeLineSegmentation=function(e,t){this.lines[e].type!==a.LINETYPE_STRAIGHT&&(this.lines[e].numOfSegments=t)},a.prototype.RemoveLine=function(e){this.emptyLineID.push(e),this.lines[e].type=a.LINETYPE_INVALID},a.prototype.ClearLines=function(){this.lines=[],this.emptyLineID=[]},a.prototype._lineCount=function(){for(var e=0,t=0;t<this.lines.length;++t)this.lines[t].type!==a.LINETYPE_INVALID&&(e+=this.lines[t].numOfSegments);return e},a.prototype._fillColorVertices=function(e,t,r){return t[r++]=e.multiColor[0],t[r++]=e.multiColor[1],t[r++]=e.multiColor[2],t[r++]=e.multiColor[3],t[r++]=e.overlayColor[0],t[r++]=e.overlayColor[1],t[r++]=e.overlayColor[2],t[r++]=e.overlayColor[3],r},a.prototype._writeLineVerticesToBuffer=function(e,t,r,i,n,a,s,o,l,c){var u=this.lines[o];l[c++]=t[0],l[c++]=t[1],l[c++]=t[2],l[c++]=n[0]-t[0],l[c++]=n[1]-t[1],l[c++]=n[2]-t[2],l[c++]=-e.lineWidthFactor*u.width,l[c++]=0,l[c++]=i,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=this._fillColorVertices(u,l,c),l[c++]=t[0],l[c++]=t[1],l[c++]=t[2],l[c++]=n[0]-t[0],l[c++]=n[1]-t[1],l[c++]=n[2]-t[2],l[c++]=e.lineWidthFactor*u.width,l[c++]=0,l[c++]=i,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=this._fillColorVertices(u,l,c),l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=t[0]-n[0],l[c++]=t[1]-n[1],l[c++]=t[2]-n[2],l[c++]=-e.lineWidthFactor*u.width,l[c++]=1,l[c++]=s,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],c=this._fillColorVertices(u,l,c),l[c++]=t[0],l[c++]=t[1],l[c++]=t[2],l[c++]=n[0]-t[0],l[c++]=n[1]-t[1],l[c++]=n[2]-t[2],l[c++]=e.lineWidthFactor*u.width,l[c++]=0,l[c++]=i,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=this._fillColorVertices(u,l,c),l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=t[0]-n[0],l[c++]=t[1]-n[1],l[c++]=t[2]-n[2],l[c++]=e.lineWidthFactor*u.width,l[c++]=1,l[c++]=s,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],c=this._fillColorVertices(u,l,c),l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=t[0]-n[0],l[c++]=t[1]-n[1],l[c++]=t[2]-n[2],l[c++]=-e.lineWidthFactor*u.width,l[c++]=1,l[c++]=s,l[c++]=u.multiColorBorder,l[c++]=s-i,l[c++]=u.animationSpeed,l[c++]=u.animationScale,l[c++]=o,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],c=this._fillColorVertices(u,l,c)},a.scratch={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec3_3:i.vec3.create(),vec3_4:i.vec3.create(),vec3_5:i.vec3.create(),vec3_6:i.vec3.create(),vec3_7:i.vec3.create(),vec3_8:i.vec3.create(),vec3_9:i.vec3.create(),vec3_10:i.vec3.create(),vec4_0:i.vec4.create(),vec4_1:i.vec4.create(),mat4_0:i.mat4.create()},a.prototype.SubmitChanges=function(){var e=a.scratch;if(this._vertexBuffer=null,this.lines.length){this._vertexBufferSize=this._lineCount();for(var t,r,s,o=new Float32Array(6*this._vertexBufferSize*this._vertexSize),l=0,c=e.vec3_0,u=e.vec3_1,h=e.vec3_2,f=e.vec3_3,p=e.vec3_4,d=e.vec3_5,v=e.vec3_6,m=e.vec3_7,y=e.vec3_8,b=e.vec3_9,g=e.vec3_10,_=e.vec4_0,E=e.vec4_1,T=e.mat4_0,R=0;R<this.lines.length;++R){var S=this.lines[R];switch(S.type){case a.LINETYPE_INVALID:break;case a.LINETYPE_STRAIGHT:this._writeLineVerticesToBuffer(this,S.position1,S.color1,0,S.position2,S.color2,1,R,o,l),l+=6*this._vertexSize;break;case a.LINETYPE_SPHERED:i.vec3.subtract(c,S.position1,S.intermediatePosition),i.vec3.subtract(u,S.position2,S.intermediatePosition),i.vec3.normalize(h,c),i.vec3.normalize(f,u),i.vec3.cross(p,c,u);var w=Math.acos(i.vec3.dot(h,f))/S.numOfSegments;for(i.mat4.identity(T),i.mat4.rotate(T,T,w,p),i.vec3.copy(d,c),i.vec4.copy(_,S.color1),t=0;t<this.lines[R].numOfSegments;++t)s=(t+1)/S.numOfSegments,i.vec3.transformMat4(v,d,T),E[0]=S.color1[0]*(1-s)+S.color2[0]*s,E[1]=S.color1[1]*(1-s)+S.color2[1]*s,E[2]=S.color1[2]*(1-s)+S.color2[2]*s,E[3]=S.color1[3]*(1-s)+S.color2[3]*s,i.vec3.add(m,d,S.intermediatePosition),i.vec3.add(y,v,S.intermediatePosition),this._writeLineVerticesToBuffer(this,m,_,t/this.lines[R].numOfSegments,y,E,s,R,o,l),l+=6*this._vertexSize,r=d,d=v,v=r,r=_,_=E,E=r;break;case a.LINETYPE_CURVED:for(i.vec3.subtract(b,S.intermediatePosition,S.position1),i.vec3.subtract(g,S.position2,S.intermediatePosition),i.vec3.copy(m,S.position1),i.vec3.copy(_,S.color1),t=0;t<S.numOfSegments;++t)s=(t+1)/S.numOfSegments,i.vec3.hermite(y,S.position1,b,S.position2,g,s),E[0]=S.color1[0]*(1-s)+S.color2[0]*s,E[1]=S.color1[1]*(1-s)+S.color2[1]*s,E[2]=S.color1[2]*(1-s)+S.color2[2]*s,E[3]=S.color1[3]*(1-s)+S.color2[3]*s,this._writeLineVerticesToBuffer(this,m,_,t/this.lines[R].numOfSegments,y,E,s,R,o,l),l+=6*this._vertexSize,r=m,m=y,y=r,r=_,_=E,E=r}}this._vertexBuffer&&n.device.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=n.device.gl.createBuffer(),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,this._vertexBuffer),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,o,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,null)}},a.LINETYPE_INVALID=0,a.LINETYPE_STRAIGHT=1,a.LINETYPE_SPHERED=2,a.LINETYPE_CURVED=3,a.prototype.GetBatches=function(e,t){if(this.display&&this._vertexBuffer){switch(e){case n.device.RM_TRANSPARENT:if(!this.lineEffect||this.additive)return;break;case n.device.RM_ADDITIVE:if(!this.lineEffect||!this.additive)return;break;case n.device.RM_PICKABLE:if(!this.pickEffect||!this.pickable)return;break;default:return}var r=new n.Tw2ForwardingRenderBatch;i.mat4.transpose(this.perObjectData.perObjectVSData.Get("WorldMat"),this.transform),i.mat4.transpose(this.perObjectData.perObjectPSData.Get("WorldMat"),this.transform),r.perObjectData=this.perObjectData,r.geometryProvider=this,r.renderMode=e,t.Commit(r)}},a.prototype.Unload=function(){this._vertexBuffer&&(n.device.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null)},a.prototype.Render=function(e,t){var r=t||e.renderMode===n.device.RM_PICKABLE?this.pickEffect:this.lineEffect;if(!r.GetEffectRes()._isGood)return!1;var i=n.device;i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this._vertexBuffer),this.disableDepth&&n.device.gl.disable(n.device.gl.DEPTH_TEST);for(var a=r.GetPassCount(),s=0;s<a;++s){r.ApplyPass(s);var o=r.GetPassInput(s);if(!this.declaration.SetDeclaration(o,this.declaration.stride))return!1;i.ApplyShadowState(),i.gl.drawArrays(i.gl.TRIANGLES,0,6*this._vertexBufferSize)}return this.disableDepth&&n.device.gl.enable(n.device.gl.DEPTH_TEST),!0},a.prototype.Update=function(){},a.prototype.UpdateViewDependentData=function(e){i.mat4.fromRotationTranslationScale(this.transform,this.rotation,this.translation,this.scaling),i.mat4.multiply(this.transform,this.transform,e)},a.prototype.GetResources=function(e){return void 0===e&&(e=[]),this.lineEffect.GetResources(e),null!==this.pickEffect&&this.pickEffect.GetResources(e),e},a.cartFromSpherical=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=n*Math.sin(r)*Math.sin(i),e[1]=n*Math.cos(i),e[2]=n*Math.cos(r)*Math.sin(i),e},a.cartFromSphericalAndCenter=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=a*Math.sin(i)*Math.sin(n)+r[0],e[1]=a*Math.cos(n)+r[1],e[2]=a*Math.cos(i)*Math.sin(n)+r[2],e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretData=a,t.EveTurretSet=s;var i=r(0),n=r(1);function a(){this.name="",this.visible=!0,this.localTransform=i.mat4.create(),this.rotation=i.quat.create()}function s(){this.display=!0,this.name="",this.boundingSphere=i.quat.create(),this.bottomClipHeight=0,this.locatorName="",this.sysBoneHeight=0,this.turrets=[],this.turretEffect=null,this.targetPosition=i.vec3.create(),this.firingEffectResPath="",this.firingEffect=null,this.fireCallback=null,this.fireCallbackPending=!1,this.hasCyclingFiringPos=!1,this.geometryResPath="",this.geometryResource=null,this.activeAnimation=new n.Tw2AnimationController,this.inactiveAnimation=new n.Tw2AnimationController,this.parentMatrix=i.mat4.create(),this.STATE_INACTIVE=0,this.STATE_IDLE=1,this.STATE_FIRING=2,this.STATE_PACKING=3,this.STATE_UNPACKING=4,this.state=this.STATE_IDLE,this._perObjectDataActive=new n.Tw2PerObjectData,this._perObjectDataActive.perObjectVSData=new n.Tw2RawData,this._perObjectDataActive.perObjectVSData.Declare("baseCutoffData",4),this._perObjectDataActive.perObjectVSData.Declare("turretSetData",4),this._perObjectDataActive.perObjectVSData.Declare("shipMatrix",16),this._perObjectDataActive.perObjectVSData.Declare("turretTranslation",96),this._perObjectDataActive.perObjectVSData.Declare("turretRotation",96),this._perObjectDataActive.perObjectVSData.Declare("turretPoseTransAndRot",576),this._perObjectDataActive.perObjectVSData.Create(),this._perObjectDataInactive=new n.Tw2PerObjectData,this._perObjectDataInactive.perObjectVSData=new n.Tw2RawData,this._perObjectDataInactive.perObjectVSData.Declare("baseCutoffData",4),this._perObjectDataInactive.perObjectVSData.Declare("turretSetData",4),this._perObjectDataInactive.perObjectVSData.Declare("shipMatrix",16),this._perObjectDataInactive.perObjectVSData.Declare("turretTranslation",96),this._perObjectDataInactive.perObjectVSData.Declare("turretRotation",96),this._perObjectDataInactive.perObjectVSData.Declare("turretPoseTransAndRot",576),this._perObjectDataInactive.perObjectVSData.Create(),this.worldNames=["turretWorld0","turretWorld1","turretWorld2"],this._activeTurret=-1,this._recheckTimeLeft=0,this._currentCyclingFiresPos=0}function o(e,t,r,i){t*=12,i*=4;var n=o._tempMat;n[0]=e[t+0],n[1]=e[t+4],n[2]=e[t+8],n[3]=0,n[4]=e[t+1],n[5]=e[t+5],n[6]=e[t+9],n[7]=0,n[8]=e[t+2],n[9]=e[t+6],n[10]=e[t+10],n[11]=0,n[12]=e[t+3],n[13]=e[t+7],n[14]=e[t+11],n[15]=1;var a=o._tempQuat;l(n,a),r[i]=a[0],r[i+1]=a[1],r[i+2]=a[2],r[i+3]=a[3]}function l(e,t){t=t||i.quat.create();var r=e[0]+e[5]+e[10]+1;if(r>1)return t[0]=(e[6]-e[9])/(2*Math.sqrt(r)),t[1]=(e[8]-e[2])/(2*Math.sqrt(r)),t[2]=(e[1]-e[4])/(2*Math.sqrt(r)),t[3]=Math.sqrt(r)/2,t;for(var n,a=0,s=e[0],o=1;o<3;o++)e[4*o+o]>s&&(a=o,s=e[4*o+o]);switch(a){case 0:n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[2]+e[8])/n,t[3]=(e[6]-e[9])/n;break;case 1:n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n,t[3]=(e[8]-e[2])/n;break;case 2:n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[0]=(e[2]+e[8])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n,t[3]=(e[1]-e[4])/n}return t}s.positionBoneSkeletonNames=["Pos_Fire01","Pos_Fire02","Pos_Fire03","Pos_Fire04","Pos_Fire05","Pos_Fire06","Pos_Fire07","Pos_Fire08"],s.prototype.Initialize=function(){if(this.turretEffect&&""!==this.geometryResPath&&(this.geometryResource=n.resMan.GetResource(this.geometryResPath),this.activeAnimation.SetGeometryResource(this.geometryResource),this.inactiveAnimation.SetGeometryResource(this.geometryResource),this.geometryResource&&this.geometryResource.RegisterNotification(this)),""!==this.firingEffectResPath){var e=this;n.resMan.GetObject(this.firingEffectResPath,function(t){e.firingEffect=t})}},s.prototype.GetResources=function(e){return void 0===e&&(e=[]),null!==this.geometryResource&&-1===e.indexOf(this.geometryResource)&&e.push(this.geometryResource),null!==this.turretEffect&&this.turretEffect.GetResources(e),null!==this.firingEffect&&this.firingEffect.GetResources(e),e},s.prototype.RebuildCachedData=function(){for(var e=new n.Tw2VertexElement(n.Tw2VertexDeclaration.Type.TEXCOORD,1,n.device.gl.FLOAT,2),t=0;t<this.geometryResource.meshes.length;++t)this.geometryResource.meshes[t].declaration.elements.push(e),this.geometryResource.meshes[t].declaration.RebuildHash();var r=this;switch(this.state){case this.STATE_INACTIVE:this.activeAnimation.PlayAnimation("Inactive",!0),this.inactiveAnimation.PlayAnimation("Inactive",!0);break;case this.STATE_IDLE:this.activeAnimation.PlayAnimation("Active",!0),this.inactiveAnimation.PlayAnimation("Active",!0);break;case this.STATE_FIRING:this.activeAnimation.PlayAnimation("Fire",!1,function(){r.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Active",!0);break;case this.STATE_PACKING:this.EnterStateIdle();break;case this.STATE_UNPACKING:this.EnterStateDeactive()}},s.prototype.InitializeFiringEffect=function(){if(this.firingEffect&&this.geometryResource&&this.geometryResource.models.length)for(var e=this.geometryResource.models[0],t=0;t<this.firingEffect.GetPerMuzzleEffectCount();++t)this.firingEffect.SetMuzzleBoneID(t,e.FindBoneByName(s.positionBoneSkeletonNames[t]))},s.prototype.SetLocalTransform=function(e,t,r){var n=i.mat4.clone(t);if(i.vec3.normalize(n.subarray(0,3),n.subarray(0,3)),i.vec3.normalize(n.subarray(4,7),n.subarray(4,7)),i.vec3.normalize(n.subarray(8,11),n.subarray(8,11)),e>=this.turrets.length){var s=new a;s.name=r,s.localTransform.set(n),this.turrets[e]=s}else this.turrets[e].localTransform.set(n);l(this.turrets[e].localTransform,this.turrets[e].rotation)},o._tempMat=i.mat4.create(),o._tempQuat=i.quat.create(),s.prototype._UpdatePerObjectData=function(e,t){i.mat4.transpose(e.Get("shipMatrix"),this.parentMatrix);var r=t.length/12;e.Get("turretSetData")[0]=r,e.Get("baseCutoffData")[0]=this.bottomClipHeight;for(var n=e.Get("turretTranslation"),a=e.Get("turretRotation"),s=e.Get("turretPoseTransAndRot"),l=0;l<this.turrets.length;++l){for(var c=0;c<r;++c)s[2*(l*r+c)*4]=t[12*c+3],s[2*(l*r+c)*4+1]=t[12*c+7],s[2*(l*r+c)*4+2]=t[12*c+11],s[2*(l*r+c)*4+3]=1,o(t,c,s,2*(l*r+c)+1);n[4*l]=this.turrets[l].localTransform[12],n[4*l+1]=this.turrets[l].localTransform[13],n[4*l+2]=this.turrets[l].localTransform[14],n[4*l+3]=1,a[4*l]=this.turrets[l].rotation[0],a[4*l+1]=this.turrets[l].rotation[1],a[4*l+2]=this.turrets[l].rotation[2],a[4*l+3]=this.turrets[l].rotation[3]}},s.prototype.GetBatches=function(e,t,r){if(!this.turretEffect||null===this.geometryResource||!this.display)return!1;if(e===n.device.RM_OPAQUE){var i=this.inactiveAnimation.GetBoneMatrices(0);if(0===i.length)return!0;this._UpdatePerObjectData(this._perObjectDataInactive.perObjectVSData,i),this._perObjectDataInactive.perObjectPSData=r.perObjectPSData;var a=new n.Tw2ForwardingRenderBatch;if(a.renderMode=e,a.renderActive=!1,a.perObjectData=this._perObjectDataInactive,a.geometryProvider=this,t.Commit(a),this.state===this.STATE_FIRING){if(0===(i=this.activeAnimation.GetBoneMatrices(0)).length)return!0;this._UpdatePerObjectData(this._perObjectDataActive.perObjectVSData,i),this._perObjectDataActive.perObjectPSData=r.perObjectPSData,(a=new n.Tw2ForwardingRenderBatch).renderActive=!0,a.perObjectData=this._perObjectDataActive,a.geometryProvider=this,t.Commit(a)}}return this.firingEffect&&this.firingEffect.GetBatches(e,t,r),!0},s.prototype.Update=function(e,t){if(this.turretEffect&&(this.activeAnimation.Update(e),this.inactiveAnimation.Update(e)),i.mat4.copy(this.parentMatrix,t),this.firingEffect){if(-1!==this._activeTurret){var r;if(this.firingEffect.isLoopFiring&&this.state===this.STATE_FIRING&&(this._recheckTimeLeft-=e,this._recheckTimeLeft<=0&&this._DoStartFiring()),this.activeAnimation.models.length){var n=this.activeAnimation.models[0].bonesByName;for(r=0;r<this.firingEffect.GetPerMuzzleEffectCount();++r){var a=n[s.positionBoneSkeletonNames[r]].worldTransform,o=this.firingEffect.GetMuzzleTransform(r);i.mat4.multiply(o,this.turrets[this._activeTurret].localTransform,a),i.mat4.multiply(o,o,t)}}else for(r=0;r<this.firingEffect.GetPerMuzzleEffectCount();++r)i.mat4.multiply(this.firingEffect.GetMuzzleTransform(r),t,this.turrets[this._activeTurret].localTransform);if(this.fireCallbackPending){if(this.fireCallback){var l=[];for(r=0;r<this.firingEffect.GetPerMuzzleEffectCount();++r)l.push(this.firingEffect.GetMuzzleTransform(r));this.fireCallback(this,l)}this.fireCallbackPending=!1}}i.vec3.copy(this.firingEffect.endPosition,this.targetPosition),this.firingEffect.Update(e)}},s.prototype.Render=function(e,t){for(var r=t||this.turretEffect,i=0,a=function(e){n.device.gl.disableVertexAttribArray(e.location),n.device.gl.vertexAttrib2f(e.location,i,i)},s=0;s<this.geometryResource.meshes.length;++s){this.geometryResource.meshes[s].declaration.FindUsage(n.Tw2VertexDeclaration.Type.TEXCOORD,1).customSetter=a}for(;i<this.turrets.length;++i)if(this.turrets[i].visible){var o=this.state===this.STATE_FIRING&&i===this._activeTurret;e.renderActive===o&&this.geometryResource.RenderAreas(0,0,1,r)}},s.prototype.EnterStateDeactive=function(){if(this.state!==this.STATE_INACTIVE&&this.state!==this.STATE_PACKING){var e=this;this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.activeAnimation.PlayAnimation("Pack",!1,function(){e.state=e.STATE_INACTIVE,e.activeAnimation.PlayAnimation("Inactive",!0)}),this.inactiveAnimation.PlayAnimation("Pack",!1,function(){e.state=e.STATE_INACTIVE,e.inactiveAnimation.PlayAnimation("Inactive",!0)}),this.state=this.STATE_PACKING):this.state=e.STATE_INACTIVE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring()}},s.prototype.EnterStateIdle=function(){var e=this;this.state!==this.STATE_IDLE&&this.state!==this.STATE_UNPACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===this.STATE_FIRING?(this.activeAnimation.PlayAnimation("Active",!0),this.inactiveAnimation.PlayAnimation("Active",!0)):(this.activeAnimation.PlayAnimation("Deploy",!1,function(){e.state=e.STATE_IDLE,e.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){e.state=e.STATE_IDLE,e.inactiveAnimation.PlayAnimation("Active",!0)})),this.state=this.STATE_UNPACKING):this.state=e.STATE_IDLE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())},s.prototype.EnterStateFiring=function(){var e=this;if(!this.turretEffect||this.state===this.STATE_FIRING)return this._DoStartFiring(),void(this.turretEffect&&this.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)}));this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===this.STATE_INACTIVE?(this.activeAnimation.PlayAnimation("Deploy",!1,function(){e._DoStartFiring(),e.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)})}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){e.inactiveAnimation.PlayAnimation("Active",!0)}),this.state=this.STATE_UNPACKING):(this._DoStartFiring(),this.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Active",!0))},s.prototype.UpdateViewDependentData=function(){this.firingEffect&&this.firingEffect.UpdateViewDependentData()},s.prototype._DoStartFiring=function(){this.hasCyclingFiringPos&&(this._currentCyclingFiresPos=1-this._currentCyclingFiresPos);var e=this.GetClosestTurret();this.firingEffect&&this.firingEffect.PrepareFiring(0,this.hasCyclingFiringPos?this._currentCyclingFiresPos:-1),this._activeTurret=e,this.state=this.STATE_FIRING,this._recheckTimeLeft=2,this.fireCallback&&(this.fireCallbackPending=!0)},s._tempVec3=[i.vec3.create(),i.vec3.create()],s._tempQuat4=[i.quat.create(),i.quat.create()],s.prototype.GetClosestTurret=function(){for(var e=-1,t=-2,r=s._tempVec3[0],n=s._tempQuat4[0],a=s._tempQuat4[1],o=0;o<this.turrets.length;++o){a[0]=this.turrets[o].localTransform[12],a[1]=this.turrets[o].localTransform[13],a[2]=this.turrets[o].localTransform[14],a[3]=1,i.vec4.transformMat4(a,a,this.parentMatrix),i.vec3.subtract(r,this.targetPosition,a),i.vec3.normalize(r,r),n[0]=0,n[1]=1,n[2]=0,n[3]=0,i.vec4.transformMat4(n,n,this.turrets[o].localTransform),i.vec4.transformMat4(n,n,this.parentMatrix);var l=i.vec3.dot(n,r);l>t&&(e=o,t=l)}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceScene=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r(0),a=r(1);var s=t.EveSpaceScene=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.lensflares=!0,this.visible.objects=!0,this.visible.planets=!0,this.visible.fog=!0,this.visible.clearColor=!0,this.visible.reflection=!0,this.visible.diffuse=!0,this.visible.blur=!0,this.lensflares=[],this.objects=[],this.planets=[],this.nebulaIntensity=1,this.ambientColor=n.quat.fromValues(.25,.25,.25,1),this.backgroundEffect=null,this.backgroundRenderingEnabled=1,this.clearColor=n.vec4.fromValues(0,0,0,0),this.lodEnabled=!1,this.fogStart=0,this.fogEnd=0,this.fogMax=0,this.fogType=0,this.fogBlur=0,this.fogColor=n.vec4.fromValues(.25,.25,.25,1),this.sunDirection=n.vec3.fromValues(1,-1,1),this.sunDiffuseColor=n.vec4.fromValues(1,1,1,1),this.envMapScaling=n.vec3.fromValues(1,1,1),this.envMapRotation=n.quat.create(),this.envMapResPath="",this.envMap1ResPath="",this.envMap2ResPath="",this.envMap3ResPath="",this.envMapRes=null,this.envMap1Res=null,this.envMap2Res=null,this.envMap3Res=null,this.renderDebugInfo=!1,this._debugHelper=null,this._batches=new a.Tw2BatchAccumulator,this._perFrameVS=new a.Tw2RawData(e.perObjectDataDecl.VSData),this._perFramePS=new a.Tw2RawData(e.perObjectDataDecl.PSData),Object.defineProperty(this.visible,"environment",{get:function(){return t.backgroundRenderingEnabled},set:function(e){t.backgroundRenderingEnabled=e?1:0}}),e.init()}return i(e,[{key:"Initialize",value:function(){this.SetEnvMapReflection(this.envMapResPath),this.SetEnvMapDiffuse(this.envMap1ResPath),this.SetEnvMapBlur(this.envMap2ResPath),this.SetEnvMapPath(3,this.envMap3ResPath)}},{key:"KeepAlive",value:function(){for(var e=this.GetResources(),t=0;t<e.length;t++)e[t].KeepAlive()}},{key:"EnableLod",value:function(e){if(this.lodEnabled=e,!e)for(var t=0;t<this.objects.length;++t)this.objects[t].ResetLod&&this.objects[t].ResetLod()}},{key:"SetEnvMapReflection",value:function(e){this.SetEnvMapPath(0,e)}},{key:"SetEnvMapDiffuse",value:function(e){this.SetEnvMapPath(1,e)}},{key:"SetEnvMapBlur",value:function(e){this.SetEnvMapPath(2,e)}},{key:"SetEnvMapPath",value:function(e,t){var r=this,i=function(e,t,i){return e=e.toLowerCase(),r[t]=e,r[i]=""===e?null:a.resMan.GetResource(e),!0};switch(e){case 0:return i(t,"envMapResPath","envMapRes");case 1:return i(t,"envMap1ResPath","envMap1Res");case 2:return i(t,"envMap2ResPath","envMap2Res");case 3:return i(t,"envMap3ResPath","envMap3Res")}return!1}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=0;r<this.lensflares.length;r++)this.lensflares[r].GetResources(e);if(this.backgroundEffect&&this.backgroundEffect.GetResources(e),this.envMapRes&&!e.includes(this.envMapRes)&&e.push(this.envMapRes),this.envMap1Res&&!e.includes(this.envMap1Res)&&e.push(this.envMapRes),this.envMap2Res&&!e.includes(this.envMap2Res)&&e.push(this.envMapRes),this.envMap3Res&&!e.includes(this.envMap3Res)&&e.push(this.envMapRes),!t){for(var i=0;i<this.planets.length;i++)this.planets[i].GetResources(e);for(var n=0;n<this.objects.length;n++)"GetResources"in this.objects[n]&&this.objects[n].GetResources(e)}return e}},{key:"Update",value:function(e){for(var t=0;t<this.planets.length;++t)"Update"in this.planets[t]&&this.planets[t].Update(e);for(var r=0;r<this.objects.length;++r)"Update"in this.objects[r]&&this.objects[r].Update(e)}},{key:"RenderBatches",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._batches,i=0;i<t.length;++i)"GetBatches"in t[i]&&t[i].GetBatches(e,r)}},{key:"Render",value:function(){this.ApplyPerFrameData();var t=e.global,r=n.mat4.identity(t.mat4_ID),i=this.visible;if(this.backgroundRenderingEnabled&&this.backgroundEffect&&(a.device.SetStandardStates(a.device.RM_FULLSCREEN),a.device.RenderCameraSpaceQuad(this.backgroundEffect)),i.planets&&this.planets.length){var s=n.mat4.copy(t.mat4_0,a.device.projection),o=n.mat4.copy(t.mat4_1,a.device.projection);o[10]=1e11/(1e4-1e11),o[14]=1e15/(1e4-1e11),a.device.SetProjection(o,!0),this.ApplyPerFrameData();for(var l=0;l<this.planets.length;++l)this.planets[l].UpdateViewDependentData&&this.planets[l].UpdateViewDependentData(r);this._batches.Clear(),a.device.gl.depthRange(.9,1),this.RenderBatches(a.device.RM_OPAQUE,this.planets),this.RenderBatches(a.device.RM_DECAL,this.planets),this.RenderBatches(a.device.RM_TRANSPARENT,this.planets),this.RenderBatches(a.device.RM_ADDITIVE,this.planets),this._batches.Render(),a.device.SetProjection(s,!0),this.ApplyPerFrameData(),a.device.gl.depthRange(0,.9)}if(this.lodEnabled){t.frustum.Initialize(a.device.view,a.device.projection,a.device.viewportWidth,a.device.viewInverse,a.device.viewProjection);for(var c=0;c<this.objects.length;++c)this.objects[c].UpdateLod&&this.objects[c].UpdateLod(t.frustum)}if(i.objects)for(var u=0;u<this.objects.length;++u)this.objects[u].UpdateViewDependentData&&this.objects[u].UpdateViewDependentData(r);if(i.lensflares)for(var h=0;h<this.lensflares.length;++h)this.lensflares[h].PrepareRender();if(this._batches.Clear(),this.visible.planets)for(var f=0;f<this.planets.length;++f)this.planets[f].GetZOnlyBatches(a.device.RM_OPAQUE,this._batches);if(this.visible.objects&&(this.RenderBatches(a.device.RM_OPAQUE,this.objects),this.RenderBatches(a.device.RM_DECAL,this.objects),this.RenderBatches(a.device.RM_TRANSPARENT,this.objects),this.RenderBatches(a.device.RM_ADDITIVE,this.objects)),this.visible.lensflares)for(var p=0;p<this.lensflares.length;++p)this.lensflares[p].GetBatches(a.device.RM_ADDITIVE,this._batches);if(this._batches.Render(),this.visible.lensflares)for(var d=0;d<this.lensflares.length;++d)this.lensflares[d].UpdateOccluders();if(this.renderDebugInfo&&e.DebugRenderer){this._debugHelper||(this._debugHelper=new e.DebugRenderer);for(var v=0;v<this.objects.length;++v)void 0!==this.objects[v].RenderDebugInfo&&this.objects[v].RenderDebugInfo(this._debugHelper);this._debugHelper.Render()}}},{key:"ApplyPerFrameData",value:function(){var t=e.global,r=t.mat4_2,i=t.vec3_0;n.mat4.fromQuat(r,this.envMapRotation),n.mat4.scale(r,r,this.envMapScaling),n.mat4.transpose(r,r),n.vec3.negate(i,this.sunDirection),n.vec3.normalize(i,i);var s=this.fogEnd-this.fogStart;Math.abs(s)<1e-5&&(s=1e-5);var o=1/s,l=this._perFrameVS;l.Set("FogFactors",[this.fogEnd*o,o,this.visible.fog?this.fogMax:0,1]),l.Set("ViewportAdjustment",[1,1,1,1]),l.Set("MiscSettings",[a.device.currentTime,0,a.device.viewportWidth,a.device.viewportHeight]),l.Set("SunData.DirWorld",i),l.Set("SunData.DiffuseColor",this.sunDiffuseColor),l.Set("TargetResolution",a.device.targetResolution),l.Set("ViewInverseTransposeMat",a.device.viewInverse),l.Set("ViewProjectionMat",a.device.viewProjectionTranspose),l.Set("ViewMat",a.device.viewTranspose),l.Set("ProjectionMat",a.device.projectionTranspose),l.Set("EnvMapRotationMat",r),a.device.perFrameVSData=l;var c=this._perFramePS;c.Set("ViewInverseTransposeMat",a.device.viewInverse),c.Set("ViewMat",a.device.viewTranspose),c.Set("EnvMapRotationMat",r),c.Set("SunData.DirWorld",i),c.Set("SunData.DiffuseColor",this.sunDiffuseColor),c.Set("SceneData.AmbientColor",this.ambientColor),c.Set("MiscSettings",[a.device.currentTime,this.fogType,this.fogBlur,1]),c.Set("SceneData.FogColor",this.fogColor),c.Set("FovXY",[a.device.targetResolution[3],a.device.targetResolution[2]]),c.Set("ShadowMapSettings",[1,1,0,0]),c.Set("TargetResolution",a.device.targetResolution),c.Get("SceneData.NebulaIntensity")[0]=this.nebulaIntensity,c.Get("ViewportSize")[0]=a.device.viewportWidth,c.Get("ViewportSize")[1]=a.device.viewportHeight,c.Get("ShadowCameraRange")[0]=1,c.Get("ProjectionToView")[0]=-a.device.projection[14],c.Get("ProjectionToView")[1]=-a.device.projection[10]-1,a.device.perFramePSData=c;var u=a.store._variables,h=u.EveSpaceSceneEnvMap,f=u.EnvMap1,p=u.EnvMap2,d=u.EnvMap3;h.textureRes=this.envMapRes&&this.visible.reflection?this.envMapRes:t.emptyTexture,f.textureRes=this.envMap1Res&&this.visible.diffuse?this.envMap1Res:t.emptyTexture,p.textureRes=this.envMap2Res&&this.visible.blur?this.envMap2Res:t.emptyTexture,d.textureRes=this.envMap3Res?this.envMap3Res:t.emptyTexture}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:n.vec3.create(),vec4_0:n.vec4.create(),mat4_0:n.mat4.create(),mat4_1:n.mat4.create(),mat4_2:n.mat4.create(),mat4_ID:n.mat4.create(),frustum:new a.Tw2Frustum,emptyTexture:a.resMan.GetResource("res:/texture/global/black.dds.0.png")})}}]),e}();s.global=null,s.perObjectDataDecl={VSData:[{name:"ViewInverseTransposeMat",size:16},{name:"ViewProjectionMat",size:16},{name:"ViewMat",size:16},{name:"ProjectionMat",size:16},{name:"ShadowViewMat",size:16},{name:"ShadowViewProjectionMat",size:16},{name:"EnvMapRotationMat",size:16},{name:"SunData.DirWorld",size:4},{name:"SunData.DiffuseColor",size:4},{name:"FogFactors",size:4},{name:"TargetResolution",size:4},{name:"ViewportAdjustment",size:4},{name:"MiscSettings",size:4}],PSData:[{name:"ViewInverseTransposeMat",size:16},{name:"ViewMat",size:16},{name:"EnvMapRotationMat",size:16},{name:"SunData.DirWorld",size:4},{name:"SunData.DiffuseColor",size:4},{name:"SceneData.AmbientColor",size:3},{name:"SceneData.NebulaIntensity",size:1},{name:"SceneData.FogColor",size:4},{name:"ViewportOffset",size:2},{name:"ViewportSize",size:2},{name:"TargetResolution",size:4},{name:"ShadowMapSettings",size:4},{name:"ShadowCameraRange",size:4},{name:"ProjectionToView",size:2},{name:"FovXY",size:2},{name:"MiscSettings",size:4}]},s.DebugRenderer="Tw2DebugRenderer"in window?window.Tw2DebugRenderer:null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSOF=function(){var e=null,t=null;function r(e,t,r){return t in e?e[t]:r}function v(t){return r(e.generic,t?"shaderPrefixAnimated":"shaderPrefix","")}function m(e,t,i,n,a){var s=null;if(r(n,"resPathInsert","").length&&(s=n.resPathInsert),"respathinsert"in a&&1===a.respathinsert.length){if("none"===a.respathinsert[0])return e;s=a.respathinsert[0]}if("MaterialMap"===t||"PaintMaskMap"===t||"PmdgMap"===t){var o=e.lastIndexOf("/"),l=e;if(o>=0&&(l=e.substr(0,o+1)+s+"/"+e.substr(o+1)),(o=l.lastIndexOf("_"))>=0){l=l.substr(0,o)+"_"+s+l.substr(o);var c=r(i,"textureOverrides",{});if(t in c&&n.name in c[t])return l}}return e}function y(e,t){var r=v(t),i=(e="/"+e).lastIndexOf("/");return e.substr(0,i+1)+r+e.substr(i+1)}function b(e,t){for(var r=0;r<e.length;++r)if(t.substr(0,e[r].length)===e[r])return r;return null}function g(t,i,n,a){var s,o,l,c;return"mesh"in n&&(s=e.generic.materialPrefixes,null!==(o=b(s,t))&&o<n.mesh.length&&0==(r(i,"blockedMaterials",0)&1<<o)&&(l=r(e.material,n.mesh[o],null)))?(c=t.substr(s[o].length),r(l.parameters,c,void 0)):(s=e.generic.patternMaterialPrefixes,o=b(s,t),"pattern"in n&&null!==o&&1+o<n.pattern.length&&(l=r(e.material,n.pattern[1+o],null))?(c=t.substr(s[o].length),r(l.parameters,c,void 0)):null!==o&&(l=r(e.material,a.defaultPatternLayer1MaterialName,null))?(c=t.substr(s[o].length),r(l.parameters,c,void 0)):void 0)}function _(e){switch(e){case 2:return 4;case 1:return 3;default:return 1}}function E(t,i,a,s,o,l,c,u){for(var h=r(a,i,[]),f=0;f<h.length;++f){var p=h[f],d=new n.Tw2Effect;d.effectFilePath=e.generic.areaShaderLocation+y(u||p.shader,a.isSkinned);for(var v=r(r(e.generic.areaShaders,p.shader,{}),"parameters",[]),b=0;b<v.length;++b){var E=v[b],T=g(E,p,c,o);(T=(T=(T=(T=T||r(r(r(e.generic.hullAreas,p.name,{}),"parameters",{}),E))||r(r(r(o.hullAreas,p.name,{}),"parameters",{}),E))||r(r(r(s.areas,p.name,{}),"parameters",{}),E))||r(r(p,"parameters",{}),E))&&(d.parameters[E]=new n.Tw2Vector4Parameter(E,T))}var R=r(p,"textures",[]);for(b in R)if(R.hasOwnProperty(b)){var S=R[b];S=m(S,b,p,s,c),d.parameters[b]=new n.Tw2TextureParameter(b,S)}for(b=0;b<l.layers.length;++b)if(l.layers[b]&&!(l.layers[b].textureName in d.parameters)){var w=new n.Tw2TextureParameter(l.layers[b].textureName);w.resourcePath=l.layers[b].textureResFilePath,w.useAllOverrides=!0,w.addressUMode=_(r(l.layers[b],"projectionTypeU",0)),w.addressVMode=_(r(l.layers[b],"projectionTypeV",0)),w.Initialize(),d.parameters[l.layers[b].textureName]=w}var O=r(r(e.generic.areaShaders,p.shader,{}),"defaultTextures",{});for(var A in O)O.hasOwnProperty(A)&&(A in d.parameters||(d.parameters[A]=new n.Tw2TextureParameter(A,O[A])));d.Initialize();var P=new n.Tw2MeshArea;P.name=p.name,P.effect=d,P.index=r(p,"index",0),P.count=r(p,"count",1),t.push(P)}}function T(e,t,r){r in t&&(e[r]=t[r])}function R(e,t,a,s){function o(t){return function(o){o.isEffectChild?e.effectChildren.push(o):e.children.push(o),i.vec3.copy(o.translation,r(t,"translation",[0,0,0])),i.quat.copy(o.rotation,r(t,"rotation",[0,0,0,1])),i.vec3.copy(o.scaling,r(t,"scaling",[1,1,1]));var l=r(t,"id",-1);-1!==l&&s[l]&&function e(t,r,i){for(var a=0;a<t.particleEmitters.length;++a)if("rate"in t.particleEmitters[a]){var s=new n.Tw2ValueBinding;s.sourceObject=i,s.sourceAttribute="currentValue",s.destinationObject=t.particleEmitters[a],s.destinationAttribute="rate",s.Initialize(),r.bindings.push(s)}for(a=0;a<t.children.length;++a)e(t.children[a],r,i)}(o,a,s[l])}}for(var l=r(t,"children",[]),c=0;c<l.length;++c)n.resMan.GetObject(l[c].redFilePath,o(l[c]))}var S=!1,w=[];function O(m){for(var y=m.split(":"),b={},g=3;g<y.length;++g){var _=y[g].split("?");b[_[0]]=_[1].split(";")}var S=e.hull[y[0]],w=e.faction[y[1]],O=e.race[y[2]],A=new(2===r(S,"buildClass",0)?p.EveSpaceObject:d.EveShip),P=function(t,i,n){var a={patterns:[],layers:[]};if("pattern"in n){for(var s={},o=0;o<e.pattern.length;++o)if(e.pattern[o].name===n.pattern[0]){s=e.pattern[o];break}var l=r(s,"layer1",null);l&&a.layers.push(l),(l=r(s,"layer2",null))&&a.layers.push(l);for(var c=r(s,"projections",[]),u=0;u<c.length;++u)c[u].name===t.name&&(s=c[u],(l=r(s,"transformLayer1",null))&&a.patterns.push(l),(l=r(s,"transformLayer2",null))&&a.patterns.push(l))}else r(t,"defaultPattern")&&(s=r(t,"defaultPattern",{}),(l=r(s,"transformLayer1",null))&&a.patterns.push(l),(l=r(s,"transformLayer2",null))&&a.patterns.push(l),s=r(i,"defaultPattern",{}),(l=r(s,"layer1",null))&&a.layers.push(l),(l=r(s,"layer2",null))&&a.layers.push(l));return a}(S,O,b);!function(e,t,i,a,s,o){var l=new n.Tw2Mesh;l.geometryResPath=t.geometryResFilePath,e.boundingSphereCenter[0]=t.boundingSphere[0],e.boundingSphereCenter[1]=t.boundingSphere[1],e.boundingSphereCenter[2]=t.boundingSphere[2],e.boundingSphereRadius=t.boundingSphere[3],E(r(l,"opaqueAreas",[]),"opaqueAreas",t,i,a,o,s),E(r(l,"transparentAreas",[]),"transparentAreas",t,i,a,o,s),E(r(l,"additiveAreas",[]),"additiveAreas",t,i,a,o,s),E(r(l,"decalAreas",[]),"decalAreas",t,i,a,o,s),E(r(l,"depthAreas",[]),"depthAreas",t,i,a,o,s),l.Initialize(),e.mesh=l,"shapeEllipsoidCenter"in t&&(e.shapeEllipsoidCenter=t.shapeEllipsoidCenter);"shapeEllipsoidRadius"in t&&(e.shapeEllipsoidRadius=t.shapeEllipsoidRadius)}(A,S,w,O,b,P),function(e,t){for(var n=0;n<t.patterns.length;++n)if(t.patterns[n]&&t.layers[n]){var a=t.patterns[n],s=t.layers[n];e.AddCustomMask(r(a,"position",i.vec3.create()),r(a,"scaling",i.vec3.fromValues(1,1,1)),r(a,"rotation",i.quat.create()),r(a,"isMirrored",!1),r(s,"materialSource",0),i.vec4.fromValues(r(s,"isTargetMtl1",!0)?1:0,r(s,"isTargetMtl2",!0)?1:0,r(s,"isTargetMtl3",!0)?1:0,r(s,"isTargetMtl4",!0)?1:0))}}(A,P),function(t,a,s){for(var o=r(a,"hullDecals",[]),l=0;l<o.length;++l){var c=o[l],h=null,f="group"+r(c,"groupIndex",-1);if(s.decals&&f in s.decals&&(h=s.decals[f]),!h||h.isVisible){var p=new n.Tw2Effect;if(h&&h.shader&&h.shader.length)p.effectFilePath=e.generic.decalShaderLocation+"/"+v(!1)+h.shader;else{if(!c.shader||!c.shader.length)continue;p.effectFilePath=e.generic.decalShaderLocation+"/"+v(!1)+c.shader}var d=r(c,"parameters",{});for(var m in d)d.hasOwnProperty(m)&&(p.parameters[m]=new n.Tw2Vector4Parameter(m,d[m]));var y=r(c,"textures",{});for(m in y)y.hasOwnProperty(m)&&(p.parameters[m]=new n.Tw2TextureParameter(m,y[m]));if(h){var b=r(h,"parameters",{});for(m in b)b.hasOwnProperty(m)&&(p.parameters[m]=new n.Tw2Vector4Parameter(m,b[m]));var g=r(h,"textures",{});for(m in g)!g.hasOwnProperty(m)||m in p.parameters||(p.parameters[m]=new n.Tw2TextureParameter(m,g[m]))}var _=r(r(e.generic.decalShaders,c.shader,{}),"defaultTextures",{});for(var E in _)_.hasOwnProperty(E)&&(E in p.parameters||(p.parameters[E]=new n.Tw2TextureParameter(E,_[E])));p.Initialize();var T=new u.EveSpaceObjectDecal;i.vec3.copy(T.position,r(c,"position",[0,0,0])),i.quat.copy(T.rotation,r(c,"rotation",[0,0,0,1])),i.vec3.copy(T.scaling,r(c,"scaling",[1,1,1])),T.parentBoneIndex=r(c,"boneIndex",-1),T.indexBuffer=new Uint16Array(c.indexBuffer),T.decalEffect=p,T.name=r(o[l],"name",""),"groupIndex"in o[l]&&(T.groupIndex=o[l].groupIndex),T.Initialize(),t.decals.push(T)}}}(A,S,w),function(e,n,a){for(var s=r(n,"spriteSets",[]),o=r(a,"spriteSets",{}),l=0;l<s.length;++l){var c=new f.EveSpriteSet(!0,!(!n.isSkinned||!s[l].skinned));c.name=r(s[l],"name",""),c.effect=t;for(var u=r(s[l],"items",[]),h=0;h<u.length;++h)if("group"+r(u[h],"groupIndex",-1)in o){var p=new f.EveSpriteSetItem;p.blinkPhase=r(u[h],"blinkPhase",0),p.blinkRate=r(u[h],"blinkRate",.1),p.boneIndex=r(u[h],"boneIndex",0),p.falloff=r(u[h],"falloff",0),p.maxScale=r(u[h],"maxScale",10),p.minScale=r(u[h],"minScale",1),p.name=r(u[h],"name",""),p.groupIndex=r(u[h],"groupIndex",-1),i.vec3.copy(p.position,r(u[h],"position",[0,0,0]));var d=o["group"+p.groupIndex];d&&(p.groupName=d.name,"color"in d&&i.vec4.copy(p.color,d.color)),c.sprites.push(p)}c.Initialize(),e.spriteSets.push(c)}}(A,S,w),function(e,t,a){for(var s=r(t,"spotlightSets",[]),o=r(a,"spotlightSets",{}),l=0;l<s.length;++l){var c=new h.EveSpotlightSet;c.name=r(s[l],"name",""),c.coneEffect=new n.Tw2Effect,c.glowEffect=new n.Tw2Effect,s[l].skinned?(c.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightcone.fx",c.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightglow.fx"):(c.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightcone.fx",c.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightglow.fx"),c.coneEffect.parameters.TextureMap=new n.Tw2TextureParameter("TextureMap",s[l].coneTextureResPath),c.glowEffect.parameters.TextureMap=new n.Tw2TextureParameter("TextureMap",s[l].glowTextureResPath),c.coneEffect.parameters.zOffset=new n.Tw2FloatParameter("zOffset",r(s[l],"zOffset",0)),c.coneEffect.Initialize(),c.glowEffect.Initialize();for(var u=r(s[l],"items",[]),f=0;f<u.length;++f){var p=new h.EveSpotlightSetItem;p.name=r(u[f],"name",""),p.groupIndex=r(u[f],"groupIndex",-1),p.boneIndex=r(u[f],"boneIndex",0),p.boosterGainInfluence=r(u[f],"boosterGainInfluence",0),p.coneIntensity=r(u[f],"coneIntensity",0),p.spriteIntensity=r(u[f],"spriteIntensity",0),p.flareIntensity=r(u[f],"flareIntensity",0);var d=o["group"+p.groupIndex];d&&(i.vec4.copy(p.coneColor,r(d,"coneColor",[0,0,0,0])),i.vec4.copy(p.spriteColor,r(d,"spriteColor",[0,0,0,0])),i.vec4.copy(p.flareColor,r(d,"flareColor",[0,0,0,0]))),i.vec3.copy(p.spriteScale,r(u[f],"spriteScale",[1,1,1])),"transform"in u[f]?i.mat4.copy(p.transform,u[f].transform):i.mat4.identity(p.transform),c.spotlightItems.push(p)}c.Initialize(),e.spotlightSets.push(c)}}(A,S,w),function(e,t,a){for(var s=r(t,"planeSets",[]),o=r(a,"planeSets",{}),l=0;l<s.length;++l){var u=new c.EvePlaneSet;u.name=r(s[l],"name",""),u.effect=new n.Tw2Effect,s[l].skinned?u.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_planeglow.fx":u.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/planeglow.fx",u.effect.parameters.Layer1Map=new n.Tw2TextureParameter("Layer1Map",s[l].layer1MapResPath),u.effect.parameters.Layer2Map=new n.Tw2TextureParameter("Layer2Map",s[l].layer2MapResPath),u.effect.parameters.MaskMap=new n.Tw2TextureParameter("MaskMap",s[l].maskMapResPath),u.effect.parameters.PlaneData=new n.Tw2Vector4Parameter("PlaneData",r(s[l],"planeData",[1,0,0,0])),u.effect.Initialize();for(var h=r(s[l],"items",[]),f=0;f<h.length;++f){var p=new c.EvePlaneSetItem;T(p,h[f],"groupIndex"),T(p,h[f],"name"),p.boneIndex=r(h[f],"boneIndex",-1),p.maskAtlasID=r(h[f],"maskMapAtlasIndex",0),i.vec3.copy(p.position,r(h[f],"position",[0,0,0])),i.quat.copy(p.rotation,r(h[f],"rotation",[0,0,0,1])),i.vec3.copy(p.scaling,r(h[f],"scaling",[1,1,1])),i.vec4.copy(p.color,r(h[f],"color",[0,0,0,0])),i.vec4.copy(p.layer1Transform,r(h[f],"layer1Transform",[0,0,0,0])),i.vec4.copy(p.layer1Scroll,r(h[f],"layer1Scroll",[0,0,0,0])),i.vec4.copy(p.layer2Transform,r(h[f],"layer2Transform",[0,0,0,0])),i.vec4.copy(p.layer2Scroll,r(h[f],"layer2Scroll",[0,0,0,0]));var d=o["group"+r(h[f],"groupIndex",-1)];d&&i.vec4.copy(p.color,r(d,"color",[0,0,0,0])),u.planes.push(p)}u.Initialize(),e.planeSets.push(u)}}(A,S,w),function(e,t,a){if(!("booster"in t))return;var o=new s.EveBoosterSet,c=t.booster,u=r(a,"booster",{});T(o,u,"glowScale"),T(o,u,"symHaloScale"),T(o,u,"haloScaleX"),T(o,u,"haloScaleY"),T(o,u,"haloColor"),i.vec4.copy(o.glowColor,r(u,"glowColor",[0,0,0,0])),i.vec4.copy(o.warpGlowColor,r(u,"warpGlowColor",[0,0,0,0])),i.vec4.copy(o.warpHaloColor,r(u,"warpHalpColor",[0,0,0,0])),i.vec4.copy(o.trailColor,r(u,"trailColor",[0,0,0,0])),i.vec4.copy(o.trailSize,r(u,"trailSize",[0,0,0,0])),o.effect=new n.Tw2Effect,o.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterVolumetric.fx",o.effect.parameters.NoiseFunction0=new n.Tw2FloatParameter("NoiseFunction0",r(u.shape0,"noiseFunction",0)),o.effect.parameters.NoiseSpeed0=new n.Tw2FloatParameter("NoiseSpeed0",r(u.shape0,"noiseSpeed",0)),o.effect.parameters.NoiseAmplitudeStart0=new n.Tw2Vector4Parameter("NoiseAmplitudeStart0",r(u.shape0,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.NoiseAmplitudeEnd0=new n.Tw2Vector4Parameter("NoiseAmplitudeEnd0",r(u.shape0,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.NoiseFrequency0=new n.Tw2Vector4Parameter("NoiseFrequency0",r(u.shape0,"noiseFrequency",[0,0,0,0])),o.effect.parameters.Color0=new n.Tw2Vector4Parameter("Color0",r(u.shape0,"color",[0,0,0,0])),o.effect.parameters.NoiseFunction1=new n.Tw2FloatParameter("NoiseFunction1",r(u.shape1,"noiseFunction",0)),o.effect.parameters.NoiseSpeed1=new n.Tw2FloatParameter("NoiseSpeed1",r(u.shape1,"noiseSpeed",0)),o.effect.parameters.NoiseAmplitudeStart1=new n.Tw2Vector4Parameter("NoiseAmplitudeStart1",r(u.shape1,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.NoiseAmplitudeEnd1=new n.Tw2Vector4Parameter("NoiseAmplitudeEnd1",r(u.shape1,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.NoiseFrequency1=new n.Tw2Vector4Parameter("NoiseFrequency1",r(u.shape1,"noiseFrequency",[0,0,0,0])),o.effect.parameters.Color1=new n.Tw2Vector4Parameter("Color1",r(u.shape1,"color",[0,0,0,0])),o.effect.parameters.WarpNoiseFunction0=new n.Tw2FloatParameter("WarpNoiseFunction0",r(u.warpShape0,"noiseFunction",0)),o.effect.parameters.WarpNoiseSpeed0=new n.Tw2FloatParameter("WarpNoiseSpeed0",r(u.warpShape0,"noiseSpeed",0)),o.effect.parameters.WarpNoiseAmplitudeStart0=new n.Tw2Vector4Parameter("WarpNoiseAmplitudeStart0",r(u.warpShape0,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.WarpNoiseAmplitudeEnd0=new n.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd0",r(u.warpShape0,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.WarpNoiseFrequency0=new n.Tw2Vector4Parameter("WarpNoiseFrequency0",r(u.warpShape0,"noiseFrequency",[0,0,0,0])),o.effect.parameters.WarpColor0=new n.Tw2Vector4Parameter("WarpColor0",r(u.warpShape0,"color",[0,0,0,0])),o.effect.parameters.WarpNoiseFunction1=new n.Tw2FloatParameter("WarpNoiseFunction1",r(u.warpShape1,"noiseFunction",0)),o.effect.parameters.WarpNoiseSpeed1=new n.Tw2FloatParameter("WarpNoiseSpeed1",r(u.warpShape1,"noiseSpeed",0)),o.effect.parameters.WarpNoiseAmplitudeStart1=new n.Tw2Vector4Parameter("WarpNoiseAmplitudeStart1",r(u.warpShape1,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.WarpNoiseAmplitudeEnd1=new n.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd1",r(u.warpShape1,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.WarpNoiseFrequency1=new n.Tw2Vector4Parameter("WarpNoiseFrequency1",r(u.warpShape1,"noiseFrequency",[0,0,0,0])),o.effect.parameters.WarpColor1=new n.Tw2Vector4Parameter("WarpColor1",r(u.warpShape1,"color",[0,0,0,0])),o.effect.parameters.ShapeAtlasSize=new n.Tw2Vector4Parameter("ShapeAtlasSize",[r(u,"shapeAtlasHeight",0),r(u,"shapeAtlasCount",0),0,0]),o.effect.parameters.BoosterScale=new n.Tw2Vector4Parameter("BoosterScale",r(u,"scale",[1,1,1,1])),o.effect.parameters.ShapeMap=new n.Tw2TextureParameter("ShapeMap",u.shapeAtlasResPath),o.effect.parameters.GradientMap0=new n.Tw2TextureParameter("GradientMap0",u.gradient0ResPath),o.effect.parameters.GradientMap1=new n.Tw2TextureParameter("GradientMap1",u.gradient1ResPath),o.effect.parameters.NoiseMap=new n.Tw2TextureParameter("ShapeMap","res:/Texture/Global/noise32cube_volume.dds.0.png"),o.effect.Initialize(),o.glows=new f.EveSpriteSet(!0),o.glows.effect=new n.Tw2Effect,o.glows.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterGlowAnimated.fx",o.glows.effect.parameters.DiffuseMap=new n.Tw2TextureParameter("DiffuseMap","res:/Texture/Particle/whitesharp.dds.0.png"),o.glows.effect.parameters.NoiseMap=new n.Tw2TextureParameter("NoiseMap","res:/Texture/global/noise.dds.0.png"),o.glows.effect.Initialize();for(var h=r(c,"items",[]),p=0;p<h.length;++p){var d=new l.EveLocator;d.name="locator_booster_"+(p+1),"transform"in h[p]?i.mat4.copy(d.transform,h[p].transform):i.mat4.identity(d.transform),d.atlasIndex0=r(h[p],"atlasIndex0",0),d.atlasIndex1=r(h[p],"atlasIndex1",0),e.locators.push(d)}o.Initialize(),e.boosters=o}(A,S,O),function(e,t){for(var n=r(t,"locatorTurrets",[]),a=0;a<n.length;++a){var s=new l.EveLocator;s.name=n[a].name,"transform"in n[a]?i.mat4.copy(s.transform,n[a].transform):i.mat4.identity(s.transform),e.locators.push(s)}}(A,S);var M=function(e,t){for(var i=[],s=null,o=r(t,"animations",[]),l=0;l<o.length;++l)if(-1!==r(o[l],"id",-1)&&-1!==r(o[l],"startRate",-1)){s||(s=new n.Tw2CurveSet);var c=new a.Tw2ScalarCurve2;c.keys.push(new a.Tw2ScalarKey2),c.keys.push(new a.Tw2ScalarKey2),c.keys[0].value=r(o[l],"startRate",-1),c.keys[1].time=1,c.keys[1].value=r(o[l],"endRate",-1),c.Initialize(),s.curves.push(c),e.curveSets.push(s),i[r(o[l],"id",-1)]=c}s&&s.Initialize();return[s,i]}(A,S);return R(A,S,M[0],M[1]),function(e,t,i,a,s,l){for(var c=r(t,"instancedMeshes",[]),u=0;u<c.length;++u){var h=c[u],f=new n.Tw2InstancedMesh;f.instanceGeometryResPath=h.instanceGeometryResPath,f.geometryResPath=h.geometryResPath,f.Initialize(),E(r(f,"opaqueAreas",[]),"opaqueAreas",t,i,a,l,s,h.shader);var p=new o.EveChildMesh;p.mesh=f,e.effectChildren.push(p)}}(A,S,w,O,b,P),A.Initialize(),A}function A(t,i,n){for(var a=-1,s=0;s<e.generic.materialPrefixes.length;++s)t.substr(0,e.generic.materialPrefixes[s].length)===e.generic.materialPrefixes[s]&&(a=s,t=t.substr(e.generic.materialPrefixes[s].length));if(-1!==a){var o=r(i,"materialUsageMtl"+(a+1),a);if(o>=0&&o<e.generic.materialPrefixes.length&&(t=e.generic.materialPrefixes[o]+t)in n.parameters)return n.parameters[t]}}this.LoadData=function(r){null===e?(r&&w.push(r),S||((t=new n.Tw2Effect).effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/blinkinglightspool.fx",t.parameters.MainIntensity=new n.Tw2FloatParameter("MainIntensity",1),t.parameters.GradientMap=new n.Tw2TextureParameter("GradientMap","res:/texture/particle/whitesharp_gradient.dds.0.png"),t.Initialize(),n.resMan.GetObject("res:/dx9/model/spaceobjectfactory/data.red",function(t){e=t;for(var r=0;r<w.length;++r)w[r]();w=[]}),S=!0)):r&&r()},this.BuildFromDNA=function(t,r){if(null===e)this.LoadData(function(){var e=O(t);r&&r(e)});else{var i=O(t);r&&r(i)}};var P=[0,0,0,0];function M(e,t,r,i){switch(i){case"overridable":return t||(r||P);case"half_overridable":return e.indexOf("GlowColor")>=0?r||P:t||(r||P);case"not_overridable":case"half_overridable_2":return r||P}return P}function D(t,r,a){var s=e.faction[r],o=e.faction[a],l=null;s&&s.areas&&"hull"in s.areas&&(l=s.areas.hull);var c=null;if(o&&o.areas&&"hull"in o.areas&&(c=o.areas.hull),(l||c)&&t.turretEffect){var u=t.turretEffect.parameters;for(var h in u)if(u.hasOwnProperty(h)){if(u[h].constructor.prototype!==n.Tw2Vector4Parameter.prototype)continue;var f=null,p=null;l&&(f=A(h,s,l)),c&&(p=A(h,s,l)),i.vec4.copy(u[h].value,M(h,f,p,t.turretEffect.name))}t.turretEffect.BindParameters()}}function I(t){if("all"!==t){var r={};for(var i in e[t])e[t].hasOwnProperty(i)&&(r[i]=e[t][i].description||"");return r}return e}this.SetupTurretMaterial=function(t,r,i,n){null===e?this.LoadData(function(){D(t,r,i),n&&n()}):(D(t,r,i),n&&n())},this.GetHullNames=function(e){this.LoadData(function(){e(I("hull"))})},this.GetFactionNames=function(e){this.LoadData(function(){e(I("faction"))})},this.GetRaceNames=function(e){this.LoadData(function(){e(I("race"))})},this.GetSofData=function(e){this.LoadData(function(){e(I("all"))})}};var i=r(0),n=r(1),a=r(41),s=r(46),o=r(42),l=r(47),c=r(48),u=r(49),h=r(50),f=r(51),p=r(27),d=r(44)}])});