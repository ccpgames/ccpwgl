!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ccpwgl_int=t():e.ccpwgl_int=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=26)}([function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"GL_COLOR_BUFFER_BIT",function(){return x}),n.d(r,"GL_DEPTH_BUFFER_BIT",function(){return G}),n.d(r,"GL_STENCIL_BUFFER_BIT",function(){return j}),n.d(r,"GL_TEXTURE_2D",function(){return F}),n.d(r,"GL_TEXTURE_CUBE_MAP",function(){return L}),n.d(r,"GL_TEXTURE_3D",function(){return B}),n.d(r,"GL_TEXTURE_MAG_FILTER",function(){return U}),n.d(r,"GL_TEXTURE_MIN_FILTER",function(){return N}),n.d(r,"GL_TEXTURE_WRAP_S",function(){return V}),n.d(r,"GL_TEXTURE_WRAP_T",function(){return H}),n.d(r,"GL_BYTE",function(){return z}),n.d(r,"GL_UNSIGNED_BYTE",function(){return q}),n.d(r,"GL_SHORT",function(){return X}),n.d(r,"GL_UNSIGNED_SHORT",function(){return Y}),n.d(r,"GL_INT",function(){return W}),n.d(r,"GL_UNSIGNED_INT",function(){return K}),n.d(r,"GL_FLOAT",function(){return Q}),n.d(r,"GL_HALF_FLOAT_OES",function(){return Z}),n.d(r,"GL_HALF_FLOAT",function(){return $}),n.d(r,"GL_DEPTH_COMPONENT16",function(){return J}),n.d(r,"GL_DEPTH_COMPONENT24",function(){return ee}),n.d(r,"GL_DEPTH_COMPONENT32F",function(){return te}),n.d(r,"GL_FLOAT_VEC2",function(){return ne}),n.d(r,"GL_FLOAT_VEC3",function(){return re}),n.d(r,"GL_FLOAT_VEC4",function(){return ie}),n.d(r,"GL_INT_VEC2",function(){return oe}),n.d(r,"GL_INT_VEC3",function(){return ae}),n.d(r,"GL_INT_VEC4",function(){return se}),n.d(r,"GL_BOOL",function(){return ue}),n.d(r,"GL_BOOL_VEC2",function(){return le}),n.d(r,"GL_BOOL_VEC3",function(){return ce}),n.d(r,"GL_BOOL_VEC4",function(){return fe}),n.d(r,"GL_FLOAT_MAT2",function(){return he}),n.d(r,"GL_FLOAT_MAT3",function(){return de}),n.d(r,"GL_FLOAT_MAT4",function(){return pe}),n.d(r,"GL_TYPE_LENGTH",function(){return me}),n.d(r,"GL_SAMPLER_2D",function(){return ye}),n.d(r,"GL_SAMPLER_3D",function(){return be}),n.d(r,"GL_SAMPLER_CUBE",function(){return ve}),n.d(r,"GL_DEPTH_COMPONENT",function(){return ge}),n.d(r,"GL_ALPHA",function(){return _e}),n.d(r,"GL_RGB",function(){return we}),n.d(r,"GL_RGBA",function(){return Ee}),n.d(r,"GL_LUMINANCE",function(){return Te}),n.d(r,"GL_LUMINANCE_ALPHA",function(){return Re}),n.d(r,"GL_DEPTH_STENCIL",function(){return Se}),n.d(r,"GL_UNSIGNED_INT_24_8_WEBGL",function(){return Oe}),n.d(r,"GL_R8",function(){return Pe}),n.d(r,"GL_R16F",function(){return Ae}),n.d(r,"GL_R32F",function(){return Ie}),n.d(r,"GL_R8UI",function(){return Ce}),n.d(r,"GL_RG8",function(){return Me}),n.d(r,"GL_RG16F",function(){return De}),n.d(r,"GL_RG32F",function(){return ke}),n.d(r,"GL_RGB8",function(){return xe}),n.d(r,"GL_SRGB8",function(){return Ge}),n.d(r,"GL_RGB565",function(){return je}),n.d(r,"GL_R11F_G11F_B10F",function(){return Fe}),n.d(r,"GL_RGB9_E5",function(){return Le}),n.d(r,"GL_RGB16F",function(){return Be}),n.d(r,"GL_RGB32F",function(){return Ue}),n.d(r,"GL_RGB8UI",function(){return Ne}),n.d(r,"GL_RGBA8",function(){return Ve}),n.d(r,"GL_RGB5_A1",function(){return He}),n.d(r,"GL_RGBA16F",function(){return ze}),n.d(r,"GL_RGBA32F",function(){return qe}),n.d(r,"GL_RGBA8UI",function(){return Xe}),n.d(r,"GL_RGBA16I",function(){return Ye}),n.d(r,"GL_RGBA16UI",function(){return We}),n.d(r,"GL_RGBA32I",function(){return Ke}),n.d(r,"GL_RGBA32UI",function(){return Qe}),n.d(r,"GL_NEAREST",function(){return Ze}),n.d(r,"GL_LINEAR",function(){return $e}),n.d(r,"GL_NEAREST_MIPMAP_NEAREST",function(){return Je}),n.d(r,"GL_LINEAR_MIPMAP_NEAREST",function(){return et}),n.d(r,"GL_NEAREST_MIPMAP_LINEAR",function(){return tt}),n.d(r,"GL_LINEAR_MIPMAP_LINEAR",function(){return nt}),n.d(r,"GL_REPEAT",function(){return rt}),n.d(r,"GL_CLAMP_TO_EDGE",function(){return it}),n.d(r,"GL_MIRRORED_REPEAT",function(){return ot}),n.d(r,"GL_ZERO",function(){return at}),n.d(r,"GL_ONE",function(){return st}),n.d(r,"GL_SRC_COLOR",function(){return ut}),n.d(r,"GL_ONE_MINUS_SRC_COLOR",function(){return lt}),n.d(r,"GL_SRC_ALPHA",function(){return ct}),n.d(r,"GL_ONE_MINUS_SRC_ALPHA",function(){return ft}),n.d(r,"GL_DST_ALPHA",function(){return ht}),n.d(r,"GL_ONE_MINUS_DST_ALPHA",function(){return dt}),n.d(r,"GL_DST_COLOR",function(){return pt}),n.d(r,"GL_ONE_MINUS_DST_COLOR",function(){return mt}),n.d(r,"GL_SRC_ALPHA_SATURATE",function(){return yt}),n.d(r,"GL_CONSTANT_COLOR",function(){return bt}),n.d(r,"GL_ONE_MINUS_CONSTANT_COLOR",function(){return vt}),n.d(r,"GL_CONSTANT_ALPHA",function(){return gt}),n.d(r,"GL_ONE_MINUS_CONSTANT_ALPHA",function(){return _t}),n.d(r,"GL_VERTEX_SHADER",function(){return wt}),n.d(r,"GL_FRAGMENT_SHADER",function(){return Et}),n.d(r,"GL_FRONT",function(){return Tt}),n.d(r,"GL_BACK",function(){return Rt}),n.d(r,"GL_FRONT_AND_BACK",function(){return St}),n.d(r,"GL_NEVER",function(){return Ot}),n.d(r,"GL_LESS",function(){return Pt}),n.d(r,"GL_EQUAL",function(){return At}),n.d(r,"GL_LEQUAL",function(){return It}),n.d(r,"GL_GREATER",function(){return Ct}),n.d(r,"GL_NOTEQUAL",function(){return Mt}),n.d(r,"GL_GEQUAL",function(){return Dt}),n.d(r,"GL_ALWAYS",function(){return kt}),n.d(r,"GL_KEEP",function(){return xt}),n.d(r,"GL_REPLACE",function(){return Gt}),n.d(r,"GL_INCR",function(){return jt}),n.d(r,"GL_DECR",function(){return Ft}),n.d(r,"GL_INCR_WRAP",function(){return Lt}),n.d(r,"GL_DECR_WRAP",function(){return Bt}),n.d(r,"GL_INVERT",function(){return Ut}),n.d(r,"GL_STREAM_DRAW",function(){return Nt}),n.d(r,"GL_STATIC_DRAW",function(){return Vt}),n.d(r,"GL_DYNAMIC_DRAW",function(){return Ht}),n.d(r,"GL_ARRAY_BUFFER",function(){return zt}),n.d(r,"GL_ELEMENT_ARRAY_BUFFER",function(){return qt}),n.d(r,"GL_POINTS",function(){return Xt}),n.d(r,"GL_LINES",function(){return Yt}),n.d(r,"GL_LINE_LOOP",function(){return Wt}),n.d(r,"GL_LINE_STRIP",function(){return Kt}),n.d(r,"GL_TRIANGLES",function(){return Qt}),n.d(r,"GL_TRIANGLE_STRIP",function(){return Zt}),n.d(r,"GL_TRIANGLE_FAN",function(){return $t}),n.d(r,"GL_CW",function(){return Jt}),n.d(r,"GL_CCW",function(){return en}),n.d(r,"GL_CULL_FACE",function(){return tn}),n.d(r,"GL_DEPTH_TEST",function(){return nn}),n.d(r,"GL_BLEND",function(){return rn}),n.d(r,"RM_ANY",function(){return on}),n.d(r,"RM_OPAQUE",function(){return an}),n.d(r,"RM_DECAL",function(){return sn}),n.d(r,"RM_TRANSPARENT",function(){return un}),n.d(r,"RM_ADDITIVE",function(){return ln}),n.d(r,"RM_DEPTH",function(){return cn}),n.d(r,"RM_FULLSCREEN",function(){return fn}),n.d(r,"RM_PICKABLE",function(){return hn}),n.d(r,"RM_DISTORTION",function(){return dn}),n.d(r,"RS_ZENABLE",function(){return pn}),n.d(r,"RS_FILLMODE",function(){return mn}),n.d(r,"RS_SHADEMODE",function(){return yn}),n.d(r,"RS_ZWRITEENABLE",function(){return bn}),n.d(r,"RS_ALPHATESTENABLE",function(){return vn}),n.d(r,"RS_LASTPIXEL",function(){return gn}),n.d(r,"RS_SRCBLEND",function(){return _n}),n.d(r,"RS_DESTBLEND",function(){return wn}),n.d(r,"RS_CULLMODE",function(){return En}),n.d(r,"RS_ZFUNC",function(){return Tn}),n.d(r,"RS_ALPHAREF",function(){return Rn}),n.d(r,"RS_ALPHAFUNC",function(){return Sn}),n.d(r,"RS_DITHERENABLE",function(){return On}),n.d(r,"RS_ALPHABLENDENABLE",function(){return Pn}),n.d(r,"RS_FOGENABLE",function(){return An}),n.d(r,"RS_SPECULARENABLE",function(){return In}),n.d(r,"RS_FOGCOLOR",function(){return Cn}),n.d(r,"RS_FOGTABLEMODE",function(){return Mn}),n.d(r,"RS_FOGSTART",function(){return Dn}),n.d(r,"RS_FOGEND",function(){return kn}),n.d(r,"RS_FOGDENSITY",function(){return xn}),n.d(r,"RS_RANGEFOGENABLE",function(){return Gn}),n.d(r,"RS_STENCILENABLE",function(){return jn}),n.d(r,"RS_STENCILFAIL",function(){return Fn}),n.d(r,"RS_STENCILZFAIL",function(){return Ln}),n.d(r,"RS_STENCILPASS",function(){return Bn}),n.d(r,"RS_STENCILFUNC",function(){return Un}),n.d(r,"RS_STENCILREF",function(){return Nn}),n.d(r,"RS_STENCILMASK",function(){return Vn}),n.d(r,"RS_STENCILWRITEMASK",function(){return Hn}),n.d(r,"RS_TEXTUREFACTOR",function(){return zn}),n.d(r,"RS_WRAP0",function(){return qn}),n.d(r,"RS_WRAP1",function(){return Xn}),n.d(r,"RS_WRAP2",function(){return Yn}),n.d(r,"RS_WRAP3",function(){return Wn}),n.d(r,"RS_WRAP4",function(){return Kn}),n.d(r,"RS_WRAP5",function(){return Qn}),n.d(r,"RS_WRAP6",function(){return Zn}),n.d(r,"RS_WRAP7",function(){return $n}),n.d(r,"RS_CLIPPING",function(){return Jn}),n.d(r,"RS_LIGHTING",function(){return er}),n.d(r,"RS_AMBIENT",function(){return tr}),n.d(r,"RS_FOGVERTEXMODE",function(){return nr}),n.d(r,"RS_COLORVERTEX",function(){return rr}),n.d(r,"RS_LOCALVIEWER",function(){return ir}),n.d(r,"RS_NORMALIZENORMALS",function(){return or}),n.d(r,"RS_DIFFUSEMATERIALSOURCE",function(){return ar}),n.d(r,"RS_SPECULARMATERIALSOURCE",function(){return sr}),n.d(r,"RS_AMBIENTMATERIALSOURCE",function(){return ur}),n.d(r,"RS_EMISSIVEMATERIALSOURCE",function(){return lr}),n.d(r,"RS_VERTEXBLEND",function(){return cr}),n.d(r,"RS_CLIPPLANEENABLE",function(){return fr}),n.d(r,"RS_POINTSIZE",function(){return hr}),n.d(r,"RS_POINTSIZE_MIN",function(){return dr}),n.d(r,"RS_POINTSPRITEENABLE",function(){return pr}),n.d(r,"RS_POINTSCALEENABLE",function(){return mr}),n.d(r,"RS_POINTSCALE_A",function(){return yr}),n.d(r,"RS_POINTSCALE_B",function(){return br}),n.d(r,"RS_POINTSCALE_C",function(){return vr}),n.d(r,"RS_MULTISAMPLEANTIALIAS",function(){return gr}),n.d(r,"RS_MULTISAMPLEMASK",function(){return _r}),n.d(r,"RS_PATCHEDGESTYLE",function(){return wr}),n.d(r,"RS_DEBUGMONITORTOKEN",function(){return Er}),n.d(r,"RS_POINTSIZE_MAX",function(){return Tr}),n.d(r,"RS_INDEXEDVERTEXBLENDENABLE",function(){return Rr}),n.d(r,"RS_COLORWRITEENABLE",function(){return Sr}),n.d(r,"RS_TWEENFACTOR",function(){return Or}),n.d(r,"RS_BLENDOP",function(){return Pr}),n.d(r,"RS_POSITIONDEGREE",function(){return Ar}),n.d(r,"RS_NORMALDEGREE",function(){return Ir}),n.d(r,"RS_SCISSORTESTENABLE",function(){return Cr}),n.d(r,"RS_SLOPESCALEDEPTHBIAS",function(){return Mr}),n.d(r,"RS_ANTIALIASEDLINEENABLE",function(){return Dr}),n.d(r,"RS_TWOSIDEDSTENCILMODE",function(){return kr}),n.d(r,"RS_CCW_STENCILFAIL",function(){return xr}),n.d(r,"RS_CCW_STENCILZFAIL",function(){return Gr}),n.d(r,"RS_CCW_STENCILPASS",function(){return jr}),n.d(r,"RS_CCW_STENCILFUNC",function(){return Fr}),n.d(r,"RS_COLORWRITEENABLE1",function(){return Lr}),n.d(r,"RS_COLORWRITEENABLE2",function(){return Br}),n.d(r,"RS_COLORWRITEENABLE3",function(){return Ur}),n.d(r,"RS_BLENDFACTOR",function(){return Nr}),n.d(r,"RS_SRGBWRITEENABLE",function(){return Vr}),n.d(r,"RS_DEPTHBIAS",function(){return Hr}),n.d(r,"RS_SEPARATEALPHABLENDENABLE",function(){return zr}),n.d(r,"RS_SRCBLENDALPHA",function(){return qr}),n.d(r,"RS_DESTBLENDALPHA",function(){return Xr}),n.d(r,"RS_BLENDOPALPHA",function(){return Yr}),n.d(r,"CULL_NONE",function(){return Wr}),n.d(r,"CULL_CW",function(){return Kr}),n.d(r,"CULL_CCW",function(){return Qr}),n.d(r,"CMP_NEVER",function(){return Zr}),n.d(r,"CMP_LESS",function(){return $r}),n.d(r,"CMP_EQUAL",function(){return Jr}),n.d(r,"CMP_LEQUAL",function(){return ei}),n.d(r,"CMP_GREATER",function(){return ti}),n.d(r,"CMP_NOTEQUAL",function(){return ni}),n.d(r,"CMP_GREATEREQUAL",function(){return ri}),n.d(r,"CMP_ALWAYS",function(){return ii}),n.d(r,"BLEND_ZERO",function(){return oi}),n.d(r,"BLEND_ONE",function(){return ai}),n.d(r,"BLEND_SRCCOLOR",function(){return si}),n.d(r,"BLEND_INVSRCCOLOR",function(){return ui}),n.d(r,"BLEND_SRCALPHA",function(){return li}),n.d(r,"BLEND_INVSRCALPHA",function(){return ci}),n.d(r,"BLEND_DESTALPHA",function(){return fi}),n.d(r,"BLEND_INVDESTALPHA",function(){return hi}),n.d(r,"BLEND_DESTCOLOR",function(){return di}),n.d(r,"BLEND_INVDESTCOLOR",function(){return pi}),n.d(r,"BLEND_SRCALPHASAT",function(){return mi}),n.d(r,"BLEND_BOTHSRCALPHA",function(){return yi}),n.d(r,"BLEND_BOTHINVSRCALPHA",function(){return bi}),n.d(r,"BLEND_BLENDFACTOR",function(){return vi}),n.d(r,"BLEND_INVBLENDFACTOR",function(){return gi}),n.d(r,"BLENDOP_ADD",function(){return _i}),n.d(r,"BLENDOP_SUBTRACT",function(){return wi}),n.d(r,"BLENDOP_REVSUBTRACT",function(){return Ei}),n.d(r,"BLENDOP_MIN",function(){return Ti}),n.d(r,"BLENDOP_MAX",function(){return Ri}),n.d(r,"TF_ALPHA",function(){return Si}),n.d(r,"TF_LUMINANCE",function(){return Oi}),n.d(r,"TF_LUMINANCE_ALPHA",function(){return Pi}),n.d(r,"TF_RGB",function(){return Ai}),n.d(r,"TF_RGBA",function(){return Ii}),n.d(r,"TF_RED",function(){return Ci}),n.d(r,"TF_R",function(){return Mi}),n.d(r,"TF_RG",function(){return Di}),n.d(r,"TF_RED_INTEGER",function(){return ki}),n.d(r,"TF_R_INTEGER",function(){return xi}),n.d(r,"TF_RG_INTEGER",function(){return Gi}),n.d(r,"TF_RGB_INTEGER",function(){return ji}),n.d(r,"TF_RGBA_INTEGER",function(){return Fi}),n.d(r,"TT_UNSIGNED_BYTE",function(){return Li}),n.d(r,"TT_UNSIGNED_INT",function(){return Bi}),n.d(r,"TT_FLOAT",function(){return Ui}),n.d(r,"TT_HALF_FLOAT",function(){return Ni}),n.d(r,"TT_BYTE",function(){return Vi}),n.d(r,"TT_SHORT",function(){return Hi}),n.d(r,"TT_UNSIGNED_SHORT",function(){return zi}),n.d(r,"TT_INT",function(){return qi}),n.d(r,"TT_UNSIGNED_INTEGER",function(){return Xi}),n.d(r,"TT_UNSIGNED_SHORT_4_4_4_4",function(){return Yi}),n.d(r,"TT_UNSIGNED_SHORT_5_5_5_1",function(){return Wi}),n.d(r,"TT_UNSIGNED_SHORT_5_6_5",function(){return Ki}),n.d(r,"TT_UNSIGNED_INT_2_10_10_10_REV",function(){return Qi}),n.d(r,"TT_UNSIGNED_INT_24_8",function(){return Zi}),n.d(r,"TT_UNSIGNED_INT_10F_11F_11F_REV",function(){return $i}),n.d(r,"TT_UNSIGNED_INT_5_9_9_9_REV",function(){return Ji}),n.d(r,"TT_FLOAT_32_UNSIGNED_INT_24_8_REV",function(){return eo}),n.d(r,"WrapModes",function(){return to}),n.d(r,"BlendTable",function(){return no}),n.d(r,"FilterMode",function(){return ro}),n.d(r,"MipFilterMode",function(){return io}),n.d(r,"DDS_MAGIC",function(){return oo}),n.d(r,"DDSD_CAPS",function(){return ao}),n.d(r,"DDSD_HEIGHT",function(){return so}),n.d(r,"DDSD_WIDTH",function(){return uo}),n.d(r,"DDSD_PITCH",function(){return lo}),n.d(r,"DDSD_PIXELFORMAT",function(){return co}),n.d(r,"DDSD_MIPMAPCOUNT",function(){return fo}),n.d(r,"DDSD_LINEARSIZE",function(){return ho}),n.d(r,"DDSD_DEPTH",function(){return po}),n.d(r,"DDSCAPS_COMPLEX",function(){return mo}),n.d(r,"DDSCAPS_MIPMAP",function(){return yo}),n.d(r,"DDSCAPS_TEXTURE",function(){return bo}),n.d(r,"DDSCAPS2_CUBEMAP",function(){return vo}),n.d(r,"DDSCAPS2_CUBEMAP_POSITIVEX",function(){return go}),n.d(r,"DDSCAPS2_CUBEMAP_NEGATIVEX",function(){return _o}),n.d(r,"DDSCAPS2_CUBEMAP_POSITIVEY",function(){return wo}),n.d(r,"DDSCAPS2_CUBEMAP_NEGATIVEY",function(){return Eo}),n.d(r,"DDSCAPS2_CUBEMAP_POSITIVEZ",function(){return To}),n.d(r,"DDSCAPS2_CUBEMAP_NEGATIVEZ",function(){return Ro}),n.d(r,"DDSCAPS2_VOLUME",function(){return So}),n.d(r,"DDPF_ALPHAPIXELS",function(){return Oo}),n.d(r,"DDPF_ALPHA",function(){return Po}),n.d(r,"DDPF_FOURCC",function(){return Ao}),n.d(r,"DDPF_RGB",function(){return Io}),n.d(r,"DDPF_YUV",function(){return Co}),n.d(r,"DDPF_LUMINANCE",function(){return Mo}),n.d(r,"DDS_HEADER_LENGTH_INT",function(){return Do}),n.d(r,"DDS_HEADER_OFFSET_MAGIC",function(){return ko}),n.d(r,"DDS_HEADER_OFFSET_SIZE",function(){return xo}),n.d(r,"DDS_HEADER_OFFSET_FLAGS",function(){return Go}),n.d(r,"DDS_HEADER_OFFSET_HEIGHT",function(){return jo}),n.d(r,"DDS_HEADER_OFFSET_WIDTH",function(){return Fo}),n.d(r,"DDS_HEADER_OFFSET_MIPMAP_COUNT",function(){return Lo}),n.d(r,"DDS_HEADER_OFFSET_PF_FLAGS",function(){return Bo}),n.d(r,"DDS_HEADER_OFFSET_PF_FOURCC",function(){return Uo}),n.d(r,"DDS_HEADER_OFFSET_RGB_BPP",function(){return No}),n.d(r,"DDS_HEADER_OFFSET_R_MASK",function(){return Vo}),n.d(r,"DDS_HEADER_OFFSET_G_MASK",function(){return Ho}),n.d(r,"DDS_HEADER_OFFSET_B_MASK",function(){return zo}),n.d(r,"DDS_HEADER_OFFSET_A_MASK",function(){return qo}),n.d(r,"DDS_HEADER_OFFSET_CAPS1",function(){return Xo}),n.d(r,"DDS_HEADER_OFFSET_CAPS2",function(){return Yo}),n.d(r,"DDS_HEADER_OFFSET_CAPS3",function(){return Wo}),n.d(r,"DDS_HEADER_OFFSET_CAPS4",function(){return Ko}),n.d(r,"DDS_HEADER_OFFSET_DXGI_FORMAT",function(){return Qo}),n.d(r,"FOURCC_DXT1",function(){return Zo}),n.d(r,"FOURCC_DXT5",function(){return $o}),n.d(r,"FOURCC_DXT3",function(){return Jo}),n.d(r,"FOURCC_DXT10",function(){return ea}),n.d(r,"FOURCC_D3DFMT_R16G16B16A16F",function(){return ta}),n.d(r,"FOURCC_D3DFMT_R32G32B32A32F",function(){return na}),n.d(r,"DXGI_FORMAT_R16G16B16A16_FLOAT",function(){return ra}),n.d(r,"DXGI_FORMAT_B8G8R8X8_UNORM",function(){return ia}),n.d(r,"VendorRequestAnimationFrame",function(){return oa}),n.d(r,"VendorCancelAnimationFrame",function(){return aa}),n.d(r,"VendorRequestFullScreen",function(){return sa}),n.d(r,"VendorExitFullScreen",function(){return ua}),n.d(r,"VendorGetFullScreenElement",function(){return la}),n.d(r,"VendorWebglPrefixes",function(){return ca}),n.d(r,"WebglContextNames",function(){return fa}),n.d(r,"Webgl2ContextNames",function(){return ha}),n.d(r,"WebglVersion",function(){return da});var i=n(4),o=n(3),a=n(10);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=u(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?c(n):r,f(c(c(e)),"name",""),f(c(c(e)),"display",!0),f(c(c(e)),"visible",{log:!0,info:!0,debug:!0,warn:!0,error:!0}),f(c(c(e)),"history",100),f(c(c(e)),"throttle",20),f(c(c(e)),"_logs",[]),f(c(c(e)),"_throttled",null),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a["a"]),n=t,(r=[{key:"Set",value:function(e){e&&(Object(o.assignIfExists)(this,e,["name","display","history","throttle"]),Object(o.assignIfExists)(this.visible,e.visible,["log","info","debug","warn","error"]))}},{key:"log",value:function(e){if(e._logged)return e;Object(o.isError)(e)&&(e={err:e}),e.err?(e.type="error",e.name||(e.name=e.err.name),e.message||(e.message=e.err.message)):(e.type=t.LogType[e.type?e.type.toUpperCase():"LOG"]||"log",e.message=e.message||"");let n=e.name||this.constructor.category;if(n=(n=n.replace(/_/g," ")).charAt(0).toUpperCase()+n.slice(1),e.name=n,this.display&&this.visible[e.type]||(e.hide=!0),this.throttle){if(!e.hide){this._throttled||(this._throttled={}),this._throttled[e.type]||(this._throttled[e.type]=[]);const t=this._throttled[e.type];t.includes(e.message)?e.hide=!0:(t.unshift(e.message),t.splice(this.throttle))}}else this._throttled=null;if(!e.hide){let t=`${this.name} ${e.name}:`;e.err||e.data?(console.group(t,e.message),e.err&&console.debug(e.err.stack||e.err.toString()),e.data&&console.debug(JSON.stringify(e.data,null,4)),console.groupEnd()):console[e.type](t,e.message)}return this.history?(this._logs.unshift(e),this._logs.splice(this.history)):this._logs=[],e._logged=!0,this.emit(e.type,e),e}}])&&s(n.prototype,r),i&&s(n,i),t}();f(h,"LogType",{ERROR:"error",WARNING:"warn",INFO:"info",LOG:"log",DEBUG:"debug"}),f(h,"category","logger");const d=new h;function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}a.a.defaultLogger=d;let m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loadedObjects={},this._errors={}}var t,n,r;return t=e,(n=[{key:"AddError",value:function(e,t){return this._errors[e]=this._errors[e]||[],this._errors[e].includes(t)||(t.data=t.data||{},t.data.path=t.data.path||e,this._errors[e].push(t)),t}},{key:"GetErrors",value:function(e){return e&&e in this._errors?Object.assign([],this._errors[e]):null}},{key:"HasErrors",value:function(e){return e&&e in this._errors}},{key:"Find",value:function(e){return e in this._loadedObjects?this._loadedObjects[e]:null}},{key:"Add",value:function(e,t){this._loadedObjects[e]=t}},{key:"Remove",value:function(e){delete this._loadedObjects[e]}},{key:"Clear",value:function(){this._loadedObjects={}}},{key:"UnloadAndClear",value:function(){for(const e in this._loadedObjects)this._loadedObjects.hasOwnProperty(e)&&this._loadedObjects[e].Unload();this._loadedObjects={}}},{key:"PurgeInactive",value:function(e,t,n){for(const r in this._loadedObjects)if(this._loadedObjects.hasOwnProperty(r)){const i=this._loadedObjects[r];i.doNotPurge||(i.IsPurged()&&(i.OnUnloaded(),this.Remove(r)),i._isGood&&(e-i.activeFrame)%t>=n&&i.Unload()&&(i.OnUnloaded(),this.Remove(r)))}}}])&&p(t.prototype,n),r&&p(t,r),e}();var y=n(15),b=n(1);function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let T=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=g(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?w(n):r,E(w(w(e)),"motherLode",new m),E(w(w(e)),"systemMirror",!1),E(w(w(e)),"maxPrepareTime",.05),E(w(w(e)),"autoPurgeResources",!0),E(w(w(e)),"activeFrame",0),E(w(w(e)),"purgeTime",30),E(w(w(e)),"_prepareBudget",0),E(w(w(e)),"_prepareQueue",[]),E(w(w(e)),"_purgeTime",0),E(w(w(e)),"_purgeFrame",0),E(w(w(e)),"_purgeFrameLimit",1e3),E(w(w(e)),"_pendingLoads",0),E(w(w(e)),"_noLoadFrames",0),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,a["a"]),n=t,i=[{key:"NormalizePath",value:function(e){return"str:/"===e.substr(0,5)?e:((e=e.toLowerCase()).replace("\\","/"),e)}},{key:"GetPathExt",value:function(e){if("str:/"===e.substr(0,5)){const t=e.indexOf("/",5);return-1===t?null:e.substr(5,t-5)}{const t=e.lastIndexOf(".");return-1===t?null:e.substr(t+1)}}},{key:"LoadResource",value:function(e,n){const r=n.path,i=e.BuildUrl(r);if(e.motherLode.Add(r,n),n.DoCustomLoad&&n.DoCustomLoad(i,t.GetPathExt(i)))return n;const o=t.CreateHttpRequest(n);o.onreadystatechange=t.DoLoadResource(e,n),o.open("GET",i);try{o.send(),e._pendingLoads++,n.OnRequested()}catch(e){throw new b.ErrHTTPRequestSend({path:r})}return n}},{key:"DoLoadResource",value:function(e,t){const n=t.path;return function(){let r=0;try{r=this.readyState}catch(r){return e._pendingLoads--,void t.OnError(new b.ErrHTTPReadyState({path:n}))}if(4===r){const r=this.status;if(200===r){let n=null,r=null;try{n=this.responseText,r=this.responseXML}catch(e){n=this.response}e._prepareQueue.push([t,n,r]),t.OnLoaded()}else t.OnError(new b.ErrHTTPStatus({path:n,status:r}));e._pendingLoads--}}}},{key:"CreateHttpRequest",value:function(e){let t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(!t)throw new b.ErrHTTPInstance({path:e.path});return e.requestResponseType&&(t.responseType=e.requestResponseType),t}}],(r=[{key:"Set",value:function(e){e&&Object(o.assignIfExists)(this,e,["systemMirror","maxPrepareTime","autoPurgeResources","purgeTime"])}},{key:"OnResError",value:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.Tw2Error({path:e});e=t.NormalizePath(e);const r=this.motherLode.Find(e);return r?r.OnError(n):this.OnResEvent("error",e,{type:"error",message:n.message,err:n}),n}},{key:"OnResEvent",value:function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.DefaultLog[e.toUpperCase()];if(i){r=Object.assign({},i,r);const t={res:this.motherLode.Find(n),path:n,log:r},o=r.err;o&&(this.motherLode.AddError(n,o),t.err=o,Object.assign(t,o.data)),r.message=r.message.includes(n)?r.message:r.message+=` "${n}"`,this.emit(e.toLowerCase(),t)}}},{key:"IsLoading",value:function(){return this._noLoadFrames<2}},{key:"Clear",value:function(){this.motherLode.Clear()}},{key:"UnloadAndClear",value:function(){this.motherLode.UnloadAndClear()}},{key:"PrepareLoop",value:function(e){0===this._prepareQueue.length&&0===this._pendingLoads?this._noLoadFrames<2&&this._noLoadFrames++:this._noLoadFrames=0,this._prepareBudget=this.maxPrepareTime;const t=Date.now();for(;this._prepareQueue.length;){const e=this._prepareQueue[0][0],n=this._prepareQueue[0][1],r=this._prepareQueue[0][2];this._prepareQueue.shift();try{e.Prepare(n,r)}catch(t){e.OnError(t)}if(this._prepareBudget-=.001*(Date.now()-t),this._prepareBudget<0)break}return this._purgeTime+=e,this._purgeTime>1&&(this.activeFrame+=1,this._purgeTime-=Math.floor(this._purgeTime),this._purgeFrame+=1,this._purgeFrame>=5&&this.autoPurgeResources&&this.motherLode.PurgeInactive(this._purgeFrame,this._purgeFrameLimit,this.purgeTime)),!0}},{key:"GetResource",value:function(e){let n;if(e=t.NormalizePath(e),n=this.motherLode.Find(e))return n.IsPurged()&&n.Reload(),n;if(0===e.indexOf("dynamic:/"))return this.OnResError(e,new b.ErrFeatureNotImplemented({feature:"Dynamic resources"})),null;const r=t.GetPathExt(e);if(null===r)return this.OnResError(e,new b.ErrResourceExtensionUndefined({path:e})),null;const i=M.GetExtension(r);if(!i)return this.OnResError(e,new b.ErrResourceExtensionUnregistered({path:e,extension:r})),null;try{return(n=new i).path=e,t.LoadResource(this,n)}catch(t){return this.OnResError(e,t),null}}},{key:"GetObject",value:function(e,n,r){e=t.NormalizePath(e);let i=this.motherLode.Find(e);if(i)i.AddObject(n,r);else try{(i=new y.a).path=e,i.AddObject(n,r),t.LoadResource(this,i)}catch(t){this.OnResError(e,t)}}},{key:"ReloadResource",value:function(e){const n=e.path,r=this.motherLode.Find(n);if(r&&!r.IsPurged())return r;try{return t.LoadResource(this,e)}catch(t){return this.OnResError(n,t),e}}},{key:"BuildUrl",value:function(e){const t=e.indexOf(":/");if(-1===t)throw new b.ErrResourcePrefixUndefined({path:e});const n=e.substr(0,t);if("http"===n||"https"===n)return e;const r=M.GetPath(n);if(!r)throw new b.ErrResourcePrefixUnregistered({path:e,prefix:n});return r+e.substr(t+2)}}])&&v(n.prototype,r),i&&v(n,i),t}();E(T,"DefaultLog",{ERROR:{type:"error",message:"Uncaught error"},WARNING:{type:"warn",message:"Undefined warning"},REQUESTED:{type:"info",message:"Requested"},RELOADING:{type:"info",message:"Reloading"},LOADED:{type:"info",message:"Loaded"},PREPARED:{type:"log",message:"Prepared"},PURGED:{type:"info",message:"Purged"},UNLOADED:{type:"info",message:"Unloaded"},DEBUG:{type:"debug",message:"Debug"}}),E(T,"category","resource_manager");const R=new T;function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let C=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=O(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?A(n):r,I(A(A(e)),"_type",{}),I(A(A(e)),"_path",{}),I(A(A(e)),"_variable",{}),I(A(A(e)),"_extension",{}),I(A(A(e)),"_class",{}),I(A(A(e)),"_dynamicPath",{}),I(A(A(e)),"_schema",{}),I(A(A(e)),"_missing",{}),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,a["a"]),n=t,i=[{key:"GetStoreItem",value:function(e,t,n){const r=e["_"+t];if(r&&Object(o.isString)(n)){if(n in r)return r[n];e._missing[t]||(e._missing[t]=[]),e._missing[t].includes(n)||e._missing[t].push(n),e.emit("missing",{type:t,key:n,log:{type:"debug",message:`Missing ${t}: "${n}"`}})}return null}},{key:"SetStoreItem",value:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(i&&!i(r))return e.emit("error",{type:t,key:n,value:r,log:{type:"error",message:`Invalid ${t}: "${n}"`}}),!1;const a=e["_"+t];if(a&&Object(o.isString)(n)&&!Object(o.isUndefined)(r)){const i=a[n];return a[n]=r,e.emit("registered",{type:t,key:n,value:r,oldValue:i,log:{type:"debug",message:`${i?"Re-registered":"Registered"} ${t} "${n}"`}}),!0}return!1}},{key:"RegisterFromObject",value:function(e,t,n){if(n&&t in e){n=Object(o.toArray)(n);for(let r=0;r<n.length;r++)for(let i in n[r])n[r].hasOwnProperty(i)&&e[t](i,n[r][i]);return!0}return!1}}],(r=[{key:"HasPath",value:function(e){return e&&e in this._path}},{key:"GetPath",value:function(e){return t.GetStoreItem(this,"path",e)}},{key:"RegisterPath",value:function(e,n){return n.lastIndexOf("/")!==n.length-1&&(n+="/"),t.RestrictedPathPrefixes.includes(e)?(this.emit("error",{type:"path",key:e,value:n,log:{type:"error",message:`Cannot register restricted prefix "${e}"`}}),!1):t.SetStoreItem(this,"path",e,n,o.isString)}},{key:"RegisterPaths",value:function(e){return t.RegisterFromObject(this,"RegisterPath",e)}},{key:"HasDynamicPath",value:function(e){return e&&e in this._dynamicPath}},{key:"GetDynamicPath",value:function(e){return t.GetStoreItem(this,"dynamicPath",e)}},{key:"RegisterDynamicPath",value:function(e,n){return t.SetStoreItem(this,"dynamicPath",e,n,o.isArray)}},{key:"RegisterDynamicPaths",value:function(e){return t.RegisterFromObject(this,"RegisterDynamicPath",e)}},{key:"HasExtension",value:function(e){return e&&e in this._extension}},{key:"GetExtension",value:function(e){return t.GetStoreItem(this,"extension",e)}},{key:"RegisterExtension",value:function(e,n){return t.SetStoreItem(this,"extension",e,n,o.isFunction)}},{key:"RegisterExtensions",value:function(e){return t.RegisterFromObject(this,"RegisterExtension",e)}},{key:"HasClass",value:function(e){return e&&e in this._class}},{key:"GetClass",value:function(e){let n=t.GetStoreItem(this,"class",e);if(!n&&(e.includes("Tr2")||e.includes("Tri"))){const r="Tw2"+e.substring(3);(n=t.GetStoreItem(this,"class",r))&&this.emit("substitute",{type:"class",key:r,originalKey:e,value:n,log:{type:"warning",message:`"${e}" class not found, substituting with "${r}"`}})}return n&&n.partialImplementation&&this.emit("partial",{type:"class",key:e,value:n,log:{type:"warning",message:`"${e}" class partially implemented`}}),n}},{key:"RegisterClass",value:function(e,n){return t.SetStoreItem(this,"class",e,n,o.isFunction)}},{key:"RegisterClasses",value:function(e){return t.RegisterFromObject(this,"RegisterClass",e)}},{key:"HasVariable",value:function(e){return e&&e in this._variable}},{key:"GetVariable",value:function(e){return t.GetStoreItem(this,"variable",e)}},{key:"GetVariableValue",value:function(e,t){const n=this.GetVariable(e);return n&&n.GetValue?n.GetValue(t):null}},{key:"SetVariableValue",value:function(e,t){const n=this.GetVariable(e);return n&&n.SetValue?(n.SetValue(t),!0):null}},{key:"RegisterVariable",value:function(e,n,r){const i=this.CreateType(e,n,r);return t.SetStoreItem(this,"variable",e,i),i}},{key:"RegisterVariables",value:function(e){return t.RegisterFromObject(this,"RegisterVariable",e)}},{key:"GetType",value:function(e){return t.GetStoreItem(this,"type",e)}},{key:"HasType",value:function(e){return e&&e in this._type}},{key:"GetTypeByValue",value:function(e){for(let t in this._type)if(this._type.hasOwnProperty(t)&&"isValue"in this._type[t]&&this._type[t].isValue(e))return this._type[t];return null}},{key:"CreateType",value:function(e,t,n){return Object(o.isPlain)(t)&&(n=t.Type||t.type,t=t.value),n||(n=this.GetTypeByValue(t)),Object(o.isString)(n)&&(n=this.GetType(n)),Object(o.isFunction)(n)?new n(e,t):null}},{key:"RegisterType",value:function(e,n){return t.SetStoreItem(this,"type",e,n,o.isFunction)}},{key:"RegisterTypes",value:function(e){return t.RegisterFromObject(this,"RegisterType",e)}},{key:"HasSchema",value:function(e){return e&&e in this._schema}},{key:"GetSchema",value:function(e){return t.GetStoreItem(this,"schema",e)}},{key:"RegisterSchema",value:function(e,n){return t.SetStoreItem(this,"schema",e,n,e=>e&&"Tw2Schema"===e.constructor.name)}},{key:"RegisterSchemas",value:function(e){return t.RegisterFromObject(this,"RegisterSchema",e)}},{key:"Register",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"uuid"in e&&Object(o.enableUUID)(e.uuid),"logger"in e&&d.Set(e.logger),"resMan"in e&&R.Set(e.resMan),this.RegisterPaths(e.paths),this.RegisterDynamicPaths(e.dynamicPaths),this.RegisterTypes(e.types),this.RegisterClasses(e.classes),this.RegisterExtensions(e.extensions),this.RegisterVariables(e.variables),this.RegisterSchemas(e.schemas)}}])&&S(n.prototype,r),i&&S(n,i),t}();I(C,"RestrictedPathPrefixes",["dynamic","rgba"]),I(C,"category","variable_store");const M=new C;var D=n(13),k=n(7);const x=16384,G=256,j=1024,F=3553,L=34067,B=32879,U=10240,N=10241,V=10242,H=10243,z=5120,q=5121,X=5122,Y=5123,W=5124,K=5125,Q=5126,Z=36193,$=5131,J=33189,ee=33190,te=36012,ne=35664,re=35665,ie=35666,oe=35667,ae=35668,se=35669,ue=35670,le=35671,ce=35672,fe=35673,he=35674,de=35675,pe=35676,me={[Q]:1,[W]:1,[z]:1,[ue]:1,[ne]:2,[oe]:2,[le]:2,[re]:3,[ae]:3,[ce]:3,[ie]:4,[se]:4,[fe]:4,[de]:9,[pe]:16},ye=35678,be=35679,ve=35680,ge=6402,_e=6406,we=6407,Ee=6408,Te=6409,Re=6410,Se=34041,Oe=34042,Pe=33321,Ae=33325,Ie=33326,Ce=33330,Me=33323,De=33327,ke=33328,xe=32849,Ge=35905,je=36194,Fe=35898,Le=35901,Be=34843,Ue=34837,Ne=36221,Ve=32856,He=32855,ze=34842,qe=34836,Xe=36220,Ye=36232,We=36214,Ke=36226,Qe=36208,Ze=9728,$e=9729,Je=9984,et=9985,tt=9986,nt=9987,rt=10497,it=33071,ot=33648,at=0,st=1,ut=768,lt=769,ct=770,ft=771,ht=772,dt=773,pt=774,mt=775,yt=776,bt=32769,vt=32770,gt=32771,_t=32772,wt=35633,Et=35632,Tt=1028,Rt=1029,St=1032,Ot=512,Pt=513,At=514,It=515,Ct=516,Mt=517,Dt=518,kt=519,xt=7680,Gt=7681,jt=7682,Ft=7683,Lt=34055,Bt=34056,Ut=5386,Nt=35040,Vt=35044,Ht=35048,zt=34962,qt=34963,Xt=0,Yt=1,Wt=2,Kt=3,Qt=4,Zt=5,$t=6,Jt=2304,en=2305,tn=2884,nn=2929,rn=3042,on=-1,an=0,sn=1,un=2,ln=3,cn=4,fn=5,hn=6,dn=7,pn=7,mn=8,yn=9,bn=14,vn=15,gn=16,_n=19,wn=20,En=22,Tn=23,Rn=24,Sn=25,On=26,Pn=27,An=28,In=29,Cn=34,Mn=35,Dn=36,kn=37,xn=38,Gn=48,jn=52,Fn=53,Ln=54,Bn=55,Un=56,Nn=57,Vn=58,Hn=59,zn=60,qn=128,Xn=129,Yn=130,Wn=131,Kn=132,Qn=133,Zn=134,$n=135,Jn=136,er=137,tr=139,nr=140,rr=141,ir=142,or=143,ar=145,sr=146,ur=147,lr=148,cr=151,fr=152,hr=154,dr=155,pr=156,mr=157,yr=158,br=159,vr=160,gr=161,_r=162,wr=163,Er=165,Tr=166,Rr=167,Sr=168,Or=170,Pr=171,Ar=172,Ir=173,Cr=174,Mr=175,Dr=176,kr=185,xr=186,Gr=187,jr=188,Fr=189,Lr=190,Br=191,Ur=192,Nr=193,Vr=194,Hr=195,zr=206,qr=207,Xr=208,Yr=209,Wr=1,Kr=2,Qr=3,Zr=1,$r=2,Jr=3,ei=4,ti=5,ni=6,ri=7,ii=8,oi=1,ai=2,si=3,ui=4,li=5,ci=6,fi=7,hi=8,di=9,pi=10,mi=11,yi=12,bi=13,vi=14,gi=15,_i=1,wi=2,Ei=3,Ti=4,Ri=5,Si=0,Oi=1,Pi=2,Ai=4,Ii=5,Ci=6,Mi=6,Di=7,ki=8,xi=8,Gi=9,ji=10,Fi=11,Li=0,Bi=0,Ui=1,Ni=2,Vi=3,Hi=4,zi=5,qi=6,Xi=7,Yi=8,Wi=9,Ki=10,Qi=11,Zi=12,$i=13,Ji=14,eo=15,to=[0,rt,ot,it,it,it],no=[-1,at,st,ut,lt,ct,ft,ht,dt,pt,mt,yt,-1,-1,bt,vt],ro={[Ze]:1,[$e]:2},io={[Ze]:0,[$e]:0,[Je]:1,[et]:1,[tt]:2,[nt]:2},oo=542327876,ao=1,so=2,uo=4,lo=8,co=4096,fo=131072,ho=524288,po=8388608,mo=8,yo=4194304,bo=4096,vo=512,go=1024,_o=2048,wo=4096,Eo=8192,To=16384,Ro=32768,So=2097152,Oo=1,Po=2,Ao=4,Io=64,Co=512,Mo=131072,Do=31,ko=0,xo=1,Go=2,jo=3,Fo=4,Lo=7,Bo=20,Uo=21,No=22,Vo=23,Ho=24,zo=25,qo=26,Xo=27,Yo=28,Wo=29,Ko=30,Qo=32,Zo=827611204,$o=894720068,Jo=861165636,ea=827611204,ta=113,na=116,ra=10,ia=88,oa=["requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"],aa=["cancelAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"],sa=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],ua=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],la=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"],ca=["","MOZ_","WEBKIT_","WEBGL_"],fa=["webgl","experimental-webgl"],ha=["webgl2","experimental-webgl2"],da={NONE:0,WEBGL:1,WEBGL2:2};function pa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ma(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ya(e){return(ya=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ba(e,t){return(ba=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function va(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ga=n(30);let _a=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ma(this,ya(t).call(this))).name="Device",e.gl=null,e.glVersion=da.NONE,e.vrDisplay=null,e.ext=null,e.dt=0,e.frameCounter=0,e.startTime=e.Now(),e.currentTime=e.startTime,e.previousTime=null,e.eyePosition=i.vec3.create(),e.targetResolution=i.vec4.create(),e.world=i.mat4.create(),e.view=i.mat4.create(),e.viewInverse=i.mat4.create(),e.viewTranspose=i.mat4.create(),e.projection=i.mat4.create(),e.projectionInverse=i.mat4.create(),e.projectionTranspose=i.mat4.create(),e.viewProjection=i.mat4.create(),e.viewProjectionTranspose=i.mat4.create(),e.canvas=null,e.viewportWidth=0,e.viewportHeight=0,e.viewportAspect=0,e.viewportPixelRatio="devicePixelRatio"in window?window.devicePixelRatio:1,e.effectDir="/effect.gles2/",e.mipLevelSkipCount=0,e.shaderModel="hi",e.enableAnisotropicFiltering=!0,e.alphaBlendBackBuffer=!0,e.antialiasing=!0,e.msaaSamples=0,e.wrapModes=[],e.shadowHandles=null,e.perObjectData=null,e._alphaBlendState=null,e._alphaTestState=null,e._depthOffsetState=null,e._shadowStateBuffer=null,e._scheduled=[],e._quadBuffer=null,e._quadDecl=null,e._cameraQuadBuffer=null,e._currentRenderMode=on,e._fallbackCube=null,e._fallbackTexture=null,e._blitEffect=null,e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ba(e,t)}(t,a["a"]),n=t,o=[{key:"CreateContext",value:function(e,t,n){function r(e,t,n){n=Array.isArray(n)?n:[n];for(let r=0;r<n.length;r++)try{return e.getContext(n[r],t)}catch(e){}return null}let i=null,o=da.NONE;return n&&(i=r(e,t,ha))&&(o=da.WEBGL2),i||(i=r(e,t,fa))&&(o=da.WEBGL),{gl:i,version:o}}}],(r=[{key:"Now",value:function(){return this.constructor.Clock.now()}},{key:"CreateDevice",value:function(e,n){this.gl=null,this.glVersion=da.NONE,this.effectDir="/effect.gles2/",this.canvas=null;const r=()=>!1,i=()=>!0;this.ext={drawElementsInstanced:r,drawArraysInstanced:r,vertexAttribDivisor:r,hasInstancedArrays:r};let o=t.CreateContext(e,n,n.webgl2),a=o.gl,s=o.version;if(!a)return this.glVersion;switch(this.debugMode&&(this.debugUtils=ga,a=this.debugUtils.makeDebugContext(a)),this.gl=a,this.glVersion=s,this.canvas=e,this.emit("created",{device:this,gl:a,params:n,canvas:e,log:{type:"debug",message:`Webgl${s} context created`}}),this.glVersion){case da.WEBGL2:this.ext={drawElementsInstanced:function(e,t,n,r,i){a.drawElementsInstanced(e,t,n,r,i)},drawArraysInstanced:function(e,t,n,r){a.drawArraysInstanced(e,t,n,r)},vertexAttribDivisor:function(e,t){a.vertexAttribDivisor(e,t)},hasInstancedArrays:i};break;default:this.GetExtension("OES_standard_derivatives"),this.GetExtension("OES_element_index_uint"),this.GetExtension("OES_texture_float"),this.GetExtension("EXT_shader_texture_lod");const t=this.GetExtension("ANGLE_instanced_arrays");t&&(this.ext={drawElementsInstanced:function(e,n,r,i,o){t.drawElementsInstancedANGLE(e,n,r,i,o)},drawArraysInstanced:function(e,n,r,i){t.drawArraysInstancedANGLE(e,n,r,i)},vertexAttribDivisor:function(e,n){t.vertexAttribDivisorANGLE(e,n)},hasInstancedArrays:i})}this.ext.CompressedTextureS3TC=this.GetExtension("compressed_texture_s3tc"),this.ext.AnisotropicFilter=this.GetExtension("EXT_texture_filter_anisotropic"),this.ext.AnisotropicFilter&&(this.ext.AnisotropicFilter.maxAnisotropy=a.getParameter(this.ext.AnisotropicFilter.MAX_TEXTURE_MAX_ANISOTROPY_EXT));const u=this.GetExtension("CCP_shader_binary");if(u){const e=a.getParameter(this.gl.RENDERER).match(/Mali-(\w+).*/);e&&(this.effectDir="/effect.gles2.mali"+e[1]+"/",this.ext.ShaderBinary=u)}this.alphaBlendBackBuffer=!n||void 0===n.alpha||n.alpha,this.msaaSamples=this.gl.getParameter(this.gl.SAMPLES),this.antialiasing=this.msaaSamples>1,this.Resize();return this._quadBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._quadBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),a.STATIC_DRAW),this._cameraQuadBuffer=a.createBuffer(),this._quadDecl=new k.a([["POSITION",0,4],["TEXCOORD",0,2]]),this.wrapModes=Array.from(to),this._alphaBlendState={dirty:!1,states:{[_n]:li,[wn]:ci,[Pr]:_i,[zr]:0,[Yr]:_i,[qr]:li,[Xr]:ci}},this._alphaTestState={dirty:!1,states:{[vn]:0,[Rn]:-1,[Sn]:ti,[Jn]:0,[fr]:0}},this._depthOffsetState={dirty:!1,states:{[Mr]:0,[Hr]:0}},this._shadowStateBuffer=new Float32Array(24),this.glVersion}},{key:"Schedule",value:function(e){this._scheduled.includes(e)||this._scheduled.push(e)}},{key:"Resize",value:function(){const e=this.vrDisplay&&this.vrDisplay.isPresenting;if(e){const e=this.vrDisplay.getEyeParameters("left"),t=this.vrDisplay.getEyeParameters("right");this.canvas.width=2*Math.max(e.renderWidth,t.renderWidth),this.canvas.height=Math.max(t.renderHeight,t.renderHeight)}else this.canvas.width=this.canvas.offsetWidth*this.viewportPixelRatio,this.canvas.height=this.canvas.offsetHeight*this.viewportPixelRatio;this.viewportWidth=this.canvas.clientWidth,this.viewportHeight=this.canvas.clientHeight,this.viewportAspect=this.viewportWidth/this.viewportHeight,M.SetVariableValue("ViewportSize",[this.viewportWidth,this.viewportHeight,this.viewportWidth,this.viewportHeight]),this.emit("resized",{width:this.viewportWidth,height:this.viewportHeight,aspect:this.viewportAspect,source:e?this.vrDisplay:this.canvas})}},{key:"Tick",value:function(){this.canvas.clientWidth===this.viewportWidth&&this.canvas.clientHeight===this.viewportHeight||this.Resize();const e=null===this.previousTime?0:this.previousTime,t=this.Now();this.currentTime=.001*(t-this.startTime),this.dt=null===this.previousTime?0:.001*(t-this.previousTime),this.previousTime=t,M.SetVariableValue("Time",[this.currentTime,this.currentTime-Math.floor(this.currentTime),this.frameCounter,e]),this.emit("tick",{dt:this.dt,previous:e,current:this.currentTime,frame:this.frameCounter}),R.PrepareLoop(this.dt);for(let e=0;e<this._scheduled.length;++e)this._scheduled[e](this.dt)||(this._scheduled.splice(e,1),--e);this.frameCounter++}},{key:"RequestAnimationFrame",value:function(e){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(e):t.RequestAnimationFrame(e)}},{key:"CancelAnimationFrame",value:function(e){return this.vrDisplay?this.vrDisplay.cancelAnimationFrame(e):t.CancelAnimationFrame(e)}},{key:"SetWorld",value:function(e){i.mat4.copy(this.world,e)}},{key:"SetView",value:function(e){i.mat4.copy(this.view,e),i.mat4.invert(this.viewInverse,this.view),i.mat4.transpose(this.viewTranspose,this.view),i.mat4.getTranslation(this.eyePosition,this.viewInverse),this.UpdateViewProjection()}},{key:"SetProjection",value:function(e,t){i.mat4.copy(this.projection,e),i.mat4.transpose(this.projectionTranspose,this.projection),i.mat4.invert(this.projectionInverse,this.projection),this.GetTargetResolution(this.targetResolution),t&&this.UpdateViewProjection()}},{key:"UpdateViewProjection",value:function(){i.mat4.multiply(this.viewProjection,this.projection,this.view),i.mat4.transpose(this.viewProjectionTranspose,this.viewProjection),M.SetVariableValue("ViewProjectionMat",this.viewProjection)}},{key:"GetTargetResolution",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.vec4.create();const t=this.projection[0]?this.projection[5]/this.projection[0]:0;let n=1;t>1.6&&(n=t/1.6);const r=2*Math.atan(n/this.projection[5]);return e[0]=this.viewportWidth,e[1]=this.viewportHeight,e[2]=r,e[3]=r*t,e}},{key:"GetEyePosition",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.vec3.create();return i.vec3.copy(e,this.eyePosition)}},{key:"IsAlphaTestEnabled",value:function(){return this._alphaTestState.states[vn]}},{key:"IsFrameBufferComplete",value:function(e){return this.gl.checkFramebufferStatus(e)===this.gl.FRAMEBUFFER_COMPLETE}},{key:"GetExtension",value:function(e){for(let t=0;t<ca.length;t++){const n=this.gl.getExtension(ca[t]+e);if(n)return n}return null}},{key:"GetFallbackTexture",value:function(){return this._fallbackTexture||(this._fallbackTexture=this.CreateSolidTexture()),this._fallbackTexture}},{key:"GetFallbackCubeMap",value:function(){return this._fallbackCube||(this._fallbackCube=this.CreateSolidCube()),this._fallbackCube}},{key:"CreateSolidTexture",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0];const t=this.gl,n=this.gl.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),n}},{key:"CreateSolidCube",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0];const t=this.gl,n=this.gl.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,n);for(let n=0;n<6;++n)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e));return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_CUBE_MAP,null),n}},{key:"RenderFullScreenQuad",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!e||!e.IsGood())return!1;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,this._quadBuffer);for(let r=0;r<e.GetPassCount(t);++r){if(e.ApplyPass(t,r),!this._quadDecl.SetDeclaration(e.GetPassInput(t,r),24))return!1;this.ApplyShadowState(),n.drawArrays(n.TRIANGLE_STRIP,0,4)}return!0}},{key:"RenderTexture",value:function(e){return null===this._blitEffect&&(this._blitEffect=D.a.create({effectFilePath:"res:/graphics/effect/managed/space/system/blit.fx",textures:{BlitSource:""}})),this._blitEffect.parameters.BlitSource.SetTextureRes(e),this.RenderFullScreenQuad(this._blitEffect)}},{key:"RenderCameraSpaceQuad",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!e||!e.IsGood())return!1;const n=new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),r=this.projectionInverse;for(let e=0;e<4;++e){const t=n.subarray(6*e,6*e+4);i.vec4.transformMat4(t,t,r),i.vec3.scale(t,t,1/t[3]),t[3]=1}const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,this._cameraQuadBuffer),o.bufferData(o.ARRAY_BUFFER,n,o.STATIC_DRAW);for(let n=0;n<e.GetPassCount(t);++n){if(e.ApplyPass(t,n),!this._quadDecl.SetDeclaration(e.GetPassInput(t,n),24))return!1;this.ApplyShadowState(),o.drawArrays(o.TRIANGLE_STRIP,0,4)}return!0}},{key:"SetRenderState",value:function(e,t){const n=this.gl;switch(this._currentRenderMode=on,e){case pn:return void(t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST));case bn:return void n.depthMask(!!t);case vn:case Rn:case Sn:case Jn:case fr:return void(this._alphaTestState[e]!==t&&(this._alphaTestState.states[e]=t,this._alphaTestState.dirty=!0));case _n:case wn:case Pr:case zr:case Yr:case qr:case Xr:return void(this._alphaBlendState[e]!==t&&(this._alphaBlendState.states[e]=t,this._alphaBlendState.dirty=!0));case En:switch(t){case Wr:return void n.disable(n.CULL_FACE);case Kr:return n.enable(n.CULL_FACE),void n.cullFace(n.FRONT);case Qr:return n.enable(n.CULL_FACE),void n.cullFace(n.BACK)}return;case Tn:return void n.depthFunc(512+t-1);case Pn:return void(t?n.enable(n.BLEND):n.disable(n.BLEND));case Sr:return void n.colorMask(0!=(1&t),0!=(2&t),0!=(4&t),0!=(8&t));case Cr:return void(t?n.enable(n.SCISSOR_TEST):n.disable(n.SCISSOR_TEST));case Mr:case Hr:return t=i.num.dwordToFloat(t),void(this._depthOffsetState[e]!==t&&(this._depthOffsetState.states[e]=t,this._depthOffsetState.dirty=!0))}}},{key:"ApplyShadowState",value:function(){const e=this.gl;if(this._alphaBlendState.dirty){let t=e.FUNC_ADD;this._alphaBlendState.states[Pr]===wi?t=e.FUNC_SUBTRACT:this._alphaBlendState.states[Pr]===Ei&&(t=e.FUNC_REVERSE_SUBTRACT);const n=no[this._alphaBlendState.states[_n]],r=no[this._alphaBlendState.states[wn]];if(this._alphaBlendState.states[zr]){let i=e.FUNC_ADD;this._alphaBlendState.states[Pr]===wi?i=e.FUNC_SUBTRACT:this._alphaBlendState.states[Pr]===Ei&&(i=e.FUNC_REVERSE_SUBTRACT);const o=no[this._alphaBlendState.states[qr]],a=no[this._alphaBlendState.states[Xr]];e.blendEquationSeparate(t,i),e.blendFuncSeparate(n,r,o,a)}else e.blendEquation(t),e.blendFunc(n,r);this._alphaBlendState.dirty=!1}let t,n,r;if(this._depthOffsetState.dirty&&(e.polygonOffset(this._depthOffsetState.states[Mr],this._depthOffsetState.states[Hr]),this._depthOffsetState.dirty=!1),this.shadowHandles&&this._alphaTestState.states[vn]){switch(this._alphaTestState.states[Sn]){case Zr:t=0,n=1,r=-256;break;case $r:t=0,n=-1,r=this._alphaTestState.states[Rn]-1;break;case Jr:t=1,n=0,r=this._alphaTestState.states[Rn];break;case ei:t=0,n=-1,r=this._alphaTestState.states[Rn];break;case ti:t=0,n=1,r=-this._alphaTestState.states[Rn]-1;break;case ri:t=0,n=1,r=-this._alphaTestState.states[Rn];break;default:t=0,n=0,r=1}const i=0;e.uniform4f(this.shadowHandles.shadowStateInt,n,r,t,i)}}},{key:"SetStandardStates",value:function(e){if(this._currentRenderMode!==e){switch(this.gl.frontFace(this.gl.CW),e){case an:case hn:case dn:this.SetRenderState(pn,!0),this.SetRenderState(bn,!0),this.SetRenderState(Tn,ei),this.SetRenderState(En,Kr),this.SetRenderState(Pn,!1),this.SetRenderState(vn,!1),this.SetRenderState(zr,!1),this.SetRenderState(Mr,0),this.SetRenderState(Hr,0),this.SetRenderState(Sr,15);break;case sn:this.SetRenderState(Pn,!1),this.SetRenderState(vn,!0),this.SetRenderState(Sn,ti),this.SetRenderState(Rn,127),this.SetRenderState(pn,!0),this.SetRenderState(bn,!0),this.SetRenderState(Tn,ei),this.SetRenderState(En,Kr),this.SetRenderState(Pr,_i),this.SetRenderState(Mr,0),this.SetRenderState(Hr,0),this.SetRenderState(zr,!1),this.SetRenderState(Sr,15);break;case un:this.SetRenderState(En,Kr),this.SetRenderState(Pn,!0),this.SetRenderState(_n,li),this.SetRenderState(wn,ci),this.SetRenderState(Pr,_i),this.SetRenderState(pn,!0),this.SetRenderState(bn,!1),this.SetRenderState(Tn,ei),this.SetRenderState(vn,!1),this.SetRenderState(Mr,0),this.SetRenderState(Hr,0),this.SetRenderState(zr,!1),this.SetRenderState(Sr,15);break;case ln:this.SetRenderState(En,Wr),this.SetRenderState(Pn,!0),this.SetRenderState(_n,ai),this.SetRenderState(wn,ai),this.SetRenderState(Pr,_i),this.SetRenderState(pn,!0),this.SetRenderState(bn,!1),this.SetRenderState(Tn,ei),this.SetRenderState(vn,!1),this.SetRenderState(Mr,0),this.SetRenderState(Hr,0),this.SetRenderState(zr,!1),this.SetRenderState(Sr,15);break;case fn:this.SetRenderState(Pn,!1),this.SetRenderState(vn,!1),this.SetRenderState(En,Wr),this.SetRenderState(pn,!1),this.SetRenderState(bn,!1),this.SetRenderState(Tn,ii),this.SetRenderState(Mr,0),this.SetRenderState(Hr,0),this.SetRenderState(zr,!1),this.SetRenderState(Sr,15);break;default:return}this._currentRenderMode=e}}}])&&pa(n.prototype,r),o&&pa(n,o),t}();va(_a,"Clock",Date),va(_a,"RequestAnimationFrame",function(){const e=Object(o.get)(window,oa);return function(t){return e(t)}}()),va(_a,"CancelAnimationFrame",function(){const e=Object(o.get)(window,aa);return function(t){return e(t)}}()),va(_a,"category","device"),_a.prototype.RM_ANY=on,_a.prototype.RM_OPAQUE=an,_a.prototype.RM_DECAL=sn,_a.prototype.RM_TRANSPARENT=un,_a.prototype.RM_ADDITIVE=ln,_a.prototype.RM_DEPTH=cn,_a.prototype.RM_DISTORTION=dn,_a.prototype.RM_FULLSCREEN=fn,_a.prototype.RM_PICKABLE=hn,_a.prototype.RM_DISTORTION=dn;const wa=new _a;n.d(t,"B",function(){return i.num}),n.d(t,"G",function(){return i.vec2}),n.d(t,"H",function(){return i.vec3}),n.d(t,"I",function(){return i.vec4}),n.d(t,"C",function(){return i.quat}),n.d(t,"y",function(){return i.mat3}),n.d(t,"z",function(){return i.mat4}),n.d(t,"A",function(){return i.noise}),n.d(t,"v",function(){return i.curve}),n.d(t,"w",function(){return wa}),n.d(t,"D",function(){return R}),n.d(t,"E",function(){return M}),n.d(t,"x",function(){return d}),n.d(t,"s",function(){return F}),n.d(t,"q",function(){return $e}),n.d(t,"r",function(){return rt}),n.d(t,"p",function(){return ro}),n.d(t,"t",function(){return io}),n.d(t,"l",function(){return oo}),n.d(t,"b",function(){return fo}),n.d(t,"a",function(){return vo}),n.d(t,"c",function(){return Do}),n.d(t,"g",function(){return ko}),n.d(t,"j",function(){return xo}),n.d(t,"e",function(){return Go}),n.d(t,"f",function(){return jo}),n.d(t,"k",function(){return Fo}),n.d(t,"h",function(){return Lo}),n.d(t,"i",function(){return Uo}),n.d(t,"d",function(){return Yo}),n.d(t,"m",function(){return Zo}),n.d(t,"o",function(){return $o}),n.d(t,"n",function(){return Jo}),n.d(t,"F",function(){return o}),n.d(t,"u",function(){return r})},function(e,t,n){"use strict";n.r(t);var r=n(0);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let a=function(){function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"batches",[]),o(this,"_sortMethod",null),this._sortMethod=t}var t,n,a;return t=e,(n=[{key:"Commit",value:function(e){this.batches.push(e)}},{key:"Clear",value:function(){this.batches=[]}},{key:"Render",value:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Main";this._sortMethod&&this.batches.sort(this._sortMethod);for(let n=0;n<this.batches.length;++n)this.batches[n]instanceof e?this.batches[n].Render(t):(this.batches[n].renderMode!==r.w.RM_ANY&&r.w.SetStandardStates(this.batches[n].renderMode),r.w.perObjectData=this.batches[n].perObjectData,this.batches[n].Commit(t))}},{key:"length",get:function(){return this.batches.length}}])&&i(t.prototype,n),a&&i(t,a),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"renderMode",r.w.RM_ANY),u(this,"perObjectData",null)}var t,n,i;return t=e,(n=[{key:"Commit",value:function(e){}}])&&s(t.prototype,n),i&&s(t,i),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let p=function(e){function t(){var e,n,r,i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=this,e=!(r=f(t).call(this,...u))||"object"!=typeof r&&"function"!=typeof r?d(n):r,i=d(d(e)),a=null,(o="geometryProvider")in i?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,l),n=t,(r=[{key:"Commit",value:function(e){this.geometryProvider&&this.geometryProvider.Render(this,e)}}])&&c(n.prototype,r),i&&c(n,i),t}();function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let _=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=y(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?v(n):r,g(v(v(e)),"geometryRes",null),g(v(v(e)),"meshIx",0),g(v(v(e)),"start",0),g(v(v(e)),"count",1),g(v(v(e)),"effect",null),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,l),n=t,(r=[{key:"Commit",value:function(e){this.geometryRes&&this.effect&&this.geometryRes.RenderAreas(this.meshIx,this.start,this.count,this.effect,e)}}])&&m(n.prototype,r),i&&m(n,i),t}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}let S=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,T(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,_),n=t,(r=[{key:"Commit",value:function(e){this.geometryRes&&this.effect&&this.geometryRes.RenderLines(this.meshIx,this.start,this.count,this.effect,e)}}])&&w(n.prototype,r),i&&w(n,i),t}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let C=function(e){function t(){var e,n,r,i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=this,e=!(r=P(t).call(this,...u))||"object"!=typeof r&&"function"!=typeof r?I(n):r,i=I(I(e)),a=null,(o="instanceMesh")in i?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,_),n=t,(r=[{key:"Commit",value:function(e){this.instanceMesh&&this.effect&&this.instanceMesh.RenderAreas(this.meshIx,this.start,this.count,this.effect,e)}}])&&O(n.prototype,r),i&&O(n,i),t}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,"_id",r.F.generateID()),D(this,"name",""),D(this,"curves",[]),D(this,"bindings",[]),D(this,"scale",1),D(this,"playOnLoad",!0),D(this,"isPlaying",!1),D(this,"scaledTime",0)}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(){this.playOnLoad&&this.Play()}},{key:"Play",value:function(){this.isPlaying=!0,this.scaledTime=0}},{key:"PlayFrom",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isPlaying=!0,this.scaledTime=e}},{key:"Stop",value:function(){this.isPlaying=!1}},{key:"Update",value:function(e){if(this.isPlaying){this.scaledTime+=e*this.scale;for(let e=0;e<this.curves.length;++e)this.curves[e].UpdateValue(this.scaledTime);for(let e=0;e<this.bindings.length;++e)this.bindings[e].CopyValue()}}},{key:"GetMaxCurveDuration",value:function(){let e=0;for(let t=0;t<this.curves.length;++t)"GetLength"in this.curves[t]&&(e=Math.max(e,this.curves[t].GetLength()));return e}}])&&M(t.prototype,n),i&&M(t,i),e}();var x=n(6);function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let U=function(e){function t(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,e=!(a=j(t).call(this,n))||"object"!=typeof a&&"function"!=typeof a?L(o):a,B(L(L(e)),"name",""),B(L(L(e)),"value",1),B(L(L(e)),"constantBuffer",null),B(L(L(e)),"offset",null),e.value=r.F.isArrayLike(i)?i[0]:i,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,x["a"]),n=t,o=[{key:"isValue",value:function(e){return r.F.isNumber(e)}}],(i=[{key:"SetValue",value:function(e){this.value=e,this.OnValueChanged()}},{key:"GetValue",value:function(){return this.value}},{key:"Apply",value:function(e,t){e[t]=this.value}},{key:"EqualsValue",value:function(e){return this.value===e}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.SetValue(e.GetValue())}}])&&G(n.prototype,i),o&&G(n,o),t}();function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}B(U,"constantBufferSize",1);let q=function(e){function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.z.create();return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),V(this,H(t).call(this,e,n))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,x["b"]),n=t,(i=[{key:"Compose",value:function(e,t,n){"value"in e&&(e=e.value),"value"in t&&(t=t.value),"value"in n&&(n=n.value),r.z.fromRotationTranslationScale(this.value,e,t,n),this.OnValueChanged()}},{key:"Decompose",value:function(e,t,n){r.z.getRotation("value"in e?e.value:e,this.value),r.z.getTranslation("value"in t?t.value:t,this.value),r.z.getScaling("value"in n?n.value:n,this.value),"OnValueChanged"in e&&e.OnValueChanged(),"OnValueChanged"in t&&t.OnValueChanged(),"OnValueChanged"in n&&n.OnValueChanged()}},{key:"x",get:function(){return this.GetIndexValue(12)},set:function(e){this.SetIndexValue(12,e)}},{key:"y",get:function(){return this.GetIndexValue(13)},set:function(e){this.SetIndexValue(13,e)}},{key:"z",get:function(){return this.GetIndexValue(14)},set:function(e){this.SetIndexValue(14,e)}}])&&N(n.prototype,i),o&&N(n,o),t}();var X,Y,W;function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return(Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}W=16,(Y="constantBufferSize")in(X=q)?Object.defineProperty(X,Y,{value:W,enumerable:!0,configurable:!0,writable:!0}):X[Y]=W;let te=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Z(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?J(n):i,ee(J(J(e)),"name",""),ee(J(J(e)),"scaling",r.H.fromValues(1,1,1)),ee(J(J(e)),"rotationCenter",r.H.create()),ee(J(J(e)),"rotation",r.C.create()),ee(J(J(e)),"translation",r.H.create()),ee(J(J(e)),"transform",r.z.create()),ee(J(J(e)),"worldTransform",r.z.create()),ee(J(J(e)),"constantBuffer",null),ee(J(J(e)),"offset",null),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(t,x["a"]),n=t,(i=[{key:"Initialize",value:function(){this.OnValueChanged()}},{key:"GetValue",value:function(e){return e?Array.from(this.transform):new Float32Array(this.transform)}},{key:"OnValueChanged",value:function(e,n){r.z.fromRotationTranslationScaleOrigin(this.transform,this.rotation,this.translation,this.scaling,this.rotationCenter),r.z.transpose(this.worldTransform,this.transform),Q(Z(t.prototype),"OnValueChanged",this).call(this,e,n)}},{key:"Bind",value:function(e,t,n){return!this.constantBuffer&&n>=this.size&&(this.constantBuffer=e,this.offset=t,this.Apply(e,t,n),!0)}},{key:"Apply",value:function(e,t,n){n>=this.constructor.constantBufferSize?e.set(this.worldTransform,t):e.set(this.worldTransform.subarray(0,n),t)}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),r.C.copy(this.rotation,e.rotation),r.H.copy(this.translation,e.translation),r.H.copy(this.scaling,e.scaling),r.H.copy(this.rotationCenter,e.rotationCenter),this.OnValueChanged()}}])&&K(n.prototype,i),o&&K(n,o),t}();function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}ee(te,"constantBufferSize",16);let ae=function(e){function t(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var i,o,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,e=!(o=re(t).call(this,n))||"object"!=typeof o&&"function"!=typeof o?oe(i):o,a=oe(oe(e)),u="",(s="variableName")in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,e.variableName=r,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,x["a"]),n=t,(i=[{key:"GetValue",value:function(e){return r.E.GetVariableValue(this.variableName,e)}},{key:"Apply",value:function(e,t,n){this.variable&&this.variable.Apply(e,t,n)}},{key:"AddCallback",value:function(){return!1}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.variableName=e.variableName}},{key:"variable",get:function(){return r.E.GetVariable(this.variableName)}},{key:"size",get:function(){return this.variable?this.variable.size:0}}])&&ne(n.prototype,i),o&&ne(n,o),t}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}let fe=function(e){function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.G.fromValues(1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ue(this,le(t).call(this,e,n))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(t,x["b"]),n=t,(i=[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}}])&&se(n.prototype,i),o&&se(n,o),t}();function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(fe,"constantBufferSize",2);let ye=function(e){function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.H.fromValues(1,1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),de(this,pe(t).call(this,e,n))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(t,x["b"]),n=t,(i=[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}},{key:"z",get:function(){return this.GetIndexValue(2)},set:function(e){this.SetIndexValue(2,e)}}])&&he(n.prototype,i),o&&he(n,o),t}();function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ye,"constantBufferSize",3);let we=function(e){function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.I.fromValues(1,1,1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ve(this,ge(t).call(this,e,n))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,x["b"]),n=t,(i=[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}},{key:"z",get:function(){return this.GetIndexValue(2)},set:function(e){this.SetIndexValue(2,e)}},{key:"w",get:function(){return this.GetIndexValue(3)},set:function(e){this.SetIndexValue(3,e)}}])&&be(n.prototype,i),o&&be(n,o),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(we,"constantBufferSize",4);var Ee=n(9);function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Re(this,"_id",r.F.generateID()),Re(this,"name",""),Re(this,"sourceObject",null),Re(this,"sourceAttribute",""),Re(this,"_sourceElement",null),Re(this,"sourceIsArray",null),Re(this,"destinationObject",null),Re(this,"destinationAttribute",""),Re(this,"_destinationElement",null),Re(this,"destinationIsArray",null),Re(this,"scale",1),Re(this,"offset",r.C.create()),Re(this,"_copyFunc",null)}var t,n,i;return t=e,i=[{key:"CopyValueToValue",value:function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyArray",value:function(){let e=Math.min(this.destinationObject[this.destinationAttribute].length,this.sourceObject[this.sourceAttribute].length);for(let t=0;t<e;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute][t]*this.scale+this.offset[t]}},{key:"CopyElementToElement",value:function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"ReplicateValue",value:function(){for(let e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[e]}},{key:"ReplicateElement",value:function(){for(let e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[e]}},{key:"ExtractPos",value:function(){for(let e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][e+12]*this.scale+this.offset[e]}},{key:"CopyElementToValue",value:function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"CopyValueToElement",value:function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyFloatToBoolean",value:function(){this.destinationObject[this.destinationAttribute]=0!==this.sourceObject[this.sourceAttribute]}}],(n=[{key:"Initialize",value:function(){if(!this.sourceObject||""===this.sourceAttribute)return;if(!this.destinationObject||""===this.destinationAttribute)return;let t=!1,n=!1,i=this.sourceAttribute.substr(-2);".x"===i||".r"===i?(t=!0,this._sourceElement=0,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".y"===i||".g"===i?(t=!0,this._sourceElement=1,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".z"===i||".b"===i?(t=!0,this._sourceElement=2,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".w"===i||".a"===i?(t=!0,this._sourceElement=3,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):this.sourceObject instanceof we&&("v1"===this.sourceAttribute?(t=!0,this._sourceElement=0,this.sourceAttribute="value"):"v2"===this.sourceAttribute?(t=!0,this._sourceElement=1,this.sourceAttribute="value"):"v3"===this.sourceAttribute?(t=!0,this._sourceElement=2,this.sourceAttribute="value"):"v4"===this.sourceAttribute&&(t=!0,this._sourceElement=3,this.sourceAttribute="value"));let o=this.destinationAttribute.substr(-2);".x"===o||".r"===o?(n=!0,this._destinationElement=0,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".y"===o||".g"===o?(n=!0,this._destinationElement=1,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".z"===o||".b"===o?(n=!0,this._destinationElement=2,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".w"===o||".a"===o?(n=!0,this._destinationElement=3,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):this.destinationObject instanceof we&&("v1"===this.destinationAttribute?(n=!0,this._destinationElement=0,this.destinationAttribute="value"):"v2"===this.destinationAttribute?(n=!0,this._destinationElement=1,this.destinationAttribute="value"):"v3"===this.destinationAttribute?(n=!0,this._destinationElement=2,this.destinationAttribute="value"):"v4"===this.destinationAttribute&&(n=!0,this._destinationElement=3,this.destinationAttribute="value")),this.sourceAttribute in this.sourceObject&&this.destinationAttribute in this.destinationObject&&(this.sourceIsArray=r.F.isArrayLike(this.sourceObject[this.sourceAttribute]),this.destinationIsArray=r.F.isArrayLike(this.destinationObject[this.destinationAttribute]),this.sourceIsArray===this.destinationIsArray&&typeof this.sourceObject[this.sourceAttribute]==typeof this.destinationObject[this.destinationAttribute]?this.sourceIsArray?t?this._copyFunc=n?e.CopyElementToElement:e.ReplicateElement:this.sourceObject[this.sourceAttribute].length<=this.destinationObject[this.destinationAttribute].length?this._copyFunc=e.CopyArray:16===this.sourceObject[this.sourceAttribute].length&&(this._copyFunc=e.ExtractPos):this._copyFunc=e.CopyValueToValue:this.sourceIsArray&&t&&r.F.isNumber(this.destinationObject[this.destinationAttribute])?this._copyFunc=e.CopyElementToValue:this.destinationIsArray&&r.F.isNumber(this.sourceObject[this.sourceAttribute])?this._copyFunc=n?e.CopyValueToElement:e.ReplicateValue:r.F.isNumber(this.sourceObject[this.sourceAttribute])&&r.F.isBoolean(this.destinationObject[this.destinationAttribute])&&(this._copyFunc=e.CopyFloatToBoolean))}},{key:"CopyValue",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this._copyFunc&&(this._copyFunc.call(this),"OnValueChanged"in this.destinationObject&&this.destinationObject.OnValueChanged(e,[this.destinationAttribute]))}}])&&Te(t.prototype,n),i&&Te(t,i),e}();var Oe=n(2);function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ae(this,"nextOffset",0),Ae(this,"data",null),Ae(this,"elements",{}),t&&this.DeclareFromObject(t)}var t,n,i;return t=e,(n=[{key:"Set",value:function(e,t){const n=this.elements[e],r="subarray"in t?"subarray":"slice";this.data.set(t.length>n.size?t[r](0,n.size):t,n.offset)}},{key:"Get",value:function(e){return this.elements[e].array}},{key:"GetData",value:function(e){return this.data.subarray(this.elements[e].offset,this.elements[e].offset+this.elements[e].array.length)}},{key:"Create",value:function(){this.data=new Float32Array(this.nextOffset);for(let e in this.elements)if(this.elements.hasOwnProperty(e)){const t=this.elements[e];if(t.array=this.data.subarray(t.offset,t.offset+t.size),null!==t.value){if(1===t.size)r.F.isNumber(t.value)?t.array[0]=t.value:t.array[0]=t.value[0];else for(let e=0;e<t.size;e++)t.array[e]=t.value[e];t.value=null}}}},{key:"Declare",value:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==n&&!r.F.isArrayLike(n)&&!r.F.isNumber(n))throw new Oe.b({declaration:e,valueType:typeof n});this.elements[e]={offset:this.nextOffset,size:t,array:null,value:n},this.nextOffset+=t}},{key:"DeclareFromObject",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<e.length;t++){const n=e[t];r.F.isArray(n)?this.Declare(n[0],n[1],n[2]):this.Declare(n.name,n.size,n.value)}this.Create()}}])&&Pe(t.prototype,n),i&&Pe(t,i),e}();function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let De=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Me(this,"perObjectVSData",null),Me(this,"perObjectPSData",null),t&&this.DeclareFromObject(t)}var t,n,i;return t=e,(n=[{key:"SetPerObjectDataToDevice",value:function(e){const t=r.w.gl;this.perObjectVSData&&e[3]&&t.uniform4fv(e[3],this.perObjectVSData.data),this.perObjectPSData&&e[4]&&t.uniform4fv(e[4],this.perObjectPSData.data)}},{key:"DeclareFromObject",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.VSData&&(this.perObjectVSData=new Ie(e.VSData)),e.PSData&&(this.perObjectPSData=new Ie(e.PSData))}}])&&Ce(t.prototype,n),i&&Ce(t,i),e}();function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t,n){return(xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ge(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let Le=function(e){function t(e){var n,r,i,o,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=!(i=Ge(t).call(this))||"object"!=typeof i&&"function"!=typeof i?Fe(r):i,o=Fe(Fe(n)),s=null,(a="perObjectFFEData")in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,e&&n.DeclareFromObject(e),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(t,De),n=t,(i=[{key:"SetPerObjectDataToDevice",value:function(e){xe(Ge(t.prototype),"SetPerObjectDataToDevice",this).call(this,e),this.perObjectFFEData&&e[5]&&r.w.gl.uniform4fv(e[5],this.perObjectFFEData.data)}},{key:"DeclareFromObject",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(Ge(t.prototype),"DeclareFromObject",this).call(this,e),e.FFEData&&(this.perObjectFFEData=new Ie(e.FFEData))}}])&&ke(n.prototype,i),o&&ke(n,o),t}();var Be=n(7);function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Ne=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ue(this,"name",""),Ue(this,"declaration",new Be.a),Ue(this,"buffers",[]),Ue(this,"indexes",null),Ue(this,"weightProxy",null)};function Ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let He=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ve(this,"name",""),Ve(this,"duration",0),Ve(this,"trackGroups",[])};function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qe(this,"name",""),qe(this,"parentIndex",-1),qe(this,"position",r.H.create()),qe(this,"orientation",r.C.create()),qe(this,"scaleShear",r.y.create()),qe(this,"localTransform",r.z.create()),qe(this,"worldTransform",r.z.create()),qe(this,"worldTransformInv",r.z.create())}var t,n,i;return t=e,(n=[{key:"UpdateTransform",value:function(){r.z.fromMat3(this.localTransform,this.scaleShear),r.C.normalize(this.orientation,this.orientation);let t=r.z.fromQuat(e.global.mat4_0,this.orientation);return r.z.multiply(this.localTransform,this.localTransform,t),this.localTransform[12]=this.position[0],this.localTransform[13]=this.position[1],this.localTransform[14]=this.position[2],this.localTransform}}])&&ze(t.prototype,n),i&&ze(t,i),e}();function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}qe(Xe,"global",{mat4_0:r.z.create()});let We=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ye(this,"dimension",0),Ye(this,"degree",0),Ye(this,"knots",null),Ye(this,"controls",null)};function Ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Qe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ke(this,"name",""),Ke(this,"declaration",new Be.a),Ke(this,"areas",[]),Ke(this,"buffer",null),Ke(this,"bufferLength",0),Ke(this,"bufferData",null),Ke(this,"indexes",null),Ke(this,"indexData",null),Ke(this,"indexType",0),Ke(this,"minBounds",r.H.create()),Ke(this,"maxBounds",r.H.create()),Ke(this,"boundsSpherePosition",r.H.create()),Ke(this,"boundsSphereRadius",0),Ke(this,"bones",[]),Ke(this,"boneBindings",[])};function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let $e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ze(this,"name",""),Ze(this,"start",0),Ze(this,"count",0),Ze(this,"minBounds",r.H.create()),Ze(this,"maxBounds",r.H.create()),Ze(this,"boundsSpherePosition",r.H.create()),Ze(this,"boundsSphereRadius",0)};function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let et=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Je(this,"mesh",null),Je(this,"bones",[])};function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let rt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),nt(this,"name",""),nt(this,"meshBindings",[]),nt(this,"skeleton",null)}var t,n,r;return t=e,(n=[{key:"FindBoneByName",value:function(e){if(!this.skeleton)return null;for(let t=0;t<this.skeleton.bones.length;++t)if(this.skeleton.bones[t].name===e)return this.skeleton.bones[t];return null}}])&&tt(t.prototype,n),r&&tt(t,r),e}();let it=function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=[],(n="bones")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r};function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let at=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ot(this,"name",""),ot(this,"model",null),ot(this,"transformTracks",[])};function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ut=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),st(this,"name",""),st(this,"position",null),st(this,"orientation",null),st(this,"scaleShear",null)};var lt=n(13);function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ht=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ft(this,"_id",r.F.generateID()),ft(this,"name",""),ft(this,"display",!0),ft(this,"visible",{opaqueAreas:!0,transparentAreas:!0,additiveAreas:!0,pickableAreas:!0,decalAreas:!0,depthAreas:!0}),ft(this,"opaqueAreas",[]),ft(this,"transparentAreas",[]),ft(this,"additiveAreas",[]),ft(this,"pickableAreas",[]),ft(this,"decalAreas",[]),ft(this,"depthAreas",[]),ft(this,"meshIndex",0),ft(this,"geometryResPath",""),ft(this,"lowDetailGeometryResPath",""),ft(this,"geometryResource",null)}var t,n,i;return t=e,i=[{key:"GetAreaBatches",value:function(e,t,n,r,i){for(let o=0;o<t.length;++o){const a=t[o];if(a.effect&&a.display){const t=new a.constructor.batchType;t.renderMode=n,t.perObjectData=i,t.geometryRes=e.geometryResource,t.meshIx=e.meshIndex,t.start=a.index,t.count=a.count,t.effect=a.effect,r.Commit(t)}}}}],(n=[{key:"Initialize",value:function(){""!==this.geometryResPath&&(this.geometryResource=r.D.GetResource(this.geometryResPath))}},{key:"IsGood",value:function(){return this.geometryResource&&this.geometryResource.IsGood()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.includes(this.geometryResource)||e.push(this.geometryResource),r.F.perArrayChild(this.opaqueAreas,"GetResources",e),r.F.perArrayChild(this.transparentAreas,"GetResources",e),r.F.perArrayChild(this.additiveAreas,"GetResources",e),r.F.perArrayChild(this.pickableAreas,"GetResources",e),r.F.perArrayChild(this.decalAreas,"GetResources",e),r.F.perArrayChild(this.depthAreas,"GetResources",e),e}},{key:"GetBatches",value:function(e,t,n){if(!this.IsGood()||!this.display)return!1;const i=this.constructor.GetAreaBatches;switch(e){case r.w.RM_OPAQUE:return void(this.visible.opaqueAreas&&i(this,this.opaqueAreas,e,t,n));case r.w.RM_DECAL:return void(this.visible.decalAreas&&i(this,this.opaqueAreas,e,t,n));case r.w.RM_TRANSPARENT:return void(this.visible.transparentAreas&&i(this,this.transparentAreas,e,t,n));case r.w.RM_ADDITIVE:return void(this.visible.transparentAreas&&i(this,this.additiveAreas,e,t,n));case r.w.RM_PICKABLE:return void(this.visible.pickableAreas&&i(this,this.pickableAreas,e,t,n))}}}])&&ct(t.prototype,n),i&&ct(t,i),e}();function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pt(e,t,n){return(pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function mt(e){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yt(e,t){return(yt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let gt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=mt(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?bt(n):i,vt(bt(bt(e)),"instanceGeometryResource",null),vt(bt(bt(e)),"instanceGeometryResPath",""),vt(bt(bt(e)),"instanceMeshIndex",0),vt(bt(bt(e)),"minBounds",r.H.create()),vt(bt(bt(e)),"maxBounds",r.H.create()),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yt(e,t)}(t,ht),n=t,o=[{key:"GetAreaBatches",value:function(e,t,n,r,i){for(let o=0;o<t.length;++o){const a=t[o];if(a.effect&&a.display){const t=new C;t.renderMode=n,t.perObjectData=i,t.instanceMesh=e,t.meshIx=a.meshIndex,t.start=a.index,t.count=a.count,t.effect=a.effect,r.Commit(t)}}}}],(i=[{key:"Initialize",value:function(){pt(mt(t.prototype),"Initialize",this).call(this),""!==this.instanceGeometryResPath&&(this.instanceGeometryResource=r.D.GetResource(this.instanceGeometryResPath))}},{key:"IsGood",value:function(){const e=this.instanceGeometryResource,n=pt(mt(t.prototype),"IsGood",this).call(this),r=!!e&&(!e.IsGood||e.IsGood());return n&&r}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return pt(mt(t.prototype),"GetResources",this).call(this,e),this.instanceGeometryResource&&"GetResources"in this.instanceGeometryResource&&this.instanceGeometryResource.GetResources(e),e}},{key:"RenderAreas",value:function(e,t,n,r,i){if(!this.IsGood())return;const o=this.instanceGeometryResource.GetInstanceBuffer(this.instanceMeshIndex);o&&this.geometryResource.RenderAreasInstanced(e,t,n,r,i,o,this.instanceGeometryResource.GetInstanceDeclaration(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceStride(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceCount(this.instanceMeshIndex))}}])&&dt(n.prototype,i),o&&dt(n,o),t}();function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let wt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_t(this,"_id",r.F.generateID()),_t(this,"name",""),_t(this,"effect",null),_t(this,"meshIndex",0),_t(this,"index",0),_t(this,"count",1),_t(this,"display",!0)};function Et(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}_t(wt,"batchType",_);let St=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Et(this,Tt(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}(t,wt),t}();function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(St,"batchType",S);let At=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Pt(this,"animationRes",null),Pt(this,"time",0),Pt(this,"timeScale",1),Pt(this,"cycle",!1),Pt(this,"isPlaying",!1),Pt(this,"callback",null),Pt(this,"trackGroups",[])}var t,n,r;return t=e,(n=[{key:"IsFinished",value:function(){return!this.cycle&&this.time>=this.animationRes.duration}}])&&Ot(t.prototype,n),r&&Ot(t,r),e}();var It=n(17),Ct=n(16),Mt=n(8),Dt=n(14);function kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Gt=function(){function e(t,n,i,o,a){function s(){const e=t.ReadUInt32();let n=e;for(;i.charCodeAt(n);)++n;return i.substr(e,n-e)}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xt(this,"techniques",{}),xt(this,"annotations",{});const u=r.w.wrapModes,l=r.w.gl;let c=1;n>6&&(c=t.ReadUInt8());for(let f=0;f<c;++f){let c={name:"Main",passes:[]};n>6&&(c.name=s()),this.techniques[c.name]=c;const f=t.ReadUInt8();for(let h=0;h<f;++h){const f={stages:[{},{}]},d=t.ReadUInt8();let p=!0;for(let c=0;c<d;++c){const c={};c.inputDefinition=new Be.a,c.constants=[],c.textures=[],c.samplers=[];const h=t.ReadUInt8(),d=t.ReadUInt8();for(let e=0;e<d;++e){const n=t.ReadUInt8();t.ReadUInt8();const r=t.ReadUInt8();t.ReadUInt8(),c.inputDefinition.elements[e]=new Be.b(n,r,0)}let m,y,b,v;if(c.inputDefinition.RebuildHash(),n<5)m=t.ReadUInt32(),y=t.data.subarray(t.cursor,t.cursor+m),t.cursor+=m,b=t.ReadUInt32(),v=t.data.subarray(t.cursor,t.cursor+b),t.cursor+=b;else{m=t.ReadUInt32();let e=t.ReadUInt32();y=i.substr(e,m),b=t.ReadUInt32(),e=t.ReadUInt32(),v=i.substr(e,b)}c.shader=e.CompileShader(h,"",y,a),p?(c.shadowShader=0===b?e.CompileShader(h,"\n#define PS\n",y,a,!0):e.CompileShader(h,"",v,a,!0),null===c.shadowShader&&(p=!1)):c.shadowShader=null,n>=3&&(t.ReadUInt32(),t.ReadUInt32(),t.ReadUInt32()),c.constantSize=0;const g=t.ReadUInt32();for(let n=0;n<g;++n){const r={};if(r.name=s(),r.offset=t.ReadUInt32()/4,r.size=t.ReadUInt32()/4,r.type=t.ReadUInt8(),r.dimension=t.ReadUInt8(),r.elements=t.ReadUInt32(),r.isSRGB=t.ReadUInt8(),r.isAutoregister=t.ReadUInt8(),c.constants[n]=r,e.ConstantIgnore.includes(r.name))continue;const i=r.offset+r.size;i>c.constantSize&&(c.constantSize=i)}const _=t.ReadUInt32()/4;if(c.constantValues=new Float32Array(_),n<5)for(let e=0;e<_;++e)c.constantValues[e]=t.ReadFloat32();else{const e=t.ReadUInt32(),n=t.cursor;t.cursor=o+e;for(let e=0;e<_;++e)c.constantValues[e]=t.ReadFloat32();t.cursor=n}c.constantSize=Math.max(c.constantSize,_);let w=t.ReadUInt8();for(let e=0;e<w;++e){const e={};e.registerIndex=t.ReadUInt8(),e.name=s(),e.type=t.ReadUInt8(),e.isSRGB=t.ReadUInt8(),e.isAutoregister=t.ReadUInt8(),c.textures.push(e)}const E=t.ReadUInt8();for(let e=0;e<E;++e){const e=t.ReadUInt8(),i=n>=4?s():"";t.ReadUInt8();const o=t.ReadUInt8(),a=t.ReadUInt8(),f=t.ReadUInt8(),h=t.ReadUInt8(),d=t.ReadUInt8(),p=t.ReadUInt8();t.ReadFloat32();const m=t.ReadUInt8();t.ReadUInt8();const y=r.C.create();y[0]=t.ReadFloat32(),y[1]=t.ReadFloat32(),y[2]=t.ReadFloat32(),y[3]=t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32(),n<4&&t.ReadUInt8();const b=new Dt.b;if(b.registerIndex=e,b.name=i,1===o){switch(f){case 0:b.minFilter=l.NEAREST;break;case 1:b.minFilter=l.NEAREST_MIPMAP_NEAREST;break;default:b.minFilter=l.NEAREST_MIPMAP_LINEAR}b.minFilterNoMips=l.NEAREST}else{switch(f){case 0:b.minFilter=l.LINEAR;break;case 1:b.minFilter=l.LINEAR_MIPMAP_NEAREST;break;default:b.minFilter=l.LINEAR_MIPMAP_LINEAR}b.minFilterNoMips=l.LINEAR}b.magFilter=1===a?l.NEAREST:l.LINEAR,b.addressU=u[h],b.addressV=u[d],b.addressW=u[p],3!==o&&3!==a&&3!==f||(b.anisotropy=Math.max(m,1));for(let e=0;e<c.textures.length;++e)if(c.textures[e].registerIndex===b.registerIndex){b.samplerType=4===c.textures[e].type?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D,b.isVolume=3===c.textures[e].type;break}b.ComputeHash(),c.samplers.push(b)}n>=3&&t.ReadUInt8(),f.stages[h]=c}f.states=[];const m=t.ReadUInt8();for(let e=0;e<m;++e){const e=t.ReadUInt32(),n=t.ReadUInt32();f.states.push({state:e,value:n})}f.shaderProgram=e.CreateProgram(f.stages[0].shader,f.stages[1].shader,f,a),p?(f.shadowShaderProgram=e.CreateProgram(f.stages[0].shadowShader,f.stages[1].shadowShader,f,a,!0),null===f.shadowShaderProgram&&(f.shadowShaderProgram=f.shaderProgram)):f.shadowShaderProgram=f.shaderProgram,c.passes[h]=f}}const f=t.ReadUInt16();for(let e=0;e<f;++e){const e=s(),n=[],r=t.ReadUInt8();for(let e=0;e<r;++e)switch(n[e]={},n[e].name=s(),n[e].type=t.ReadUInt8(),n[e].type){case 0:n[e].value=0!==t.ReadUInt32();break;case 1:n[e].value=t.ReadInt32();break;case 2:n[e].value=t.ReadFloat32();break;default:n[e].value=s()}this.annotations[e]=n}}var t,n,i;return t=e,i=[{key:"Has",value:function(e,t,n){for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];for(let e=0;e<i.passes.length;e++){const r=i.passes[e];for(let e=0;e<r.stages.length;e++){const i=r.stages[e];for(let e=0;e<i[t].length;e++)if(i[t][e].name===n)return!0}}}return!1}},{key:"CompileShader",value:function(e,t,n,i,o){const a=r.w.ext,s=r.w.gl,u=s.createShader(0===e?s.VERTEX_SHADER:s.FRAGMENT_SHADER);if(a.ShaderBinary)a.ShaderBinary.shaderBinary(u,n);else{let e=t+(r.F.isString(n)?n:String.fromCharCode.apply(null,n));e=e.substr(0,e.length-1),s.shaderSource(u,e),s.compileShader(u)}if(!s.getShaderParameter(u,s.COMPILE_STATUS)){if(!o)throw new Oe.t({path:i,shaderType:0===e?"vertex":"fragment",infoLog:s.getShaderInfoLog(u)});return null}return u}},{key:"CreateProgram",value:function(e,t,n,i,o){const a=r.w.gl,s={};if(s.program=a.createProgram(),a.attachShader(s.program,e),a.attachShader(s.program,t),a.linkProgram(s.program),!a.getProgramParameter(s.program,a.LINK_STATUS)){if(!o)throw new Oe.v({path:i,infoLog:a.getProgramInfoLog(s.program)});return null}a.useProgram(s.program),s.constantBufferHandles=[];for(let e=0;e<16;++e)s.constantBufferHandles[e]=a.getUniformLocation(s.program,"cb"+e);s.samplerHandles=[];for(let e=0;e<16;++e)s.samplerHandles[e]=a.getUniformLocation(s.program,"s"+e),a.uniform1i(s.samplerHandles[e],e);for(let e=0;e<16;++e)s.samplerHandles[e+12]=a.getUniformLocation(s.program,"vs"+e),a.uniform1i(s.samplerHandles[e+12],e+12);s.input=new Be.a;for(let e=0;e<n.stages[0].inputDefinition.elements.length;++e){let t=a.getAttribLocation(s.program,"attr"+e);if(t>=0){const r=new Be.b(n.stages[0].inputDefinition.elements[e].usage,n.stages[0].inputDefinition.elements[e].usageIndex);r.location=t,s.input.elements.push(r)}}s.input.RebuildHash(),s.shadowStateInt=a.getUniformLocation(s.program,"ssi"),s.shadowStateFloat=a.getUniformLocation(s.program,"ssf"),s.shadowStateYFlip=a.getUniformLocation(s.program,"ssyf"),a.uniform3f(s.shadowStateYFlip,0,0,1),s.volumeSlices=[];for(let e=0;e<n.stages[1].samplers.length;++e)n.stages[1].samplers[e].isVolume&&(s.volumeSlices[n.stages[1].samplers[e].registerIndex]=a.getUniformLocation(s.program,"s"+n.stages[1].samplers[e].registerIndex+"sl"));return s}}],(n=[{key:"ApplyPass",value:function(e,t){const n=r.w,i=n.gl;t=this.techniques[e].passes[t];for(let e=0;e<t.states.length;++e)n.SetRenderState(t.states[e].state,t.states[e].value);n.IsAlphaTestEnabled()?(i.useProgram(t.shadowShaderProgram.program),n.shadowHandles=t.shadowShaderProgram):(i.useProgram(t.shaderProgram.program),n.shadowHandles=null)}},{key:"HasConstant",value:function(e){return this.constructor.Has(this.techniques,"constants",e)}},{key:"HasTexture",value:function(e){return this.constructor.Has(this.techniques,"textures",e)}},{key:"HasSampler",value:function(e){return this.constructor.Has(this.techniques,"samplers",e)}}])&&kt(t.prototype,n),i&&kt(t,i),e}();function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}xt(Gt,"ConstantIgnore",["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS"]);let Nt=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=Ft(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?Bt(n):r,Ut(Bt(Bt(e)),"passes",[]),Ut(Bt(Bt(e)),"annotations",{}),Ut(Bt(Bt(e)),"permutations",[]),Ut(Bt(Bt(e)),"offsets",[]),Ut(Bt(Bt(e)),"reader",null),Ut(Bt(Bt(e)),"version",0),Ut(Bt(Bt(e)),"stringTable",""),Ut(Bt(Bt(e)),"shaders",{}),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(t,Mt["a"]),n=t,(r=[{key:"Prepare",value:function(e){this.permutations=[],this.offsets=[],this.passes=[],this.annotations={},this.reader=null,this.version=0,this.stringTable="",this.shaders={};const t=new It.a(new Uint8Array(e));let n="";function r(){const e=t.ReadUInt32();let r=e;for(;n.charCodeAt(r);)++r;return n.substr(e,r-e)}const i=t.ReadUInt32();if(i<2||i>7)return void this.OnError(new Oe.x({path:this.path,version:i}));let o,a;if(i<5){if(0===(o=t.ReadUInt32()))return void this.OnError(new Oe.u({path:this.path}));t.ReadUInt32();const e=t.ReadUInt32();t.cursor=8+3*o*4,a=t.ReadUInt32(),this.stringTableOffset=t.cursor,n=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+a)),t.cursor=e}else{a=t.ReadUInt32(),this.stringTableOffset=t.cursor,n=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+a)),t.cursor+=a;const e=t.ReadUInt8();for(let n=0;n<e;++n){let e={name:r(),defaultOption:t.ReadUInt8(),description:r(),type:t.ReadUInt8(),options:{},optionCount:t.ReadUInt8()};for(let t=0;t<e.optionCount;++t)e.options[r()]=t;this.permutations.push(e)}if(0===(o=t.ReadUInt32()))return void this.OnError(new Oe.u({path:this.path}));for(let e=0;e<o;++e)this.offsets.push({index:t.ReadUInt32(),offset:t.ReadUInt32(),size:t.ReadUInt32()});t.ReadUInt32(),t.cursor=t.ReadUInt32()}this.reader=t,this.version=i,this.stringTable=n,this.OnPrepared()}},{key:"GetShader",value:function(e){if(!this.IsGood())return null;let t=0,n=1;for(let r=0;r<this.permutations.length;++r){let i=this.permutations[r],o=i.defaultOption;if(e.hasOwnProperty(i.name)){let t=e[i.name];if(!i.options.hasOwnProperty(t))return this.OnError(new Oe.w({path:this.path,permutation:i.name,valueName:t})),null;o=i.options[t]}t+=o*n,n*=i.optionCount}if(this.shaders.hasOwnProperty(t))return this.shaders[t];this.reader.cursor=this.offsets[t].offset;let r=null;try{r=new Gt(this.reader,this.version,this.stringTable,this.stringTableOffset,this.path)}catch(e){return this.OnError(e),null}return this.shaders[t]=r,r}}])&&jt(n.prototype,r),i&&jt(n,i),t}();function Vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Nt.prototype.requestResponseType="arraybuffer";let Yt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Ht(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?qt(n):i,Xt(qt(qt(e)),"meshes",[]),Xt(qt(qt(e)),"minBounds",r.H.create()),Xt(qt(qt(e)),"maxBounds",r.H.create()),Xt(qt(qt(e)),"boundsSpherePosition",r.H.create()),Xt(qt(qt(e)),"boundsSphereRadius",0),Xt(qt(qt(e)),"models",[]),Xt(qt(qt(e)),"animations",[]),Xt(qt(qt(e)),"systemMirror",!1),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,Mt["a"]),n=t,o=[{key:"BindMeshToModel",value:function(e,t,n){const r=new et;r.mesh=e;for(let e=0;e<r.mesh.boneBindings.length;++e){const i=r.mesh.boneBindings[e],o=t.FindBoneByName(i);if(!o)throw new Oe.e({path:n.path,mesh:r.mesh.name,bone:i,model:t.name});r.bones[r.bones.length]=o}t.meshBindings[t.meshBindings.length]=r}},{key:"ReadVertexBuffer",value:function(e,t,n){const i=e.ReadUInt8();let o=0;for(let n=0;n<i;++n){let i=new Be.b;i.usage=e.ReadUInt8(),i.usageIndex=e.ReadUInt8(),i.fileType=e.ReadUInt8(),i.type=r.w.gl.FLOAT,i.elements=1+(i.fileType>>5),i.offset=4*o,t.elements[n]=i,o+=i.elements}t.RebuildHash(),t.stride=4*o;const a=e.ReadUInt32();if(0===a)return null;const s=new Float32Array(o*a);let u=0;for(let r=0;r<a;++r)for(let r=0;r<i;++r){let i=t.elements[r];switch(15&i.fileType){case 0:if(0!=(16&i.fileType))for(let t=0;t<i.elements;++t)s[u++]=e.ReadInt8()/127;else for(let t=0;t<i.elements;++t)s[u++]=e.ReadInt8();break;case 1:if(0!=(16&i.fileType))for(let t=0;t<i.elements;++t)s[u++]=e.ReadInt8()/32767;else for(let t=0;t<i.elements;++t)s[u++]=e.ReadInt16();break;case 2:for(let t=0;t<i.elements;++t)s[u++]=e.ReadInt32();break;case 3:for(let t=0;t<i.elements;++t)s[u++]=e.ReadFloat16();break;case 4:for(let t=0;t<i.elements;++t)s[u++]=e.ReadFloat32();break;case 8:if(0!=(16&i.fileType))for(let t=0;t<i.elements;++t)s[u++]=e.ReadUInt8()/255;else for(let t=0;t<i.elements;++t)s[u++]=e.ReadUInt8();break;case 9:if(0!=(16&i.fileType))for(let n=0;n<t.elements[r].elements;++n)s[u++]=e.ReadUInt8()/65535;else for(let t=0;t<i.elements;++t)s[u++]=e.ReadUInt16();break;case 10:for(let t=0;t<i.elements;++t)s[u++]=e.ReadUInt32();break;default:throw new Oe.d({path:n,key:"fileType",value:15&i.fileType})}}return s}},{key:"ReadIndexBuffer",value:function(e){const t=e.ReadUInt8(),n=e.ReadUInt32();if(0===t){const t=new Uint16Array(n);for(let r=0;r<n;++r)t[r]=e.ReadUInt16();return t}{const t=new Uint32Array(n);for(let r=0;r<n;++r)t[r]=e.ReadUInt32();return t}}},{key:"ReadCurve",value:function(e){if(0===e.ReadUInt8())return null;const t=new We;t.dimension=e.ReadUInt8(),t.degree=e.ReadUInt8();const n=e.ReadUInt32();t.knots=new Float32Array(n);for(let r=0;r<n;++r)t.knots[r]=e.ReadFloat32();const r=e.ReadUInt32();t.controls=new Float32Array(r);for(let n=0;n<r;++n)t.controls[n]=e.ReadFloat32();return t}}],(i=[{key:"GetInstanceBuffer",value:function(e){return e<this.meshes.length?this.meshes[e].buffer:void 0}},{key:"GetInstanceDeclaration",value:function(e){return this.meshes[e].declaration}},{key:"GetInstanceStride",value:function(e){return this.meshes[e].declaration.stride}},{key:"GetInstanceCount",value:function(e){return 4*this.meshes[e].bufferLength/this.meshes[e].declaration.stride}},{key:"Prepare",value:function(e){const n=r.w.gl,i=new It.a(new Uint8Array(e));i.ReadUInt8();const o=i.ReadUInt8();for(let e=0;e<o;++e){const o=new Qe;o.name=i.ReadString();const a=t.ReadVertexBuffer(i,o.declaration,this.path);a?(o.bufferLength=a.length,o.buffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,o.buffer),n.bufferData(n.ARRAY_BUFFER,a,n.STATIC_DRAW)):o.buffer=null;const s=t.ReadIndexBuffer(i);s?(o.indexes=n.createBuffer(),o.indexType=2===s.BYTES_PER_ELEMENT?n.UNSIGNED_SHORT:n.UNSIGNED_INT,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.indexes),n.bufferData(n.ELEMENT_ARRAY_BUFFER,s,n.STATIC_DRAW)):o.indexes=null;const u=i.ReadUInt8();for(let e=0;e<u;++e)o.areas[e]=new $e,o.areas[e].name=i.ReadString(),o.areas[e].start=i.ReadUInt32()*s.BYTES_PER_ELEMENT,o.areas[e].count=3*i.ReadUInt32(),o.areas[e].minBounds=r.H.fromValues(i.ReadFloat32(),i.ReadFloat32(),i.ReadFloat32()),o.areas[e].maxBounds=r.H.fromValues(i.ReadFloat32(),i.ReadFloat32(),i.ReadFloat32());const l=i.ReadUInt8();o.boneBindings=[];for(let e=0;e<l;++e)o.boneBindings[e]=i.ReadString();const c=i.ReadUInt16();if((c||this.systemMirror)&&(o.bufferData=a,o.indexData=s),c){o.blendShapes=[];for(let e=0;e<c;++e)o.blendShapes[e]=new Ne,o.blendShapes[e].name=i.ReadString(),o.blendShapes[e].buffer=t.ReadVertexBuffer(i,o.blendShapes[e].declaration,this.path),o.blendShapes[e].indexes=t.ReadIndexBuffer(i)}this.meshes[e]=o}const a=i.ReadUInt8();for(let e=0;e<a;++e){const e=new rt;e.name=i.ReadString(),e.skeleton=new it;const n=i.ReadUInt8();for(let t=0;t<n;++t){const n=new Xe;n.name=i.ReadString();const o=i.ReadUInt8();if(n.parentIndex=i.ReadUInt8(),255===n.parentIndex&&(n.parentIndex=-1),0!=(1&o)?r.H.set(n.position,i.ReadFloat32(),i.ReadFloat32(),i.ReadFloat32()):r.H.set(n.position,0,0,0),0!=(2&o)?r.C.set(n.orientation,i.ReadFloat32(),i.ReadFloat32(),i.ReadFloat32(),i.ReadFloat32()):r.C.identity(n.orientation),0!=(4&o))for(let e=0;e<9;++e)n.scaleShear[e]=i.ReadFloat32();else r.y.identity(n.scaleShear);e.skeleton.bones[t]=n}for(let t=0;t<e.skeleton.bones.length;++t)e.skeleton.bones[t].UpdateTransform(),-1!==e.skeleton.bones[t].parentIndex?r.z.multiply(e.skeleton.bones[t].worldTransform,e.skeleton.bones[e.skeleton.bones[t].parentIndex].worldTransform,e.skeleton.bones[t].localTransform):r.z.copy(e.skeleton.bones[t].worldTransform,e.skeleton.bones[t].localTransform),r.z.invert(e.skeleton.bones[t].worldTransformInv,e.skeleton.bones[t].worldTransform);const o=i.ReadUInt8();for(let n=0;n<o;++n){const n=i.ReadUInt8();n<this.meshes.length&&t.BindMeshToModel(this.meshes[n],e,this)}this.models[this.models.length]=e}const s=i.ReadUInt8();for(let e=0;e<s;++e){const e=new He;e.name=i.ReadString(),e.duration=i.ReadFloat32();const n=i.ReadUInt8();for(let r=0;r<n;++r){const n=new at;n.name=i.ReadString();for(let e=0;e<this.models.length;++e)if(this.models[e].name===n.name){n.model=this.models[e];break}const r=i.ReadUInt8();for(let e=0;e<r;++e){const e=new ut;if(e.name=i.ReadString(),e.orientation=t.ReadCurve(i),e.position=t.ReadCurve(i),e.scaleShear=t.ReadCurve(i),e.orientation){let t=0,n=0,r=0,i=0;for(let o=0;o<e.orientation.controls.length;o+=4){let a=e.orientation.controls[o],s=e.orientation.controls[o+1],u=e.orientation.controls[o+2],l=e.orientation.controls[o+3];t*a+n*s+r*u+i*l<0&&(e.orientation.controls[o]=-a,e.orientation.controls[o+1]=-s,e.orientation.controls[o+2]=-u,e.orientation.controls[o+3]=-l),t=a,n=s,r=u,i=l}}n.transformTracks[n.transformTracks.length]=e}e.trackGroups[e.trackGroups.length]=n}this.animations[this.animations.length]=e}this.OnPrepared()}},{key:"RenderAreasInstanced",value:function(e,t,n,i,o,a,s,u,l){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||e>=this.meshes.length)return!1;const c=r.w,f=c.ext,h=c.gl,d=this.meshes[e],p=i.GetPassCount(o);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,d.indexes);for(let e=0;e<p;++e){i.ApplyPass(o,e);const r=i.GetPassInput(o,e);if(0===r.elements.length)continue;h.bindBuffer(h.ARRAY_BUFFER,d.buffer),d.declaration.SetPartialDeclaration(r,d.declaration.stride),h.bindBuffer(h.ARRAY_BUFFER,a);const p=s.SetPartialDeclaration(r,u,8,1);c.ApplyShadowState();for(let e=0;e<n;++e)if(e+t<d.areas.length){let r=d.areas[e+t],i=r.start,o=r.count;for(;e+1<n&&(r=d.areas[e+1+t]).start===i+2*o;)o+=r.count,++e;f.drawElementsInstanced(h.TRIANGLES,o,d.indexType,i,l)}s.ResetInstanceDivisors(p)}return!0}},{key:"RenderAreas",value:function(e,t,n,i,o){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||e>=this.meshes.length)return!1;const a=r.w,s=a.gl,u=this.meshes[e]||this.meshes[0],l=i.GetPassCount(o);s.bindBuffer(s.ARRAY_BUFFER,u.buffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,u.indexes);for(let e=0;e<l;++e){i.ApplyPass(o,e);const r=i.GetPassInput(o,e);if(!u.declaration.SetDeclaration(r,u.declaration.stride))return this.OnError(new Oe.f({path:this.path,pass:e,passInput:r,meshStride:u.declaration.stride})),!1;a.ApplyShadowState();for(let e=0;e<n;++e)if(e+t<u.areas.length){let r=u.areas[e+t],i=r.start,o=r.count;for(;e+1<n&&(r=u.areas[e+1+t]).start===i+2*o;)o+=r.count,++e;s.drawElements(s.TRIANGLES,o,u.indexType,i)}}return!0}},{key:"RenderLines",value:function(e,t,n,i,o){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||e>=this.meshes.length)return!1;const a=r.w,s=a.gl,u=this.meshes[e],l=i.GetPassCount(o);s.bindBuffer(s.ARRAY_BUFFER,u.buffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,u.indexes);for(let e=0;e<l;++e){i.ApplyPass(o,e);const r=i.GetPassInput(o,e);if(!u.declaration.SetDeclaration(r,u.declaration.stride))return this.OnError(new Oe.f({path:this.path,pass:e,passInput:r,meshStride:u.declaration.stride})),!1;a.ApplyShadowState();for(let e=0;e<n;++e)if(e+t<u.areas.length){let r=u.areas[e+t],i=r.start,o=r.count;for(;e+1<n&&(r=u.areas[e+1+t]).start===i+2*o;)o+=r.count,++e;s.drawElements(s.LINES,o,u.indexType,i)}}return!0}},{key:"RenderDebugInfo",value:function(e){if(!this.IsGood())return!1;for(let t=0;t<this.models.length;++t)if(this.models[t].skeleton)for(let n=0;n<this.models[t].skeleton.bones.length;++n){const r=this.models[t].skeleton.bones[n];if(r.parentIndex>=0){const n=this.models[t].skeleton.bones[r.parentIndex];e.AddLine([r.worldTransform[12],r.worldTransform[13],r.worldTransform[14]],[n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]],[0,.7,0,1],[0,.7,0,1])}}}},{key:"Unload",value:function(){for(let e=0;e<this.meshes.length;++e){const t=r.w.gl;this.meshes[e].buffer&&(t.deleteBuffer(this.meshes[e].buffer),this.meshes[e].buffer=null),this.meshes[e].indexes&&(t.deleteBuffer(this.meshes[e].indexes),this.meshes[e].indexes=null)}return this._isPurged=!0,this._isGood=!1,!0}}])&&Vt(n.prototype,i),o&&Vt(n,o),t}();Yt.prototype.requestResponseType="arraybuffer";var Wt=n(15),Kt=n(11);function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t,n){return(Zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$t(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function $t(e){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jt(e,t){return(Jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let nn=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=$t(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?en(n):r,tn(en(en(e)),"texture",null),tn(en(en(e)),"video",null),tn(en(en(e)),"width",0),tn(en(en(e)),"height",0),tn(en(en(e)),"cycle",!0),tn(en(en(e)),"playOnLoad",!0),tn(en(en(e)),"_currentSampler",0),tn(en(en(e)),"_currentTime",-1),tn(en(en(e)),"_playable",!1),tn(en(en(e)),"_isPlaying",!1),tn(en(en(e)),"_onPlaying",null),tn(en(en(e)),"_onPause",null),tn(en(en(e)),"_onEnded",null),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jt(e,t)}(t,Mt["a"]),n=t,(i=[{key:"IsGood",value:function(){return this.KeepAlive(),Zt($t(t.prototype),"IsGood",this).call(this)&&this.video&&this._playable}},{key:"KeepAlive",value:function(){this.activeFrame=r.D.activeFrame}},{key:"Play",value:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cycle=e,this._onEnded=t,this.video&&this._playable?(this.video.loop=this.cycle,this.video.play()):this.playOnLoad=!0}},{key:"Pause",value:function(){this.video?this.video.pause():this.playOnLoad=!1}},{key:"Prepare",value:function(e){const t=r.w.gl;switch(e){case"mp4":case"webm":case"ogg":this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.video),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),this.width=this.video.width,this.height=this.video.height,this.video.loop=this.cycle,this.playOnLoad&&this.video.play();break;default:throw new Oe.p({path:this.path,extension:e})}this.OnPrepared()}},{key:"DoCustomLoad",value:function(e,t){switch(t){case"mp4":case"webm":case"ogg":break;default:throw new Oe.p({path:e,extension:t})}return this.OnRequested(),r.D._pendingLoads++,this.video=document.createElement("video"),this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.onerror=(()=>{r.D._pendingLoads--,this.video=null,this.OnError(new Oe.k({path:e}))}),this.video.oncanplay=(()=>{this._playable=!0,this.video.oncanplay=null,r.D._pendingLoads--,r.D._prepareQueue.push([this,t,null]),this.OnLoaded()}),this.video.onended=(()=>{this._isPlaying=!1,this._onEnded&&this._onEnded(this)}),this.video.onpause=(()=>{this._isPlaying=!1,this._onPause&&this._onPause(this)}),this.video.onplaying=(()=>{this._isPlaying=!0,this._onPlaying&&this._onPlaying(this)}),this.video.src=e,!0}},{key:"Unload",value:function(){return this.texture&&(r.w.gl.deleteTexture(this.texture),this.texture=null),this._isPlaying=!1,this._playable=!1,this.playOnLoad=!0,this.video=null,!0}},{key:"Bind",value:function(e){const t=r.w,n=t.gl;this.KeepAlive();const i=e.samplerType;i===n.TEXTURE_2D&&(this.texture?(this._currentTime=this.video.currentTime,n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.video),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(i,this.texture),e.hash!==this._currentSampler&&(e.Apply(!1),this._currentSampler=e.hash)):n.bindTexture(n.TEXTURE_2D,t.GetFallbackTexture()))}}])&&Qt(n.prototype,i),o&&Qt(n,o),t}();function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let on=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),rn(this,"boneRes",null),rn(this,"localTransform",r.z.create()),rn(this,"worldTransform",r.z.create()),rn(this,"offsetTransform",r.z.create())};function an(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let sn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),an(this,"modelRes",null),an(this,"bones",[]),an(this,"bonesByName",{})};function un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ln=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),un(this,"trackRes",null),un(this,"bone",null)};function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let fn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),cn(this,"trackGroupRes",null),cn(this,"model",null),cn(this,"transformTracks",[])};function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let pn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),dn(this,"geometryResources",[]),dn(this,"models",[]),dn(this,"animations",[]),dn(this,"meshBindings",[]),dn(this,"loaded",!1),dn(this,"update",!0),dn(this,"pendingCommands",[]),dn(this,"onPendingCleared",null),dn(this,"_geometryResource",null),t&&this.SetGeometryResource(t)}var t,n,i;return t=e,i=[{key:"AddModel",value:function(e,t){for(let n=0;n<e.models.length;++n)if(e.models[n].modelRes.name===t.name)return null;const n=new sn;n.modelRes=t;const r=t.skeleton;if(null!==r)for(let e=0;e<r.bones.length;++e){const t=new on;t.boneRes=r.bones[e],n.bones.push(t),n.bonesByName[t.boneRes.name]=t}return e.models.push(n),n}},{key:"FindMeshBindings",value:function(e,t){for(let n=0;n<e.meshBindings.length;++n)if(e.meshBindings[n].resource===t)return e.meshBindings[n];return null}},{key:"DoRebuildCachedData",value:function(t,n){const r=[];if(n.meshes.length)for(let i=0;i<n.models.length;++i){const o=e.AddModel(t,n.models[i]);o&&r.push(o)}for(let e=0;e<t.geometryResources.length;++e)t.AddAnimationsFromRes(t.geometryResources[e]);if(0===n.models.length){for(let e=0;e<n.meshes.length;++e)Yt.BindMeshToModel(n.meshes[e],t.geometryResources[0].models[0],n);n.models.push(t.geometryResources[0].models[0])}for(let r=0;r<n.models.length;++r){let i=null;for(let e=0;e<t.models.length;++e)if(t.models[e].modelRes.name===n.models[r].name){i=t.models[e];break}if(null!==i)for(let o=0;o<n.models[r].meshBindings.length;++o){const a=n.meshes.indexOf(n.models[r].meshBindings[o].mesh);let s=e.FindMeshBindings(t,n);null===s&&((s=[]).resource=n,t.meshBindings.push(s)),s[a]=new Float32Array(12*n.models[r].meshBindings[o].bones.length);for(let e=0;e<n.models[r].meshBindings[o].bones.length;++e)for(let t=0;t<i.bones.length;++t)if(i.bones[t].boneRes.name===n.models[r].meshBindings[o].bones[e].name){i.bones[t].bindingArrays||(i.bones[t].bindingArrays=[]),i.bones[t].bindingArrays[i.bones[t].bindingArrays.length]={array:s[a],offset:12*e};break}}}if(n.meshes.length&&n.models.length&&t.ResetBoneTransforms(),t.loaded=!0,t.animations.length){if(t.pendingCommands.length)for(let e=0;e<t.pendingCommands.length;++e)t.pendingCommands[e].args?t.pendingCommands[e].func.apply(t,t.pendingCommands[e].args):t.pendingCommands[e].func.apply(t);t.pendingCommands=[],t.onPendingCleared&&t.onPendingCleared(t)}}}],(n=[{key:"GetAnimationsByName",value:function(){if(!this.loaded)return null;const e={};for(let t=0;t<this.animations.length;t++)e[this.animations[t].animationRes.name]=this.animations[t];return e}},{key:"GetAnimation",value:function(e){for(let t=0;t<this.animations.length;t++)if(this.animations[t].animationRes.name===e)return this.animations[t];return null}},{key:"ResetAnimation",value:function(e){const t=this.GetAnimation(e);if(t)return t.time=0,t.isPlaying=!1,t.callback=null,!0}},{key:"PlayAnimation",value:function(e,t,n){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimation,args:[e,t,n]}),!0;const i=this.GetAnimation(e);return i?(i.time=0,i.isPlaying=!0,r.F.isUndefined(t)||(i.cycle=t),n&&(i.callback=n),!0):void 0}},{key:"PlayAnimationFrom",value:function(e,t,n,i){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimationFrom,args:[e,t,n,i]}),!0;const o=this.GetAnimation(e);return o?(o.time=Math.max(Math.min(t,o.animationRes.duration),0),o.isPlaying=!0,r.F.isUndefined(n)||(o.cycle=n),i&&(o.callback=i),!0):void 0}},{key:"GetPlayingAnimations",value:function(){const e=[];for(let t=0;t<this.animations.length;t++)this.animations[t].isPlaying&&e.push(this.animations[t].animationRes.name);return e}},{key:"StopAnimation",value:function(e){if(0===this.animations.length)return void this.pendingCommands.push({func:this.StopAnimation,args:e});e=r.F.toArray(e);const t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;for(let e=0;e<this.animations.length;++e)this.animations[e].animationRes.name in t&&(this.animations[e].isPlaying=!1)}},{key:"StopAllAnimations",value:function(){if(0!==this.animations.length)for(let e=0;e<this.animations.length;++e)this.animations[e].isPlaying=!1;else this.pendingCommands.push({func:this.StopAllAnimations,args:null})}},{key:"StopAllAnimationsExcept",value:function(e){if(0===this.animations.length)return void this.pendingCommands.push({func:this.StopAllAnimationsExcept,args:e});r.F.toArray(e);const t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;for(let e=0;e<this.animations.length;++e)this.animations[e].animationRes.name in t||(this.animations[e].isPlaying=!1)}},{key:"SetGeometryResource",value:function(e){this.models=[],this.animations=[],this.meshBindings=[];for(let e=0;e<this.geometryResources.length;++e)this.geometryResources[e].UnregisterNotification(this);this.loaded=!1,this.geometryResources=[],e&&(this.geometryResources.push(e),e.RegisterNotification(this))}},{key:"AddGeometryResource",value:function(e){for(let t=0;t<this.geometryResources.length;++t)if(this.geometryResources[t]===e)return;this.geometryResources.push(e),e.RegisterNotification(this)}},{key:"AddAnimationsFromRes",value:function(e){for(let t=0;t<e.animations.length;++t){let n=null;for(let r=0;r<this.animations.length;++r)if(this.animations[r].animationRes===e.animations[t]){n=this.animations[t];break}n||((n=new At).animationRes=e.animations[t],this.animations.push(n));for(let e=0;e<n.animationRes.trackGroups.length;++e){let t=!1;for(let r=0;r<n.trackGroups.length;++r)if(n.trackGroups[r].trackGroupRes===n.animationRes.trackGroups[e]){t=!0;break}if(t)continue;let r=null;for(let t=0;t<this.models.length;++t)if(this.models[t].modelRes.name===n.animationRes.trackGroups[e].name){r=this.models[t];break}if(null!==r){const t=new fn;t.trackGroupRes=n.animationRes.trackGroups[e];for(let e=0;e<t.trackGroupRes.transformTracks.length;++e)for(let n=0;n<r.bones.length;++n)if(r.bones[n].boneRes.name===t.trackGroupRes.transformTracks[e].name){const i=new ln;i.trackRes=t.trackGroupRes.transformTracks[e],i.bone=r.bones[n],t.transformTracks.push(i);break}n.trackGroups.push(t)}}}}},{key:"ResetBoneTransforms",value:function(){for(let e=0;e<this.models.length;++e)for(let t=0;t<this.models[e].bones.length;++t){const n=this.models[e].bones[t],i=n.boneRes;r.z.copy(n.localTransform,i.localTransform),-1!==i.parentIndex?r.z.multiply(n.worldTransform,n.localTransform,this.models[e].bones[n.boneRes.parentIndex].worldTransform):r.z.set(n.worldTransform,n.localTransform),r.z.identity(n.offsetTransform)}const t=r.z.identity(e.global.mat4_0);for(let e=0;e<this.meshBindings.length;++e)for(let n=0;n<this.meshBindings[e].length;++n)for(let r=0;16*r<this.meshBindings[e][n].length;++r)for(let i=0;i<16;++i)this.meshBindings[e][n][16*r+i]=t[i]}},{key:"GetBoneMatrices",value:function(t,n){if(0===this.geometryResources.length)return new Float32Array;n||(n=this.geometryResources[0]);const r=e.FindMeshBindings(this,n);return r&&t<r.length?r[t]:new Float32Array}},{key:"FindModelForMesh",value:function(e,t){if(0===this.geometryResources.length)return null;if(t||(t=this.geometryResources[0]),!t.IsGood())return null;const n=t.meshes[e];for(let e=0;e<this.models.length;++e)for(let t=0;t<this.models[e].modelRes.meshBindings.length;++e)if(this.models[e].modelRes.meshBindings[t].mesh===n)return this.models[e];return null}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.geometryResources.length;t++)e.includes(this.geometryResources[t])||e.push(this.geometryResources[t]);return e}},{key:"RebuildCachedData",value:function(t){let n=!1;for(let e=0;e<this.geometryResources.length;++e)if(this.geometryResources[e]===t){n=!0;break}if(n){for(let e=0;e<this.geometryResources.length;++e)if(!this.geometryResources[e].IsGood())return;for(let t=0;t<this.geometryResources.length;++t)e.DoRebuildCachedData(this,this.geometryResources[t])}}},{key:"Update",value:function(t){if(!this.models||!this.update)return;for(let e=0;e<this.geometryResources.length;++e)this.geometryResources[e].KeepAlive();const n=e.global,i=n.mat4_0,o=n.quat_0,a=n.vec3_0,s=n.mat3_0;for(let e=0;e<this.animations.length;++e){const n=this.animations[e];if(n.isPlaying){const e=n.animationRes;n.time+=t*n.timeScale,n.time>e.duration&&(n.callback&&n.callback(this,n),n.cycle?n.time=n.time%e.duration:(n.isPlaying=!1,n.time=e.duration));for(let t=0;t<n.trackGroups.length;++t)for(let u=0;u<n.trackGroups[t].transformTracks.length;++u){const l=n.trackGroups[t].transformTracks[u];l.trackRes.position?r.v.evaluate(l.trackRes.position,n.time,a,n.cycle,e.duration):a[0]=a[1]=a[2]=0,l.trackRes.orientation?(r.v.evaluate(l.trackRes.orientation,n.time,o,n.cycle,e.duration),r.C.normalize(o,o)):r.C.identity(o),l.trackRes.scaleShear?r.v.evaluate(l.trackRes.scaleShear,n.time,s,n.cycle,e.duration):r.y.identity(s),r.z.fromMat3(l.bone.localTransform,s),r.z.multiply(l.bone.localTransform,l.bone.localTransform,r.z.fromQuat(i,o)),l.bone.localTransform[12]=a[0],l.bone.localTransform[13]=a[1],l.bone.localTransform[14]=a[2]}}}for(let e=0;e<this.models.length;++e)for(let t=0;t<this.models[e].bones.length;++t){const n=this.models[e].bones[t];if(-1!==n.boneRes.parentIndex?r.z.multiply(n.worldTransform,this.models[e].bones[n.boneRes.parentIndex].worldTransform,n.localTransform):r.z.copy(n.worldTransform,n.localTransform),r.z.multiply(n.offsetTransform,n.worldTransform,n.boneRes.worldTransformInv),n.bindingArrays)for(let e=0;e<n.bindingArrays.length;++e)n.bindingArrays[e].array[n.bindingArrays[e].offset+0]=n.offsetTransform[0],n.bindingArrays[e].array[n.bindingArrays[e].offset+1]=n.offsetTransform[4],n.bindingArrays[e].array[n.bindingArrays[e].offset+2]=n.offsetTransform[8],n.bindingArrays[e].array[n.bindingArrays[e].offset+3]=n.offsetTransform[12],n.bindingArrays[e].array[n.bindingArrays[e].offset+4]=n.offsetTransform[1],n.bindingArrays[e].array[n.bindingArrays[e].offset+5]=n.offsetTransform[5],n.bindingArrays[e].array[n.bindingArrays[e].offset+6]=n.offsetTransform[9],n.bindingArrays[e].array[n.bindingArrays[e].offset+7]=n.offsetTransform[13],n.bindingArrays[e].array[n.bindingArrays[e].offset+8]=n.offsetTransform[2],n.bindingArrays[e].array[n.bindingArrays[e].offset+9]=n.offsetTransform[6],n.bindingArrays[e].array[n.bindingArrays[e].offset+10]=n.offsetTransform[10],n.bindingArrays[e].array[n.bindingArrays[e].offset+11]=n.offsetTransform[14]}}},{key:"RenderDebugInfo",value:function(e){for(let t=0;t<this.models.length;++t)for(let n=0;n<this.models[t].bones.length;++n){const r=this.models[t].bones[n];if(r.boneRes.parentIndex>=0){const n=this.models[t].bones[r.boneRes.parentIndex];e.AddLine([r.worldTransform[12],r.worldTransform[13],r.worldTransform[14]],[n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]])}}}}])&&hn(t.prototype,n),i&&hn(t,i),e}();dn(pn,"global",{vec3_0:r.H.create(),quat_0:r.C.create(),mat3_0:r.y.create(),mat4_0:r.z.create()});var mn=n(3);function yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let vn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),bn(this,"_id",r.F.generateID()),bn(this,"name",""),bn(this,"texture",null),bn(this,"width",null),bn(this,"height",null),bn(this,"hasDepth",null),bn(this,"_frameBuffer",null),bn(this,"_renderBuffer",null)}var t,n,i;return t=e,(n=[{key:"Destroy",value:function(){const e=r.w.gl;this.texture&&(e.deleteTexture(this.texture.texture),this.texture=null),this._renderBuffer&&(e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),this._frameBuffer&&(e.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null)}},{key:"Create",value:function(e,t,n){const i=r.w.gl;this.Destroy(),this.texture=new Kt.a,this.texture.Attach(i.createTexture()),this._frameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),i.bindTexture(i.TEXTURE_2D,this.texture.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.bindTexture(i.TEXTURE_2D,null),this._renderBuffer=null,n&&(this._renderBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture.texture,0),n&&i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._renderBuffer),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),this.texture.width=this.width=e,this.texture.height=this.height=t,this.hasDepth=n}},{key:"Set",value:function(){r.w.gl.bindFramebuffer(r.w.gl.FRAMEBUFFER,this._frameBuffer),r.w.gl.viewport(0,0,this.width,this.height)}},{key:"Unset",value:function(){r.w.gl.bindFramebuffer(r.w.gl.FRAMEBUFFER,null),r.w.gl.viewport(0,0,r.w.viewportWidth,r.w.viewportHeight)}}])&&yn(t.prototype,n),i&&yn(t,i),e}();function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let wn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_n(this,"_id",Object(mn.generateID)()),_n(this,"name",""),_n(this,"index",-1),_n(this,"display",!0),_n(this,"effect",null),_n(this,"target",null),_n(this,"inputs",{}),_n(this,"_renderTarget",null),_n(this,"_rebuildPending",!0),_n(this,"_onModified",null)}var t,n,r;return t=e,r=[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return Object(mn.assignIfExists)(t,e,["name","display","target","index"]),e.inputs&&Object.assign(t.inputs,e.inputs),t.effect=lt.a.create({name:e.name,autoParameter:!0,effectFilePath:e.effectFilePath,parameters:e.parameters,textures:e.textures,overrides:e.overrides}),t}}],(n=[{key:"OnValueChanged",value:function(){this._rebuildPending=!0,this._onModified&&this._onModified(this)}},{key:"IsGood",value:function(){return!!this.effect&&this.effect.IsGood()}},{key:"KeepAlive",value:function(){this.effect&&this.effect.KeepAlive()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}}])&&gn(t.prototype,n),r&&gn(t,r),e}();function En(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Rn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Tn(this,"_id",Object(mn.generateID)()),Tn(this,"name",""),Tn(this,"display",!0),Tn(this,"index",-1),Tn(this,"width",0),Tn(this,"height",0),Tn(this,"texture",null),Tn(this,"curveSet",null),Tn(this,"targets",{}),Tn(this,"items",[]),Tn(this,"_visibleItems",[]),Tn(this,"_rebuildPending",!0),Tn(this,"_onChildModified",e=>this.OnValueChanged(e))}var t,n,i;return t=e,i=[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;if(Object(mn.assignIfExists)(t,e,["name","display","index"]),e.targets)for(let n=0;n<e.targets.length;n++)t.targets[e.targets[n]]=null;if(e.steps)for(let n=0;n<e.steps.length;n++)t.CreateItem(e.steps[n]);return t}}],(n=[{key:"OnValueChanged",value:function(){this._rebuildPending=!0}},{key:"IsGood",value:function(){let e=0;for(let t=0;t<this.items.length;t++)this.items[t].IsGood()&&e++;return e===this.items.length}},{key:"KeepAlive",value:function(){this.items.forEach(e=>e.KeepAlive())}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.items.length;t++)this.items[t].GetResources(e);return e}},{key:"CreateItem",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=wn.create(e);return this.AddItem(t),t}},{key:"AddItem",value:function(e){this.items.includes(e)||(e._onModified=this._onChildModified,-1===e.index&&(e.index=this.items.length),this.items.push(e),this.OnValueChanged())}},{key:"RemoveItem",value:function(e){const t=this.items.indexOf(e);-1!==t&&(e._onModified=null,this.items.splice(t,1),this.OnValueChanged())}},{key:"ClearItems",value:function(){for(let e=0;e<this.items.length;e++)this.items[e]._onModified=null;this.items=[],this.OnValueChanged()}},{key:"GetTarget",value:function(e){return e&&e in this.targets?this.targets[e]:null}},{key:"HasTarget",value:function(e){return!(!e||!this.targets[e])}},{key:"CreateTarget",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.w.viewportWidth,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.w.viewportHeight;return this.targets[e]||(this.targets[e]=new vn,this.targets[e].name=e),this.targets[e].Create(t,n,!1),this.targets[e]}},{key:"Update",value:function(e){this.curveSet&&this.curveSet.Update(e)}},{key:"Render",value:function(){const e=r.w,t=e.gl,n=e.viewportWidth,i=e.viewportHeight;if(!this.IsGood()||!this.display||n<=0||i<=0)return!1;if(n!==this.width||i!==this.height||this._rebuildPending||!this.texture){this.texture||(this.texture=new Kt.a,this.texture.Attach(t.createTexture())),t.bindTexture(t.TEXTURE_2D,this.texture.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null),this.width=n,this.height=i;for(const e in this.targets)this.targets.hasOwnProperty(e)&&this.CreateTarget(e,n,i);this._visibleItems=[];for(let e=0;e<this.items.length;++e){const t=this.items[e],r=t.inputs,o=t.effect,a=o.shader,s=o.parameters;a.HasTexture(!s.BlitCurrent)&&(s.BlitCurrent=new Ee.a("BlitCurrent","rgba:/0,0,0,255")),a.HasTexture(!s.BlitOriginal)&&(s.BlitOriginal=new Ee.a("BlitOriginal","rgba:/0,0,0,255")),t.target?(this.HasTarget(t.target)||this.CreateTarget(t.target,n,i),t._renderTarget=this.GetTarget(t.target)):t._renderTarget=null;for(let e in r)if(r.hasOwnProperty(e))if(a.HasTexture(e)){s[e]||(s[e]=new Ee.a(e));const t=s[e],o=r[e];o?(this.HasTarget(o)||this.CreateTarget(o,n,i),t.SetTextureRes(this.GetTarget(o).texture)):t.SetTextureRes(this.texture)}else console.warn(`Invalid input parameter ${e}`),delete r[e];if("BlitCurrent"in r&&a.HasConstant("g_texelSize")){s.g_texelSize||(s.g_texelSize=new we("g_texelSize",[1,1,1,1]));const e=s.g_texelSize,t=this.GetTarget(r.BlitCurrent);t?(e.value[0]=1/t.width,e.value[1]=1/t.width):(e.value[0]=1/n,e.value[1]=1/n),e.OnValueChanged()}t.display&&this._visibleItems.push(t),t._rebuildPending=!1}this._visibleItems.sort((e,t)=>e.index-t.index),this.rebuildPending=!1}t.bindTexture(t.TEXTURE_2D,this.texture.texture),t.copyTexImage2D(t.TEXTURE_2D,0,e.alphaBlendBackBuffer?t.RGBA:t.RGB,0,0,n,i,0),t.bindTexture(t.TEXTURE_2D,null),e.SetStandardStates(r.w.RM_OPAQUE);let o=0;for(let r=0;r<this._visibleItems.length;++r){const a=this._visibleItems[r];a.display&&(a._renderTarget?a._renderTarget.Set():(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,n,i)),e.RenderFullScreenQuad(a.effect),o++)}return!!o}},{key:"steps",get:function(){return this.items}}])&&En(t.prototype,n),i&&En(t,i),e}();function Sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Tn(Rn,"Item",wn);let Pn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),On(this,"_id",Object(mn.generateID)()),On(this,"name","Post manager"),On(this,"display",!0),On(this,"items",[])}var t,n,r;return t=e,(n=[{key:"CreateItem",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Rn.create(e);return this.AddItem(t),t}},{key:"AddItem",value:function(e){this.items.includes(e)||(-1===e.index&&(e.index=this.items.length),this.items.push(e))}},{key:"RemoveItem",value:function(e){const t=this.items.indexOf(e);-1!==t&&this.items.splice(t,1)}},{key:"ClearItems",value:function(){for(let e=0;e<this.items.length;e++)this.items[e].ClearItems();this.items=[]}},{key:"IsGood",value:function(){let e=0;for(let t=0;t<this.items.length;t++)this.items[t].IsGood()&&e++;return e===this.items.length}},{key:"KeepAlive",value:function(){for(let e=0;e<this.items.length;e++)this.items[e].KeepAlive()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.items.length;t++)this.items[t].GetResources(e);return e}},{key:"Update",value:function(e){for(let t=0;t<this.items.length;t++)this.items[t].Update(e)}},{key:"Render",value:function(){if(!this.display)return this.KeepAlive(),!1;let e=0;for(let t=0;t<this.items.length;t++)this.items[t].Render()&&e++;return!!e}},{key:"effects",get:function(){return this.items}}])&&Sn(t.prototype,n),r&&Sn(t,r),e}();function An(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}On(Pn,"Item",Rn);let In=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),An(this,"stages",[])};An(In,"partialImplementation",!0);var Cn=n(10);let Mn=function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=0,(n="value")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r};function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let xn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),kn(this,"planes",[r.I.create(),r.I.create(),r.I.create(),r.I.create(),r.I.create(),r.I.create()]),kn(this,"viewPos",r.H.create()),kn(this,"viewDir",r.H.create()),kn(this,"halfWidthProjection",1)}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(t,n,i,o,a){const s=e.global.mat4_0,u=o||r.z.invert(s,t);this.viewPos.set(u.subarray(12,14)),this.viewDir.set(u.subarray(8,10)),this.halfWidthProjection=n[0]*i*.5;const l=a||r.z.multiply(s,n,t);this.planes[0][0]=l[2],this.planes[0][1]=l[6],this.planes[0][2]=l[10],this.planes[0][3]=l[14],this.planes[1][0]=l[3]+l[0],this.planes[1][1]=l[7]+l[4],this.planes[1][2]=l[11]+l[8],this.planes[1][3]=l[15]+l[12],this.planes[2][0]=l[3]-l[1],this.planes[2][1]=l[7]-l[5],this.planes[2][2]=l[11]-l[9],this.planes[2][3]=l[15]-l[13],this.planes[3][0]=l[3]-l[0],this.planes[3][1]=l[7]-l[4],this.planes[3][2]=l[11]-l[8],this.planes[3][3]=l[15]-l[12],this.planes[4][0]=l[3]+l[1],this.planes[4][1]=l[7]+l[5],this.planes[4][2]=l[11]+l[9],this.planes[4][3]=l[15]+l[13],this.planes[5][0]=l[3]-l[2],this.planes[5][1]=l[7]-l[6],this.planes[5][2]=l[11]-l[10],this.planes[5][3]=l[15]-l[14];for(let e=0;e<6;++e){let t=r.H.length(this.planes[e]);this.planes[e][0]/=t,this.planes[e][1]/=t,this.planes[e][2]/=t,this.planes[e][3]/=t}}},{key:"IsSphereVisible",value:function(e,t){for(let n=0;n<6;++n)if(this.planes[n][0]*e[0]+this.planes[n][1]*e[1]+this.planes[n][2]*e[2]+this.planes[n][3]<-t)return!1;return!0}},{key:"GetPixelSizeAcross",value:function(t,n){const i=r.H.subtract(e.global.vec3_0,this.viewPos,t);let o=r.H.dot(this.viewDir,i);return o<1e-5&&(o=1e-5),n<1e-5?0:n/o*this.halfWidthProjection*2}}])&&Dn(t.prototype,n),i&&Dn(t,i),e}();kn(xn,"global",{vec3_0:r.H.create(),mat4_0:r.z.create()}),n.d(t,"Tw2BatchAccumulator",function(){return a}),n.d(t,"Tw2ForwardingRenderBatch",function(){return p}),n.d(t,"Tw2GeometryBatch",function(){return _}),n.d(t,"Tw2GeometryLineBatch",function(){return S}),n.d(t,"Tw2RenderBatch",function(){return l}),n.d(t,"Tw2InstancedMeshBatch",function(){return C}),n.d(t,"Tw2CurveSet",function(){return k}),n.d(t,"Tw2ValueBinding",function(){return Se}),n.d(t,"Tw2BasicPerObjectData",function(){return Le}),n.d(t,"EveBasicPerObjectData",function(){return Le}),n.d(t,"Tw2PerObjectData",function(){return De}),n.d(t,"Tw2RawData",function(){return Ie}),n.d(t,"Tw2BlendShapeData",function(){return Ne}),n.d(t,"Tw2GeometryAnimation",function(){return He}),n.d(t,"Tw2GeometryBone",function(){return Xe}),n.d(t,"Tw2GeometryCurve",function(){return We}),n.d(t,"Tw2GeometryMesh",function(){return Qe}),n.d(t,"Tw2GeometryMeshArea",function(){return $e}),n.d(t,"Tw2GeometryMeshBinding",function(){return et}),n.d(t,"Tw2GeometryModel",function(){return rt}),n.d(t,"Tw2GeometrySkeleton",function(){return it}),n.d(t,"Tw2GeometryTrackGroup",function(){return at}),n.d(t,"Tw2GeometryTransformTrack",function(){return ut}),n.d(t,"Tw2Effect",function(){return lt.a}),n.d(t,"Tw2InstancedMesh",function(){return gt}),n.d(t,"Tw2Mesh",function(){return ht}),n.d(t,"Tw2MeshArea",function(){return wt}),n.d(t,"Tw2MeshLineArea",function(){return St}),n.d(t,"Tw2Animation",function(){return At}),n.d(t,"Tw2AnimationController",function(){return pn}),n.d(t,"Tw2Bone",function(){return on}),n.d(t,"Tw2Model",function(){return sn}),n.d(t,"Tw2Track",function(){return ln}),n.d(t,"Tw2TrackGroup",function(){return fn}),n.d(t,"Tw2Parameter",function(){return x.a}),n.d(t,"Tw2VectorParameter",function(){return x.b}),n.d(t,"Tw2FloatParameter",function(){return U}),n.d(t,"Tw2MatrixParameter",function(){return q}),n.d(t,"Tw2TransformParameter",function(){return te}),n.d(t,"Tw2VariableParameter",function(){return ae}),n.d(t,"Tw2Vector2Parameter",function(){return fe}),n.d(t,"Tw2Vector3Parameter",function(){return ye}),n.d(t,"Tw2Vector4Parameter",function(){return we}),n.d(t,"Tw2TextureParameter",function(){return Ee.a}),n.d(t,"Tw2PostEffect",function(){return Rn}),n.d(t,"Tw2PostEffectManager",function(){return Pn}),n.d(t,"Tw2PostEffectStep",function(){return wn}),n.d(t,"Tw2PostProcess",function(){return In}),n.d(t,"Tw2BinaryReader",function(){return It.a}),n.d(t,"Tw2ObjectReader",function(){return Ct.a}),n.d(t,"Tw2EffectRes",function(){return Nt}),n.d(t,"Tw2GeometryRes",function(){return Yt}),n.d(t,"Tw2LoadingObject",function(){return Wt.a}),n.d(t,"Tw2Resource",function(){return Mt.a}),n.d(t,"Tw2TextureRes",function(){return Kt.a}),n.d(t,"Tw2VideoRes",function(){return nn}),n.d(t,"Tw2SamplerState",function(){return Dt.b}),n.d(t,"Tw2SamplerOverride",function(){return Dt.a}),n.d(t,"Tw2VertexDeclaration",function(){return Be.a}),n.d(t,"Tw2VertexElement",function(){return Be.b}),n.d(t,"Tw2Error",function(){return Oe.B}),n.d(t,"ErrHTTPRequest",function(){return Oe.k}),n.d(t,"ErrHTTPRequestSend",function(){return Oe.l}),n.d(t,"ErrHTTPInstance",function(){return Oe.i}),n.d(t,"ErrHTTPStatus",function(){return Oe.m}),n.d(t,"ErrHTTPReadyState",function(){return Oe.j}),n.d(t,"ErrXMLBinaryFormat",function(){return Oe.z}),n.d(t,"ErrXMLObjectTypeUndefined",function(){return Oe.A}),n.d(t,"ErrGeometryMeshMissingParticleElement",function(){return Oe.h}),n.d(t,"ErrGeometryMeshElementComponentsMissing",function(){return Oe.g}),n.d(t,"ErrGeometryMeshBoneNameInvalid",function(){return Oe.e}),n.d(t,"ErrGeometryMeshEffectBinding",function(){return Oe.f}),n.d(t,"ErrGeometryFileType",function(){return Oe.d}),n.d(t,"ErrResourcePrefixUnregistered",function(){return Oe.s}),n.d(t,"ErrResourcePrefixUndefined",function(){return Oe.r}),n.d(t,"ErrResourceExtensionUnregistered",function(){return Oe.p}),n.d(t,"ErrResourceExtensionUndefined",function(){return Oe.o}),n.d(t,"ErrResourceFormat",function(){return Oe.q}),n.d(t,"ErrShaderVersion",function(){return Oe.x}),n.d(t,"ErrShaderHeaderSize",function(){return Oe.u}),n.d(t,"ErrShaderPermutationValue",function(){return Oe.w}),n.d(t,"ErrShaderCompile",function(){return Oe.t}),n.d(t,"ErrShaderLink",function(){return Oe.v}),n.d(t,"ErrDeclarationValueType",function(){return Oe.b}),n.d(t,"ErrSingletonInstantiation",function(){return Oe.y}),n.d(t,"ErrAbstractClassMethod",function(){return Oe.a}),n.d(t,"ErrFeatureNotImplemented",function(){return Oe.c}),n.d(t,"ErrIndexBounds",function(){return Oe.n}),n.d(t,"Tw2EventEmitter",function(){return Cn.a}),n.d(t,"Tw2Float",function(){return Mn}),n.d(t,"Tw2Frustum",function(){return xn}),n.d(t,"Tw2RenderTarget",function(){return vn})},function(e,t,n){"use strict";n.d(t,"B",function(){return p}),n.d(t,"k",function(){return v}),n.d(t,"l",function(){return g}),n.d(t,"i",function(){return _}),n.d(t,"m",function(){return w}),n.d(t,"j",function(){return E}),n.d(t,"z",function(){return T}),n.d(t,"A",function(){return R}),n.d(t,"h",function(){return S}),n.d(t,"g",function(){return O}),n.d(t,"e",function(){return P}),n.d(t,"f",function(){return A}),n.d(t,"d",function(){return I}),n.d(t,"s",function(){return C}),n.d(t,"r",function(){return M}),n.d(t,"p",function(){return D}),n.d(t,"o",function(){return k}),n.d(t,"q",function(){return x}),n.d(t,"x",function(){return G}),n.d(t,"u",function(){return j}),n.d(t,"w",function(){return F}),n.d(t,"t",function(){return L}),n.d(t,"v",function(){return B}),n.d(t,"b",function(){return U}),n.d(t,"y",function(){return N}),n.d(t,"a",function(){return V}),n.d(t,"c",function(){return H}),n.d(t,"n",function(){return z});var r=n(3);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return c(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)})(e)}function c(e,t,n){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&f(i,n.prototype),i}).apply(null,arguments)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const d=Object(r.isFunction)(Error.captureStackTrace);let p=function(e){function t(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Undefined error";i(this,t);let s=o;return"string"==typeof n?(s=n,n={}):n.message&&(s=n.message,delete n.message),(e=a(this,h(t).call(this))).message=Object(r.template)(s,n),e.name=e.constructor.name,e.data=n,d?Error.captureStackTrace(u(u(e)),t):e.stack=new Error(e.message).stack,e}var n,c,f;return s(t,l(Error)),n=t,(c=[{key:"emitOn",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&e.emit&&e.emit(t,Object.assign({err:this,log:{type:"error",message:this.message,err:this}},this.data,n)),this}}])&&o(n.prototype,c),f&&o(n,f),t}();var m,y,b;b="error",(y="category")in(m=p)?Object.defineProperty(m,y,{value:b,enumerable:!0,configurable:!0,writable:!0}):m[y]=b;let v=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Communication error while requesting resource"))}return s(t,p),t}(),g=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Communication send error while requesting resource"))}return s(t,p),t}(),_=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Could not create an XML HTTP instance"))}return s(t,p),t}(),w=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Communication status error while loading resource (%status%)"))}return s(t,p),t}(),E=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Communication ready state error while loading resource"))}return s(t,p),t}(),T=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid binary format"))}return s(t,p),t}(),R=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,'XML Object type "%type%" undefined type'))}return s(t,p),t}(),S=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Input geometry mesh lacks element required by particle system"))}return s(t,p),t}(),O=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Input geometry mesh elements do not have the required number of components"))}return s(t,p),t}(),P=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Geometry mesh has invalid bone name for model"))}return s(t,p),t}(),A=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Error binding geometry mesh to effect"))}return s(t,p),t}(),I=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid geometry file type (%fileType%)"))}return s(t,p),t}(),C=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Unregistered resource prefix (%prefix%)"))}return s(t,p),t}(),M=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Undefined resource prefix"))}return s(t,p),t}(),D=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Unregistered resource extension (%extension%)"))}return s(t,p),t}(),k=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Undefined resource extension"))}return s(t,p),t}(),x=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid resource format"))}return s(t,p),t}(),G=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid version of effect file (%version%)"))}return s(t,p),t}(),j=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Effect file contains no compiled effects"))}return s(t,p),t}(),F=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid shader permutation value"))}return s(t,p),t}(),L=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Error compiling %shaderType% shader (%infoLog%)"))}return s(t,p),t}(),B=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Error linking shaders"))}return s(t,p),t}(),U=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Invalid declaration value type (%declaration%:%valueType%)"))}return s(t,p),t}(),N=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Multiple class instantiations not yet supported"))}return s(t,p),t}(),V=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Abstract class method not implemented directly on child class"))}return s(t,p),t}(),H=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"%feature=Feature% not implemented"))}return s(t,p),t}(),z=function(e){function t(e){return i(this,t),a(this,h(t).call(this,e,"Array index out of bounds"))}return s(t,p),t}()},function(e,t,n){"use strict";n.r(t);const r=Object.prototype.toString,i=Array.isArray;function o(e){return!!e&&(i(e)||E(e))}function a(e){return w(e,"[object Boolean]")}function s(e){return!!(e&&e instanceof HTMLCanvasElement)}function u(e){if(!e||!e.hasOwnProperty)return!1;const t=["value","initializer","get","set"];for(let n=0,r=t.length;n<r;n++)if(e.hasOwnProperty(t[n]))return!0;return!1}function l(e){return g(e)&&e.match(/(\w|\d|[-_])+:(\w|\d|[-_])+:(\w|\d|[-_])+/)}function c(e){return!!(e&&e instanceof Error||"error"===e.constructor.category)}function f(e){return w(e,"[object Number]")}function h(e){return"function"==typeof e}function d(e){return null==e}function p(e){return null===e}function m(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function y(e){return null!==e&&"object"==typeof e}function b(e){if(!m(e)||!w(e,"[object Object]"))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function v(e){return a(e)||f(e)||g(e)}function g(e){return w(e,"[object String]")}function _(e){return"symbol"==typeof e||w(e,"[object Symbol]")}function w(e,t){return r.call(e)===t}function E(e){return!!e&&!!(e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT)}function T(e){return void 0===e}function R(e){if(!e)return!1;if(E(e))return!0;if(i(e)){for(let t=0;t<e.length;t++)if(!f(e[t]))return!1;return!0}}function S(e){let t=!1;for(let n=0;n<(arguments.length<=1?0:arguments.length-1);n++)-1===e.indexOf(n+1<1||arguments.length<=n+1?void 0:arguments[n+1])&&(e.push(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]),t=!0);return t}function O(e,t){const n=e.length;for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];for(let r=0;r<n;r++)t in e&&e[r][t](...i)}function P(e){let t=!1;for(let n=0;n<(arguments.length<=1?0:arguments.length-1);n++){const r=e.indexOf(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]);-1!==r&&(e.splice(r,1),t=!0)}return t}function A(e){return i(e)?e:[e]}function I(e){return Array.from(new Set(A(e)))}function C(e,t,n){if(t){n=A(n);for(let r=0;r<n.length;r++){const i=n[r];if(void 0!==t[i])if(o(e[i]))if(E(e[i]))if(e[i].length!==t[i].length){const n=e[i].constructor;e[i]=new n(t[i])}else e[i].set(t[i]);else{e[i]=e[i].splice(e[i].length,0);for(let n=0;n<t[i].length;n++)e[i].push(t[i][n])}else if(E(t[i])){const n=t[i].constructor;e[i]=new n(t[i])}else e[i]=t[i]}}}function M(e,t,n){if(!i(t))return t in e?e[t]:n;for(let n=0;n<t.length;n++)if(t[n]in e)return e[t[n]];return n}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.match(/%([^%]+)?%/g)||[];for(let r=0;r<n.length;r++){const i=n[r],o=i.substring(1,i.length-1).split("="),a=o[0]in t?t[o[0]]:o[1];e=e.replace(i,a)}return e}let k=null,x=0,G=null;function j(e){if(e!==k){if(null!==k)throw new Error("Cannot change id generation type once set");if(e){G=[];for(let e=0;e<256;e++)G[e]=(e<16?"0":"")+e.toString(16).toUpperCase()}k=e}}function F(){return null===k&&(k=!1),k?function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return G[255&e]+G[e>>8&255]+G[e>>16&255]+G[e>>24&255]+"-"+G[255&t]+G[t>>8&255]+"-"+G[t>>16&15|64]+G[t>>24&255]+"-"+G[63&n|128]+G[n>>8&255]+"-"+G[n>>16&255]+G[n>>24&255]+G[255&r]+G[r>>8&255]+G[r>>16&255]+G[r>>24&255]}():x++}const L={},B=window.location.search.substring(1).split("&");for(let e=0;e<B.length;e++){const t=B[e].split("="),n=t[0].toLowerCase(),r=unescape(t[1]);if(n){let e=r.toLowerCase();L[n]="true"===e||"false"!==e&&r}}function U(){return Object.assign({},L)}function N(e,t){return(e=e.toLowerCase())in L?L[e]:t}function V(e,t){return(e=e.toLowerCase())in L?parseInt(L[e],10):t}function H(e,t){return(e=e.toLowerCase())in L?parseFloat(L[e]):t}function z(e,t){return(e=e.toLowerCase())in L?L[e]:t}n.d(t,"addToArray",function(){return S}),n.d(t,"perArrayChild",function(){return O}),n.d(t,"removeFromArray",function(){return P}),n.d(t,"toArray",function(){return A}),n.d(t,"toUniqueArray",function(){return I}),n.d(t,"assignIfExists",function(){return C}),n.d(t,"get",function(){return M}),n.d(t,"template",function(){return D}),n.d(t,"isArray",function(){return i}),n.d(t,"isArrayLike",function(){return o}),n.d(t,"isBoolean",function(){return a}),n.d(t,"isCanvas",function(){return s}),n.d(t,"isDescriptor",function(){return u}),n.d(t,"isDNA",function(){return l}),n.d(t,"isError",function(){return c}),n.d(t,"isNumber",function(){return f}),n.d(t,"isFunction",function(){return h}),n.d(t,"isNoU",function(){return d}),n.d(t,"isNull",function(){return p}),n.d(t,"isObject",function(){return m}),n.d(t,"isObjectLike",function(){return y}),n.d(t,"isPlain",function(){return b}),n.d(t,"isPrimary",function(){return v}),n.d(t,"isString",function(){return g}),n.d(t,"isSymbol",function(){return _}),n.d(t,"isTag",function(){return w}),n.d(t,"isTyped",function(){return E}),n.d(t,"isUndefined",function(){return T}),n.d(t,"isVector",function(){return R}),n.d(t,"enableUUID",function(){return j}),n.d(t,"generateID",function(){return F}),n.d(t,"getURL",function(){return U}),n.d(t,"getURLString",function(){return N}),n.d(t,"getURLInteger",function(){return V}),n.d(t,"getURLFloat",function(){return H}),n.d(t,"getURLBoolean",function(){return z})},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"create",function(){return d}),n.d(r,"fromMat4",function(){return p}),n.d(r,"clone",function(){return m}),n.d(r,"copy",function(){return y}),n.d(r,"fromValues",function(){return b}),n.d(r,"set",function(){return v}),n.d(r,"identity",function(){return g}),n.d(r,"transpose",function(){return _}),n.d(r,"invert",function(){return w}),n.d(r,"adjoint",function(){return E}),n.d(r,"determinant",function(){return T}),n.d(r,"multiply",function(){return R}),n.d(r,"translate",function(){return S}),n.d(r,"rotate",function(){return O}),n.d(r,"scale",function(){return P}),n.d(r,"fromTranslation",function(){return A}),n.d(r,"fromRotation",function(){return I}),n.d(r,"fromScaling",function(){return C}),n.d(r,"fromMat2d",function(){return M}),n.d(r,"fromQuat",function(){return D}),n.d(r,"normalFromMat4",function(){return k}),n.d(r,"projection",function(){return x}),n.d(r,"str",function(){return G}),n.d(r,"frob",function(){return j}),n.d(r,"add",function(){return F}),n.d(r,"subtract",function(){return L}),n.d(r,"multiplyScalar",function(){return B}),n.d(r,"multiplyScalarAndAdd",function(){return U}),n.d(r,"exactEquals",function(){return N}),n.d(r,"equals",function(){return V}),n.d(r,"mul",function(){return H}),n.d(r,"sub",function(){return z});var i={};n.r(i),n.d(i,"create",function(){return q}),n.d(i,"clone",function(){return X}),n.d(i,"copy",function(){return Y}),n.d(i,"fromValues",function(){return W}),n.d(i,"set",function(){return K}),n.d(i,"identity",function(){return Q}),n.d(i,"transpose",function(){return Z}),n.d(i,"invert",function(){return $}),n.d(i,"adjoint",function(){return J}),n.d(i,"determinant",function(){return ee}),n.d(i,"multiply",function(){return te}),n.d(i,"translate",function(){return ne}),n.d(i,"scale",function(){return re}),n.d(i,"rotate",function(){return ie}),n.d(i,"rotateX",function(){return oe}),n.d(i,"rotateY",function(){return ae}),n.d(i,"rotateZ",function(){return se}),n.d(i,"fromTranslation",function(){return ue}),n.d(i,"fromScaling",function(){return le}),n.d(i,"fromRotation",function(){return ce}),n.d(i,"fromXRotation",function(){return fe}),n.d(i,"fromYRotation",function(){return he}),n.d(i,"fromZRotation",function(){return de}),n.d(i,"fromRotationTranslation",function(){return pe}),n.d(i,"fromQuat2",function(){return me}),n.d(i,"getTranslation",function(){return ye}),n.d(i,"getScaling",function(){return be}),n.d(i,"getRotation",function(){return ve}),n.d(i,"fromRotationTranslationScale",function(){return ge}),n.d(i,"fromRotationTranslationScaleOrigin",function(){return _e}),n.d(i,"fromQuat",function(){return we}),n.d(i,"frustum",function(){return Ee}),n.d(i,"perspective",function(){return Te}),n.d(i,"perspectiveFromFieldOfView",function(){return Re}),n.d(i,"ortho",function(){return Se}),n.d(i,"lookAt",function(){return Oe}),n.d(i,"targetTo",function(){return Pe}),n.d(i,"str",function(){return Ae}),n.d(i,"frob",function(){return Ie}),n.d(i,"add",function(){return Ce}),n.d(i,"subtract",function(){return Me}),n.d(i,"multiplyScalar",function(){return De}),n.d(i,"multiplyScalarAndAdd",function(){return ke}),n.d(i,"exactEquals",function(){return xe}),n.d(i,"equals",function(){return Ge}),n.d(i,"mul",function(){return je}),n.d(i,"sub",function(){return Fe});var o={};n.r(o),n.d(o,"create",function(){return Le}),n.d(o,"clone",function(){return Be}),n.d(o,"length",function(){return Ue}),n.d(o,"fromValues",function(){return Ne}),n.d(o,"copy",function(){return Ve}),n.d(o,"set",function(){return He}),n.d(o,"add",function(){return ze}),n.d(o,"subtract",function(){return qe}),n.d(o,"multiply",function(){return Xe}),n.d(o,"divide",function(){return Ye}),n.d(o,"ceil",function(){return We}),n.d(o,"floor",function(){return Ke}),n.d(o,"min",function(){return Qe}),n.d(o,"max",function(){return Ze}),n.d(o,"round",function(){return $e}),n.d(o,"scale",function(){return Je}),n.d(o,"scaleAndAdd",function(){return et}),n.d(o,"distance",function(){return tt}),n.d(o,"squaredDistance",function(){return nt}),n.d(o,"squaredLength",function(){return rt}),n.d(o,"negate",function(){return it}),n.d(o,"inverse",function(){return ot}),n.d(o,"normalize",function(){return at}),n.d(o,"dot",function(){return st}),n.d(o,"cross",function(){return ut}),n.d(o,"lerp",function(){return lt}),n.d(o,"hermite",function(){return ct}),n.d(o,"bezier",function(){return ft}),n.d(o,"random",function(){return ht}),n.d(o,"transformMat4",function(){return dt}),n.d(o,"transformMat3",function(){return pt}),n.d(o,"transformQuat",function(){return mt}),n.d(o,"rotateX",function(){return yt}),n.d(o,"rotateY",function(){return bt}),n.d(o,"rotateZ",function(){return vt}),n.d(o,"angle",function(){return gt}),n.d(o,"str",function(){return _t}),n.d(o,"exactEquals",function(){return wt}),n.d(o,"equals",function(){return Et}),n.d(o,"sub",function(){return Rt}),n.d(o,"mul",function(){return St}),n.d(o,"div",function(){return Ot}),n.d(o,"dist",function(){return Pt}),n.d(o,"sqrDist",function(){return At}),n.d(o,"len",function(){return It}),n.d(o,"sqrLen",function(){return Ct}),n.d(o,"forEach",function(){return Mt});var a={};n.r(a),n.d(a,"create",function(){return Dt}),n.d(a,"clone",function(){return kt}),n.d(a,"fromValues",function(){return xt}),n.d(a,"copy",function(){return Gt}),n.d(a,"set",function(){return jt}),n.d(a,"add",function(){return Ft}),n.d(a,"subtract",function(){return Lt}),n.d(a,"multiply",function(){return Bt}),n.d(a,"divide",function(){return Ut}),n.d(a,"ceil",function(){return Nt}),n.d(a,"floor",function(){return Vt}),n.d(a,"min",function(){return Ht}),n.d(a,"max",function(){return zt}),n.d(a,"round",function(){return qt}),n.d(a,"scale",function(){return Xt}),n.d(a,"scaleAndAdd",function(){return Yt}),n.d(a,"distance",function(){return Wt}),n.d(a,"squaredDistance",function(){return Kt}),n.d(a,"length",function(){return Qt}),n.d(a,"squaredLength",function(){return Zt}),n.d(a,"negate",function(){return $t}),n.d(a,"inverse",function(){return Jt}),n.d(a,"normalize",function(){return en}),n.d(a,"dot",function(){return tn}),n.d(a,"lerp",function(){return nn}),n.d(a,"random",function(){return rn}),n.d(a,"transformMat4",function(){return on}),n.d(a,"transformQuat",function(){return an}),n.d(a,"str",function(){return sn}),n.d(a,"exactEquals",function(){return un}),n.d(a,"equals",function(){return ln}),n.d(a,"sub",function(){return cn}),n.d(a,"mul",function(){return fn}),n.d(a,"div",function(){return hn}),n.d(a,"dist",function(){return dn}),n.d(a,"sqrDist",function(){return pn}),n.d(a,"len",function(){return mn}),n.d(a,"sqrLen",function(){return yn}),n.d(a,"forEach",function(){return bn});var s={};n.r(s),n.d(s,"create",function(){return vn}),n.d(s,"identity",function(){return gn}),n.d(s,"setAxisAngle",function(){return _n}),n.d(s,"getAxisAngle",function(){return wn}),n.d(s,"multiply",function(){return En}),n.d(s,"rotateX",function(){return Tn}),n.d(s,"rotateY",function(){return Rn}),n.d(s,"rotateZ",function(){return Sn}),n.d(s,"calculateW",function(){return On}),n.d(s,"slerp",function(){return Pn}),n.d(s,"random",function(){return An}),n.d(s,"invert",function(){return In}),n.d(s,"conjugate",function(){return Cn}),n.d(s,"fromMat3",function(){return Mn}),n.d(s,"fromEuler",function(){return Dn}),n.d(s,"str",function(){return kn}),n.d(s,"clone",function(){return Un}),n.d(s,"fromValues",function(){return Nn}),n.d(s,"copy",function(){return Vn}),n.d(s,"set",function(){return Hn}),n.d(s,"add",function(){return zn}),n.d(s,"mul",function(){return qn}),n.d(s,"scale",function(){return Xn}),n.d(s,"dot",function(){return Yn}),n.d(s,"lerp",function(){return Wn}),n.d(s,"length",function(){return Kn}),n.d(s,"len",function(){return Qn}),n.d(s,"squaredLength",function(){return Zn}),n.d(s,"sqrLen",function(){return $n}),n.d(s,"normalize",function(){return Jn}),n.d(s,"exactEquals",function(){return er}),n.d(s,"equals",function(){return tr}),n.d(s,"rotationTo",function(){return nr}),n.d(s,"sqlerp",function(){return rr}),n.d(s,"setAxes",function(){return ir});var u={};n.r(u),n.d(u,"create",function(){return or}),n.d(u,"clone",function(){return ar}),n.d(u,"fromValues",function(){return sr}),n.d(u,"copy",function(){return ur}),n.d(u,"set",function(){return lr}),n.d(u,"add",function(){return cr}),n.d(u,"subtract",function(){return fr}),n.d(u,"multiply",function(){return hr}),n.d(u,"divide",function(){return dr}),n.d(u,"ceil",function(){return pr}),n.d(u,"floor",function(){return mr}),n.d(u,"min",function(){return yr}),n.d(u,"max",function(){return br}),n.d(u,"round",function(){return vr}),n.d(u,"scale",function(){return gr}),n.d(u,"scaleAndAdd",function(){return _r}),n.d(u,"distance",function(){return wr}),n.d(u,"squaredDistance",function(){return Er}),n.d(u,"length",function(){return Tr}),n.d(u,"squaredLength",function(){return Rr}),n.d(u,"negate",function(){return Sr}),n.d(u,"inverse",function(){return Or}),n.d(u,"normalize",function(){return Pr}),n.d(u,"dot",function(){return Ar}),n.d(u,"cross",function(){return Ir}),n.d(u,"lerp",function(){return Cr}),n.d(u,"random",function(){return Mr}),n.d(u,"transformMat2",function(){return Dr}),n.d(u,"transformMat2d",function(){return kr}),n.d(u,"transformMat3",function(){return xr}),n.d(u,"transformMat4",function(){return Gr}),n.d(u,"rotate",function(){return jr}),n.d(u,"angle",function(){return Fr}),n.d(u,"str",function(){return Lr}),n.d(u,"exactEquals",function(){return Br}),n.d(u,"equals",function(){return Ur}),n.d(u,"len",function(){return Nr}),n.d(u,"sub",function(){return Vr}),n.d(u,"mul",function(){return Hr}),n.d(u,"div",function(){return zr}),n.d(u,"dist",function(){return qr}),n.d(u,"sqrDist",function(){return Xr}),n.d(u,"sqrLen",function(){return Yr}),n.d(u,"forEach",function(){return Wr});const l={biCumulative:function(e,t){if(1===t){const t=1-e;return 1-t*t*t}return 2===t?3*e*e-2*e*e*e:e*e*e},dwordToFloat:function(e){const t=(16711680&e)>>16,n=(4278190080&e)>>24,r=(n<<1&255|t>>7)-127,i=(127&t)<<16|(65280&e)>>8<<8|255&e;return 0===i&&-127===r?0:(1-2*(n>>7))*(1+i*Math.pow(2,-23))*Math.pow(2,r)},exponentialDecay:function(e,t,n,r,i){return t*i/r+n*(e*r-t)/(r*r)*(1-Math.pow(Math.E,-r*i/n))},fromHalfFloat:function(e){const t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31===n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},getLongWordOrder:function(e){return 0===e||255===e||-16777216===e?0:1+l.getLongWordOrder(e>>8)},log2:function(e){return Math.log(e)*Math.LOG2E}};l.toHalfFloat=function(){let e,t;return function(n){e||(e=new Float32Array(1),t=new Int32Array(e.buffer)),e[0]=n;const r=t[0];let i=r>>16&32768,o=r>>12&2047,a=r>>23&255;return a<103?i:a>142?(i|=31744,i|=(255===a?0:1)&&8388607&r):a<113?i|=((o|=2048)>>114-a)+(o>>113-a&1):(i|=a-112<<10|o>>1,i+=1&o)}}();var c=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array,h=Math.random;Math.PI;function d(){var e=new f(9);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function m(e){var t=new f(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function b(e,t,n,r,i,o,a,s,u){var l=new f(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=u,l}function v(e,t,n,r,i,o,a,s,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e}function g(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function _(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function w(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=c*a-s*l,h=-c*o+s*u,d=l*o-a*u,p=n*f+r*h+i*d;return p?(p=1/p,e[0]=f*p,e[1]=(-c*r+i*l)*p,e[2]=(s*r-i*a)*p,e[3]=h*p,e[4]=(c*n-i*u)*p,e[5]=(-s*n+i*o)*p,e[6]=d*p,e[7]=(-l*n+r*u)*p,e[8]=(a*n-r*o)*p,e):null}function E(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=a*c-s*l,e[1]=i*l-r*c,e[2]=r*s-i*a,e[3]=s*u-o*c,e[4]=n*c-i*u,e[5]=i*o-n*s,e[6]=o*l-a*u,e[7]=r*u-n*l,e[8]=n*a-r*o,e}function T(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8];return t*(l*o-a*u)+n*(-l*i+a*s)+r*(u*i-o*s)}function R(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=n[0],d=n[1],p=n[2],m=n[3],y=n[4],b=n[5],v=n[6],g=n[7],_=n[8];return e[0]=h*r+d*a+p*l,e[1]=h*i+d*s+p*c,e[2]=h*o+d*u+p*f,e[3]=m*r+y*a+b*l,e[4]=m*i+y*s+b*c,e[5]=m*o+y*u+b*f,e[6]=v*r+g*a+_*l,e[7]=v*i+g*s+_*c,e[8]=v*o+g*u+_*f,e}function S(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=h*r+d*a+l,e[7]=h*i+d*s+c,e[8]=h*o+d*u+f,e}function O(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*a,e[1]=d*i+h*s,e[2]=d*o+h*u,e[3]=d*a-h*r,e[4]=d*s-h*i,e[5]=d*u-h*o,e[6]=l,e[7]=c,e[8]=f,e}function P(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function A(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function I(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function C(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function D(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,f=r*s,h=i*a,d=i*s,p=i*u,m=o*a,y=o*s,b=o*u;return e[0]=1-f-p,e[3]=c-b,e[6]=h+y,e[1]=c+b,e[4]=1-l-p,e[7]=d-m,e[2]=h-y,e[5]=d+m,e[8]=1-l-f,e}function k(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15],v=n*s-r*a,g=n*u-i*a,_=n*l-o*a,w=r*u-i*s,E=r*l-o*s,T=i*l-o*u,R=c*m-f*p,S=c*y-h*p,O=c*b-d*p,P=f*y-h*m,A=f*b-d*m,I=h*b-d*y,C=v*I-g*A+_*P+w*O-E*S+T*R;return C?(C=1/C,e[0]=(s*I-u*A+l*P)*C,e[1]=(u*O-a*I-l*S)*C,e[2]=(a*A-s*O+l*R)*C,e[3]=(i*A-r*I-o*P)*C,e[4]=(n*I-i*O+o*S)*C,e[5]=(r*O-n*A-o*R)*C,e[6]=(m*T-y*E+b*w)*C,e[7]=(y*_-p*T-b*g)*C,e[8]=(p*E-m*_+b*v)*C,e):null}function x(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function G(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function j(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}function F(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function L(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function B(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function U(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function V(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],f=e[8],h=t[0],d=t[1],p=t[2],m=t[3],y=t[4],b=t[5],v=t[6],g=t[7],_=t[8];return Math.abs(n-h)<=c*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=c*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=c*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-m)<=c*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-y)<=c*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-b)<=c*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(u-v)<=c*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-g)<=c*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(f-_)<=c*Math.max(1,Math.abs(f),Math.abs(_))}var H=R,z=L;function q(){var e=new f(16);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function X(e){var t=new f(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function W(e,t,n,r,i,o,a,s,u,l,c,h,d,p,m,y){var b=new f(16);return b[0]=e,b[1]=t,b[2]=n,b[3]=r,b[4]=i,b[5]=o,b[6]=a,b[7]=s,b[8]=u,b[9]=l,b[10]=c,b[11]=h,b[12]=d,b[13]=p,b[14]=m,b[15]=y,b}function K(e,t,n,r,i,o,a,s,u,l,c,f,h,d,p,m,y){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=y,e}function Q(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Z(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function $(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15],v=n*s-r*a,g=n*u-i*a,_=n*l-o*a,w=r*u-i*s,E=r*l-o*s,T=i*l-o*u,R=c*m-f*p,S=c*y-h*p,O=c*b-d*p,P=f*y-h*m,A=f*b-d*m,I=h*b-d*y,C=v*I-g*A+_*P+w*O-E*S+T*R;return C?(C=1/C,e[0]=(s*I-u*A+l*P)*C,e[1]=(i*A-r*I-o*P)*C,e[2]=(m*T-y*E+b*w)*C,e[3]=(h*E-f*T-d*w)*C,e[4]=(u*O-a*I-l*S)*C,e[5]=(n*I-i*O+o*S)*C,e[6]=(y*_-p*T-b*g)*C,e[7]=(c*T-h*_+d*g)*C,e[8]=(a*A-s*O+l*R)*C,e[9]=(r*O-n*A-o*R)*C,e[10]=(p*E-m*_+b*v)*C,e[11]=(f*_-c*E-d*v)*C,e[12]=(s*S-a*P-u*R)*C,e[13]=(n*P-r*S+i*R)*C,e[14]=(m*g-p*w-y*v)*C,e[15]=(c*w-f*g+h*v)*C,e):null}function J(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15];return e[0]=s*(h*b-d*y)-f*(u*b-l*y)+m*(u*d-l*h),e[1]=-(r*(h*b-d*y)-f*(i*b-o*y)+m*(i*d-o*h)),e[2]=r*(u*b-l*y)-s*(i*b-o*y)+m*(i*l-o*u),e[3]=-(r*(u*d-l*h)-s*(i*d-o*h)+f*(i*l-o*u)),e[4]=-(a*(h*b-d*y)-c*(u*b-l*y)+p*(u*d-l*h)),e[5]=n*(h*b-d*y)-c*(i*b-o*y)+p*(i*d-o*h),e[6]=-(n*(u*b-l*y)-a*(i*b-o*y)+p*(i*l-o*u)),e[7]=n*(u*d-l*h)-a*(i*d-o*h)+c*(i*l-o*u),e[8]=a*(f*b-d*m)-c*(s*b-l*m)+p*(s*d-l*f),e[9]=-(n*(f*b-d*m)-c*(r*b-o*m)+p*(r*d-o*f)),e[10]=n*(s*b-l*m)-a*(r*b-o*m)+p*(r*l-o*s),e[11]=-(n*(s*d-l*f)-a*(r*d-o*f)+c*(r*l-o*s)),e[12]=-(a*(f*y-h*m)-c*(s*y-u*m)+p*(s*h-u*f)),e[13]=n*(f*y-h*m)-c*(r*y-i*m)+p*(r*h-i*f),e[14]=-(n*(s*y-u*m)-a*(r*y-i*m)+p*(r*u-i*s)),e[15]=n*(s*h-u*f)-a*(r*h-i*f)+c*(r*u-i*s),e}function ee(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],h=e[11],d=e[12],p=e[13],m=e[14],y=e[15];return(t*a-n*o)*(f*y-h*m)-(t*s-r*o)*(c*y-h*p)+(t*u-i*o)*(c*m-f*p)+(n*s-r*a)*(l*y-h*d)-(n*u-i*a)*(l*m-f*d)+(r*u-i*s)*(l*p-c*d)}function te(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],d=t[10],p=t[11],m=t[12],y=t[13],b=t[14],v=t[15],g=n[0],_=n[1],w=n[2],E=n[3];return e[0]=g*r+_*s+w*f+E*m,e[1]=g*i+_*u+w*h+E*y,e[2]=g*o+_*l+w*d+E*b,e[3]=g*a+_*c+w*p+E*v,g=n[4],_=n[5],w=n[6],E=n[7],e[4]=g*r+_*s+w*f+E*m,e[5]=g*i+_*u+w*h+E*y,e[6]=g*o+_*l+w*d+E*b,e[7]=g*a+_*c+w*p+E*v,g=n[8],_=n[9],w=n[10],E=n[11],e[8]=g*r+_*s+w*f+E*m,e[9]=g*i+_*u+w*h+E*y,e[10]=g*o+_*l+w*d+E*b,e[11]=g*a+_*c+w*p+E*v,g=n[12],_=n[13],w=n[14],E=n[15],e[12]=g*r+_*s+w*f+E*m,e[13]=g*i+_*u+w*h+E*y,e[14]=g*o+_*l+w*d+E*b,e[15]=g*a+_*c+w*p+E*v,e}function ne(e,t,n){var r=n[0],i=n[1],o=n[2],a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,h=void 0,d=void 0,p=void 0,m=void 0,y=void 0,b=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*o+t[12],e[13]=t[1]*r+t[5]*i+t[9]*o+t[13],e[14]=t[2]*r+t[6]*i+t[10]*o+t[14],e[15]=t[3]*r+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],u=t[2],l=t[3],c=t[4],f=t[5],h=t[6],d=t[7],p=t[8],m=t[9],y=t[10],b=t[11],e[0]=a,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=m,e[10]=y,e[11]=b,e[12]=a*r+c*i+p*o+t[12],e[13]=s*r+f*i+m*o+t[13],e[14]=u*r+h*i+y*o+t[14],e[15]=l*r+d*i+b*o+t[15]),e}function re(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ie(e,t,n,r){var i,o,a,s,u,l,f,h,d,p,m,y,b,v,g,_,w,E,T,R,S,O,P,A,I=r[0],C=r[1],M=r[2],D=Math.sqrt(I*I+C*C+M*M);return D<c?null:(I*=D=1/D,C*=D,M*=D,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],l=t[2],f=t[3],h=t[4],d=t[5],p=t[6],m=t[7],y=t[8],b=t[9],v=t[10],g=t[11],_=I*I*a+o,w=C*I*a+M*i,E=M*I*a-C*i,T=I*C*a-M*i,R=C*C*a+o,S=M*C*a+I*i,O=I*M*a+C*i,P=C*M*a-I*i,A=M*M*a+o,e[0]=s*_+h*w+y*E,e[1]=u*_+d*w+b*E,e[2]=l*_+p*w+v*E,e[3]=f*_+m*w+g*E,e[4]=s*T+h*R+y*S,e[5]=u*T+d*R+b*S,e[6]=l*T+p*R+v*S,e[7]=f*T+m*R+g*S,e[8]=s*O+h*P+y*A,e[9]=u*O+d*P+b*A,e[10]=l*O+p*P+v*A,e[11]=f*O+m*P+g*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function oe(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+f*r,e[7]=u*i+h*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=f*i-s*r,e[11]=h*i-u*r,e}function ae(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-f*r,e[3]=u*i-h*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+f*i,e[11]=u*r+h*i,e}function se(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+f*r,e[3]=u*i+h*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=f*i-s*r,e[7]=h*i-u*r,e}function ue(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function le(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],l=Math.sqrt(a*a+s*s+u*u);return l<c?null:(a*=l=1/l,s*=l,u*=l,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fe(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function he(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function de(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,f=r*u,h=r*l,d=i*u,p=i*l,m=o*l,y=a*s,b=a*u,v=a*l;return e[0]=1-(d+m),e[1]=f+v,e[2]=h-b,e[3]=0,e[4]=f-v,e[5]=1-(c+m),e[6]=p+y,e[7]=0,e[8]=h+b,e[9]=p-y,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function me(e,t){var n=new f(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+c*r+u*o-l*i)/h,n[1]=2*(u*a+c*i+l*r-s*o)/h,n[2]=2*(l*a+c*o+s*i-u*r)/h):(n[0]=2*(s*a+c*r+u*o-l*i),n[1]=2*(u*a+c*i+l*r-s*o),n[2]=2*(l*a+c*o+s*i-u*r)),pe(e,t,n),e}function ye(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function be(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(u*u+l*l+c*c),e}function ve(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function ge(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,f=i*u,h=i*l,d=i*c,p=o*l,m=o*c,y=a*c,b=s*u,v=s*l,g=s*c,_=r[0],w=r[1],E=r[2];return e[0]=(1-(p+y))*_,e[1]=(h+g)*_,e[2]=(d-v)*_,e[3]=0,e[4]=(h-g)*w,e[5]=(1-(f+y))*w,e[6]=(m+b)*w,e[7]=0,e[8]=(d+v)*E,e[9]=(m-b)*E,e[10]=(1-(f+p))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _e(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,f=s+s,h=o*l,d=o*c,p=o*f,m=a*c,y=a*f,b=s*f,v=u*l,g=u*c,_=u*f,w=r[0],E=r[1],T=r[2],R=i[0],S=i[1],O=i[2],P=(1-(m+b))*w,A=(d+_)*w,I=(p-g)*w,C=(d-_)*E,M=(1-(h+b))*E,D=(y+v)*E,k=(p+g)*T,x=(y-v)*T,G=(1-(h+m))*T;return e[0]=P,e[1]=A,e[2]=I,e[3]=0,e[4]=C,e[5]=M,e[6]=D,e[7]=0,e[8]=k,e[9]=x,e[10]=G,e[11]=0,e[12]=n[0]+R-(P*R+C*S+k*O),e[13]=n[1]+S-(A*R+M*S+x*O),e[14]=n[2]+O-(I*R+D*S+G*O),e[15]=1,e}function we(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,f=r*s,h=i*a,d=i*s,p=i*u,m=o*a,y=o*s,b=o*u;return e[0]=1-f-p,e[1]=c+b,e[2]=h-y,e[3]=0,e[4]=c-b,e[5]=1-l-p,e[6]=d+m,e[7]=0,e[8]=h+y,e[9]=d-m,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ee(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function Te(e,t,n,r,i){var o=1/Math.tan(t/2),a=void 0;return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(r-i),e[10]=(i+r)*a,e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e}function Re(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Se(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}function Oe(e,t,n,r){var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,f=void 0,h=void 0,d=void 0,p=void 0,m=t[0],y=t[1],b=t[2],v=r[0],g=r[1],_=r[2],w=n[0],E=n[1],T=n[2];return Math.abs(m-w)<c&&Math.abs(y-E)<c&&Math.abs(b-T)<c?Q(e):(f=m-w,h=y-E,d=b-T,i=g*(d*=p=1/Math.sqrt(f*f+h*h+d*d))-_*(h*=p),o=_*(f*=p)-v*d,a=v*h-g*f,(p=Math.sqrt(i*i+o*o+a*a))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-d*o,u=d*i-f*a,l=f*o-h*i,(p=Math.sqrt(s*s+u*u+l*l))?(s*=p=1/p,u*=p,l*=p):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=l,e[10]=d,e[11]=0,e[12]=-(i*m+o*y+a*b),e[13]=-(s*m+u*y+l*b),e[14]=-(f*m+h*y+d*b),e[15]=1,e)}function Pe(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],f=o-n[1],h=a-n[2],d=c*c+f*f+h*h;d>0&&(c*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-l*f,m=l*c-s*h,y=s*f-u*c;return(d=p*p+m*m+y*y)>0&&(p*=d=1/Math.sqrt(d),m*=d,y*=d),e[0]=p,e[1]=m,e[2]=y,e[3]=0,e[4]=f*y-h*m,e[5]=h*p-c*y,e[6]=c*m-f*p,e[7]=0,e[8]=c,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function Ae(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ie(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function Ce(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Me(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function De(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function ke(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function xe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Ge(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],m=e[12],y=e[13],b=e[14],v=e[15],g=t[0],_=t[1],w=t[2],E=t[3],T=t[4],R=t[5],S=t[6],O=t[7],P=t[8],A=t[9],I=t[10],C=t[11],M=t[12],D=t[13],k=t[14],x=t[15];return Math.abs(n-g)<=c*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-_)<=c*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-w)<=c*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-E)<=c*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-T)<=c*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-R)<=c*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(u-S)<=c*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-O)<=c*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(f-P)<=c*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(h-A)<=c*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-I)<=c*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-C)<=c*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(m-M)<=c*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(y-D)<=c*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(b-k)<=c*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(v-x)<=c*Math.max(1,Math.abs(v),Math.abs(x))}var je=te,Fe=Me;function Le(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Be(e){var t=new f(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ue(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function Ne(e,t,n){var r=new f(3);return r[0]=e,r[1]=t,r[2]=n,r}function Ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function He(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function ze(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function qe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Xe(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Ye(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function We(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ke(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Qe(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Ze(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function $e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Je(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function et(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function tt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function nt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function rt(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function it(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ot(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function at(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function st(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ut(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function lt(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function ct(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function ft(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,f=3*u*a,h=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*f+i[0]*h,e[1]=t[1]*l+n[1]*c+r[1]*f+i[1]*h,e[2]=t[2]*l+n[2]*c+r[2]*f+i[2]*h,e}function ht(e,t){t=t||1;var n=2*h()*Math.PI,r=2*h()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function dt(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function pt(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function mt(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,f=o*s-r*l,h=r*u-i*s,d=i*h-o*f,p=o*c-r*h,m=r*f-i*c,y=2*a;return c*=y,f*=y,h*=y,d*=2,p*=2,m*=2,e[0]=s+c+d,e[1]=u+f+p,e[2]=l+h+m,e}function yt(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function bt(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function vt(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function gt(e,t){var n=Ne(e[0],e[1],e[2]),r=Ne(t[0],t[1],t[2]);at(n,n),at(r,r);var i=st(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function _t(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function wt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Et(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=c*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=c*Math.max(1,Math.abs(i),Math.abs(s))}var Tt,Rt=qe,St=Xe,Ot=Ye,Pt=tt,At=nt,It=Ue,Ct=rt,Mt=(Tt=Le(),function(e,t,n,r,i,o){var a=void 0,s=void 0;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)Tt[0]=e[a],Tt[1]=e[a+1],Tt[2]=e[a+2],i(Tt,Tt,o),e[a]=Tt[0],e[a+1]=Tt[1],e[a+2]=Tt[2];return e});function Dt(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function kt(e){var t=new f(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function xt(e,t,n,r){var i=new f(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Gt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function jt(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function Ft(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Lt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Bt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Ut(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Nt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Vt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Ht(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function zt(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function qt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Xt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Yt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function Wt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function Kt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function Qt(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function Zt(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function $t(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Jt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function en(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a),e}function tn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function nn(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e[3]=s+r*(n[3]-s),e}function rn(e,t){var n,r,i,o,a,s;t=t||1;do{a=(n=2*h()-1)*n+(r=2*h()-1)*r}while(a>=1);do{s=(i=2*h()-1)*i+(o=2*h()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*i*u,e[3]=t*o*u,e}function on(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function an(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*o-u*i,f=l*i+u*r-a*o,h=l*o+a*i-s*r,d=-a*r-s*i-u*o;return e[0]=c*l+d*-a+f*-u-h*-s,e[1]=f*l+d*-s+h*-a-c*-u,e[2]=h*l+d*-u+c*-s-f*-a,e[3]=t[3],e}function sn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function un(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ln(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(n-a)<=c*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=c*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=c*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=c*Math.max(1,Math.abs(o),Math.abs(l))}var cn=Lt,fn=Bt,hn=Ut,dn=Wt,pn=Kt,mn=Qt,yn=Zt,bn=function(){var e=Dt();return function(t,n,r,i,o,a){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function vn(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function gn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function _n(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function wn(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>c?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function En(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*c+a*s+i*l-o*u,e[1]=i*c+a*u+o*s-r*l,e[2]=o*c+a*l+r*u-i*s,e[3]=a*c-r*s-i*u-o*l,e}function Tn(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*s,e[1]=i*u+o*s,e[2]=o*u-i*s,e[3]=a*u-r*s,e}function Rn(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-o*s,e[1]=i*u+a*s,e[2]=o*u+r*s,e[3]=a*u-i*s,e}function Sn(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=i*u-r*s,e[2]=o*u+a*s,e[3]=a*u-o*s,e}function On(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function Pn(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=n[0],l=n[1],f=n[2],h=n[3],d=void 0,p=void 0,m=void 0,y=void 0,b=void 0;return(p=i*u+o*l+a*f+s*h)<0&&(p=-p,u=-u,l=-l,f=-f,h=-h),1-p>c?(d=Math.acos(p),m=Math.sin(d),y=Math.sin((1-r)*d)/m,b=Math.sin(r*d)/m):(y=1-r,b=r),e[0]=y*i+b*u,e[1]=y*o+b*l,e[2]=y*a+b*f,e[3]=y*s+b*h,e}function An(e){var t=h(),n=h(),r=h(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e}function In(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function Cn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Mn(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*o+a]-t[3*a+o])*r,e[o]=(t[3*o+i]+t[3*i+o])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}function Dn(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return e[0]=o*u*c-a*s*l,e[1]=a*s*c+o*u*l,e[2]=a*u*l-o*s*c,e[3]=a*u*c+o*s*l,e}function kn(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var xn,Gn,jn,Fn,Ln,Bn,Un=kt,Nn=xt,Vn=Gt,Hn=jt,zn=Ft,qn=En,Xn=Xt,Yn=tn,Wn=nn,Kn=Qt,Qn=Kn,Zn=Zt,$n=Zn,Jn=en,er=un,tr=ln,nr=(xn=Le(),Gn=Ne(1,0,0),jn=Ne(0,1,0),function(e,t,n){var r=st(t,n);return r<-.999999?(ut(xn,Gn,t),It(xn)<1e-6&&ut(xn,jn,t),at(xn,xn),_n(e,xn,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ut(xn,t,n),e[0]=xn[0],e[1]=xn[1],e[2]=xn[2],e[3]=1+r,Jn(e,e))}),rr=(Fn=vn(),Ln=vn(),function(e,t,n,r,i,o){return Pn(Fn,t,i,o),Pn(Ln,n,r,o),Pn(e,Fn,Ln,2*o*(1-o)),e}),ir=(Bn=d(),function(e,t,n,r){return Bn[0]=n[0],Bn[3]=n[1],Bn[6]=n[2],Bn[1]=r[0],Bn[4]=r[1],Bn[7]=r[2],Bn[2]=-t[0],Bn[5]=-t[1],Bn[8]=-t[2],Jn(e,Mn(e,Bn))});function or(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}function ar(e){var t=new f(2);return t[0]=e[0],t[1]=e[1],t}function sr(e,t){var n=new f(2);return n[0]=e,n[1]=t,n}function ur(e,t){return e[0]=t[0],e[1]=t[1],e}function lr(e,t,n){return e[0]=t,e[1]=n,e}function cr(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function fr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function hr(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function dr(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function pr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function mr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function yr(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function br(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function vr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function gr(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function _r(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function wr(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function Er(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function Tr(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function Rr(e){var t=e[0],n=e[1];return t*t+n*n}function Sr(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Or(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Pr(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function Ar(e,t){return e[0]*t[0]+e[1]*t[1]}function Ir(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Cr(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}function Mr(e,t){t=t||1;var n=2*h()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Dr(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}function kr(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}function xr(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}function Gr(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}function jr(e,t,n,r){var i=t[0]-n[0],o=t[1]-n[1],a=Math.sin(r),s=Math.cos(r);return e[0]=i*s-o*a+n[0],e[1]=i*a+o*s+n[1],e}function Fr(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],a=n*n+r*r;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var u=(n*i+r*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}function Lr(e){return"vec2("+e[0]+", "+e[1]+")"}function Br(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ur(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.abs(n-i)<=c*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))}var Nr=Tr,Vr=fr,Hr=hr,zr=dr,qr=wr,Xr=Er,Yr=Rr,Wr=function(){var e=or();return function(t,n,r,i,o,a){var s=void 0,u=void 0;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}();o.fromSpherical=function(e,t,n){const r=t[0],i=t[1],o=t[2];return e[0]=o*Math.sin(r)*Math.sin(i),e[1]=o*Math.cos(i),e[2]=o*Math.cos(r)*Math.sin(i),n&&(e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]),e},o.getSpherical=function(e,t){let n=0,r=0,i=o.length(t);return 0!==i&&(n=Math.acos(Math.max(t[1]/i,Math.min(-1,1))),r=Math.atan2(t[0],t[2])),e[0]=n,e[1]=r,e[2]=i,e},o.exponentialDecay=function(e,t,n,r,i,o){return e[0]=l.exponentialDecay(t[0],n[0],r,i,o),e[1]=l.exponentialDecay(t[1],n[1],r,i,o),e[2]=l.exponentialDecay(t[2],n[2],r,i,o),e},o.project=function(e,t,n,r){let i=t[0],o=t[1],a=t[2],s=n[0]*i+n[4]*o+n[8]*a+n[12],u=n[1]*i+n[5]*o+n[9]*a+n[13],l=n[3]*i+n[7]*o+n[11]*a+n[15],c=(s/l+1)/2,f=1-(u/l+1)/2;return e[0]=c*r[2]+r[0],e[1]=f*r[3]+r[1],e[2]=l,e},o.unproject=function(){let e;return function(t,n,r,i){e||(e=a.create());let o=n[0],s=n[1],u=n[2];if(e[0]=2*(o-i[0])/i[2]-1,e[1]=2*(s-i[1])/i[3]-1,e[2]=2*u-1,e[3]=1,a.transformMat4(e,e,r),0===e[3])throw t[0]=0,t[1]=0,t[2]=0,new Error("Perspective divide error");return t[0]=e[0]/e[3],t[1]=e[1]/e[3],t[2]=e[2]/e[3],t}}(),s.exp=function(e,t){let n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return n?(e[0]=Math.sin(n)*t[0]/n,e[1]=Math.sin(n)*t[1]/n,e[2]=Math.sin(n)*t[2]/n,e[3]=Math.cos(n)):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e},s.ln=function(e,t){let n=s.length(t);if(n>1.0001||n<.99999)e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0;else if(n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])){let r=Math.atan2(n,t[3])/n;e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=0}else e[0]=0,e[1]=0,e[2]=0,e[3]=0;return e},s.pow=function(e,t,n){return 1===n?s.copy(e,t):(s.ln(e,t),e[0]*=n,e[1]*=n,e[2]*=n,e[3]*=n,s.exp(e,e),e)},i.arcFromForward=function(){let e;return function(t,n){e||(e=o.create());const r=o.normalize(e,n);if(i.identity(t),r[2]<-.99999)return t;if(r[2]>.99999)return t[5]=-1,t[10]=-1,t;const a=(1+r[2])/(r[0]*r[0]+r[1]*r[1]);return t[0]=a*r[1]*r[1]-r[2],t[1]=-a*r[0]*r[1],t[2]=r[0],t[4]=t[1],t[5]=a*r[0]*r[0]-r[2],t[6]=r[1],t[8]=-r[0],t[9]=-r[1],t[10]=-r[2],t}}(),i.copyTranslation=function(e,t){return e[12]=t[12],e[13]=t[13],e[14]=t[14],e},i.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,e},i.lookAtGL=function(){let e,t,n;return function(r,i,a,s){return e||(e=o.create(),t=o.create(),n=o.create()),o.subtract(n,i,a),0===o.squaredLength(n)&&(n[2]=1),o.normalize(n,n),o.cross(e,s,n),0===o.squaredLength(e)&&(n[2]+=1e-4,o.cross(e,s,n)),o.normalize(e,e),o.cross(t,n,e),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=t[0],r[5]=t[1],r[6]=t[2],r[8]=n[0],r[9]=n[1],r[10]=n[2],r}}(),i.perspectiveGL=function(e,t,n,r,o){let a=Math.tan(t/360*Math.PI)*r,s=a*n;return i.frustum(e,-s,s,-a,a,r,o),e},i.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},i.setTranslationFromValues=function(e,t,n,r){return e[12]=t,e[13]=n,e[14]=r,e};const Kr={};Kr.turbulence=function(){const e=[],t=[],n=[];let r=!1;return function(i,s,u,l,c,f){r||function(){for(let n=0;n<256;n++)e[n]=a.fromValues(Math.random()-.5,Math.random()-.5,Math.random()-.5,Math.random()-.5),t[n]=n;let i=256;for(;--i;){const e=t[i],n=Math.floor(256*Math.random());t[i]=t[n],t[n]=e}for(let n=0;n<256;n++)t[256+n]=t[n],e[256+n]=e[n],e[512+n]=e[n];for(let e=0;e<15;++e)n[e]=o.create();r=!0}(),s+=4096,u+=4096,l+=4096,c+=4096;let h=Math.floor(s),d=Math.floor(u),p=Math.floor(l),m=Math.floor(c);const y=s-h,b=u-d,v=l-p,g=c-m,_=(h&=255)+1,w=(d&=255)+1,E=(p&=255)+1,T=(m&=255)+1,R=t[h],S=t[_],O=t[R+d],P=t[S+d],A=t[R+w],I=t[S+w];let C=o.lerp(n[0],e[O+p+m],e[P+p+m],y),M=o.lerp(n[1],e[A+p+m],e[I+p+m],y),D=o.lerp(n[2],e[O+E+m],e[P+E+m],y),k=o.lerp(n[3],e[O+E+m],e[P+E+m],y),x=o.lerp(n[4],C,M,b),G=o.lerp(n[5],D,k,b);const j=o.lerp(n[6],x,G,v);C=o.lerp(n[7],e[O+p+T],e[P+p+T],y),M=o.lerp(n[8],e[A+p+T],e[I+p+T],y),D=o.lerp(n[9],e[O+E+T],e[P+E+T],y),k=o.lerp(n[10],e[O+E+T],e[P+E+T],y),x=o.lerp(n[11],C,M,b),G=o.lerp(n[12],D,k,b);const F=o.lerp(n[13],x,G,v),L=o.lerp(n[14],j,F,g);return i[0]+=L[0]*f,i[1]+=L[1]*f,i[2]+=L[2]*f,i}}(),Kr.perlin1=function(){let e=!1,t=256,n=null,r=null;return function(i){e||function(){n=new Array(t+t+2),r=new Array(t+t+2);let i=0,o=0,a=0;for(i=0;i<t;i++)n[i]=i,r[i]=2*Math.random()-1;for(;--i;)a=n[i],n[i]=n[o=Math.floor(Math.random()*t)],n[o]=a;for(i=0;i<t+2;i++)n[t+i]=n[i],r[t+i]=r[i];e=!0}();let o=i+4096,a=255&Math.floor(o),s=a+1&255,u=o-Math.floor(o),l=u-1,c=u*u*(3-2*u),f=u*r[n[a]];return f+c*(l*r[n[s]]-f)}}(),Kr.perlin1D=function(e,t,n,r){let i=0,o=e,a=1;for(let e=0;e<r;++e)i+=Kr.perlin1(o)/a,a*=t,o*=n;return i};const Qr={evaluate:function(e,t,n,r,i){let o=e.knots.length,a=o-1,s=0;for(let n=0;n<e.knots.length;++n)if(e.knots[n]>t){a=n;break}if(0===e.degree)for(let t=0;t<e.dimension;++t)n[t]=e.controls[a*e.dimension+t];else if(1===e.degree){let u=r?(a+o-1)%o:0===a?0:a-1,l=e.knots[a]-e.knots[u];l<0&&(l+=i),l>0&&(s=(t-e.knots[e.knots.length-1])/l);for(let t=0;t<e.dimension;++t)n[t]=e.controls[u*e.dimension+t]*(1-s)+e.controls[a*e.dimension+t]*s}else{let s=r?(a+o-2)%o:0===a?0:a-2,u=r?(a+o-1)%o:0===a?0:a-1,l=s*e.dimension,c=u*e.dimension,f=a*e.dimension,h=e.knots[s],d=e.knots[u],p=e.knots[a],m=e.knots[(a+1)%o];h>p&&(p+=i,m+=i,t+=i),d>p&&(p+=i,m+=i,t+=i),m<p&&(m+=i);let y=t-d,b=y/(p-d),v=(t-h)/(p-h),g=v+b-b*v,_=b*(y/(m-d)),w=g-_;g=1-g;for(let t=0;t<e.dimension;++t)n[t]=g*e.controls[l+t]+w*e.controls[c+t]+_*e.controls[f+t]}},ag_horner1:function(e,t,n){let r=e[t];for(;--t>=0;)r=n*r+e[t];return r},ag_zeroin2:function(e,t,n,r,i,o){let a,s,u,l,c,f,h,d,p,m,y,b;d=1.192092896e-7;let v=!0;for(;v&&(s=e,c=n,l=u=t-e),Math.abs(c)<Math.abs(r)&&(e=t,t=s,s=e,n=r,r=c,c=n),v=!1,f=2.384185792e-7*Math.abs(t)+.5*i,h=.5*(s-t),a=Math.abs(h)>f&&0!==r;)Math.abs(l)<f||Math.abs(n)<=Math.abs(r)?l=u=h:(b=r/n,e===s?(p=2*h*b,m=1-b):(p=b*(2*h*(m=n/c)*(m-(y=r/c))-(t-e)*(y-1)),m=(m-1)*(y-1)*(b-1)),p>0?m=-m:p=-p,b=l,l=u,2*p<3*h*m-Math.abs(f*m)&&p<Math.abs(.5*b*m)?u=p/m:l=u=h),e=t,n=r,Math.abs(u)>f?t+=u:h>0?t+=f:t-=f,(r=Qr.ag_horner1(o.p,o.deg,t))*(c/Math.abs(c))>0&&(v=!0);return t},ag_zeroin:function(e,t,n,r){let i,o;return i=Qr.ag_horner1(r.p,r.deg,e),Math.abs(i)<1.192092896e-7?e:(o=Qr.ag_horner1(r.p,r.deg,t),Math.abs(o)<1.192092896e-7?t:Qr.ag_zeroin2(e,t,i,o,n,r))},polyZeroes:function(e,t,n,r,i,o,a){let s,u,l,c,f,h,d,p,m,y,b,v,g,_,w,E=new Array(22),T=new Array(22),R=new Array(22),S={p:[],deg:0};for(d=y=0,p=0,s=0;s<t+1;++s)p+=Math.abs(e[s]);if(p<=(v=(Math.abs(n)+Math.abs(i))*(t+1)*1.192092896e-7))return-1;for(g=E,_=T,w=R,s=0;s<t+1;++s)g[s]=1/p*e[s];for(;Math.abs(g[t])<v;)t--;if(c=0,0===t)return c;if(1===t)return a[0]=-g[0]/g[1],u=r?n<a[0]+v:n<a[0]-v,l=o?i>a[0]-v:i>a[0]+v,(c=u&&l?1:0)&&(r&&a[0]<n?a[0]=n:o&&a[0]>i&&(a[0]=i)),c;for(S.p=g,S.deg=t,s=1;s<=t;s++)_[s-1]=s*g[s];if(0===(f=Qr.polyZeroes(_,t-1,n,0,i,0,w)).length)return 0;for(s=h=0;s<=f;s++){if(c>t)return c;0===s?(m=n,b=Qr.ag_horner1(g,t,m),Math.abs(b)<=v&&r&&(a[c++]=n)):(m=d,b=y),s===f?(d=i,h=0):d=w[s],y=Qr.ag_horner1(g,t,d),h?h=0:Math.abs(y)<v?(s!==f||o)&&(a[c++]=d,h=1):(b<0&&y>0||b>0&&y<0)&&(a[c++]=Qr.ag_zeroin(m,d,0,S),c>1&&a[c-2]>=a[c-1]-v&&(a[c-2]=.5*(a[c-2]+a[c-1]),c--))}return c}};n.d(t,"num",function(){return l}),n.d(t,"vec2",function(){return u}),n.d(t,"vec3",function(){return o}),n.d(t,"vec4",function(){return a}),n.d(t,"quat",function(){return s}),n.d(t,"mat3",function(){return r}),n.d(t,"mat4",function(){return i}),n.d(t,"noise",function(){return Kr}),n.d(t,"curve",function(){return Qr})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),i=n(0);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"elementType",4),a(this,"customName",""),a(this,"dimension",1),a(this,"usageIndex",0),a(this,"usedByGPU",!0)}var t,n,s;return t=e,(n=[{key:"GetDimension",value:function(){switch(this.elementType){case e.Type.LIFETIME:return 2;case e.Type.POSITION:case e.Type.VELOCITY:return 3;case e.Type.MASS:return 1}return this.dimension}},{key:"GetDeclaration",value:function(){let t;switch(this.elementType){case e.Type.LIFETIME:t=r.Tw2VertexDeclaration.Type.TANGENT;break;case e.Type.POSITION:t=r.Tw2VertexDeclaration.Type.POSITION;break;case e.Type.VELOCITY:t=r.Tw2VertexDeclaration.Type.NORMAL;break;case e.Type.MASS:t=r.Tw2VertexDeclaration.Type.BINORMAL;break;default:t=r.Tw2VertexDeclaration.Type.TEXCOORD}return new r.Tw2VertexElement(t,this.usageIndex,i.w.gl.FLOAT,this.GetDimension())}}])&&o(t.prototype,n),s&&o(t,s),e}();a(s,"Type",{LIFETIME:0,POSITION:1,VELOCITY:2,MASS:3,CUSTOM:4})},function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"b",function(){return p});var r=n(0),i=n(2);function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let d=function(){function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(this,e),h(this,"_id",r.F.generateID()),h(this,"name",""),h(this,"_onModified",[]),this.name=t}return f(e,[{key:"OnValueChanged",value:function(e,t){for(let n=0;n<this._onModified.length;n++)this._onModified[n](this,e,t)}},{key:"AddCallback",value:function(e){return this._onModified.includes(e)||this._onModified.push(e),!0}},{key:"RemoveCallback",value:function(e){const t=this._onModified.indexOf(e);-1!==t&&this._onModified.splice(t,1)}},{key:"GetValue",value:function(e){}},{key:"Bind",value:function(e,t,n){return!1}},{key:"UnBind",value:function(){}},{key:"Apply",value:function(e,t,n){}},{key:"Copy",value:function(e){}},{key:"Clone",value:function(){const e=new this.constructor;return e.Copy(this,!0),e}},{key:"size",get:function(){return this.constructor.constantBufferSize}}]),e}();h(d,"constantBufferSize",0);let p=function(e){function t(e,n){var r,i,o;return l(this,t),i=this,r=!(o=a(t).call(this,e))||"object"!=typeof o&&"function"!=typeof o?u(i):o,h(u(u(r)),"constantBuffer",null),h(u(u(r)),"offset",null),h(u(u(r)),"value",new Float32Array(r.size)),n&&r.value.set(n),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,d),f(t,[{key:"SetValue",value:function(e){this.value.set(e),this.OnValueChanged()}},{key:"SetIndexValue",value:function(e,t){if(void 0===this.value[e])throw new i.n;this.value[e]!==t&&(this.value[e]=t,this.OnValueChanged())}},{key:"GetValue",value:function(e){const t=this.constantBuffer?this.constantBuffer.subarray(this.offset,this.offset+this.size):this.value;return e?Array.from(t):new Float32Array(t)}},{key:"GetIndexValue",value:function(e){if(void 0!==this.value[e])return this.value[e];throw new i.n}},{key:"OnValueChanged",value:function(e,n){this.constantBuffer&&this.Apply(this.constantBuffer,this.offset),o(a(t.prototype),"OnValueChanged",this).call(this,e,n)}},{key:"Bind",value:function(e,t,n){return!this.constantBuffer&&n>=this.size&&(this.constantBuffer=e,this.offset=t,this.Apply(e,t,n),!0)}},{key:"Unbind",value:function(){this.constantBuffer=null}},{key:"Apply",value:function(e,t,n){e.set(this.value,t)}},{key:"EqualsValue",value:function(e){for(let t=0;t<this.size;t++)if(this.value[t]!==e[t])return!1;return!0}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.SetValue(e.GetValue())}}],[{key:"isValue",value:function(e){return r.F.isArrayLike(e)&&e.length===this.constantBufferSize}}]),t}()},function(e,t,n){"use strict";var r=n(0);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let o=function e(t,n,r,o){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"usage",null),i(this,"usageIndex",null),i(this,"type",null),i(this,"elements",null),i(this,"offset",0),i(this,"location",null),i(this,"customSetter",null),this.usage=t,this.usageIndex=n,this.type=r,this.elements=o,this.offset=a};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"elements",[]),s(this,"_elementsSorted",[]),s(this,"stride",null),void 0!==n&&(this.stride=n),t&&this.DeclareFromObject(t)}var t,n,i;return t=e,i=[{key:"CompareDeclarationElements",value:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.usage<t.usage?-1:e.usage>t.usage?1:e.usageIndex+n<t.usageIndex?-1:e.usageIndex+n>t.usageIndex?1:0}}],(n=[{key:"RebuildHash",value:function(){this._elementsSorted=[];for(let e=0;e<this.elements.length;++e)this._elementsSorted[e]=this.elements[e];this._elementsSorted.sort(e.CompareDeclarationElements)}},{key:"FindUsage",value:function(e,t){for(let n=0;n<this._elementsSorted.length;++n){const r=this._elementsSorted[n];if(r.usage===e){if(r.usageIndex===t)return r;if(r.usageIndex>t)return null}if(r.usage>e)return null}return null}},{key:"SetDeclaration",value:function(t,n){const i=r.w.gl;let o=0;for(let r=0;r<t._elementsSorted.length;++r){const a=t._elementsSorted[r];if(!(a.location<0))for(;;){if(o>=this._elementsSorted.length){i.disableVertexAttribArray(a.location),i.vertexAttrib4f(a.location,0,0,0,0);break}const t=this._elementsSorted[o],r=e.CompareDeclarationElements(t,a);if(r>0){i.disableVertexAttribArray(a.location),i.vertexAttrib4f(a.location,0,0,0,0);break}if(0===r){t.customSetter?t.customSetter(a):(i.enableVertexAttribArray(a.location),i.vertexAttribPointer(a.location,t.elements,t.type,!1,n,t.offset));break}o++}}return!0}},{key:"SetPartialDeclaration",value:function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=r.w.ext,s=r.w.gl,u=[];let l=0;for(let r=0;r<t._elementsSorted.length;++r){const c=t._elementsSorted[r];if(!(c.location<0))for(;;){const t=this._elementsSorted[l],r=e.CompareDeclarationElements(t,c,i);if(0===r){t.customSetter?t.customSetter(c):(s.enableVertexAttribArray(c.location),s.vertexAttribPointer(c.location,t.elements,t.type,!1,n,t.offset),a.vertexAttribDivisor(c.location,o),o&&u.push(c.location));break}if(r>0){o||(s.disableVertexAttribArray(c.location),s.vertexAttrib4f(c.location,0,0,0,0));break}if(++l>=this._elementsSorted.length)return o||(s.disableVertexAttribArray(c.location),s.vertexAttrib4f(c.location,0,0,0,0)),u}}return u}},{key:"ResetInstanceDivisors",value:function(e){if(e)for(let t=0;t<e.length;++t)r.w.ext.vertexAttribDivisor(e[t],0)}},{key:"DeclareFromObject",value:function(t,n){this.elements.splice(0,this.elements.length);let i=0;for(let n=0;n<t.length;n++){const a=t[n];let s,u,l,c,f;r.F.isArray(a)?(s=a[0],u=a[1],c=a[2],l=a[3],f=a[4]):(s=a.usage,u=a.usageIndex,c=a.elements,l=a.type,f=a.offset),r.F.isString(s)&&(s=e.Type[s.toUpperCase()]),r.F.isNoU(l)&&(l="FLOAT"),r.F.isString(l)&&(l=r.w.gl[l.toUpperCase()]),r.F.isNoU(f)&&(f=i),this.elements.push(new o(s,u,l,c,f)),i+=4*c}void 0!==n&&(this.stride=n),this.RebuildHash()}}])&&a(t.prototype,n),i&&a(t,i),e}();s(u,"Type",{POSITION:0,COLOR:1,NORMAL:2,TANGENT:3,BINORMAL:4,TEXCOORD:5,BLENDWEIGHT:6,BLENDINDICES:7}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return o})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=n(2);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"path",""),a(this,"_isLoading",!1),a(this,"_isGood",!1),a(this,"_isPurged",!1),a(this,"_notifications",[]),a(this,"activeFrame",0),a(this,"doNotPurge",0)}var t,n,s;return t=e,(n=[{key:"IsLoading",value:function(){return this.KeepAlive(),this._isLoading}},{key:"IsGood",value:function(){return this.KeepAlive(),this._isGood}},{key:"IsPurged",value:function(){return this._isPurged}},{key:"Unload",value:function(){}},{key:"Reload",value:function(){this.Unload(),r.D.ReloadResource(this)}},{key:"KeepAlive",value:function(){this.activeFrame=r.D.activeFrame,this.IsPurged()&&this.Reload()}},{key:"GetErrors",value:function(){return r.D.motherLode.GetErrors(this.path)}},{key:"HasErrors",value:function(){return r.D.motherLode.HasErrors(this.path)}},{key:"OnError",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.B;return this._isGood=!1,r.D.OnResEvent("error",this.path,{type:"error",message:e.message,err:e}),this.UpdateNotifications("OnResError"),e}},{key:"OnWarning",value:function(e){r.D.OnResEvent("warning",this.path,e)}},{key:"OnDebug",value:function(e){r.D.OnResEvent("debug",this.path,e)}},{key:"OnRequested",value:function(e){this._isLoading=!0,this._isPurged=!1,r.D.OnResEvent(this.IsPurged()?"reloading":"requested",this.path,e),this.UpdateNotifications("ReleaseCachedData")}},{key:"OnLoaded",value:function(e){this._isLoading=!1,this.HasErrors()||r.D.OnResEvent("loaded",this.path,e)}},{key:"OnPrepared",value:function(e){this._isLoading=!1,this.HasErrors()||(this._isGood=!0,r.D.OnResEvent("prepared",this.path,e),this.UpdateNotifications("RebuildCachedData"))}},{key:"OnUnloaded",value:function(e){r.D.OnResEvent(this.IsPurged()?"purged":"unloaded",this.path,e)}},{key:"RegisterNotification",value:function(e){this._notifications.includes(e)||(this._notifications.push(e),this.HasErrors()?"OnResError"in e&&e.OnResError(this):this.IsGood()&&"RebuildCachedData"in e&&e.RebuildCachedData(this))}},{key:"UnregisterNotification",value:function(e){this._notifications.splice(this._notifications.indexOf(e),1)}},{key:"UpdateNotifications",value:function(e){for(let t=0;t<this._notifications.length;t++)e in this._notifications[t]&&this._notifications[t][e](this)}}])&&o(t.prototype,n),s&&o(t,s),e}();s.prototype.DoCustomLoad=null,s.prototype.requestResponseType=null},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(0),i=n(14),o=n(6),a=n(11);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let d=function(e){function t(e,n){var r,i,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,r=!(o=l(t).call(this,e))||"object"!=typeof o&&"function"!=typeof o?f(i):o,h(f(f(r)),"resourcePath",""),h(f(f(r)),"useAllOverrides",!1),h(f(f(r)),"addressUMode",1),h(f(f(r)),"addressVMode",1),h(f(f(r)),"addressWMode",1),h(f(f(r)),"filterMode",2),h(f(f(r)),"mipFilterMode",2),h(f(f(r)),"maxAnisotropy",4),h(f(f(r)),"textureRes",null),h(f(f(r)),"_sampler",null),n&&(r.resourcePath=n,r.Initialize()),r}var n,d,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,o["a"]),n=t,p=[{key:"isValue",value:function(e){return r.F.isString(e)}}],(d=[{key:"Initialize",value:function(){this.OnValueChanged()}},{key:"SetTexturePath",value:function(e){this.resourcePath=e,this.OnValueChanged()}},{key:"GetValue",value:function(){return this.isTextureAttached?null:this.resourcePath}},{key:"SetTextureRes",value:function(e){return this.textureRes!==e&&(this.resourcePath="",this.textureRes=e,this.textureRes&&(this.textureRes._isAttached=!0),!0)}},{key:"OnValueChanged",value:function(e,n){if(""!==this.resourcePath)if(0===this.resourcePath.indexOf("rgba:/")){if(!this.textureRes||this.textureRes.path!==this.resourcePath){const e=this.resourcePath.replace("rgba:/","").split(","),t=r.w.CreateSolidTexture([parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),void 0!==e[3]?parseFloat(e[3]):255]);this.textureRes=new a.a,this.textureRes.path=this.resourcePath,this.textureRes.Attach(t)}}else this.resourcePath=this.resourcePath.toLowerCase(),this.textureRes=""!==this.resourcePath?r.D.GetResource(this.resourcePath):null;this.UpdateOverrides(),u(l(t.prototype),"OnValueChanged",this).call(this,e,n)}},{key:"Apply",value:function(e,t,n){this.textureRes&&(this.useAllOverrides&&this._sampler&&(this._sampler.samplerType=t.samplerType,this._sampler.isVolume=t.isVolume,this._sampler.registerIndex=t.registerIndex,t=this._sampler),r.w.gl.activeTexture(r.w.gl.TEXTURE0+e),this.textureRes.Bind(t,n))}},{key:"SetOverrides",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.F.assignIfExists(this,e,t.overrideProperties),this.OnValueChanged()}},{key:"GetOverrides",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.F.assignIfExists(e,this,t.overrideProperties),e}},{key:"UpdateOverrides",value:function(){if(this.useAllOverrides){this._sampler=this._sampler||new i.b;const e=r.w.wrapModes,t=r.w.gl,n=this._sampler;if(1===this.filterMode){switch(this.mipFilterMode){case 0:n.minFilter=t.NEAREST;break;case 1:n.minFilter=t.NEAREST_MIPMAP_NEAREST;break;default:n.minFilter=t.NEAREST_MIPMAP_LINEAR}n.minFilterNoMips=t.NEAREST,n.magFilter=t.NEAREST}else{switch(this.mipFilterMode){case 0:n.minFilter=t.LINEAR;break;case 1:n.minFilter=t.LINEAR_MIPMAP_NEAREST;break;default:n.minFilter=t.LINEAR_MIPMAP_LINEAR}n.minFilterNoMips=t.LINEAR,n.magFilter=t.LINEAR}n.addressU=e[this.addressUMode],n.addressV=e[this.addressVMode],n.addressW=e[this.addressWMode],n.anisotropy=this.maxAnisotropy,n.ComputeHash()}else this._sampler&&(this._sampler=null)}},{key:"EqualsValue",value:function(e){return e.toLowerCase()===this.GetValue()}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.resourcePath=e.resourcePath,this.SetOverrides(e.GetOverrides)}},{key:"Clone",value:function(){const e=new t;return e.Copy(this,!0),e}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.textureRes&&!e.includes(this.textureRes)&&e.push(this.textureRes),e}},{key:"isTextureAttached",get:function(){return this.textureRes&&this.textureRes._isAttached}}])&&s(n.prototype,d),p&&s(n,p),t}();h(d,"overrideProperties",["useAllOverrides","addressUMode","addressVMode","addressWMode","filterMode","mipFilterMode","maxAnisotropy"]),d.prototype.SetValue=d.prototype.SetTexturePath},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});const i=new WeakMap;let o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"emit",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.log&&!t.log._logged&&(t.log=this.log(t.log));const n=i.get(this);return n?((e=e.toLowerCase())in n&&n[e].forEach(function(r,i){i.call(r.context,t),r.once&&n[e].delete(i)}),this):this}},{key:"on",value:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i.get(this);return o||(o={},i.set(this,o)),o[e=e.toLowerCase()]||(o[e]=new Set),o[e].add(t,{context:n,once:r}),this}},{key:"once",value:function(e,t,n){return this.on(e,t,n,!0)}},{key:"off",value:function(e,t){const n=i.get(this);if(!n)return this;if("*"===(e=e.toLowerCase()))for(const e in n)n.hasOwnProperty(e)&&n[e].delete(t);else e in n&&n[e].delete(t);return this}},{key:"del",value:function(e){const t=i.get(this);return t?((e=e.toLowerCase())in t&&delete t[e],this):this}},{key:"clr",value:function(e){const t=i.get(this);if(!t)return this;for(let n in t)t.hasOwnProperty(n)&&t[n].has(e)&&t[n].delete(e);return this}},{key:"kill",value:function(){return i.has(this)&&(this.emit("kill"),i.delete(this)),this}},{key:"log",value:function(e){return e.name||(e.name=this.constructor.category||this.constructor.name),this.constructor.defaultLogger?this.constructor.defaultLogger.log(e,this):e}}])&&r(t.prototype,n),o&&r(t,o),e}();var a,s,u;u=null,(s="defaultLogger")in(a=o)?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(8),i=n(2),o=n(0);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=u(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?c(n):r,f(c(c(e)),"texture",null),f(c(c(e)),"isCube",!1),f(c(c(e)),"width",0),f(c(c(e)),"height",0),f(c(c(e)),"hasMipMaps",!1),f(c(c(e)),"requestResponseType",null),f(c(c(e)),"_currentSampler",0),f(c(c(e)),"_isAttached",!1),f(c(c(e)),"_extension",null),e}var n,h,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r["a"]),n=t,d=[{key:"IsPowerOfTwo",value:function(e){return 0==(e&e-1)}},{key:"AddMipLevelSkipCount",value:function(e){const t=o.w,n=t.mipLevelSkipCount>0?"."+t.mipLevelSkipCount.toString():"";if(t.mipLevelSkipCount>0){const t=e.lastIndexOf(".");t>=0&&(e=e.substr(0,t-2)+n+e.substr(t))}return e}},{key:"Int32ToFourCC",value:function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}}],(h=[{key:"Prepare",value:function(e){const n=o.w.gl,r="ccpGLFormat"in e?e.ccpGLFormat:n.RGBA;switch(this._extension){case"cube":this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,this.texture);const a=document.createElement("canvas");a.width=a.height=e.height;const s=a.getContext("2d");for(let t=0;t<6;++t)s.drawImage(e,t*a.width,0,a.width,a.height,0,0,a.width,a.height),n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,r,r,n.UNSIGNED_BYTE,a);n.generateMipmap(n.TEXTURE_CUBE_MAP),n.bindTexture(n.TEXTURE_CUBE_MAP,null),this.width=a.width,this.height=a.height,this.hasMipMaps=!0;break;case"png":this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,r,r,n.UNSIGNED_BYTE,e),this.hasMipMaps=t.IsPowerOfTwo(e.width)&&t.IsPowerOfTwo(e.height),this.hasMipMaps&&n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null),this.width=e.width,this.height=e.height;break;case"dds":const u=o.w.ext.CompressedTextureS3TC,l=new Int32Array(e,0,o.c),c=l[o.i],f=l[o.g]===o.l,h=(l[o.d]&o.a)===o.a,d=l[o.i],p=l[o.e]&o.b?Math.max(1,l[o.h]):1;if(!u)throw new i.q("Compressed textures not supported by your device");if(!f)throw new i.q("Invalid DDS, missing magic number");if(!c)throw new i.q("Invalid DDS, missing FourCC code");let m,y,b=l[o.k],v=l[o.f],g=l[o.j]+4;switch(d){case o.m:m=8,y=u.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case o.n:m=16,y=u.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case o.o:m=16,y=u.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:const e=t.Int32ToFourCC(d);throw new i.q(`Invalid DDS, ${e} unsupported`)}if(this.hasMipMaps=p>1,this.isCube=h,this.width=b,this.height=v,this.isCube)throw new i.c({feature:"DDS cube maps"});this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture);for(let t=0;t<p;++t){const r=Math.max(4,b)/4*Math.max(4,v)/4*m,i=new Uint8Array(e,g,r);n.compressedTexImage2D(n.TEXTURE_2D,t,y,b,v,0,i),g+=r,b*=.5,v*=.5}n.bindTexture(n.TEXTURE_2D,null);break;default:throw new i.q(`Invalid format, ${this._extension} unsupported`)}this._extension=null,this._isAttached=!1,this.OnPrepared()}},{key:"DoCustomLoad",value:function(e,n){switch(this._extension=n,this._extension){case"cube":this.isCube=!0,e=e.substr(0,e.length-5)+".png";break;case"png":this.isCube=!1;break;case"dds":return this._extension=n,this.requestResponseType="arraybuffer",!1;default:throw this._extension=null,new i.p({path:e,extension:n})}this.OnRequested(),o.D._pendingLoads++;const r=new Image;return r.crossOrigin="anonymous",r.onerror=(()=>{o.D._pendingLoads--,this._extension=null,this.OnError(new i.k({path:e}))}),r.onload=(()=>{o.D._pendingLoads--,o.D._prepareQueue.push([this,r,null]),this.OnLoaded()}),r.src=t.AddMipLevelSkipCount(e),!0}},{key:"Unload",value:function(){return this.texture&&(o.w.gl.deleteTexture(this.texture),this.texture=null),this._isPurged=!0,this._isGood=!1,this._isAttached=!1,this._extension=null,this.requestResponseType=null,!0}},{key:"Attach",value:function(e){this.path="",this.texture=e,this._isPurged=!1,this._isAttached=!0,this._extension=null,this.requestResponseType=null,this.OnLoaded({hide:!0,data:{isAttachment:!0}}),this.OnPrepared({hide:!0,data:{isAttachment:!0}})}},{key:"Reload",value:function(){if(!this._isAttached)return s(u(t.prototype),"Reload",this).call(this)}},{key:"Bind",value:function(e,t){const n=o.w,r=n.gl;this.KeepAlive();let i=e.samplerType;if(i===(this.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D))if(this.texture)e.isVolume&&r.uniform1f(t,this.height/this.width),r.bindTexture(i,this.texture),(e.hash!==this._currentSampler||this._updateSampler)&&(e.Apply(this.hasMipMaps),this._currentSampler=e.hash,this._updateSampler=!1);else{const e=i===r.TEXTURE_2D?n.GetFallbackTexture():n.GetFallbackCubeMap();r.bindTexture(i,e)}}}])&&a(n.prototype,h),d&&a(n,d),t}()},function(e,t,n){"use strict";n.r(t);var r=n(0);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function e(){o(this,e),a(this,"_id",r.F.generateID()),a(this,"name",""),a(this,"time",0)},u=function(){function e(){o(this,e),a(this,"_id",r.F.generateID()),a(this,"name","")}var t,n,s;return t=e,s=[{key:"Compare",value:function(e,t){return e.time<t.time?-1:e.time>t.time?1:0}},{key:"Sort",value:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.keys;n&&n.length&&(n.sort(e.Compare),t.length=n[n.length-1].time)}},{key:"Sort2",value:function(t){if(t.keys&&t.keys.length){t.keys.sort(e.Compare);const n=t.keys[t.keys.length-1];if(n.time>t.length){const e=t.length,r=t.endValue,i=t.endTangent;t.length=n.time,t.endValue=n.value,t.endTangent=n.leftTangent,e>0&&(n.time=e,n.value=r,n.leftTangent=i)}}}}],(n=[{key:"Initialize",value:function(){this.Sort()}},{key:"Sort",value:function(){}},{key:"GetLength",value:function(){return 0}},{key:"UpdateValue",value:function(e){}}])&&i(t.prototype,n),s&&i(t,s),e}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?m(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}a(u,"inputDimension",null),a(u,"outputDimension",null),a(u,"valueProperty",null),a(u,"curveType",null),a(u,"Key",null),a(u,"Interpolation",null),a(u,"Extrapolation",null),a(u,"Type",{CURVE:1,CURVE2:2,CURVE_MAYA:3,CURVE_NO_KEYS:4,SEQUENCER:100,SEQUENCER2:101}),a(u,"global",{vec3_0:r.H.create(),vec4_0:r.I.create(),quat_0:r.C.create(),quat_1:r.C.create()});let b=function(e){function t(){var e;c(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return y(m(m(e=f(this,h(t).call(this,...i)))),"value",r.I.create()),y(m(m(e)),"left",r.I.create()),y(m(m(e)),"right",r.I.create()),y(m(m(e)),"interpolation",0),e}return d(t,s),t}(),v=function(e){function t(){var e;c(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return y(m(m(e=f(this,h(t).call(this,...i)))),"start",0),y(m(m(e)),"value",r.I.create()),y(m(m(e)),"extrapolation",0),y(m(m(e)),"keys",[]),y(m(m(e)),"_currentKey",1),y(m(m(e)),"length",0),e}var n,i,o;return d(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,n){if(0===this.length)return r.I.copy(n,this.value);const i=this.keys[0],o=this.keys[this.keys.length-1];if(e>=o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.I.copy(n,this.value);case t.Extrapolation.CONSTANT:return r.I.copy(n,o.value);case t.Extrapolation.GRADIENT:return r.I.scaleAndAdd(n,o.value,o.right,e-o.time);default:e%=o.time}else if(e<0||e<i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.I.copy(n,this.value);case t.Extrapolation.GRADIENT:return r.I.scaleAndAdd(n,i.value,i.left,e*this.length-o.time);default:return r.I.copy(n,i.value)}let a=this.keys[this._currentKey],s=this.keys[this._currentKey-1];for(;e>=a.time||e<s.time;)e<s.time&&(this._currentKey=0),this._currentKey++,a=this.keys[this._currentKey],s=this.keys[this._currentKey-1];const u=(e-s.time)/(a.time-s.time);switch(s.interpolation){case t.Interpolation.CONSTANT:return r.I.copy(n,s.value);default:return n[0]=s.value[0]*(1-u)+a.value[0]*u,n[1]=s.value[1]*(1-u)+a.value[1]*u,n[2]=s.value[2]*(1-u)+a.value[2]*u,n[3]=s.value[3]*(1-u)+a.value[3]*u,n}}}])&&l(n.prototype,i),o&&l(n,o),t}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?S(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}y(v,"inputDimension",4),y(v,"ouputDimension",4),y(v,"valueProperty","value"),y(v,"curveType",u.Type.CURVE),y(v,"Key",b),y(v,"Extrapolation",{NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3}),y(v,"Interpolation",{NONE:0,CONSTANT:1,LINEAR:2});let P=function(e){function t(){var e;_(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(S(S(e=w(this,E(t).call(this,...i)))),"value",r.I.create()),O(S(S(e)),"leftTangent",r.I.create()),O(S(S(e)),"rightTangent",r.I.create()),O(S(S(e)),"interpolation",1),e}return T(t,s),t}(),A=function(e){function t(){var e;_(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(S(S(e=w(this,E(t).call(this,...i)))),"cycle",!1),O(S(S(e)),"reversed",!1),O(S(S(e)),"timeOffset",0),O(S(S(e)),"timeScale",1),O(S(S(e)),"startValue",r.I.fromValues(0,0,0,1)),O(S(S(e)),"currentValue",r.I.fromValues(0,0,0,1)),O(S(S(e)),"endValue",r.I.fromValues(0,0,0,1)),O(S(S(e)),"startTangent",r.I.create()),O(S(S(e)),"endTangent",r.I.create()),O(S(S(e)),"interpolation",1),O(S(S(e)),"keys",[]),O(S(S(e)),"length",0),e}var n,i,o;return T(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return r.I.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?r.I.copy(t,this.startValue):r.I.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);let n=this.keys[0],i=this.keys[this.keys.length-1];if(e<=n.time)return this.Interpolate(e,null,n,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(let t=0;t+1<this.keys.length&&(n=this.keys[t],i=this.keys[t+1],!(n.time<=e&&i.time>e));++t);return this.Interpolate(e,n,i,t)}},{key:"Interpolate",value:function(e,n,i,o){r.I.copy(o,this.startValue);let a=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==n&&(u=n.interpolation,e-=n.time),u){case t.Interpolation.LINEAR:return n&&i?(a=n.value,s=i.value,l=i.time-n.time):i?(s=i.value,l=i.time):n&&(a=n.value,l=this.length-n.time),o[0]=a[0]+(s[0]-a[0])*(e/l),o[1]=a[1]+(s[1]-a[1])*(e/l),o[2]=a[2]+(s[2]-a[2])*(e/l),o[3]=a[3]+(s[3]-a[3])*(e/l),o;default:return o}}}])&&g(n.prototype,i),o&&g(n,o),t}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?G(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}O(A,"inputDimension",4),O(A,"outputDimension",4),O(A,"valueProperty","currentValue"),O(A,"curveType",u.Type.CURVE2),O(A,"Key",P),O(A,"Interpolation",{CONSTANT:0,LINEAR:1});let F=function(e){function t(){var e;C(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return j(G(G(e=M(this,D(t).call(this,...r)))),"value",""),e}return k(t,s),t}(),L=function(e){function t(){var e;C(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return j(G(G(e=M(this,D(t).call(this,...r)))),"value",""),j(G(G(e)),"keys",[]),j(G(G(e)),"extrapolation",0),j(G(G(e)),"_time",0),j(G(G(e)),"_currentKey",0),j(G(G(e)),"_length",0),e}var n,r,i;return k(t,u),n=t,(r=[{key:"Sort",value:function(){this.keys.length&&(this.keys.sort(u.Compare),this._length=this.keys[this.keys.length-1].time)}},{key:"GetLength",value:function(){return this._length}},{key:"UpdateValue",value:function(e){if(this._length<=0)return this.value;let n=this._time;if(this._time=e,this._time<n&&(this._currentKey=0),this.extrapolation===t.Extrapolation.CYCLE){let e=this._time%this._length;e<n&&(this._currentKey=0),this._time=e}for(;this._currentKey<this.keys.length&&this._time>=this.keys[this._currentKey].time;)this.value=this.keys[this._currentKey].value,++this._currentKey}}])&&I(n.prototype,r),i&&I(n,i),t}();function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}j(L,"dimension",1),j(L,"outputDimension",1),j(L,"valueProperty","value"),j(L,"curveType",u.Type.CURVE),j(L,"Key",F),j(L,"Extrapolation",{NONE:0,CYCLE:3});let z=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=U(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?V(n):r,H(V(V(e)),"value",0),H(V(V(e)),"start",0),H(V(V(e)),"speed",1),H(V(V(e)),"alpha",1.1),H(V(V(e)),"beta",2),H(V(V(e)),"offset",0),H(V(V(e)),"scale",1),H(V(V(e)),"N",3),H(V(V(e)),"_startOffset",100*Math.random()),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,u),n=t,(i=[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return e-=this._startOffset,(r.A.perlin1D(e*this.speed,this.alpha,this.beta,this.N)+1)/2*this.scale+this.offset}}])&&B(n.prototype,i),o&&B(n,o),t}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Z(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}H(z,"outputDimension",1),H(z,"valueProperty","value"),H(z,"curveType",u.Type.CURVE_NO_KEYS);let J=function(e){function t(){var e;X(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return $(Z(Z(e=Y(this,W(t).call(this,...i)))),"value",r.C.create()),$(Z(Z(e)),"leftTangent",r.I.create()),$(Z(Z(e)),"rightTangent",r.I.create()),$(Z(Z(e)),"interpolation",1),e}return K(t,s),t}(),ee=function(e){function t(){var e;X(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return $(Z(Z(e=Y(this,W(t).call(this,...i)))),"cycle",!1),$(Z(Z(e)),"reversed",!1),$(Z(Z(e)),"timeOffset",0),$(Z(Z(e)),"timeScale",1),$(Z(Z(e)),"startValue",r.C.create()),$(Z(Z(e)),"currentValue",r.C.create()),$(Z(Z(e)),"endValue",r.C.create()),$(Z(Z(e)),"startTangent",r.I.create()),$(Z(Z(e)),"endTangent",r.I.create()),$(Z(Z(e)),"interpolation",1),$(Z(Z(e)),"keys",[]),$(Z(Z(e)),"length",0),e}var n,i,o;return K(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t;if(e>this.length){if(!this.cycle)return this.reversed?(t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t):(t[0]=this.endValue[0],t[1]=this.endValue[1],t[2]=this.endValue[2],t);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);let n=this.keys[0],r=this.keys[this.keys.length-1];if(e<=n.time)return this.Interpolate(e,null,n,t);if(e>=r.time)return this.Interpolate(e,r,null,t);for(let t=0;t+1<this.keys.length&&(n=this.keys[t],r=this.keys[t+1],!(n.time<=e&&r.time>e));++t);return this.Interpolate(e,n,r,t)}},{key:"Interpolate",value:function(e,n,i,o){o[0]=this.startValue[0],o[1]=this.startValue[1],o[2]=this.startValue[2];let a=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==n&&(u=n.interpolation,e-=n.time),u){case t.Interpolation.SPHERICAL_LINEAR:return n&&i?(a=n.value,s=i.value,l=i.time-n.time):i?(s=i.value,l=i.time):n&&(a=n.value,l=this.length-n.time),r.C.slerp(o,a,s,e/l),o;default:return o}}}])&&q(n.prototype,i),o&&q(n,o),t}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}$(ee,"inputDimension",4),$(ee,"outputDimension",4),$(ee,"valueProperty","currentValue"),$(ee,"curveType",u.Type.CURVE2),$(ee,"Key",J),$(ee,"Interpolation",{CONSTANT:0,SPHERICAL_LINEAR:4});let ae=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=ne(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?ie(n):r,oe(ie(ie(e)),"value",0),oe(ie(ie(e)),"min",0),oe(ie(ie(e)),"max",1),oe(ie(ie(e)),"hold",!0),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(t,u),n=t,(r=[{key:"UpdateValue",value:function(){this.value=this.GetValueAt()}},{key:"GetValueAt",value:function(){return this.hold?this.value:this.min+(this.max-this.min)*Math.random()}}])&&te(n.prototype,r),i&&te(n,i),t}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?de(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}oe(ae,"outputDimension",1),oe(ae,"valueProperty","value"),oe(ae,"curveType",u.Type.CURVE_NO_KEYS);let me=function(e){function t(){var e;ue(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(de(de(e=le(this,ce(t).call(this,...i)))),"rot0",r.C.create()),pe(de(de(e)),"omega0",r.H.create()),pe(de(de(e)),"torque",r.H.create()),e}return fe(t,s),t}(),ye=function(e){function t(){var e;ue(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(de(de(e=le(this,ce(t).call(this,...i)))),"name",""),pe(de(de(e)),"I",1),pe(de(de(e)),"drag",1),pe(de(de(e)),"value",r.C.create()),pe(de(de(e)),"start",0),pe(de(de(e)),"states",[]),pe(de(de(e)),"length",0),e}var n,i,o;return fe(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort(this,this.states)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){if(0===this.states.length||e<0||e<this.states[0].time)return r.C.copy(t,this.value);let n=0;if(e>=this.states[this.states.length-1].time)n=this.states.length-1;else for(;n+1<this.states.length&&!(e>=this.states[n].time&&e<this.states[n+1].time);++n);const i=u.global.vec3_0,o=u.global.quat_0,a=this.states[n];return r.H.exponentialDecay(i,a.omega0,a.torque,this.I,this.drag,e-a.time),r.C.exp(o,i),r.C.multiply(t,this.states[n].rot0,o),t}}])&&se(n.prototype,i),o&&se(n,o),t}();function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Te(e):t}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}pe(ye,"inputDimension",4),pe(ye,"outputDimension",4),pe(ye,"valueProperty","value"),pe(ye,"curveType",u.Type.CURVE),pe(ye,"Key",me);let Se=function(e){function t(){var e;ve(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Re(Te(Te(e=ge(this,_e(t).call(this,...i)))),"value",r.C.create()),Re(Te(Te(e)),"left",r.I.create()),Re(Te(Te(e)),"right",r.I.create()),Re(Te(Te(e)),"interpolation",5),e}return we(t,s),t}(),Oe=function(e){function t(){var e;ve(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Re(Te(Te(e=ge(this,_e(t).call(this,...i)))),"start",0),Re(Te(Te(e)),"value",r.C.create()),Re(Te(Te(e)),"extrapolation",0),Re(Te(Te(e)),"keys",[]),Re(Te(Te(e)),"_currentKey",1),Re(Te(Te(e)),"length",0),e}var n,i,o;return we(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,n){if(0===this.length)return r.C.copy(n,this.value);const i=u.global,o=this.keys[0],a=this.keys[this.keys.length-1];if(e>=a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.C.copy(n,this.value);case t.Extrapolation.CONSTANT:return r.C.copy(n,a.value);default:e%=a.time}else if(e<0||e<o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.C.copy(n,this.value);default:return r.C.copy(n,o.value)}let s=this.keys[this._currentKey],l=this.keys[this._currentKey-1];for(;e>=s.time||e<l.time;)e<l.time&&(this._currentKey=0),this._currentKey++,s=this.keys[this._currentKey],l=this.keys[this._currentKey-1];const c=(e-l.time)/(s.time-l.time);switch(l.interpolation){case t.Interpolation.CONSTANT:return r.C.copy(n,l.value);case t.Interpolation.LINEAR:return n[0]=l.value[0]*(1-c)+s.value[0]*c,n[1]=l.value[1]*(1-c)+s.value[1]*c,n[2]=l.value[2]*(1-c)+s.value[2]*c,n[3]=l.value[3]*(1-c)+s.value[3]*c,n;case t.Interpolation.HERMITE:const e=r.C.identity(i.quat_0),o=[l.value,l.right,s.left,s.value];for(let t=3;t>0;t--){const i=r.B.biCumulative(c,t);i>1&&r.C.multiply(n,e,o[t]),n[0]=-o[t-1][0],n[1]=-o[t-1][1],n[2]=-o[t-1][2],n[3]=o[t-1][3],r.C.multiply(n,n,o[t]),r.C.pow(n,n,i),r.C.multiply(e,e,n)}return r.C.multiply(n,e,l.value);case t.Interpolation.SLERP:return r.C.slerp(n,l.value,s.value,c);default:return r.C.sqlerp(n,l.value,l.right,s.left,s.value,c)}}}])&&be(n.prototype,i),o&&be(n,o),t}();function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?ke(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Re(Oe,"outputDimention",4),Re(Oe,"inputDimension",4),Re(Oe,"valueProperty","value"),Re(Oe,"curveType",u.Type.CURVE),Re(Oe,"Child",Se),Re(Oe,"Extrapolation",{NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3}),Re(Oe,"Interpolation",{NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,SLERP:5,SQUAD:6});let Ge=function(e){function t(){var e;Ae(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return xe(ke(ke(e=Ie(this,Ce(t).call(this,...r)))),"value",0),xe(ke(ke(e)),"left",0),xe(ke(ke(e)),"right",0),xe(ke(ke(e)),"interpolation",0),e}return Me(t,s),t}(),je=function(e){function t(){var e;Ae(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return xe(ke(ke(e=Ie(this,Ce(t).call(this,...r)))),"start",0),xe(ke(ke(e)),"timeScale",1),xe(ke(ke(e)),"timeOffset",0),xe(ke(ke(e)),"value",0),xe(ke(ke(e)),"extrapolation",0),xe(ke(ke(e)),"keys",[]),xe(ke(ke(e)),"_currentKey",1),xe(ke(ke(e)),"length",0),e}var n,r,i;return Me(t,u),n=t,(r=[{key:"Sort",value:function(){u.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale-this.timeOffset,0===this.length)return this.value;const n=this.keys[0],r=this.keys[this.keys.length-1];if(e>=r.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.CONSTANT:return r.value;case t.Extrapolation.GRADIENT:return r.value+(e-r.time)*r.right;default:e%=r.time}else if(e<0||e<n.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.GRADIENT:return n.value+(e*this.length-r.time)*n.left;default:return n.value}let i=this.keys[this._currentKey],o=this.keys[this._currentKey-1];for(;e>=i.time||e<o.time;)e<o.time&&(this._currentKey=0),this._currentKey++,i=this.keys[this._currentKey],o=this.keys[this._currentKey-1];const a=(e-o.time)/(i.time-o.time);switch(o.interpolation){case t.Interpolation.CONSTANT:return o.value;case t.Interpolation.LINEAR:return o.value*(1-a)+i.value*a;case t.Interpolation.HERMITE:const n=-2*a*a*a+3*a*a,r=a*a*a-2*a*a+a,s=a*a*a-a*a;return(2*a*a*a-3*a*a+1)*o.value+n*i.value+r*o.right+s*i.left;default:const u=1+(Math.sqrt(o.value/i.value)-1)*Math.exp(-e/o.right);return u*u*i.value}}}])&&Pe(n.prototype,r),i&&Pe(n,i),t}();function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?He(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ne(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}xe(je,"inputDimension",1),xe(je,"outputDimension",1),xe(je,"valueProperty","value"),xe(je,"curveType",u.Type.CURVE),xe(je,"Key",Ge),xe(je,"Extrapolation",{NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3}),xe(je,"Interpolation",{NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,CATMULROM:4});let qe=function(e){function t(){var e;Le(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return ze(He(He(e=Be(this,Ue(t).call(this,...r)))),"value",0),ze(He(He(e)),"leftTangent",0),ze(He(He(e)),"rightTangent",0),ze(He(He(e)),"interpolation",1),e}return Ne(t,s),t}(),Xe=function(e){function t(){var e;Le(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return ze(He(He(e=Be(this,Ue(t).call(this,...r)))),"cycle",!1),ze(He(He(e)),"reversed",!1),ze(He(He(e)),"timeOffset",0),ze(He(He(e)),"timeScale",1),ze(He(He(e)),"startValue",0),ze(He(He(e)),"currentValue",0),ze(He(He(e)),"endValue",0),ze(He(He(e)),"startTangent",0),ze(He(He(e)),"endTangent",0),ze(He(He(e)),"interpolation",1),ze(He(He(e)),"keys",[]),ze(He(He(e)),"length",0),e}var n,r,i;return Ne(t,u),n=t,(r=[{key:"Sort",value:function(){u.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.currentValue=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return this.startValue;if(e>this.length){if(!this.cycle)return this.reversed?this.startValue:this.endValue;e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null);let t=this.keys[0],n=this.keys[this.keys.length-1];if(e<=t.time)return this.Interpolate(e,null,t);if(e>=n.time)return this.Interpolate(e,n,null);for(let r=0;r+1<this.keys.length&&(t=this.keys[r],n=this.keys[r+1],!(t.time<=e&&n.time>e));++r);return this.Interpolate(e,t,n)}},{key:"Interpolate",value:function(e,n,r){let i=this.startValue,o=this.endValue,a=this.interpolation,s=this.length;switch(null!==n&&(a=n.interpolation,e-=n.time),a){case t.Interpolation.LINEAR:return n&&r?(i=n.value,o=r.value,s=r.time-n.time):r?(o=r.value,s=r.time):n&&(i=n.value,s=this.length-n.time),i+e/s*(o-i);case t.Interpolation.HERMITE:let u=this.startTangent,l=this.endTangent;n&&r?(i=n.value,u=n.rightTangent,o=r.value,l=r.leftTangent,s=r.time-n.time):r?(o=r.value,l=r.leftTangent,s=r.time):n&&(i=n.value,u=n.rightTangent,s=this.length-n.time);const c=e/s,f=c*c,h=f*c,d=-2*h+3*f,p=h-f;return i*(1-d)+o*d+u*(c+p-f)+l*p;default:return this.startValue}}}])&&Fe(n.prototype,r),i&&Fe(n,i),t}();function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ze(Xe,"inputDimension",1),ze(Xe,"outputDimension",1),ze(Xe,"valueProperty","currentValue"),ze(Xe,"curveType",u.Type.CURVE2),ze(Xe,"Key",qe),ze(Xe,"Interpolation",{CONSTANT:0,LINEAR:1,HERMITE:2});let $e=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=We(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?Qe(n):r,Ze(Qe(Qe(e)),"value",0),Ze(Qe(Qe(e)),"offset",0),Ze(Qe(Qe(e)),"scale",1),Ze(Qe(Qe(e)),"speed",1),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,u),n=t,(r=[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return Math.sin(e*Math.PI*2*this.speed)*this.scale+this.offset}}])&&Ye(n.prototype,r),i&&Ye(n,i),t}();function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?ot(e):t}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&it(e,t)}function it(e,t){return(it=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ze($e,"outputDimension",1),Ze($e,"valueProperty","value"),Ze($e,"curveType",u.Type.CURVE_NO_KEYS);let st=function(e){function t(){var e;et(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return at(ot(ot(e=tt(this,nt(t).call(this,...i)))),"value",r.G.create()),at(ot(ot(e)),"leftTangent",r.G.create()),at(ot(ot(e)),"rightTangent",r.G.create()),at(ot(ot(e)),"interpolation",1),e}return rt(t,s),t}(),ut=function(e){function t(){var e;et(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return at(ot(ot(e=tt(this,nt(t).call(this,...i)))),"cycle",!1),at(ot(ot(e)),"reversed",!1),at(ot(ot(e)),"timeOffset",0),at(ot(ot(e)),"timeScale",1),at(ot(ot(e)),"startValue",r.G.create()),at(ot(ot(e)),"currentValue",r.G.create()),at(ot(ot(e)),"endValue",r.G.create()),at(ot(ot(e)),"startTangent",r.G.create()),at(ot(ot(e)),"endTangent",r.G.create()),at(ot(ot(e)),"interpolation",1),at(ot(ot(e)),"keys",[]),at(ot(ot(e)),"length",0),e}var n,i,o;return rt(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return r.G.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?r.G.copy(t,this.startValue):r.G.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);let n=this.keys[0],i=this.keys[this.keys.length-1];if(e<=n.time)return this.Interpolate(e,null,n,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(let t=0;t+1<this.keys.length&&(n=this.keys[t],i=this.keys[t+1],!(n.time<=e&&i.time>e));++t);return this.Interpolate(e,n,i,t)}},{key:"Interpolate",value:function(e,n,i,o){r.G.copy(o,this.startValue);let a=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==n&&(u=n.interpolation,e-=n.time),u){case t.Interpolation.LINEAR:return n&&i?(a=n.value,s=i.value,l=i.time-n.time):i?(s=i.value,l=i.time):n&&(a=n.value,l=this.length-n.time),o[0]=a[0]+(s[0]-a[0])*(e/l),o[1]=a[1]+(s[1]-a[1])*(e/l),o;case t.Interpolation.HERMITE:let r=this.startTangent,c=this.endTangent;n&&i?(a=n.value,r=n.rightTangent,s=i.value,c=i.leftTangent,l=i.time-n.time):i?(s=i.value,c=i.leftTangent,l=i.time):n&&(a=n.value,r=n.rightTangent,l=this.length-n.time);const f=e/l,h=f*f,d=h*f,p=-2*d+3*h,m=1-p,y=d-h,b=f+y-h;return o[0]=a[0]*m+s[0]*p+r[0]*b+c[0]*y,o[1]=a[1]*m+s[1]*p+r[1]*b+c[1]*y,o;default:return o}}}])&&Je(n.prototype,i),o&&Je(n,o),t}();function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ft(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?mt(e):t}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}at(ut,"inputDimension",2),at(ut,"outputDimension",2),at(ut,"valueProperty","value"),at(ut,"curveType",u.Type.CURVE2),at(ut,"Key",st),at(ut,"Interpolation",{CONSTANT:0,LINEAR:1,HERMITE:2});let bt=function(e){function t(){var e;ct(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return yt(mt(mt(e=ft(this,ht(t).call(this,...i)))),"value",r.H.create()),yt(mt(mt(e)),"leftTangent",r.H.create()),yt(mt(mt(e)),"rightTangent",r.H.create()),yt(mt(mt(e)),"interpolation",1),e}return dt(t,s),t}(),vt=function(e){function t(){var e;ct(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return yt(mt(mt(e=ft(this,ht(t).call(this,...i)))),"cycle",!1),yt(mt(mt(e)),"reversed",!1),yt(mt(mt(e)),"timeOffset",0),yt(mt(mt(e)),"timeScale",1),yt(mt(mt(e)),"startValue",r.H.create()),yt(mt(mt(e)),"currentValue",r.H.create()),yt(mt(mt(e)),"endValue",r.H.create()),yt(mt(mt(e)),"startTangent",r.H.create()),yt(mt(mt(e)),"endTangent",r.H.create()),yt(mt(mt(e)),"interpolation",1),yt(mt(mt(e)),"keys",[]),yt(mt(mt(e)),"length",0),e}var n,i,o;return dt(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return r.H.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?r.H.copy(t,this.startValue):r.H.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);let n=this.keys[0],i=this.keys[this.keys.length-1];if(e<=n.time)return this.Interpolate(e,null,n,t);if(e>=i.time)return this.Interpolate(e,i,null,t);for(let t=0;t+1<this.keys.length&&(n=this.keys[t],i=this.keys[t+1],!(n.time<=e&&i.time>e));++t);return this.Interpolate(e,n,i,t)}},{key:"Interpolate",value:function(e,n,i,o){r.H.copy(o,this.startValue);let a=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==n&&(u=n.interpolation,e-=n.time),u){case t.Interpolation.LINEAR:return n&&i?(a=n.value,s=i.value,l=i.time-n.time):i?(s=i.value,l=i.time):n&&(a=n.value,l=this.length-n.time),o[0]=a[0]+(s[0]-a[0])*(e/l),o[1]=a[1]+(s[1]-a[1])*(e/l),o[2]=a[2]+(s[2]-a[2])*(e/l),o;case t.Interpolation.HERMITE:let r=this.startTangent,c=this.endTangent;n&&i?(a=n.value,r=n.rightTangent,s=i.value,c=i.leftTangent,l=i.time-n.time):i?(s=i.value,c=i.leftTangent,l=i.time):n&&(a=n.value,r=n.rightTangent,l=this.length-n.time);const f=e/l,h=f*f,d=h*f,p=-2*d+3*h,m=1-p,y=d-h,b=f+y-h;return o[0]=a[0]*m+s[0]*p+r[0]*b+c[0]*y,o[1]=a[1]*m+s[1]*p+r[1]*b+c[1]*y,o[2]=a[2]*m+s[2]*p+r[2]*b+c[2]*y,o;default:return o}}}])&&lt(n.prototype,i),o&&lt(n,o),t}();function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?St(e):t}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}yt(vt,"inputDimension",3),yt(vt,"outputDimension",3),yt(vt,"valueProperty","currentValue"),yt(vt,"curveType",u.Type.CURVE2),yt(vt,"Key",bt),yt(vt,"Interpolation",{CONSTANT:0,LINEAR:1,HERMITE:2});let Pt=function(e){function t(){var e;_t(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Ot(St(St(e=wt(this,Et(t).call(this,...i)))),"value",r.H.create()),Ot(St(St(e)),"left",r.H.create()),Ot(St(St(e)),"right",r.H.create()),Ot(St(St(e)),"interpolation",0),e}return Tt(t,s),t}(),At=function(e){function t(){var e;_t(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Ot(St(St(e=wt(this,Et(t).call(this,...i)))),"start",0),Ot(St(St(e)),"value",r.H.create()),Ot(St(St(e)),"extrapolation",0),Ot(St(St(e)),"keys",[]),Ot(St(St(e)),"_currentKey",1),Ot(St(St(e)),"length",0),e}var n,i,o;return Tt(t,u),n=t,(i=[{key:"Sort",value:function(){u.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,n){if(0===this.length)return r.H.copy(n,this.value);const i=this.keys[0],o=this.keys[this.keys.length-1];if(e>=o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.H.copy(n,this.value);case t.Extrapolation.CONSTANT:return r.H.copy(n,o.value);case t.Extrapolation.GRADIENT:return r.H.scaleAndAdd(n,o.value,o.right,e-o.time);default:e%=o.time}else if(e<0||e<i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return r.H.copy(n,this.value);case t.Extrapolation.GRADIENT:return r.H.scaleAndAdd(n,i.value,i.left,e*this.length-o.time);default:return r.H.copy(n,i.value)}let a=this.keys[this._currentKey],s=this.keys[this._currentKey-1];for(;e>=a.time||e<s.time;)e<s.time&&(this._currentKey=0),this._currentKey++,a=this.keys[this._currentKey],s=this.keys[this._currentKey-1];const u=(e-s.time)/(a.time-s.time);switch(s.interpolation){case t.Interpolation.CONSTANT:return r.H.copy(n,s.value);case t.Interpolation.LINEAR:return n[0]=s.value[0]*(1-u)+a.value[0]*u,n[1]=s.value[1]*(1-u)+a.value[1]*u,n[2]=s.value[2]*(1-u)+a.value[2]*u,n;case t.Interpolation.HERMITE:const e=2*u*u*u-3*u*u+1,i=-2*u*u*u+3*u*u,o=u*u*u-2*u*u+u,l=u*u*u-u*u;return n[0]=e*s.value[0]+i*a.value[0]+o*s.right[0]+l*a.left[0],n[1]=e*s.value[1]+i*a.value[1]+o*s.right[1]+l*a.left[1],n[2]=e*s.value[2]+i*a.value[2]+o*s.right[2]+l*a.left[2],n;default:return n}}}])&&gt(n.prototype,i),o&&gt(n,o),t}();function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ct(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ot(At,"inputDimension",3),Ot(At,"outputDimension",3),Ot(At,"valueProperty","value"),Ot(At,"curveType",u.Type.CURVE),Ot(At,"Key",Pt),Ot(At,"Extrapolation",{NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3}),Ot(At,"Interpolation",{NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3});let xt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ct(this,Mt(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dt(e,t)}(t,u),n=t,i=[{key:"Sort",value:function(e){let t=e.functions;if(t&&t.length)for(let e=0;e<t.length;e++)t[e]&&"Sort"in t[e]&&t[e].Sort()}},{key:"Sort2",value:function(e){const t=e.constructor.childProperties;if(t)for(let n=0;n<t.length;n++){let r=e[t[n]];r&&"Sort"in r&&r.Sort()}}}],(r=null)&&It(n.prototype,r),i&&It(n,i),t}();function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jt(e){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}kt(xt,"childProperties",null),kt(xt,"childArray",null),kt(xt,"Operator",null);let Ut=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=jt(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Lt(n):i,Bt(Lt(Lt(e)),"start",0),Bt(Lt(Lt(e)),"value",r.I.create()),Bt(Lt(Lt(e)),"operator",0),Bt(Lt(Lt(e)),"functions",[]),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort(this)}},{key:"GetLength",value:function(){let e=0;for(let t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,n){const i=xt.global.vec4_0;switch(this.operator){case t.Operator.MULTIPLY:r.I.set(n,1,1,1,1);for(let t=0;t<this.functions.length;++t)this.functions[t].GetValueAt(e,i),r.I.multiply(n,n,i);return n;default:r.I.set(n,0,0,0,0);for(let t=0;t<this.functions.length;++t)this.functions[t].GetValueAt(e,i),r.I.add(n,n,i);return n}}}])&&Gt(n.prototype,i),o&&Gt(n,o),t}();function Nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vt(e){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Bt(Ut,"inputDimension",4),Bt(Ut,"outputDimension",4),Bt(Ut,"valueProperty","value"),Bt(Ut,"curveType",xt.Type.SEQUENCER),Bt(Ut,"childArray","functions"),Bt(Ut,"Operator",{MULTIPLY:0,ADD:1});let Xt=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Vt(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?zt(n):i,qt(zt(zt(e)),"yawCurve",null),qt(zt(zt(e)),"pitchCurve",null),qt(zt(zt(e)),"rollCurve",null),qt(zt(zt(e)),"currentValue",r.C.create()),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort2(this)}},{key:"GetLength",value:function(){let e=0;return this.yawCurve&&"GetLength"in this.yawCurve&&(e=this.yawCurve.GetLength()),this.pitchCurve&&"GetLength"in this.pitchCurve&&(e=Math.max(e,this.pitchCurve.GetLength())),this.rollCurve&&"GetLength"in this.rollCurve&&(e=Math.max(e,this.rollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){const n=this.yawCurve?this.yawCurve.GetValueAt(e):0,r=this.pitchCurve?this.pitchCurve.GetValueAt(e):0,i=this.rollCurve?this.rollCurve.GetValueAt(e):0,o=Math.sin(n/2),a=Math.cos(n/2),s=Math.sin(r/2),u=Math.cos(r/2),l=Math.sin(i/2),c=Math.cos(i/2);return t[0]=o*u*l+a*s*c,t[1]=o*u*c-a*s*l,t[2]=a*u*l-o*s*c,t[3]=a*u*c+o*s*l,t}}])&&Nt(n.prototype,i),o&&Nt(n,o),t}();function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wt(e){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kt(e,t){return(Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}qt(Xt,"inputDimension",1),qt(Xt,"outputDimension",3),qt(Xt,"valueProperty","currentValue"),qt(Xt,"curveType",xt.Type.SEQUENCER2),qt(Xt,"childProperties",["yawCurve","pitchCurve","rollCurve"]);let $t=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Wt(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Qt(n):i,Zt(Qt(Qt(e)),"start",0),Zt(Qt(Qt(e)),"value",r.C.create()),Zt(Qt(Qt(e)),"functions",[]),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort(this)}},{key:"GetLength",value:function(){let e=0;for(let t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){r.C.identity(t);const n=xt.global.quat_0;for(let i=0;i<this.functions.length;++i)this.functions[i].GetValueAt(e,n),r.C.multiply(t,t,n);return t}}])&&Yt(n.prototype,i),o&&Yt(n,o),t}();function Jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Zt($t,"inputDimension",4),Zt($t,"outputDimension",4),Zt($t,"valueProperty","value"),Zt($t,"curveType",xt.Type.SEQUENCER),Zt($t,"childArray","functions");let on=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=en(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?nn(n):i,rn(nn(nn(e)),"value",r.I.create()),rn(nn(nn(e)),"RedCurve",null),rn(nn(nn(e)),"GreenCurve",null),rn(nn(nn(e)),"BlueCurve",null),rn(nn(nn(e)),"AlphaCurve",null),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort2(this)}},{key:"GetLength",value:function(){let e=0;return this.RedCurve&&"GetLength"in this.RedCurve&&(e=this.RedCurve.GetLength()),this.GreenCurve&&"GetLength"in this.GreenCurve&&(e=Math.max(e,this.GreenCurve.GetLength())),this.BlueCurve&&"GetLength"in this.BlueCurve&&(e=Math.max(e,this.BlueCurve.GetLength())),this.AlphaCurve&&"GetLength"in this.AlphaCurve&&(e=Math.max(e,this.AlphaCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.RedCurve?this.RedCurve.GetValueAt(e):0,t[1]=this.GreenCurve?this.GreenCurve.GetValueAt(e):0,t[2]=this.BlueCurve?this.BlueCurve.GetValueAt(e):0,t[3]=this.AlphaCurve?this.AlphaCurve.GetValueAt(e):0,t}}])&&Jt(n.prototype,i),o&&Jt(n,o),t}();function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e){return(sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function un(e,t){return(un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}rn(on,"inputDimension",1),rn(on,"outputDimension",4),rn(on,"valueProperty","value"),rn(on,"curveType",xt.Type.SEQUENCER2),rn(on,"childProperties",["RedCurve","GreenCurve","BlueCurve","AlphaCurve"]);let fn=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=sn(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?ln(n):r,cn(ln(ln(e)),"value",0),cn(ln(ln(e)),"operator",0),cn(ln(ln(e)),"functions",[]),cn(ln(ln(e)),"inMinClamp",0),cn(ln(ln(e)),"inMaxClamp",1),cn(ln(ln(e)),"outMinClamp",0),cn(ln(ln(e)),"outMaxClamp",1),cn(ln(ln(e)),"clamping",!1),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&un(e,t)}(t,xt),n=t,(r=[{key:"Sort",value:function(){xt.Sort(this)}},{key:"GetLength",value:function(){let e=0;for(let t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){let n;switch(this.operator){case t.Operator.MULTIPLY:n=1;for(let t=0;t<this.functions.length;++t){let r=this.functions[t].GetValueAt(e);this.clamping&&(r=Math.min(Math.max(r,this.inMinClamp),this.inMaxClamp)),n*=r}break;default:n=0;for(let t=0;t<this.functions.length;++t){let r=this.functions[t].GetValueAt(e);this.clamping&&(r=Math.min(Math.max(r,this.inMinClamp),this.inMaxClamp)),n+=r}}return this.clamping&&(n=Math.min(Math.max(n,this.outMinClamp),this.outMaxClamp)),n}}])&&an(n.prototype,r),i&&an(n,i),t}();function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dn(e){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pn(e,t){return(pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}cn(fn,"inputDimension",1),cn(fn,"outputDimension",1),cn(fn,"valueProperty","value"),cn(fn,"curveType",xt.Type.SEQUENCER),cn(fn,"childArray","functions"),cn(fn,"Operator",{MULTIPLY:0,ADD:1});let bn=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=dn(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?mn(n):i,yn(mn(mn(e)),"start",0),yn(mn(mn(e)),"value",r.H.create()),yn(mn(mn(e)),"operator",0),yn(mn(mn(e)),"functions",[]),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pn(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort(this)}},{key:"GetLength",value:function(){let e=0;for(let t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,n){const i=xt.global.vec3_0;switch(this.operator){case t.Operator.MULTIPLY:r.H.set(n,1,1,1);for(let t=0;t<this.functions.length;++t)this.functions[t].GetValueAt(e,i),r.H.multiply(n,n,i);return n;default:r.H.set(n,0,0,0);for(let t=0;t<this.functions.length;++t)this.functions[t].GetValueAt(e,i),r.H.add(n,n,i);return n}}}])&&hn(n.prototype,i),o&&hn(n,o),t}();function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gn(e){return(gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _n(e,t){return(_n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function En(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}yn(bn,"inputDimension",3),yn(bn,"outputDimension",3),yn(bn,"valueProperty","value"),yn(bn,"curveType",xt.Type.SEQUENCER),yn(bn,"childArray","functions"),yn(bn,"Operator",{MULTIPLY:0,ADD:1});let Tn=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=gn(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?wn(n):i,En(wn(wn(e)),"value",r.H.create()),En(wn(wn(e)),"XCurve",null),En(wn(wn(e)),"YCurve",null),En(wn(wn(e)),"ZCurve",null),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_n(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort2(this)}},{key:"GetLength",value:function(){let e=0;return this.XCurve&&"GetLength"in this.XCurve&&(e=this.XCurve.GetLength()),this.YCurve&&"GetLength"in this.YCurve&&(e=Math.max(e,this.YCurve.GetLength())),this.ZCurve&&"GetLength"in this.ZCurve&&(e=Math.max(e,this.ZCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.XCurve?this.XCurve.GetValueAt(e):0,t[1]=this.YCurve?this.YCurve.GetValueAt(e):0,t[2]=this.ZCurve?this.ZCurve.GetValueAt(e):0,t}}])&&vn(n.prototype,i),o&&vn(n,o),t}();function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function On(e,t){return(On=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function An(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}En(Tn,"inputDimension",1),En(Tn,"outputDimension",3),En(Tn,"valueProperty","value"),En(Tn,"curveType",xt.Type.SEQUENCER2),En(Tn,"childProperties",["XCurve","YCurve","ZCurve"]);let In=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Sn(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Pn(n):i,An(Pn(Pn(e)),"value",r.C.create()),An(Pn(Pn(e)),"YawPitchRoll",r.H.create()),An(Pn(Pn(e)),"YawCurve",null),An(Pn(Pn(e)),"PitchCurve",null),An(Pn(Pn(e)),"RollCurve",null),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&On(e,t)}(t,xt),n=t,(i=[{key:"Sort",value:function(){xt.Sort2(this)}},{key:"GetLength",value:function(){let e=0;return this.YawCurve&&"GetLength"in this.YawCurve&&(e=this.YawCurve.GetLength()),this.PitchCurve&&"GetLength"in this.PitchCurve&&(e=Math.max(e,this.PitchCurve.GetLength())),this.RollCurve&&"GetLength"in this.RollCurve&&(e=Math.max(e,this.RollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){this.YawCurve&&(this.YawPitchRoll[0]=this.YawCurve.GetValueAt(e)),this.PitchCurve&&(this.YawPitchRoll[1]=this.PitchCurve.GetValueAt(e)),this.RollCurve&&(this.YawPitchRoll[2]=this.RollCurve.GetValueAt(e));const n=Math.sin(this.YawPitchRoll[0]/180*Math.PI/2),r=Math.cos(this.YawPitchRoll[0]/180*Math.PI/2),i=Math.sin(this.YawPitchRoll[1]/180*Math.PI/2),o=Math.cos(this.YawPitchRoll[1]/180*Math.PI/2),a=Math.sin(this.YawPitchRoll[2]/180*Math.PI/2),s=Math.cos(this.YawPitchRoll[2]/180*Math.PI/2);return t[0]=n*o*a+r*i*s,t[1]=n*o*s-r*i*a,t[2]=r*o*a-n*i*s,t[3]=r*o*s+n*i*a,t}}])&&Rn(n.prototype,i),o&&Rn(n,o),t}();function Cn(){this._id=r.F.generateID(),this.name="",this.geometryResPath="",this.geometryRes=null,this.group="",this.duration=0,this.cycle=!1,this.Initialize=function(){if(this.geometryResPath){this.geometryRes=r.D.GetResource(this.geometryResPath);const e=this;let t={OnResPrepared:function(){!function(e){if(e.name&&e.group&&e.geometryRes)for(let t=0;t<e.geometryRes.animations.length;++t){let n=e.geometryRes.animations[t];for(let t=0;t<n.trackGroups.length;++t)n.trackGroups[t].name===e.group&&e._ApplyTracks(n.trackGroups[t],n.duration)}}(e)}};this.geometryRes.RegisterNotification(t)}},this.UpdateValue=function(e){this._TracksReady()&&(this.cycle&&(e%=this.duration),e<=this.duration&&e>=0&&this._UpdateValue(e))}}function Mn(){this._id=r.F.generateID(),this.translation=r.H.create(),this.rotation=r.C.create(),this.rotation[3]=1,this.scale=r.H.create();let e=null,t=null,n=null,i=r.z.create();this._TracksReady=function(){return e||t||n},this._ApplyTracks=function(r,i){for(let o=0;o<r.transformTracks.length;++o){let a=r.transformTracks[o];a.name===this.name&&(this.duration=i,e=a.position,t=a.orientation,n=a.scaleShear)}this.UpdateValue(0)},this._UpdateValue=function(o){e&&r.v.evaluate(e,o,this.translation,this.cycle,this.duration),t&&(r.v.evaluate(t,o,this.rotation,this.cycle,this.duration),r.C.normalize(this.rotation,this.rotation)),n&&r.v.evaluate(n,o,i,this.cycle,this.duration),this.scale[0]=i[0],this.scale[1]=i[5],this.scale[2]=i[10]}}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}An(In,"inputDimension",1),An(In,"outputDimension",4),An(In,"valueProperty","value"),An(In,"curveType",xt.Type.SEQUENCER2),An(In,"childProperties",["YawCurve","PitchCurve","RollCurve"]),Mn.prototype=new Cn;let xn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),kn(this,"_id",r.F.generateID()),kn(this,"name",""),kn(this,"resPath",""),kn(this,"res",null),kn(this,"group",""),kn(this,"cycle",!1),kn(this,"duration",0),kn(this,"translation",r.H.create()),kn(this,"rotation",r.C.create()),kn(this,"scale",r.H.fromValues(0,0,0)),kn(this,"scaleShear",r.z.create()),kn(this,"positionCurve",null),kn(this,"orientationCurve",null),kn(this,"scaleCurve",null)}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(){""!==this.resPath&&(this.res=r.D.GetResource(this.resPath))}},{key:"GetLength",value:function(){return this.duration}},{key:"UpdateValue",value:function(e){this.res&&this.res.IsGood()&&(this.positionCurve||this.FindTracks(),this.positionCurve&&(this.cycle&&(e%=this.duration),e>this.duration||e<0||(r.v.evaluate(this.positionCurve,e,this.translation,this.cycle,this.duration),r.v.evaluate(this.orientationCurve,e,this.rotation,this.cycle,this.duration),r.C.normalize(this.rotation,this.rotation),r.v.evaluate(this.scaleCurve,e,this.scaleShear,this.cycle,this.duration),r.z.getScaling(this.scale,this.scaleCurve))))}},{key:"FindTracks",value:function(){let e=null;for(let t=0;t<this.res.animations.length;++t)for(let n=0;n<this.res.animations[t].trackGroups.length;++n)if(this.res.animations[t].trackGroups[n].name===this.group){this.duration=this.res.animations[t].duration,e=this.res.animations[t].trackGroups[n];break}if(e)for(let t=0;t<e.transformTracks.length;++t)if(this.name===e.transformTracks[t].name){this.positionCurve=e.transformTracks[t].position,this.orientationCurve=e.transformTracks[t].orientation,this.scaleCurve=e.transformTracks[t].scaleShear;break}}}])&&Dn(t.prototype,n),i&&Dn(t,i),e}();function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jn(e){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Un=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=jn(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Ln(n):i,Bn(Ln(Ln(e)),"xIndex",-1),Bn(Ln(Ln(e)),"yIndex",-1),Bn(Ln(Ln(e)),"zIndex",-1),Bn(Ln(Ln(e)),"animationEngine",null),Bn(Ln(Ln(e)),"eulerValue",r.H.create()),Bn(Ln(Ln(e)),"updateQuaternion",!1),Bn(Ln(Ln(e)),"quatValue",r.C.create()),Bn(Ln(Ln(e)),"length",0),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(t,u),n=t,(i=[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){if(this.animationEngine&&(this.xIndex&&(this.eulerValue[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.eulerValue[1]=this.eulerValue[0]:this.eulerValue[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.eulerValue[2]=this.eulerValue[0]:this.eulerValue[2]=this.animationEngine.Evaluate(this.zIndex,e)),this.updateQuaternion)){const e=Math.sin(this.eulerValue[0]/2),t=Math.cos(this.eulerValue[0]/2),n=Math.sin(this.eulerValue[1]/2),r=Math.cos(this.eulerValue[1]/2),i=Math.sin(this.eulerValue[2]/2),o=Math.cos(this.eulerValue[2]/2);this.quatValue[0]=e*r*i+t*n*o,this.quatValue[1]=e*r*o-t*n*i,this.quatValue[2]=t*r*i-e*n*o,this.quatValue[3]=t*r*o+e*n*i}}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}])&&Gn(n.prototype,i),o&&Gn(n,o),t}();function Nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vn(e){return(Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Bn(Un,"outputDimension",3),Bn(Un,"valueProperty","eulerValue"),Bn(Un,"curveType",u.Type.CURVE_MAYA);let Xn=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=Vn(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?zn(n):r,qn(zn(zn(e)),"index",-1),qn(zn(zn(e)),"animationEngine",null),qn(zn(zn(e)),"value",0),qn(zn(zn(e)),"length",0),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(t,u),n=t,(r=[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.value=this.animationEngine.Evaluate(this.index,e))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&this.index>=0&&(this.length=this.animationEngine.GetLength(this.index))}}])&&Nn(n.prototype,r),i&&Nn(n,i),t}();function Yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wn(e){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kn(e,t){return(Kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}qn(Xn,"outputDimension",1),qn(Xn,"valueProperty","value"),qn(Xn,"curveType",u.Type.CURVE_MAYA);let $n=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=Wn(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Qn(n):i,Zn(Qn(Qn(e)),"xIndex",-1),Zn(Qn(Qn(e)),"yIndex",-1),Zn(Qn(Qn(e)),"zIndex",-1),Zn(Qn(Qn(e)),"animationEngine",null),Zn(Qn(Qn(e)),"value",r.H.create()),Zn(Qn(Qn(e)),"length",0),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kn(e,t)}(t,u),n=t,(i=[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.xIndex&&(this.value[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.value[1]=this.value[0]:this.value[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.value[2]=this.value[0]:this.value[2]=this.animationEngine.Evaluate(this.zIndex,e)))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}])&&Yn(n.prototype,i),o&&Yn(n,o),t}();Zn($n,"outputDimension",3),Zn($n,"valueProperty","value"),Zn($n,"curveType",u.Type.CURVE_MAYA);var Jn=n(1);function er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let nr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),tr(this,"_id",r.F.generateID()),tr(this,"curves",[]),tr(this,"hermiteSegments",[]),tr(this,"bezierSegments",[]),tr(this,"_currentCurveIndex",0),tr(this,"_evalCache",null)}var t,n,i;return t=e,(n=[{key:"Evaluate",value:function(t,n){if(this.curves.length<=t)return 0;if(this._currentCurveIndex=t,!this._evalCache){this._evalCache=new Array(this.curves.length);for(let e=0;e<this._evalCache.length;++e)this._evalCache[e]=-1}let r=this.curves[t],i=r[e.AnimCurveFields.SEGMENT_OFFSET],o=null;return n<(o=r[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments:this.hermiteSegments)[i][e.AnimSegment.TIME]?r[e.AnimCurveFields.PRE_INFINITY]===e.INFINITY?o[i][e.AnimSegment.VALUE]:this._EvaluateInfinities(r,o,i,n,!0):n>r[e.AnimCurveFields.END_TIME]?r[e.AnimCurveFields.POST_INFINITY]===e.INFINITY?r[e.AnimCurveFields.END_VALUE]:this._EvaluateInfinities(r,o,i,n,!1):this._EvaluateImpl(r,o,i,n)}},{key:"_EvaluateImpl",value:function(t,n,r,i){let o,a=!1,s=null,u=null;if(this._evalCache[this._currentCurveIndex]>=0)if(u=r+this._evalCache[this._currentCurveIndex],this._evalCache[this._currentCurveIndex]<t[e.AnimCurveFields.NUM_SEGMENTS-1]&&i>n[u][e.AnimSegment.TIME]){if(i===n[s=r+this._evalCache[this._currentCurveIndex]+1][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]++,n[s][e.AnimSegment.VALUE];i<n[s][e.AnimSegment.TIME]?(o=this._evalCache[this._currentCurveIndex]+1,a=!0):s=null}else if(this._evalCache[this._currentCurveIndex]>0&&i<n[u][e.AnimSegment.TIME]){let t=r+this._evalCache[this._currentCurveIndex]-1;if(i>n[t][e.AnimSegment.TIME])o=this._evalCache[this._currentCurveIndex],a=!0;else if(i===n[t][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]--,n[t][e.AnimSegment.VALUE]}if(!a){let a=this._Find(t,i,n,r);if(o=a[1],a[0]||0===o)return o===t[e.AnimCurveFields.NUM_SEGMENTS]?(o--,this._evalCache[this._currentCurveIndex]=o,t[e.AnimCurveFields.END_VALUE]):(this._evalCache[this._currentCurveIndex]=o,n[r+o][e.AnimSegment.VALUE]);if(o===t[e.AnimCurveFields.NUM_SEGMENTS]+1)return this._evalCache[this._currentCurveIndex]=0,t[e.AnimCurveFields.END_VALUE]}if(this._evalCache[this._currentCurveIndex]!==o-1&&(this._evalCache[this._currentCurveIndex]=o-1,u=r+this._evalCache[this._currentCurveIndex],null===s&&(s=r+o)),t[e.AnimCurveFields.IS_WEIGHTED]){let r=n[u];if(r[e.BezierSegment.IS_STEP])return r[e.BezierSegment.VALUE];if(r[e.BezierSegment.IS_STEP_NEXT])return null===s?t[e.AnimCurveFields.END_VALUE]:n[s][e.BezierSegment.VALUE];{let o=t[e.AnimCurveFields.END_TIME];return this._evalCache[this._currentCurveIndex]+1<t[e.AnimCurveFields.NUM_SEGMENTS]&&(o=n[s][e.BezierSegment.TIME]),this._EvaluateBezier(r,i,o)}}{let r=n[u];return r[e.HermiteSegment.IS_STEP]?r[e.HermiteSegment.VALUE]:r[e.HermiteSegment.IS_STEP_NEXT]?null===s?t[e.AnimCurveFields.END_VALUE]:n[s][e.HermiteSegment.VALUE]:this._EvaluateHermite(r,i)}}},{key:"_EvaluateInfinities",value:function(e,t,n,r,i){throw new Jn.ErrFeatureNotImplemented({feature:"Maya animation engine evaluate infinities"})}},{key:"_EvaluateHermite",value:function(t,n){let r=n-t[e.HermiteSegment.TIME],i=t[e.HermiteSegment.COEFF];return r*(r*(r*i[0]+i[1])+i[2])+i[3]}},{key:"_EvaluateBezier",value:function(t,n,i){let o,a;if(a=(n-t[e.BezierSegment.TIME])/(i-t[e.BezierSegment.TIME]),t[e.BezierSegment.IS_LINEAR])o=a;else{let n=r.I.create();n[3]=t[e.BezierSegment.COEFF][3],n[2]=t[e.BezierSegment.COEFF][2],n[1]=t[e.BezierSegment.COEFF][1],n[0]=t[e.BezierSegment.COEFF][0]-a;let i=[];o=1===r.v.polyZeroes(n,3,0,1,1,1,i)?i[0]:0}let s=t[e.BezierSegment.POLYY];return o*(o*(o*s[3]+s[2])+s[1])+s[0]}},{key:"_Find",value:function(t,n,r,i){let o,a,s,u,l=0,c=null,f=0;if((o=t[e.AnimCurveFields.NUM_SEGMENTS]+1)>0){s=0,u=o-1;do{if(n<(f=(a=s+u>>1)<o-1?r[c=i+a][e.AnimSegment.TIME]:t[e.AnimCurveFields.END_TIME]))u=a-1;else{if(!(n>f))return[!0,l=a];s=a+1}}while(s<=u);l=s}return[!1,l]}},{key:"GetNumberOfCurves",value:function(){return this.curves.length}},{key:"GetLength",value:function(t){if(t<0||t>=this.curves.length)return 0;let n,r=this.curves[t];return n=r[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]]:this.hermiteSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]],r[e.AnimCurveFields.END_TIME]-n[e.AnimSegment.TIME]}}])&&er(t.prototype,n),i&&er(t,i),e}();tr(nr,"AnimCurveFields",{NUM_SEGMENTS:0,SEGMENT_OFFSET:1,END_TIME:2,END_VALUE:3,IN_TANGENT:4,OUT_TANGENT:5,PRE_INFINITY:6,POST_INFINITY:7,IS_WEIGHTED:8}),tr(nr,"AnimSegment",{TIME:0,VALUE:1}),tr(nr,"HermiteSegment",{TIME:0,VALUE:1,COEFF:2,IS_STEP:3,IS_STEP_NEXT:4}),tr(nr,"BezierSegment",{TIME:0,VALUE:1,COEFF:2,POLYY:3,IS_STEP:4,IS_STEP_NEXT:5,IS_LINEAR:6}),tr(nr,"INFINITY",0),n.d(t,"Tw2CurveKey",function(){return s}),n.d(t,"Tw2Curve",function(){return u}),n.d(t,"Tw2ColorKey",function(){return b}),n.d(t,"Tw2ColorCurve",function(){return v}),n.d(t,"Tw2ColorKey2",function(){return P}),n.d(t,"Tw2ColorCurve2",function(){return A}),n.d(t,"Tw2EventKey",function(){return F}),n.d(t,"Tw2EventCurve",function(){return L}),n.d(t,"Tw2PerlinCurve",function(){return z}),n.d(t,"Tw2QuaternionKey2",function(){return J}),n.d(t,"Tw2QuaternionCurve",function(){return ee}),n.d(t,"Tw2RandomConstantCurve",function(){return ae}),n.d(t,"Tw2Torque",function(){return me}),n.d(t,"Tw2RigidOrientation",function(){return ye}),n.d(t,"Tw2QuaternionKey",function(){return Se}),n.d(t,"Tw2RotationCurve",function(){return Oe}),n.d(t,"Tw2ScalarKey",function(){return Ge}),n.d(t,"Tw2ScalarCurve",function(){return je}),n.d(t,"Tw2ScalarKey2",function(){return qe}),n.d(t,"Tw2ScalarCurve2",function(){return Xe}),n.d(t,"Tw2SineCurve",function(){return $e}),n.d(t,"Tw2Vector2Key",function(){return st}),n.d(t,"Tw2Vector2Curve",function(){return ut}),n.d(t,"Tw2Vector3Key",function(){return bt}),n.d(t,"Tw2Vector3Curve",function(){return vt}),n.d(t,"Tw2VectorKey",function(){return Pt}),n.d(t,"Tw2VectorCurve",function(){return At}),n.d(t,"Tw2ColorSequencer",function(){return Ut}),n.d(t,"Tw2EulerRotation",function(){return Xt}),n.d(t,"Tw2QuaternionSequencer",function(){return $t}),n.d(t,"Tw2RGBAScalarSequencer",function(){return on}),n.d(t,"Tw2ScalarSequencer",function(){return fn}),n.d(t,"Tw2VectorSequencer",function(){return bn}),n.d(t,"Tw2XYZScalarSequencer",function(){return Tn}),n.d(t,"Tw2YPRSequencer",function(){return In}),n.d(t,"Tw2WbgTrack",function(){return Cn}),n.d(t,"Tw2WbgTransformTrack",function(){return Mn}),n.d(t,"Tw2TransformTrack",function(){return xn}),n.d(t,"Tw2MayaEulerRotationCurve",function(){return Un}),n.d(t,"Tw2MayaScalarCurve",function(){return Xn}),n.d(t,"Tw2MayaVector3Curve",function(){return $n}),n.d(t,"Tw2MayaAnimationEngine",function(){return nr})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=n(9);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"_id",r.F.generateID()),a(this,"name",""),a(this,"effectFilePath",""),a(this,"effectRes",null),a(this,"parameters",{}),a(this,"techniques",[]),a(this,"samplerOverrides",[]),a(this,"autoParameter",!1),a(this,"options",{}),a(this,"shader",null)}var t,n,s;return t=e,s=[{key:"ToEffectResPath",value:function(e){return(e=e?e.substr(0,e.lastIndexOf(".")).replace("/effect/",r.w.effectDir)+".sm_"+r.w.shaderModel:"").toLowerCase()}},{key:"FromEffectResPath",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fx";return(e=e.substr(0,e.lastIndexOf(".")).replace(r.w.effectDir,"/effect/")+"."+t).toLowerCase()}},{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;if(r.F.assignIfExists(t,e,["name","effectFilePath","display","autoParameter"]),"parameters"in e&&t.SetParameters(e.parameters),"textures"in e&&t.SetTextures(e.textures),"overrides"in e&&t.SetOverrides(e.overrides),""===t.name&&""!==e.effectFilePath){let n=e.effectFilePath;t.name=n.substring(n.lastIndexOf("/")+1,n.length)}return!t.name&&t.effectFilePath&&(t.name=t.effectFilePath.substring(t.effectFilePath.lastIndexOf("/")+1,t.effectFilePath.lastIndexOf("."))),t.Initialize(),t}}],(n=[{key:"Initialize",value:function(){if(""!==this.effectFilePath){this.effectFilePath=this.effectFilePath.toLowerCase();const t=e.ToEffectResPath(this.effectFilePath);this.effectRes=r.D.GetResource(t),this.effectRes.RegisterNotification(this)}}},{key:"IsGood",value:function(){return this.KeepAlive(),null!==this.shader}},{key:"KeepAlive",value:function(){const e=this.GetResources();for(let t=0;t<e.length;t++)e[t].KeepAlive()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.effectRes&&!e.includes(this.effectRes)&&e.push(this.effectRes);for(let t in this.parameters)this.parameters.hasOwnProperty(t)&&"GetResources"in this.parameters[t]&&this.parameters[t].GetResources(e);return e}},{key:"RebuildCachedData",value:function(e){this.shader=e.GetShader(this.options),this.BindParameters()}},{key:"UnBindParameters",value:function(){for(let e in this.techniques)if(this.techniques.hasOwnProperty(e)){let t=this.techniques[e];for(let e=0;e<t.length;++e)for(let n=0;n<t[e].stages.length;++n)for(let r=0;r<t[e].stages[n].reroutedParameters.length;++r)t[e].stages[n].reroutedParameters[r].Unbind()}this.techniques={}}},{key:"BindParameters",value:function(){if(this.UnBindParameters(),!this.IsGood())return!1;for(let t in this.shader.techniques)if(this.shader.techniques.hasOwnProperty(t)){let n=this.shader.techniques[t],o=[];for(let t=0;t<n.passes.length;++t){const a=[];a.stages=[];for(let o=0;o<n.passes[t].stages.length;++o){const s=n.passes[t].stages[o],u={};u.constantBuffer=new Float32Array(s.constantSize),u.reroutedParameters=[],u.parameters=[],u.textures=[],u.constantBuffer.set(s.constantValues);for(let t=0;t<s.constants.length;++t){const n=s.constants[t],i=n.name,o=n.Type;if(!e.ConstantIgnore.includes(i))if(i in this.parameters){const e=this.parameters[i];e.Bind(u.constantBuffer,n.offset,n.size)?u.reroutedParameters.push(e):u.parameters.push({parameter:e,constantBuffer:u.constantBuffer,offset:n.offset,size:n.size})}else if(r.E.HasVariable(i))u.parameters.push({parameter:r.E.GetVariable(i),constantBuffer:u.constantBuffer,offset:n.offset,size:n.size});else if(n.isAutoregister&&o){const e=r.E.RegisterVariable(i,void 0,o);e&&u.parameters.push({parameter:e,constantBuffer:u.constantBuffer,offset:n.offset,size:n.size})}else if(this.autoParameter&&1===n.elements){let e=u.constantBuffer.subarray(n.offset,n.offset+n.size);0===e.length?e=void 0:1===e.length&&(e=e[0]);const t=r.E.CreateType(i,e,o);t&&(this.parameters[i]=t,t.Bind(u.constantBuffer,n.offset,n.size)?u.reroutedParameters.push(t):u.parameter.push({parameter:t,constantBuffer:u.constantBuffer,offset:n.offset,size:n.size}))}}for(let e=0;e<s.textures.length;++e){const t=s.textures[e].name;let n=null;if(t in this.parameters)n=this.parameters[t];else if(r.E.HasVariable(t))n=r.E.GetVariable(t);else if(s.textures[e].isAutoregister)n=r.E.RegisterVariable(t,void 0,i.a);else{if(!this.autoParameter)continue;n=this.parameters[t]=new i.a(t)}const a={parameter:n,slot:s.textures[e].registerIndex,sampler:null};for(let e=0;e<s.samplers.length;++e)if(s.samplers[e].registerIndex===a.slot){s.samplers[e].name in this.samplerOverrides?a.sampler=this.samplerOverrides[s.samplers[e].name].GetSampler(s.samplers[e]):a.sampler=s.samplers[e];break}0===o&&(a.slot+=12),u.textures.push(a)}a.stages.push(u)}o.push(a)}this.techniques[t]=o}return r.w.effectObserver&&r.w.effectObserver.OnEffectChanged(this),this.autoParameter=!1,!0}},{key:"ApplyPass",value:function(e,t){if(!this.IsGood()||!(e in this.techniques)||t>=this.techniques[e].length)return;this.shader.ApplyPass(e,t);const n=this.techniques[e][t],i=this.shader.techniques[e].passes[t],o=r.w,a=o.gl,s=o.IsAlphaTestEnabled()&&i.shadowShaderProgram?i.shadowShaderProgram:i.shaderProgram;for(let e=0;e<2;++e){const t=n.stages[e];for(let e=0;e<t.parameters.length;++e){let n=t.parameters[e];n.parameter.Apply(n.constantBuffer,n.offset,n.size)}for(let e=0;e<t.textures.length;++e){let n=t.textures[e];n.parameter.Apply(n.slot,n.sampler,s.volumeSlices[n.sampler.registerIndex])}}const u=s.constantBufferHandles;u[0]&&a.uniform4fv(u[0],n.stages[0].constantBuffer),u[7]&&a.uniform4fv(u[7],n.stages[1].constantBuffer),o.perFrameVSData&&u[1]&&a.uniform4fv(u[1],o.perFrameVSData.data),o.perFramePSData&&u[2]&&a.uniform4fv(u[2],o.perFramePSData.data),o.perObjectData&&o.perObjectData.SetPerObjectDataToDevice(u)}},{key:"GetPassCount",value:function(e){return null!==this.shader&&e in this.techniques?this.techniques[e].length:0}},{key:"GetPassInput",value:function(e,t){return null===this.shader||!(e in this.techniques)||t>=this.techniques[e].length?null:r.w.IsAlphaTestEnabled()&&this.shader.techniques[e].passes[t].shadowShaderProgram?this.shader.techniques[e].passes[t].shadowShaderProgram.input:this.shader.techniques[e].passes[t].shaderProgram.input}},{key:"Render",value:function(e){const t=this.GetPassCount("Main");for(let n=0;n<t;++n)this.ApplyPass("Main",n),e(this,n)}},{key:"GetTextures",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let t in this.parameters)if(this.parameters.hasOwnProperty(t)&&this.parameters[t]instanceof i.a){let n=this.parameters[t].GetValue();n&&(e[t]=n)}return e}},{key:"SetTextures",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(let n in e)if(e.hasOwnProperty(n)){const r=e[n],o=this.parameters[n];i.a.isValue(r)&&(o?o.EqualsValue(r)||(o.SetTexturePath(r),t=!0):(this.parameters[n]=new i.a(n,r),t=!0))}return t}},{key:"GetParameters",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let t in this.parameters)!this.parameters.hasOwnProperty(t)||this.parameters[t]instanceof i.a||(e[t]=this.parameters[t].GetValue(!0));return e}},{key:"SetParameters",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(let n in e)if(e.hasOwnProperty(n)){const i=e[n],o=this.parameters[n];if(o)o.constructor.isValue(i)&&!o.EqualsValue(i)&&(this.parameters[n].SetValue(i),t=!0);else{const e=r.E.CreateType(n,i);e&&(this.parameters[n]=e,t=!0)}}return t}},{key:"SetOverrides",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(let n in e)if(e.hasOwnProperty(n)){const r=this.parameters[n];if(r&&r instanceof i.a){let o=!1;const a=e[n];for(let e in a)if(a.hasOwnProperty(e)&&i.a.overrideProperties.includes(e)&&a[e]!==r[e]){o=!0;break}o&&(r.SetOverrides(e[n]),t=!0)}}return t}},{key:"GetOverrides",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let t in this.parameters)if(this.parameters.hasOwnProperty(t)){const n=this.parameters[t];n&&n instanceof i.a&&n.useAllOverrides&&(e[t]=this.parameters[t].GetOverrides())}return e}},{key:"AutoParameter",value:function(){return this.autoParameter=!0,this.BindParameters()}}])&&o(t.prototype,n),s&&o(t,s),e}();a(s,"ConstantIgnore",["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS","PerObjectPSInt"])},function(e,t,n){"use strict";var r=n(0);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"name",""),o(this,"registerIndex",0),o(this,"minFilter",r.q),o(this,"maxFilter",r.q),o(this,"magFilter",r.q),o(this,"minFilterNoMips",r.q),o(this,"addressU",r.r),o(this,"addressV",r.r),o(this,"addressW",r.r),o(this,"anisotropy",1),o(this,"samplerType",r.s),o(this,"isVolume",!1),o(this,"hash",0)}var t,n,a;return t=e,(n=[{key:"ComputeHash",value:function(){this.hash=2166136261,this.hash*=16777619,this.hash^=this.minFilter,this.hash*=16777619,this.hash^=this.maxFilter,this.hash*=16777619,this.hash^=this.addressU,this.hash*=16777619,this.hash^=this.addressV,this.hash*=16777619,this.hash^=this.anisotropy}},{key:"Apply",value:function(e){const t=this.samplerType,n=r.w,i=n.gl;i.texParameteri(t,i.TEXTURE_WRAP_S,e?this.addressU:i.CLAMP_TO_EDGE),i.texParameteri(t,i.TEXTURE_WRAP_T,e?this.addressV:i.CLAMP_TO_EDGE),i.texParameteri(t,i.TEXTURE_MIN_FILTER,e?this.minFilter:this.minFilterNoMips),i.texParameteri(t,i.TEXTURE_MAG_FILTER,this.magFilter),n.ext.AnisotropicFilter&&n.enableAnisotropicFiltering&&i.texParameterf(t,n.ext.AnisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropy,n.ext.AnisotropicFilter.maxAnisotropy))}},{key:"filterMode",get:function(){return this.minFilterNoMips in r.p?r.p[this.minFilterNoMips]:2}},{key:"mipFilterMode",get:function(){return this.minFilter in r.t?r.t[this.minFilter]:2}}])&&i(t.prototype,n),a&&i(t,a),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"name",""),u(this,"addressU",0),u(this,"addressV",0),u(this,"addressW",0),u(this,"filter",0),u(this,"mipFilter",0),u(this,"lodBias",0),u(this,"maxMipLevel",0),u(this,"maxAnisotropy",0),u(this,"_sampler",null)}var t,n,i;return t=e,(n=[{key:"GetSampler",value:function(e){if(this._sampler)return this._sampler;this._sampler=new a;const t=this._sampler;t.registerIndex=e.registerIndex,t.name=e.name;const n=r.w.wrapModes,i=r.w.gl;if(1===this.filter){switch(this.mipFilter){case 0:t.minFilter=i.NEAREST;break;case 1:t.minFilter=i.NEAREST_MIPMAP_NEAREST;break;default:t.minFilter=i.NEAREST_MIPMAP_LINEAR}t.minFilterNoMips=i.NEAREST,t.magFilter=i.NEAREST}else{switch(this.mipFilter){case 0:t.minFilter=i.LINEAR;break;case 1:t.minFilter=i.LINEAR_MIPMAP_NEAREST;break;default:t.minFilter=i.LINEAR_MIPMAP_LINEAR}t.minFilterNoMips=i.LINEAR,t.magFilter=i.LINEAR}return 3!==this.filter&&3!==this.mipFilter||(t.anisotropy=Math.max(this.maxAnisotropy,1)),t.addressU=n[this.addressU],t.addressV=n[this.addressV],t.addressW=n[this.addressW],t.samplerType=e.samplerType,t.isVolume=e.isVolume,t.ComputeHash(),t}}])&&s(t.prototype,n),i&&s(t,i),e}();n.d(t,"b",function(){return a}),n.d(t,"a",function(){return l})},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(0),i=n(8),o=n(16);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=u(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?c(n):r,f(c(c(e)),"path",""),f(c(c(e)),"_redContents",null),f(c(c(e)),"_inPrepare",null),f(c(c(e)),"_objects",[]),f(c(c(e)),"_constructor",null),e}var n,h,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,i["a"]),n=t,(h=[{key:"AddObject",value:function(e,t){this.HasErrors()?t&&t(this.GetErrors()[0]):this._objects.push({onResolved:e,onRejected:t})}},{key:"Prepare",value:function(e){for(null===this._inPrepare&&(this._redContents=e,this._constructor=new o.a(this._redContents),this._inPrepare=0,this._constructor.Construct());this._inPrepare<this._objects.length;){const e=this._objects[this._inPrepare];try{e.onResolved(this._constructor.Construct())}catch(t){e.onRejected&&(e.onRejected(t),e.onRejected=null),this.OnWarning({err:t,message:"Error preparing child object"})}this._inPrepare++}this.OnPrepared()}},{key:"OnError",value:function(e){s(u(t.prototype),"OnError",this).call(this,e);for(let t=0;t<this._objects.length;t++){const n=this._objects[t];n.onRejected&&n.onRejected(e)}return r.D.motherLode.Remove(this.path),this._objects=[],e}},{key:"OnPrepared",value:function(e){r.D.motherLode.Remove(this.path),this._objects=[],s(u(t.prototype),"OnPrepared",this).call(this,e)}}])&&a(n.prototype,h),d&&a(n,d),t}();h.prototype.requestResponseType="arraybuffer"},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0),i=n(17),o=n(2);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"xmlNode",null),s(this,"_inputStack",null),s(this,"_initializeObjects",null),s(this,"_ids",{}),s(this,"_reader",null),s(this,"_stringTable",null),s(this,"_start",null),t&&(this.xmlNode=t,t&&this.Initialize())}var t,n,u;return t=e,u=[{key:"IsValidXML",value:function(e){return e&&"binred"===String.fromCharCode.apply(null,new Uint8Array(e).subarray(0,6))}},{key:"ConstructObject",value:function(t){if("json"===t.type)return t;let n=r.E.GetClass(t.type);if(!n){if(!e.DEBUG_ENABLED)throw new o.A({type:t.type});n=Object}const i=new n;for(let e in t)if(t.hasOwnProperty(e)&&"type"!==e)if(t[e].constructor===Object){if(this.DEBUG_ENABLED&&(i[e]=i[e]||{}),i[e])for(let n in t[e])t[e].hasOwnProperty(n)&&(i[e][n]=t[e][n])}else i[e]=t[e];return"Initialize"in i&&i.Initialize(),i}},{key:"ReadUint",value:function(e,t){switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadUInt8();case this.ElementSize.MEDIUM:return e._reader.ReadUInt16();default:return e._reader.ReadUInt32()}}},{key:"ReadElementData",value:function(e,t){let n,r,i,a,s;switch(15&t){case this.ElementRawType.NULL:return null;case this.ElementRawType.BOOL:switch(48&t){case this.ElementSize.SMALL:return 0!==e._reader.ReadUInt8();case this.ElementSize.MEDIUM:return!1;default:return!0}case this.ElementRawType.INT:switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadInt8();case this.ElementSize.MEDIUM:return e._reader.ReadInt16();default:return e._reader.ReadInt32()}case this.ElementRawType.UINT:return this.ReadUint(e,t);case this.ElementRawType.FLOAT:switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadFloat16();case this.ElementSize.MEDIUM:return e._reader.ReadFloat32();default:throw new o.c({feature:"Element raw type Float64"})}case this.ElementRawType.STRING:return n=this.ReadUint(e,t),e._stringTable[n];case this.ElementRawType.ARRAY:for(a=this.ReadUint(e,t),i=[],r=0;r<a;++r)i.push(this.ReadElement(e));return i;case this.ElementRawType.MAPPING:for(a=this.ReadUint(e,t),i={},r=0;r<a;++r)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElement(e);return i;case this.ElementRawType.OBJECT:for(a=this.ReadUint(e,t),i={},r=0;r<a;++r)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElement(e);return this.ConstructObject(i);case this.ElementRawType.TYPED_ARRAY:for(a=this.ReadUint(e,t),s=e._reader.ReadUInt8(),i=[],r=0;r<a;++r)i.push(this.ReadElementData(e,s));return s in this.TypedArrays&&(i=new this.TypedArrays[s](i)),i;case this.ElementRawType.TYPED_MAPPING:for(a=this.ReadUint(e,t),s=e._reader.ReadUInt8(),i={},r=0;r<a;++r)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElementData(e,s);return i}}},{key:"ReadElement",value:function(e){const t=e._reader.ReadUInt8();if(t===this.REFERENCE_BIT)return e._ids[e._reader.ReadUInt16()];let n;0!=(t&this.ID_BIT)&&(n=e._reader.ReadUInt16());const r=this.ReadElementData(e,63&t);return 0!=(t&this.ID_BIT)&&(e._ids[n]=r),r}}],(n=[{key:"Initialize",value:function(){if(!e.IsValidXML(this.xmlNode))throw new o.z({message:"Invalid binary, expected binred"});this._reader=new i.a(new Uint8Array(this.xmlNode)),this._reader.cursor+=6,this._stringTable=[];const t=this._reader.ReadUInt32();for(let e=0;e<t;++e){const e=this._reader.ReadUInt16();this._stringTable.push(String.fromCharCode.apply(null,this._reader.data.subarray(this._reader.cursor,this._reader.cursor+e))),this._reader.cursor+=e}this._start=this._reader.cursor}},{key:"Construct",value:function(){return this._reader.cursor=this._start,e.ReadElement(this)}}])&&a(t.prototype,n),u&&a(t,u),e}();s(u,"DEBUG_ENABLED",!1),s(u,"ID_BIT",64),s(u,"REFERENCE_BIT",128),s(u,"ElementRawType",{NULL:0,BOOL:1,INT:2,UINT:3,FLOAT:4,STRING:5,ARRAY:6,MAPPING:7,OBJECT:8,TYPED_ARRAY:9,TYPED_MAPPING:10}),s(u,"ElementSize",{SMALL:0,MEDIUM:16,LARGE:32}),s(u,"TypedArrays",{2:Int8Array,3:Uint8Array,18:Int16Array,19:Uint16Array,34:Int32Array,35:Uint32Array,4:Float32Array,20:Float32Array,36:Float64Array});const l=u.ElementRawType,c=u.ElementSize;u.ElementTypes={NULL:l.NULL|c.SMALL,BOOL:l.BOOL|c.SMALL,FALSE:l.BOOL|c.MEDIUM,TRUE:l.BOOL|c.LARGE,INT8:l.INT|c.SMALL,UINT8:l.UINT|c.SMALL,INT16:l.INT|c.MEDIUM,UINT16:l.UINT|c.MEDIUM,INT32:l.INT|c.LARGE,UINT32:l.UINT|c.LARGE,FLOAT16:l.FLOAT|c.SMALL,FLOAT32:l.FLOAT|c.MEDIUM,FLOAT64:l.FLOAT|c.LARGE,SHORT_STRING:l.STRING|c.SMALL,MEDIUM_STRING:l.STRING|c.MEDIUM,LARGE_STRING:l.STRING|c.LARGE,SHORT_ARRAY:l.ARRAY|c.SMALL,MEDIUM_ARRAY:l.ARRAY|c.MEDIUM,LARGE_ARRAY:l.ARRAY|c.LARGE,SHORT_MAPPING:l.MAPPING|c.SMALL,MEDIUM_MAPPING:l.MAPPING|c.MEDIUM,LARGE_MAPPING:l.MAPPING|c.LARGE,SHORT_OBJECT:l.OBJECT|c.SMALL,MEDIUM_OBJECT:l.OBJECT|c.MEDIUM,LARGE_OBJECT:l.OBJECT|c.LARGE,SHORT_TYPED_ARRAY:l.TYPED_ARRAY|c.SMALL,MEDIUM_TYPED_ARRAY:l.TYPED_ARRAY|c.MEDIUM,LARGE_TYPED_ARRAY:l.TYPED_ARRAY|c.LARGE,SHORT_TYPED_MAPPING:l.TYPED_MAPPING|c.SMALL,MEDIUM_TYPED_MAPPING:l.TYPED_MAPPING|c.MEDIUM,LARGE_TYPED_MAPPING:l.TYPED_MAPPING|c.LARGE}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return o});let o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"data",null),i(this,"cursor",0),this.data=t}var t,n,o;return t=e,(n=[{key:"ReadUInt8",value:function(){return this.data[this.cursor++]}},{key:"ReadInt8",value:function(){let e=this.data[this.cursor++];return e>127&&(e=e-255-1),e}},{key:"ReadUInt16",value:function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)}},{key:"ReadInt16",value:function(){let e=this.data[this.cursor++]+(this.data[this.cursor++]<<8);return e>32767&&(e=e-65535-1),e}},{key:"ReadUInt32",value:function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0)}},{key:"ReadInt32",value:function(){let e=this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0);return e>2147483647&&(e=e-4294967295-1),e}},{key:"ReadFloat16",value:function(){let e=this.data[this.cursor++],t=this.data[this.cursor++];const n=(t>>2&31)-15,r=(3&t)<<8|e;return 0===r&&-15===n?0:(1-2*(t>>7))*(1+r*Math.pow(2,-10))*Math.pow(2,n)}},{key:"ReadFloat32",value:function(){let e=this.data[this.cursor++],t=this.data[this.cursor++],n=this.data[this.cursor++],r=this.data[this.cursor++];const i=(r<<1&255|n>>7)-127,o=(127&n)<<16|t<<8|e;return 0===o&&-127===i?0:(1-2*(r>>7))*(1+o*Math.pow(2,-23))*Math.pow(2,i)}},{key:"ReadString",value:function(){const e=this.data[this.cursor++];let t="";for(let n=0;n<e;++n)t+=String.fromCharCode(this.data[this.cursor++]);return t}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";n.r(t);var r=n(24);n.d(t,"Tw2StaticEmitter",function(){return r.c}),n.d(t,"Tw2DynamicEmitter",function(){return r.a}),n.d(t,"Tw2GpuUniqueEmitter",function(){return r.b});var i=n(23);n.d(t,"Tw2ParticleAttractorForce",function(){return i.a}),n.d(t,"Tw2ParticleDirectForce",function(){return i.b}),n.d(t,"Tw2ParticleDragForce",function(){return i.c}),n.d(t,"Tw2ParticleFluidDragForce",function(){return i.d}),n.d(t,"Tw2ParticleSpring",function(){return i.e}),n.d(t,"Tw2ParticleTurbulenceForce",function(){return i.f});var o=n(25);n.d(t,"Tw2RandomIntegerAttributeGenerator",function(){return o.a}),n.d(t,"Tw2RandomUniformAttributeGenerator",function(){return o.b}),n.d(t,"Tw2SphereShapeAttributeGenerator",function(){return o.c});var a=n(21);for(var s in a)["Tw2StaticEmitter","Tw2DynamicEmitter","Tw2GpuUniqueEmitter","Tw2ParticleAttractorForce","Tw2ParticleDirectForce","Tw2ParticleDragForce","Tw2ParticleFluidDragForce","Tw2ParticleSpring","Tw2ParticleTurbulenceForce","Tw2RandomIntegerAttributeGenerator","Tw2RandomUniformAttributeGenerator","Tw2SphereShapeAttributeGenerator","default"].indexOf(s)<0&&function(e){n.d(t,e,function(){return a[e]})}(s);var u=n(22);n.d(t,"Tw2ParticleSystem",function(){return u.a});var l=n(19);n.d(t,"Tw2ParticleElement",function(){return l.a});var c=n(5);n.d(t,"Tw2ParticleElementDeclaration",function(){return c.a})},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return i});let i=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"elementType",null),r(this,"customName",null),r(this,"dimension",null),r(this,"usageIndex",null),r(this,"usedByGPU",null),r(this,"buffer",null),r(this,"startOffset",0),r(this,"offset",0),r(this,"instanceStride",0),r(this,"vertexStride",0),r(this,"dirty",!1),t&&(this.elementType=t.elementType,this.customName=t.customName,this.dimension=t.GetDimension(),this.usageIndex=t.usageIndex,this.usedByGPU=t.usedByGPU)}},function(e,t,n){"use strict";n.r(t);var r=n(0);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"_id",r.F.generateID()),o(this,"name",""),o(this,"display",!0),o(this,"useSRT",!0),o(this,"lowestLodVisible",2),o(this,"staticTransform",!1),o(this,"rotation",r.C.create()),o(this,"translation",r.H.create()),o(this,"scaling",r.H.fromValues(1,1,1)),o(this,"localTransform",r.z.create()),o(this,"worldTransform",r.z.create()),o(this,"worldTransformLast",r.z.create()),o(this,"_perObjectData",null),o(this,"isEffectChild",!0)}var t,n,a;return t=e,(n=[{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e,t){this.useSRT&&(r.C.normalize(this.rotation,this.rotation),r.z.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)),r.z.copy(this.worldTransformLast,this.worldTransform),r.z.multiply(this.worldTransform,t,this.localTransform)}},{key:"GetBatches",value:function(e,t,n){}}])&&i(t.prototype,n),a&&i(t,a),e}();o(a,"global",{mat4_0:r.z.create(),vec3_0:r.H.create()}),o(a,"perObjectData",{FFEData:[["world",16],["worldInverseTranspose",16]]});var s=n(1);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let p=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];return n=this,e=!(r=c(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?h(n):r,d(h(h(e)),"mesh",null),d(h(h(e)),"_perObjectData",new s.Tw2BasicPerObjectData(a.perObjectData)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,a),n=t,(i=[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,n){l(c(t.prototype),"Update",this).call(this,e,n);const i=a.global.mat4_0,o=a.global.vec3_0;r.z.lookAt(i,r.w.eyePosition,this.worldTransform.subarray(12),[0,1,0]),r.z.transpose(i,i),r.z.getScaling(o,n),r.H.multiply(o,o,this.scaling),this.worldTransform[0]=i[0]*o[0],this.worldTransform[1]=i[1]*o[0],this.worldTransform[2]=i[2]*o[0],this.worldTransform[4]=i[4]*o[1],this.worldTransform[5]=i[5]*o[1],this.worldTransform[6]=i[6]*o[1],this.worldTransform[8]=i[8]*o[2],this.worldTransform[9]=i[9]*o[2],this.worldTransform[10]=i[10]*o[2]}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(r.z.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),r.z.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}])&&u(n.prototype,i),o&&u(n,o),t}();function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}let v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,y(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,a),t}();var g,_,w;function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}w=!0,(_="partialImplementation")in(g=v)?Object.defineProperty(g,_,{value:w,enumerable:!0,configurable:!0,writable:!0}):g[_]=w;let A=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=R(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?O(n):r,P(O(O(e)),"objects",[]),P(O(O(e)),"curveSets",[]),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,a),n=t,(r=[{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.objects.length;t++)"GetResources"in this.objects[t]&&this.objects[t].GetResources(e);return e}},{key:"Update",value:function(e,n){T(R(t.prototype),"Update",this).call(this,e,n);for(let t=0;t<this.curveSets.length;t++)this.curveSets[t].Update(e);for(let t=0;t<this.objects.length;t++)this.objects[t].Update(e,this.worldTransform)}},{key:"GetBatches",value:function(e,t,n){if(this.display)for(let r=0;r<this.objects.length;r++)this.objects[r].GetBatches(e,t,n)}}])&&E(n.prototype,r),i&&E(n,i),t}();function I(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}let D=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),I(this,C(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,a),t}();function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(D,"partialImplementation",!0);let L=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=x(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?j(n):r,F(j(j(e)),"mesh",null),F(j(j(e)),"useSpaceObjectData",!0),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,a),n=t,(i=[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"GetBatches",value:function(e,t,n){this.display&&this.mesh&&(this.useSpaceObjectData?(this._perObjectData||(this._perObjectData=new s.Tw2PerObjectData,this._perObjectData.perObjectVSData=new s.Tw2RawData,this._perObjectData.perObjectVSData.data=new Float32Array(n.perObjectVSData.data.length),this._perObjectData.perObjectVSData.data[33]=1,this._perObjectData.perObjectVSData.data[35]=1,this._perObjectData.perObjectPSData=new s.Tw2RawData,this._perObjectData.perObjectPSData.data=new Float32Array(n.perObjectPSData.data.length),this._perObjectData.perObjectPSData.data[1]=1,this._perObjectData.perObjectPSData.data[3]=1),this._perObjectData.perObjectVSData.data.set(n.perObjectVSData.data),this._perObjectData.perObjectPSData.data.set(n.perObjectPSData.data),r.z.transpose(this._perObjectData.perObjectVSData.data,this.worldTransform),r.z.transpose(this._perObjectData.perObjectVSData.data.subarray(16),this.worldTransformLast)):(this._perObjectData||(this._perObjectData=new s.Tw2BasicPerObjectData(a.perObjectData)),r.z.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),r.z.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform)),this.mesh.GetBatches(e,t,this._perObjectData))}}])&&k(n.prototype,i),o&&k(n,o),t}();function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t,n){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let q=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];return n=this,e=!(r=N(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?H(n):r,z(H(H(e)),"mesh",null),z(H(H(e)),"particleEmitters",[]),z(H(H(e)),"particleSystems",[]),z(H(H(e)),"_perObjectData",new s.Tw2BasicPerObjectData(a.perObjectData)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,a),n=t,(i=[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,n){U(N(t.prototype),"Update",this).call(this,e,n);for(let t=0;t<this.particleEmitters.length;++t)this.particleEmitters[t].Update(e);for(let t=0;t<this.particleSystems.length;++t)this.particleSystems[t].Update(e)}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(r.z.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),r.z.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}])&&B(n.prototype,i),o&&B(n,o),t}();function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Y(this,"_id",r.F.generateID()),Y(this,"name",""),Y(this,"value",1),Y(this,"sprites",[]),e.init()}var t,n,i;return t=e,i=[{key:"CollectSamples",value:function(e,t,n,i){const o=r.w,a=this.global,s=a.effect,u=a.vertexBuffer,l=a.decl;if(!s.effectRes||!s.effectRes.IsGood())return!1;s.parameters.BackBuffer.textureRes=e,s.parameters.OccluderIndex.SetValue([t,n,i]),o.SetStandardStates(o.RM_ADDITIVE),o.gl.bindBuffer(o.gl.ARRAY_BUFFER,u);for(let e=0;e<s.GetPassCount("Main");++e){if(s.ApplyPass("Main",e),l.SetDeclaration(s.GetPassInput("Main",e),16))return!1;o.ApplyShadowState(),o.gl.drawArrays(o.gl.TRIANGLES,0,1530)}return!0}},{key:"init",value:function(){if(e.global)return;const t=r.w,n=e.global={};n.mat4_0=r.z.create(),n.vec4_0=r.I.create(),n.accumulator=new s.Tw2BatchAccumulator,n.effect=s.Tw2Effect.create({name:"Occluder sampler",effectFilePath:"res:/graphics/effect/managed/space/specialfx/lensflares/collectsamples.fx",parameters:{OccluderPosition:[1,1,1,1],OccluderIndex:[1,1,1],BackBuffer:""}}),n.vertexBuffer=null,n.decl=new s.Tw2VertexDeclaration,n.decl.elements.push(new s.Tw2VertexElement(s.Tw2VertexDeclaration.Type.POSITION,0,t.gl.FLOAT,2,0)),n.decl.elements.push(new s.Tw2VertexElement(s.Tw2VertexDeclaration.Type.TEXCOORD,0,t.gl.FLOAT,2,8)),n.decl.RebuildHash();const i=new Float32Array(6120);let o=0;for(let e=0;e<16;++e)for(let t=0;t<16;++t){const n=(e+Math.random())/16*2-1,r=(t+Math.random())/16*2-1;i[o++]=1,i[o++]=1,i[o++]=n,i[o++]=r,i[o++]=-1,i[o++]=1,i[o++]=n,i[o++]=r,i[o++]=1,i[o++]=-1,i[o++]=n,i[o++]=r,i[o++]=-1,i[o++]=1,i[o++]=n,i[o++]=r,i[o++]=1,i[o++]=-1,i[o++]=n,i[o++]=r,i[o++]=-1,i[o++]=-1,i[o++]=n,i[o++]=r}n.vertexBuffer=t.gl.createBuffer(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,n.vertexBuffer),t.gl.bufferData(t.gl.ARRAY_BUFFER,i,t.gl.STATIC_DRAW),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,null)}}],(n=[{key:"UpdateValue",value:function(t,n){if(!r.w.alphaBlendBackBuffer)return;const i=r.w,o=e.global,a=o.mat4_0,s=o.vec4_0;o.accumulator.Clear();for(let e=0;e<this.sprites.length;++e)this.sprites[e].UpdateViewDependentData(t),this.sprites[e].GetBatches(i.RM_DECAL,o.accumulator);r.E.SetVariableValue("OccluderValue",[(1<<2*n)/255,(2<<2*n)/255,0,0]),o.accumulator.Render(),r.z.multiply(a,i.viewProjection,this.sprites[0].worldTransform),r.I.transformMat4(s,[0,0,0,1],a);const u=.5*(s[0]/s[3]+1),l=.5*(s[1]/s[3]+1);r.I.set(s,.5,.5,0,1),r.I.transformMat4(s,s,a);const c=.5*(s[0]/s[3]+1),f=.5*(s[1]/s[3]+1);s[0]=u,s[1]=l,s[2]=c-u,s[3]=f-l,o.effect.parameters.OccluderPosition.SetValue(s)}}])&&X(t.prototype,n),i&&X(t,i),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Y(W,"global",null);let Z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Q(this,"_id",r.F.generateID()),Q(this,"name",""),Q(this,"display",!0),Q(this,"update",!0),Q(this,"doOcclusionQueries",!0),Q(this,"cameraFactor",20),Q(this,"position",r.H.create()),Q(this,"flares",[]),Q(this,"occluders",[]),Q(this,"backgroundOccluders",[]),Q(this,"occlusionIntensity",1),Q(this,"backgroundOcclusionIntensity",1),Q(this,"distanceToEdgeCurves",[]),Q(this,"distanceToCenterCurves",[]),Q(this,"radialAngleCurves",[]),Q(this,"xDistanceToCenter",[]),Q(this,"yDistanceToCenter",[]),Q(this,"bindings",[]),Q(this,"curveSets",[]),Q(this,"mesh",null),Q(this,"_direction",r.H.create()),Q(this,"_transform",r.z.create()),Q(this,"_backBuffer",null),e.init()}var t,n,i;return t=e,i=[{key:"init",value:function(){if(!e.global){const t=e.global={};t.vec3_0=r.H.create(),t.vec3_1=r.H.create(),t.vec3_2=r.H.create(),t.vec3_3=r.H.create(),t.vec4_0=r.I.create(),t.vec4_1=r.I.create(),t.mat4_0=r.z.create(),t.backBuffer=new s.Tw2TextureRes,t.backBuffer.width=0,t.backBuffer.height=0,t.backBuffer.hasMipMaps=!1,t.occludedLevelIndex=0,t.occluderLevels=[new s.Tw2RenderTarget,new s.Tw2RenderTarget,new s.Tw2RenderTarget,new s.Tw2RenderTarget]}}}],(n=[{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e);for(let t=0;t<this.flares.length;t++)this.flares[t].GetResources(e);return W.global&&W.global.effect&&!e.includes(W.global.effect)&&e.push(W.global.effect),e}},{key:"UpdateOccluders",value:function(){if(!this.doOcclusionQueries)return;const t=r.w,n=e.global;if(!n.occluderLevels[0].texture||n.occluderLevels[0].width<2*this.occluders.length)for(let e=0;e<n.occluderLevels.length;++e)n.occluderLevels[e].Create(2*this.occluders.length,1,!1);for(let e=0;e<this.flares.length;++e)"_backBuffer"in this.flares[e]&&(this.flares[e]._backBuffer.textureRes=n.occluderLevels.texture);this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,n.occluderLevels[n.occludedLevelIndex].Set(),t.SetStandardStates(t.RM_OPAQUE),t.gl.clearColor(0,0,0,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT),n.occluderLevels[n.occludedLevelIndex].Unset();let i=1;t.antialiasing&&(i=t.msaaSamples,t.gl.sampleCoverage(1/i,!1));for(let e=0;e<this.occluders.length;++e)t.SetRenderState(t.RS_COLORWRITEENABLE,8),t.gl.colorMask(!1,!1,!1,!0),t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.antialiasing&&(t.gl.enable(t.gl.SAMPLE_COVERAGE),t.gl.sampleCoverage(.25,!1)),this.occluders[e].UpdateValue(this._transform,e),t.antialiasing&&t.gl.disable(t.gl.SAMPLE_COVERAGE),n.backBuffer.texture||n.backBuffer.Attach(t.gl.createTexture()),t.gl.bindTexture(t.gl.TEXTURE_2D,n.backBuffer.texture),n.backBuffer.width===t.viewportWidth&&n.backBuffer.height===t.viewportHeight||(t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,t.viewportWidth,t.viewportHeight,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,null),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,t.gl.LINEAR),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.LINEAR),n.backBuffer.width=t.viewportWidth,n.backBuffer.height=t.viewportHeight),t.gl.copyTexImage2D(t.gl.TEXTURE_2D,0,t.alphaBlendBackBuffer?t.gl.RGBA:t.gl.RGB,0,0,n.backBuffer.width,n.backBuffer.height,0),t.gl.bindTexture(t.gl.TEXTURE_2D,null),n.occluderLevels[n.occludedLevelIndex].Set(),W.CollectSamples(n.backBuffer,e,n.occluderLevels[0].width/2,i),n.occluderLevels[n.occludedLevelIndex].Unset();t.antialiasing&&t.gl.sampleCoverage(1,!1),n.occluderLevels[(n.occludedLevelIndex+1)%n.occluderLevels.length].Set();const o=new Uint8Array(4*n.occluderLevels[0].width);t.gl.readPixels(0,0,2,1,t.gl.RGBA,t.gl.UNSIGNED_BYTE,o),n.occluderLevels[(n.occludedLevelIndex+1)%n.occluderLevels.length].Unset(),this.occlusionIntensity=1;for(let e=0;e<2*n.occluderLevels[0].width;e+=4)this.occlusionIntensity*=o[e+1]?o[e]/o[e+1]:1;this.backgroundOcclusionIntensity=this.occlusionIntensity,r.E.SetVariableValue("LensflareFxOccScale",[this.occlusionIntensity,this.occlusionIntensity,0,0]),n.occludedLevelIndex=(n.occludedLevelIndex+1)%n.occluderLevels.length}},{key:"GetBatches",value:function(t,n,i){if(this.display){const o=r.I.set(e.global.vec4_0,0,0,1,0);if(r.I.transformMat4(o,o,r.w.viewInverse),r.H.dot(o,this._direction)<0)return;for(let e=0;e<this.flares.length;++e)this.flares[e].GetBatches(t,n,i);this.mesh&&this.mesh.GetBatches(t,n,i)}}},{key:"PrepareRender",value:function(){if(!this.display)return;const t=e.global,n=t.vec4_0,i=t.vec3_0,o=r.z.identity(t.mat4_0),a=t.vec3_2,s=t.vec3_3,u=t.vec3_1,l=t.vec4_1;r.H.transformMat4(i,[0,0,0],r.w.viewInverse),0===r.H.length(this.position)?r.H.negate(u,i):(r.H.negate(u,this.position),r.H.normalize(this._direction,u)),r.I.transformMat4(n,[0,0,1,0],r.w.viewInverse),r.H.scaleAndAdd(a,i,n,-this.cameraFactor),r.H.negate(s,this._direction),r.z.arcFromForward(this._transform,s),r.z.setTranslation(this._transform,a),r.z.scale(o,o,[this.occlusionIntensity,this.occlusionIntensity,1]);const c=this._direction;r.E.SetVariableValue("LensflareFxDirectionScale",[c[0],c[1],c[2],1]),r.I.set(l,c[0],c[1],c[2],0),r.I.transformMat4(l,l,r.w.view),r.I.transformMat4(l,l,r.w.projection),l[0]/=l[3],l[1]/=l[3];const f=1-Math.min(1-Math.abs(l[0]),1-Math.abs(l[1])),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]),d=Math.atan2(l[1],l[0])+Math.PI;for(let e=0;e<this.distanceToEdgeCurves.length;++e)this.distanceToEdgeCurves[e].UpdateValue(f);for(let e=0;e<this.distanceToCenterCurves.length;++e)this.distanceToCenterCurves[e].UpdateValue(h);for(let e=0;e<this.radialAngleCurves.length;++e)this.radialAngleCurves[e].UpdateValue(d);for(let e=0;e<this.xDistanceToCenter.length;++e)this.xDistanceToCenter[e].UpdateValue(l[0]+10);for(let e=0;e<this.yDistanceToCenter.length;++e)this.yDistanceToCenter[e].UpdateValue(l[1]+10);for(let e=0;e<this.bindings.length;++e)this.bindings[e].CopyValue();for(let e=0;e<this.flares.length;++e)this.flares[e].UpdateViewDependentData(this._transform)}}])&&K(t.prototype,n),i&&K(t,i),e}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Q(Z,"global",null);let ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),J(this,"_id",r.F.generateID()),J(this,"name",""),J(this,"display",!0),J(this,"visible",{opaqueEffects:!0,decalEffects:!0,transparentEffects:!0,additiveEffects:!0,distortionEffects:!0}),J(this,"update",!0),J(this,"curveSet",null),J(this,"opaqueEffects",[]),J(this,"decalEffects",[]),J(this,"transparentEffects",[]),J(this,"additiveEffects",[]),J(this,"distortionEffects",[])}var t,n,i;return t=e,(n=[{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.F.perArrayChild(this.opaqueEffects,"GetResources",e),r.F.perArrayChild(this.decalEffects,"GetResources",e),r.F.perArrayChild(this.transparentEffects,"GetResources",e),r.F.perArrayChild(this.additiveEffects,"GetResources",e),r.F.perArrayChild(this.distortionEffects,"GetResources",e),e}},{key:"Update",value:function(e){this.update&&this.curveSet&&this.curveSet.Update(e)}},{key:"GetBatches",value:function(e,t,n,r){if(!this.display||!r||!r.IsGood())return;const i=this.GetEffects(e);for(let o=0;o<i.length;o++){const a=new s.Tw2GeometryBatch;a.renderMode=e,a.perObjectData=n,a.geometryRes=r.geometryResource,a.meshIx=r.meshIndex,a.start=0,a.count=r.geometryResource.meshes[r.meshIndex].areas.length,a.effect=i[o],t.Commit(a)}}},{key:"GetEffects",value:function(e){if(this.display)switch(e){case r.w.RM_OPAQUE:if(this.visible.opaqueEffects)return this.opaqueEffects;break;case r.w.RM_TRANSPARENT:if(this.visible.transparentEffects)return this.transparentEffects;break;case r.w.RM_ADDITIVE:if(this.visible.additiveEffects)return this.additiveEffects;break;case r.w.RM_DECAL:if(this.visible.decalEffects)return this.decalEffects;break;case r.w.RM_DISTORTION:if(this.visible.distortionEffects)return this.distortionEffects}return[]}}])&&$(t.prototype,n),i&&$(t,i),e}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ne(this,"_id",r.F.generateID()),ne(this,"name",""),ne(this,"display",!0),ne(this,"update",!0),ne(this,"curveSets",[]),ne(this,"source",null),ne(this,"dest",null),ne(this,"sourceObject",null),ne(this,"destObject",null),ne(this,"stretchObject",null),ne(this,"length",new s.Tw2Float),ne(this,"_time",0),ne(this,"_useTransformsForStretch",!1),ne(this,"_sourcePosition",r.H.create()),ne(this,"_destinationPosition",r.H.create()),ne(this,"_displaySourceObject",!0),ne(this,"_sourceTransform",null),ne(this,"_displayDestObject",!0),ne(this,"_isNegZForward",!1),e.init()}var t,n,i;return t=e,i=[{key:"init",value:function(){e.global||(e.global={vec3_0:r.H.create(),vec3_1:r.H.create(),vec3_2:r.H.create(),mat4_0:r.z.create(),mat4_1:r.z.create()})}}],(n=[{key:"SetSourcePosition",value:function(e){this._useTransformsForStretch=!1,this._sourcePosition=e}},{key:"SetDestinationPosition",value:function(e){this._destinationPosition=e}},{key:"SetSourceTransform",value:function(e){this._useTransformsForStretch=!0,this._sourceTransform=e}},{key:"SetIsNegZForward",value:function(e){this._isNegZForward=e}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.source&&this.source.GetResources&&this.source.GetResources(e),this.dest&&this.dest.GetResources&&this.dest.GetResources(e),this.sourceObject&&this.sourceObject.GetResources&&this.sourceObject.GetResources(e),this.destObject&&this.destObject.GetResources&&this.destObject.GetResources(e),this.stretchObject&&this.stretchObject.GetResources&&this.stretchObject.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){if(!this.display)return;const t=e.global,n=r.H.subtract(t.vec3_0,this._destinationPosition,this._sourcePosition),i=r.z.identity(t.mat4_0),o=r.H.set(t.vec3_1,0,0,0),a=r.H.set(t.vec3_2,0,0,0),s=r.z.identity(t.mat4_1);let u=r.H.length(n);r.H.normalize(n,n),this._useTransformsForStretch?(r.z.rotateX(i,i,-Math.PI/2),r.z.multiply(i,this._sourceTransform,i)):(Math.abs(n[1])>.9?a[2]=1:a[1]=1,r.H.cross(o,a,n),r.H.normalize(o,o),r.H.cross(a,n,o),i[0]=o[0],i[1]=o[1],i[2]=o[2],i[4]=-n[0],i[5]=-n[1],i[6]=-n[2],i[8]=a[0],i[9]=a[1],i[10]=a[2]),this.destObject&&this._displayDestObject&&(r.z.setTranslation(i,this._destinationPosition),this.destObject.UpdateViewDependentData(i)),this.sourceObject&&this._displaySourceObject&&(this._useTransformsForStretch?(r.z.identity(i),r.z.rotateX(i,i,-Math.PI/2),r.z.multiply(i,this._sourceTransform,i)):r.z.setTranslation(i,this._sourcePosition),this.sourceObject.UpdateViewDependentData(i)),this.stretchObject&&(this._useTransformsForStretch?(r.z.identity(i),r.z.scale(i,i,[1,1,u]),r.z.multiply(i,this._sourceTransform,i)):(i[0]=o[0],i[1]=o[1],i[2]=o[2],i[4]=a[0],i[5]=a[1],i[6]=a[2],i[8]=-n[0],i[9]=-n[1],i[10]=-n[2],this._isNegZForward&&(u=-u),r.z.scale(s,s,[1,1,u]),r.z.multiply(i,i,s)),this.stretchObject.UpdateViewDependentData(i))}},{key:"Update",value:function(t){for(let e=0;e<this.curveSets.length;++e)this.curveSets[e].Update(t);this._time+=t,this.source?this.source.GetValueAt(this._time,this._sourcePosition):this._useTransformsForStretch&&(this._sourcePosition[0]=this._sourceTransform[12],this._sourcePosition[1]=this._sourceTransform[13],this._sourcePosition[2]=this._sourceTransform[14]),this.dest&&this.source.GetValueAt(this._time,this._destinationPosition);const n=r.H.subtract(e.global.vec3_0,this._destinationPosition,this._sourcePosition);this.length.value=r.H.length(n),r.H.normalize(n,n),this.sourceObject&&this._displaySourceObject&&this.sourceObject.Update(t),this.stretchObject&&this.stretchObject.Update(t),this.destObject&&this._displayDestObject&&this.destObject.Update(t)}},{key:"GetBatches",value:function(e,t,n){this.display&&(this.sourceObject&&this._displaySourceObject&&this.sourceObject.GetBatches(e,t,n),this.destObject&&this._displayDestObject&&this.destObject.GetBatches(e,t,n),this.stretchObject&&this.stretchObject.GetBatches(e,t,n))}}])&&te(t.prototype,n),i&&te(t,i),e}();function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t,n){return t&&oe(e.prototype,t),n&&oe(e,n),e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ne(re,"global",null);let ue=function(){function e(){ie(this,e),se(this,"_id",r.F.generateID()),se(this,"started",!1),se(this,"readyToStart",!1),se(this,"muzzlePositionBone",null),se(this,"muzzleTransform",r.z.create()),se(this,"currentStartDelay",0),se(this,"constantDelay",0),se(this,"elapsedTime",0)}return ae(e,[{key:"muzzlePosition",get:function(){return this.muzzleTransform.subarray(12,15)}}]),e}(),le=function(){function e(){ie(this,e),se(this,"_id",r.F.generateID()),se(this,"name",""),se(this,"display",!0),se(this,"stretch",[]),se(this,"useMuzzleTransform",!1),se(this,"isFiring",!1),se(this,"isLoopFiring",!1),se(this,"firingDelay1",0),se(this,"firingDelay2",0),se(this,"firingDelay3",0),se(this,"firingDelay4",0),se(this,"firingDelay5",0),se(this,"firingDelay6",0),se(this,"firingDelay7",0),se(this,"firingDelay8",0),se(this,"endPosition",r.H.create()),se(this,"_firingDuration",0),se(this,"_perMuzzleData",[])}return ae(e,[{key:"Initialize",value:function(){this._firingDuration=this.GetCurveDuration();for(let e=0;e<this.stretch.length;++e)this._perMuzzleData[e]=new ue;const e=this._perMuzzleData;e.length>0&&(e[0].constantDelay=this.firingDelay1),e.length>1&&(e[1].constantDelay=this.firingDelay2),e.length>2&&(e[2].constantDelay=this.firingDelay3),e.length>3&&(e[3].constantDelay=this.firingDelay4),e.length>4&&(e[4].constantDelay=this.firingDelay5),e.length>5&&(e[5].constantDelay=this.firingDelay6),e.length>6&&(e[6].constantDelay=this.firingDelay7),e.length>7&&(e[7].constantDelay=this.firingDelay8)}},{key:"GetCurveDuration",value:function(){let e=0;for(let t=0;t<this.stretch.length;++t){const n=this.stretch[t];for(let t=0;t<n.curveSets.length;++t)e=Math.max(e,n.curveSets[t].GetMaxCurveDuration())}return e}},{key:"GetPerMuzzleEffectCount",value:function(){return this.stretch.length}},{key:"SetMuzzleBoneID",value:function(e,t){this._perMuzzleData[e].muzzlePositionBone=t}},{key:"GetMuzzleTransform",value:function(e){return this._perMuzzleData[e].muzzleTransform}},{key:"PrepareFiring",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;for(let n=0;n<this.stretch.length;++n)t<0||t===n?(this._perMuzzleData[n].currentStartDelay=e+this._perMuzzleData[n].constantDelay,this._perMuzzleData[n].started=!1,this._perMuzzleData[n].readyToStart=!1,this._perMuzzleData[n].elapsedTime=0):(this._perMuzzleData[n].currentStartDelay=Number.MAX_VALUE,this._perMuzzleData[n].started=!1,this._perMuzzleData[n].readyToStart=!1,this._perMuzzleData[n].elapsedTime=0);this.isFiring=!0}},{key:"StartMuzzleEffect",value:function(e){const t=this.stretch[e];for(let n=0;n<t.curveSets.length;++n){const r=t.curveSets[n];switch(r.name){case"play_start":case"play_loop":r.PlayFrom(-this._perMuzzleData[e].currentStartDelay);break;case"play_stop":r.Stop()}}this._perMuzzleData[e].started=!0,this._perMuzzleData[e].readyToStart=!1}},{key:"StopFiring",value:function(){for(let e=0;e<this.stretch.length;++e){const t=this.stretch[e];for(let e=0;e<t.curveSets.length;++e){const n=t.curveSets[e];switch(n.name){case"play_start":case"play_loop":n.Stop();break;case"play_stop":n.Play()}}this._perMuzzleData[e].started=!1,this._perMuzzleData[e].readyToStart=!1,this._perMuzzleData[e].currentStartDelay=0,this._perMuzzleData[e].elapsedTime=0}this.isFiring=!1}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.stretch.length;t++)this.stretch[t].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(){for(let e=0;e<this.stretch.length;++e)this.stretch[e].UpdateViewDependentData()}},{key:"Update",value:function(e){for(let t=0;t<this.stretch.length;++t)this._perMuzzleData[t].started&&(this._perMuzzleData[t].elapsedTime+=e),(this._perMuzzleData[t].elapsedTime<this._firingDuration||this.isLoopFiring)&&this.isFiring&&(this._perMuzzleData[t].started?(this.useMuzzleTransform?this.stretch[t].SetSourceTransform(this._perMuzzleData[t].muzzleTransform):this.stretch[t].SetSourcePosition(this._perMuzzleData[t].muzzlePosition),this.stretch[t].SetDestinationPosition(this.endPosition),this.stretch[t].SetIsNegZForward(!0)):(this._perMuzzleData[t].readyToStart?(this.StartMuzzleEffect(t),this._perMuzzleData[t].currentStartDelay=0,this._perMuzzleData[t].elapsedTime=0):this._perMuzzleData[t].currentStartDelay-=e,this._perMuzzleData[t].currentStartDelay<=0&&(this._perMuzzleData[t].readyToStart=!0))),this.stretch[t].Update(e)}},{key:"GetBatches",value:function(e,t,n){if(this.display&&this.isFiring)for(let r=0;r<this.stretch.length;++r)this._perMuzzleData[r].started&&(this._firingDuration>=this._perMuzzleData[r].elapsedTime||this.isLoopFiring)&&this.stretch[r].GetBatches(e,t,n)}}]),e}();function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let fe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce(this,"_id",r.F.generateID()),ce(this,"name",""),ce(this,"display",!0),ce(this,"effect",null),ce(this,"maxDist",0),ce(this,"maxFlashRate",0),ce(this,"minFlashIntensity",0),ce(this,"minFlashRate",0),ce(this,"seed",20)};function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ce(fe,"partialImplementation",!0);let pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),de(this,"_id",r.F.generateID()),de(this,"name",""),de(this,"display",!0)}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(){}},{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e){}},{key:"GetBatches",value:function(e,t){}}])&&he(t.prototype,n),i&&he(t,i),e}();function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}de(pe,"global",{vec3_0:r.H.create(),vec3_1:r.H.create(),vec3_2:r.H.create(),vec3_3:r.H.create(),vec3_4:r.H.create(),vec3_5:r.H.create(),vec3_6:r.H.create(),vec3_7:r.H.create(),mat4_0:r.z.create(),mat4_1:r.z.create(),mat4_2:r.z.create()});let _e=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n=this,e=!(i=ye(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?ve(n):i,ge(ve(ve(e)),"visible",{mesh:!0,children:!0,effectChildren:!0,planeSets:!0,spotlightSets:!0,decals:!0,spriteSets:!0,overlayEffects:!0,lineSets:!0,killmarks:!0,customMasks:!0,turretSets:!0,boosters:!0}),ge(ve(ve(e)),"mesh",null),ge(ve(ve(e)),"animation",new s.Tw2AnimationController),ge(ve(ve(e)),"locators",[]),ge(ve(ve(e)),"spriteSets",[]),ge(ve(ve(e)),"turretSets",[]),ge(ve(ve(e)),"decals",[]),ge(ve(ve(e)),"spotlightSets",[]),ge(ve(ve(e)),"planeSets",[]),ge(ve(ve(e)),"curveSets",[]),ge(ve(ve(e)),"lineSets",[]),ge(ve(ve(e)),"overlayEffects",[]),ge(ve(ve(e)),"children",[]),ge(ve(ve(e)),"effectChildren",[]),ge(ve(ve(e)),"customMasks",[]),ge(ve(ve(e)),"lod",3),ge(ve(ve(e)),"killCount",0),ge(ve(ve(e)),"transform",r.z.create()),ge(ve(ve(e)),"boundingSphereCenter",r.H.create()),ge(ve(ve(e)),"boundingSphereRadius",0),ge(ve(ve(e)),"shapeEllipsoidRadius",r.H.create()),ge(ve(ve(e)),"shapeEllipsoidCenter",r.H.create()),ge(ve(ve(e)),"_perObjectData",new s.Tw2PerObjectData(t.perObjectData)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(t,pe),n=t,(i=[{key:"Initialize",value:function(){if(this.mesh){this.animation.SetGeometryResource(this.mesh.geometryResource);for(let e=0;e<this.decals.length;++e)this.decals[e].SetParentGeometry(this.mesh.geometryResource)}}},{key:"ResetLod",value:function(){this.lod=3}},{key:"UpdateLod",value:function(e){const n=r.H.transformMat4(t.global.vec3_0,this.boundingSphereCenter,this.transform);e.IsSphereVisible(n,this.boundingSphereRadius)?e.GetPixelSizeAcross(n,this.boundingSphereRadius)<100?this.lod=1:this.lod=2:this.lod=0}},{key:"AddCustomMask",value:function(e,t,n,i,o,a){const s=r.z.fromRotationTranslationScale(r.z.create(),n,e,t);r.z.invert(s,s),r.z.transpose(s,s),this.customMasks.push({transform:s,maskData:r.I.fromValues(1,i?1:0,0,0),materialID:r.I.fromValues(o,0,0,0),targets:a})}},{key:"GetLocatorCount",value:function(e){return this.FindLocatorsByPrefix(e).length}},{key:"FindLocatorJointByName",value:function(e){const t=this.FindLocatorBoneByName(e);return t?t.worldTransform:null}},{key:"FindLocatorTransformByName",value:function(e){const t=this.FindLocatorByName(e);return t?t.transform:null}},{key:"HasLocatorPrefix",value:function(e){for(let t=0;t<this.locators.length;t++)if(this.locators[t].name.substring(0,e.length)===e)return!0;return!1}},{key:"FindLocatorBoneByName",value:function(e){const t=this.animation.FindModelForMesh(0);if(t)for(let n=0;n<t.bones.length;++n)if(t.bones[n].boneRes.name===e)return t.bones[n];return null}},{key:"FindLocatorByName",value:function(e){for(let t=0;t<this.locators.length;t++)if(this.locators[t].name===e)return this.locators[t];return null}},{key:"FindLocatorsByPrefix",value:function(e){const t=[];for(let n=0;n<this.locators.length;n++)0===this.locators[n].name.indexOf(e)&&t.push(this.locators[n]);return t}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return this.mesh&&this.mesh.GetResources(e),this.animation&&this.animation.GetResources(e),r.F.perArrayChild(this.spriteSets,"GetResources",e),r.F.perArrayChild(this.turretSets,"GetResources",e),r.F.perArrayChild(this.decals,"GetResources",e),r.F.perArrayChild(this.spotlightSets,"GetResources",e),r.F.perArrayChild(this.planeSets,"GetResources",e),r.F.perArrayChild(this.lineSets,"GetResources",e),r.F.perArrayChild(this.overlayEffects,"GetResources",e),r.F.perArrayChild(this.effectChildren,"GetResources",e),t||r.F.perArrayChild(this.children,"GetResources",e),e}},{key:"UpdateViewDependentData",value:function(){for(let e=0;e<this.children.length;++e)this.children[e].UpdateViewDependentData(this.transform);r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform);const e=this._perObjectData.perObjectVSData.Get("EllipsoidCenter"),t=this._perObjectData.perObjectVSData.Get("EllipsoidRadii");this.shapeEllipsoidRadius[0]>0?(e[0]=this.shapeEllipsoidCenter[0],e[1]=this.shapeEllipsoidCenter[1],e[2]=this.shapeEllipsoidCenter[2],t[0]=this.shapeEllipsoidRadius[0],t[1]=this.shapeEllipsoidRadius[1],t[2]=this.shapeEllipsoidRadius[2]):this.mesh&&this.mesh.IsGood()&&(r.H.subtract(e,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),r.H.scale(e,e,.8660254035),r.H.add(t,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),r.H.scale(t,t,.5));for(let e=0;e<this.customMasks.length;++e){const t=this.visible.customMasks?this.customMasks[e].targets:[0,0,0,0];this._perObjectData.perObjectVSData.Set(e?"CustomMaskMatrix1":"CustomMaskMatrix0",this.customMasks[e].transform),this._perObjectData.perObjectVSData.Set(e?"CustomMaskData1":"CustomMaskData0",this.customMasks[e].maskData),this._perObjectData.perObjectPSData.Set(e?"CustomMaskMaterialID1":"CustomMaskMaterialID0",this.customMasks[e].materialID),this._perObjectData.perObjectPSData.Set(e?"CustomMaskTarget1":"CustomMaskTarget0",t)}this.animation.animations.length&&this._perObjectData.perObjectVSData.Set("JointMat",this.animation.GetBoneMatrices(0));for(let e=0;e<this.lineSets.length;++e)this.lineSets[e].UpdateViewDependentData(this.transform)}},{key:"Update",value:function(e){if(this.lod>0){for(let t=0;t<this.spriteSets.length;++t)this.spriteSets[t].Update(e);for(let t=0;t<this.planeSets.length;t++)this.planeSets[t].Update(e);for(let t=0;t<this.spotlightSets.length;t++)this.spotlightSets[t].Update(e);for(let t=0;t<this.children.length;++t)this.children[t].Update(e);for(let t=0;t<this.effectChildren.length;++t)this.effectChildren[t].Update(e,this.transform);for(let t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e);for(let t=0;t<this.overlayEffects.length;++t)this.overlayEffects[t].Update(e);for(let t=0;t<this.lineSets.length;t++)this.lineSets[t].Update(e);this.animation.Update(e)}}},{key:"GetBatches",value:function(e,t){if(this.display){const n=this.visible;if(n.mesh&&this.mesh&&this.lod>0&&this.mesh.GetBatches(e,t,this._perObjectData),this.lod>1){if(n.spriteSets)for(let n=0;n<this.spriteSets.length;n++)this.spriteSets[n].GetBatches(e,t,this._perObjectData,this.transform);if(n.spotlightSets)for(let n=0;n<this.spotlightSets.length;n++)this.spotlightSets[n].GetBatches(e,t,this._perObjectData);if(n.planeSets)for(let n=0;n<this.planeSets.length;n++)this.planeSets[n].GetBatches(e,t,this._perObjectData);if(n.decals)for(let r=0;r<this.decals.length;r++)this.decals[r].GetBatches(e,t,this._perObjectData,n.killmarks?this.killCount:0);if(n.lineSets)for(let n=0;n<this.lineSets.length;n++)this.lineSets[n].GetBatches(e,t)}if(n.children)for(let n=0;n<this.children.length;n++)this.children[n].GetBatches(e,t,this._perObjectData);if(n.effectChildren)for(let n=0;n<this.effectChildren.length;n++)this.effectChildren[n].GetBatches(e,t,this._perObjectData);if(n.overlayEffects&&this.mesh&&this.mesh.IsGood())for(let n=0;n<this.overlayEffects.length;n++)this.overlayEffects[n].GetBatches(e,t,this._perObjectData,this.mesh)}}},{key:"RenderDebugInfo",value:function(e){this.animation.RenderDebugInfo(e)}}])&&me(n.prototype,i),o&&me(n,o),t}();function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ge(_e,"perObjectData",{VSData:[["WorldMat",16],["WorldMatLast",16],["Shipdata",4,[0,1,0,-10]],["Clipdata1",4],["EllipsoidRadii",4],["EllipsoidCenter",4],["CustomMaskMatrix0",16,r.z.identity([])],["CustomMaskMatrix1",16,r.z.identity([])],["CustomMaskData0",4],["CustomMaskData1",4],["JointMat",696]],PSData:[["Shipdata",4,[0,1,0,1]],["Clipdata1",4],["Clipdata2",4],["ShLighting",28],["CustomMaskMaterialID0",4],["CustomMaskMaterialID1",4],["CustomMaskTarget0",4],["CustomMaskTarget1",4]]});let Oe=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n=this,e=!(i=Ee(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Re(n):i,Se(Re(Re(e)),"curveSets",[]),Se(Re(Re(e)),"effectChildren",[]),Se(Re(Re(e)),"duration",0),Se(Re(Re(e)),"scaling",r.H.fromValues(1,1,1)),Se(Re(Re(e)),"rotation",r.C.create()),Se(Re(Re(e)),"translation",r.H.create()),Se(Re(Re(e)),"localTransform",r.z.create()),Se(Re(Re(e)),"rotationTransform",r.z.create()),Se(Re(Re(e)),"boundingSphereCenter",r.H.create()),Se(Re(Re(e)),"boundingSphereRadius",0),Se(Re(Re(e)),"_perObjectData",new s.Tw2PerObjectData(_e.perObjectData)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(t,pe),n=t,(i=[{key:"Start",value:function(){for(let e=0;e<this.curveSets.length;++e)this.curveSets[e].Play()}},{key:"Stop",value:function(){for(let e=0;e<this.curveSets.length;++e)this.curveSets[e].Stop()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.effectChildren.length;++t)this.effectChildren[t].GetResources(e);return e}},{key:"Update",value:function(e){r.C.normalize(this.rotation,this.rotation),r.z.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling);for(let t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e);for(let t=0;t<this.effectChildren.length;++t)this.effectChildren[t].Update(e,this.localTransform)}},{key:"GetBatches",value:function(e,t){if(this.display)for(let n=0;n<this.effectChildren.length;++n)this.effectChildren[n].GetBatches(e,t,this._perObjectData)}}])&&we(n.prototype,i),o&&we(n,o),t}();function Pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ie(e,t,n){return t&&Ae(e.prototype,t),n&&Ae(e,n),e}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let xe=function(e){function t(){var e,n,i;Pe(this,t);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n=this,e=!(i=Ce(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?De(n):i,ke(De(De(e)),"mesh",null),ke(De(De(e)),"spriteSet",null),ke(De(De(e)),"state",t.State.READY),ke(De(De(e)),"time",0),ke(De(De(e)),"durationEjectPhase",0),ke(De(De(e)),"startEjectVelocity",0),ke(De(De(e)),"acceleration",1),ke(De(De(e)),"maxExplosionDistance",40),ke(De(De(e)),"impactSize",0),ke(De(De(e)),"impactDuration",.6),ke(De(De(e)),"pathOffset",r.H.create()),ke(De(De(e)),"transform",r.z.create()),ke(De(De(e)),"velocity",r.H.create()),ke(De(De(e)),"_perObjectData",new s.Tw2PerObjectData(t.perObjectData)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,pe),Ie(t,[{key:"Initialize",value:function(){this.spriteSet&&this.spriteSet.UseQuads(!0)}},{key:"Launch",value:function(e){r.z.copy(this.transform,e),this.velocity[0]=e[8]*this.startEjectVelocity,this.velocity[1]=e[9]*this.startEjectVelocity,this.velocity[2]=e[10]*this.startEjectVelocity,this.time=0,this.state=t.State.IN_FLIGHT}},{key:"Clone",value:function(){const e=new t;return e.mesh=this.mesh,e.spriteSet=this.spriteSet,e}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e),this.spriteSet&&this.spriteSet.GetResources(e)}},{key:"UpdateViewDependentData",value:function(){this.display&&this.state!==t.State.DEAD&&(r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform))}},{key:"Update",value:function(e,n,i){if(this.state===t.State.IN_FLIGHT){const o=t.global,a=r.z.getTranslation(o.vec3_0,this.transform),s=o.vec3_1,u=o.vec3_2,l=o.vec3_3;this.time+=e,this.time>this.durationEjectPhase?(r.H.subtract(a,this.velocity,n),r.H.lerp(a,a,n,1-Math.exp(.9999*-e)),r.z.setTranslation(this.transform,a),r.H.subtract(s,i,a),r.H.length(s)<this.maxExplosionDistance&&(console.log(a,s),this.state=t.State.DEAD)):(r.H.scale(s,this.velocity,e),this.transform[12]+=s[0],this.transform[13]+=s[1],this.transform[14]+=s[2]);const c=r.H.normalize(s,this.velocity);Math.abs(c[0])<.99?r.H.cross(u,c,[1,0,0]):r.H.cross(u,c,[0,1,0]),r.H.normalize(u,u),r.H.cross(l,u,c),this.transform[0]=u[0],this.transform[1]=u[1],this.transform[2]=u[2],this.transform[4]=l[0],this.transform[5]=l[1],this.transform[6]=l[2],this.transform[8]=c[0],this.transform[9]=c[1],this.transform[10]=c[2]}this.spriteSet&&this.spriteSet.Update(e)}},{key:"GetBatches",value:function(e,n){this.display&&this.mesh&&this.state!==t.State.DEAD&&(this.mesh&&this.mesh.GetBatches(e,n,this._perObjectData),this.spriteSet&&this.spriteSet.GetBatches(e,n,this._perObjectData,this.transform))}}]),t}();ke(xe,"perObjectData",{VSData:[["WorldMat",16],["WorldMatLast",16],["Shipdata",4,[0,1,0,-10]],["Clipdata1",4],["JointMat",696]],PSData:[["Shipdata",4,[0,1,0,1]],["Clipdata1",4],["Clipdata2",4]]}),ke(xe,"State",{READY:0,IN_FLIGHT:1,DEAD:2});let Ge=function(){function e(){Pe(this,e),ke(this,"_id",r.F.generateID()),ke(this,"name",""),ke(this,"display",!0),ke(this,"warheads",[]),ke(this,"curveSets",[]),ke(this,"speed",1),ke(this,"position",r.H.create()),ke(this,"target",r.H.create()),ke(this,"boundingSphereCenter",r.H.create()),ke(this,"boundingSphereRadius",0),ke(this,"warheadExplosionCallback",null),ke(this,"missileFinishedCallback",null)}return Ie(e,[{key:"Launch",value:function(e,t,n){if(r.H.copy(this.position,e),r.H.copy(this.target,n),this.warheads.length>t.length)this.warheads.splice(t.length);else for(;this.warheads.length<t.length;)this.warheads.push(this.warheads[0].Clone());for(let e=0;e<this.warheads.length;++e)this.warheads[0].Launch(t[e])}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<this.warheads.length;++t)this.warheads[t].GetResources(e)}},{key:"UpdateViewDependentData",value:function(){for(let e=0;e<this.warheads.length;++e)this.warheads[e].UpdateViewDependentData()}},{key:"Update",value:function(e){const t=r.H.subtract(xe.global.vec3_0,this.target,this.position),n=r.H.length(t);n>.1&&(r.H.normalize(t,t),r.H.scale(t,t,Math.min(e*this.speed,n)),r.H.add(this.position,this.position,t));for(let t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e);let i=!1;for(let t=0;t<this.warheads.length;++t){const n=this.warheads[t].state;this.warheads[t].Update(e,this.position,this.target),n!==xe.State.DEAD&&this.warheads[t].state===xe.State.DEAD&&(this.warheadExplosionCallback&&this.warheadExplosionCallback(this.warheads[t]),i=!0)}if(i&&this.missileFinishedCallback){for(let e=0;e<this.warheads.length;++e)if(this.warheads[e].state!==xe.State.DEAD)return;this.missileFinishedCallback(this)}}},{key:"GetBatches",value:function(e,t){if(this.display)for(let n=0;n<this.warheads.length;++n)this.warheads[n].GetBatches(e,t)}}]),e}();function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Ne=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n=this,e=!(i=Fe(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?Be(n):i,Ue(Be(Be(e)),"visible",{mesh:!0,children:!0}),Ue(Be(Be(e)),"mesh",null),Ue(Be(Be(e)),"curveSets",[]),Ue(Be(Be(e)),"children",[]),Ue(Be(Be(e)),"particleSystems",[]),Ue(Be(Be(e)),"particleEmitters",[]),Ue(Be(Be(e)),"modifier",t.Modifier.NONE),Ue(Be(Be(e)),"sortValueMultiplier",1),Ue(Be(Be(e)),"distanceBasedScaleArg1",.2),Ue(Be(Be(e)),"distanceBasedScaleArg2",.63),Ue(Be(Be(e)),"useDistanceBasedScale",!1),Ue(Be(Be(e)),"scaling",r.H.fromValues(1,1,1)),Ue(Be(Be(e)),"translation",r.H.create()),Ue(Be(Be(e)),"rotation",r.C.create()),Ue(Be(Be(e)),"localTransform",r.z.create()),Ue(Be(Be(e)),"worldTransform",r.z.create()),Ue(Be(Be(e)),"_perObjectData",new s.Tw2BasicPerObjectData(t.perObjectData)),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(t,pe),n=t,o=[{key:"Multiply3x3",value:function(e,t,n){n||(n=t);let r=t[0],i=t[1];return t=t[2],n[0]=e[0]*r+e[4]*i+e[8]*t,n[1]=e[1]*r+e[5]*i+e[9]*t,n[2]=e[2]*r+e[6]*i+e[10]*t,n}}],(i=[{key:"Initialize",value:function(){r.z.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(this.mesh&&this.mesh.GetResources(e),!t)for(let t=0;t<this.children;t++)this.children[t].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(e){const n=r.w,i=t.global,o=i.vec3_0,a=i.vec3_1,s=i.vec3_2,u=n.viewInverse;switch(r.C.normalize(this.rotation,this.rotation),r.z.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling),r.z.getScaling(a,e),this.modifier){case t.Modifier.BILLBOARD:case t.Modifier.SIMPLE_HALO:const l=i.vec3_3;if(r.z.multiply(this.worldTransform,e,this.localTransform),r.H.multiply(o,this.scaling,a),this.modifier===t.Modifier.SIMPLE_HALO){r.H.subtract(s,n.GetEyePosition(s),this.worldTransform.subarray(12)),r.H.normalize(l,this.worldTransform.subarray(8)),r.H.normalize(s,s);let e=r.H.dot(s,l);e<0&&(e=0),r.H.scale(o,o,e*e)}this.worldTransform[0]=u[0]*o[0],this.worldTransform[1]=u[1]*o[0],this.worldTransform[2]=u[2]*o[0],this.worldTransform[4]=u[4]*o[1],this.worldTransform[5]=u[5]*o[1],this.worldTransform[6]=u[6]*o[1],this.worldTransform[8]=u[8]*o[2],this.worldTransform[9]=u[9]*o[2],this.worldTransform[10]=u[10]*o[2];break;case t.Modifier.EVE_CAMERA_ROTATION:const c=i.vec3_3;r.H.transformMat4(c,this.translation,e),r.z.fromRotationTranslationScale(this.localTransform,this.rotation,c,this.scaling),r.z.multiply(this.worldTransform,u,this.localTransform),this.worldTransform[12]=this.localTransform[12],this.worldTransform[13]=this.localTransform[13],this.worldTransform[14]=this.localTransform[14];break;case t.Modifier.EVE_CAMERA_ROTATION_ALIGNED:case t.Modifier.EVE_SIMPLE_HALO:const f=i.vec3_3,h=i.vec3_4,d=i.vec3_5,p=i.vec3_6,m=i.vec3_7,y=i.mat4_0,b=i.mat4_1,v=i.mat4_2;if(r.z.translate(this.worldTransform,e,this.translation),r.z.transpose(y,e),n.GetEyePosition(s),s[0]-=this.worldTransform[12],s[1]-=this.worldTransform[13],s[2]-=this.worldTransform[14],r.H.copy(f,s),r.H.transformMat4(f,f,y),r.H.divide(f,f,a),r.H.normalize(f,f),r.H.set(h,n.view[0],n.view[4],n.view[8]),r.H.transformMat4(h,h,y),r.H.normalize(h,h),r.H.cross(d,f,h),r.H.normalize(d,d),r.H.cross(h,d,f),b[0]=h[0],b[1]=h[1],b[2]=h[2],b[4]=d[0],b[5]=d[1],b[6]=d[2],b[8]=f[0],b[9]=f[1],b[10]=f[2],b[15]=1,r.z.fromQuat(v,this.rotation),r.z.multiply(b,b,v),this.modifier===t.Modifier.EVE_SIMPLE_HALO){r.H.normalize(p,this.worldTransform.subarray(8)),r.H.normalize(m,s);let e=-r.H.dot(m,p);e<0&&(e=0),r.z.multiply(this.worldTransform,this.worldTransform,b),r.z.scale(this.worldTransform,this.worldTransform,[this.scaling[0]*e,this.scaling[1]*e,this.scaling[2]*e])}else r.z.scale(this.worldTransform,this.worldTransform,this.scaling),r.z.multiply(this.worldTransform,this.worldTransform,b);break;case t.Modifier.LOOK_AT_CAMERA:const g=i.mat4_0;r.z.multiply(this.worldTransform,e,this.localTransform),r.z.lookAt(g,u.subarray(12),this.worldTransform.subarray(12),[0,1,0]),r.z.transpose(g,g),r.H.multiply(o,this.scaling,a),this.worldTransform[0]=g[0]*o[0],this.worldTransform[1]=g[1]*o[0],this.worldTransform[2]=g[2]*o[0],this.worldTransform[4]=g[4]*o[1],this.worldTransform[5]=g[5]*o[1],this.worldTransform[6]=g[6]*o[1],this.worldTransform[8]=g[8]*o[2],this.worldTransform[9]=g[9]*o[2],this.worldTransform[10]=g[10]*o[2];break;default:r.z.multiply(this.worldTransform,e,this.localTransform)}for(let e=0;e<this.children.length;++e)this.children[e].UpdateViewDependentData(this.worldTransform)}},{key:"Update",value:function(e){for(let t=0;t<this.children.length;++t)this.children[t].Update(e);for(let t=0;t<this.particleEmitters.length;++t)this.particleEmitters[t].Update(e);for(let t=0;t<this.particleSystems.length;++t)this.particleSystems[t].Update(e);for(let t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e)}},{key:"GetBatches",value:function(e,t,n){if(this.display&&(this.visible.mesh&&this.mesh&&(r.z.transpose(this._perObjectData.perObjectFFEData.Get("World"),this.worldTransform),r.z.invert(this._perObjectData.perObjectFFEData.Get("WorldInverseTranspose"),this.worldTransform),n&&(this._perObjectData.perObjectVSData=n.perObjectVSData,this._perObjectData.perObjectPSData=n.perObjectPSData),this.mesh.GetBatches(e,t,this._perObjectData)),this.visible.children))for(let r=0;r<this.children.length;++r)this.children[r].GetBatches(e,t,n)}}])&&je(n.prototype,i),o&&je(n,o),t}();function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ue(Ne,"perObjectData",{FFEData:[["World",16],["WorldInverseTranspose",16]]}),Ue(Ne,"Modifier",{NONE:0,BILLBOARD:1,TRANSLATE_WITH_CAMERA:2,LOOK_AT_CAMERA:3,SIMPLE_HALO:4,EVE_CAMERA_ROTATION_ALIGNED:100,EVE_BOOSTER:101,EVE_SIMPLE_HALO:102,EVE_CAMERA_ROTATION:103});let Ye=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=He(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?qe(n):r,Xe(qe(qe(e)),"highDetail",new Ne),Xe(qe(qe(e)),"effectHeight",new s.Tw2Effect),Xe(qe(qe(e)),"heightMap",new s.Tw2RenderTarget),Xe(qe(qe(e)),"zOnlyModel",null),Xe(qe(qe(e)),"itemID",0),Xe(qe(qe(e)),"heightMapResPath1",""),Xe(qe(qe(e)),"heightMapResPath2",""),Xe(qe(qe(e)),"heightDirty",!1),Xe(qe(qe(e)),"lockedResources",[]),Xe(qe(qe(e)),"watchedResources",[]),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(t,pe),n=t,o=[{key:"MeshLoaded",value:function(e,t){e.highDetail.children.unshift(t),e.lockedResources=[],e.GetPlanetResources(e.highDetail,[],e.lockedResources);let n,r=e.highDetail.children[0].mesh,i=null;n=(n=r.transparentAreas.length?(i=r.transparentAreas[0].effect).effectFilePath:r.opaqueAreas.length?(i=r.opaqueAreas[0].effect).effectFilePath:"res:/Graphics/Effect/Managed/Space/Planet/EarthlikePlanet.fx").replace(".fx","BlitHeight.fx"),e.watchedResources=[];for(let t in i.parameters)i.parameters.hasOwnProperty(t)&&(e.effectHeight.parameters[t]=i.parameters[t],"textureRes"in i.parameters[t]&&e.watchedResources.push(i.parameters[t].textureRes));for(let t=0;t<e.highDetail.children[0].children.length;++t)if(r=e.highDetail.children[0].children[t].mesh){if(i=null,r.transparentAreas.length)i=r.transparentAreas[0].effect;else{if(!r.opaqueAreas.length)continue;i=r.opaqueAreas[0].effect}for(let t in i.parameters)i.parameters.hasOwnProperty(t)&&(e.effectHeight.parameters[t]=i.parameters[t],"textureRes"in i.parameters[t]&&e.watchedResources.push(i.parameters[t].textureRes))}const o=new s.Tw2TextureParameter("NormalHeight1",e.heightMapResPath1);o.Initialize(),e.watchedResources.push(o.textureRes),e.lockedResources.push(o.textureRes),e.effectHeight.parameters.NormalHeight1=o;const a=new s.Tw2TextureParameter("NormalHeight2",e.heightMapResPath2);a.Initialize(),e.watchedResources.push(a.textureRes),e.lockedResources.push(a.textureRes),e.effectHeight.parameters.NormalHeight2=a,e.effectHeight.parameters.Random=new s.Tw2FloatParameter("Random",e.itemID%100),e.effectHeight.parameters.TargetTextureHeight=new s.Tw2FloatParameter("TargetTextureHeight",1024),e.effectHeight.effectFilePath=n,e.effectHeight.Initialize(),e.heightDirty=!0,e.heightMap.Create(2048,1024,!1),e.watchedResources.push(e.effectHeight.effectRes);for(let t=0;t<e.lockedResources.length;++t)e.lockedResources[t].doNotPurge++,e.lockedResources[t].IsPurged()&&e.lockedResources[t].Reload()}}],(i=[{key:"Create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;const i=e.itemID,o=void 0===i?0:i,a=e.planetPath,s=e.atmospherePath,u=e.heightMap1,l=e.heightMap2;this.itemID=o,this.heightMapResPath1=u,this.heightMapResPath2=l,this.highDetail.children=[],this.heightDirty=!0;let c=1;function f(){--c<1&&n&&n()}a&&c++,s&&c++,a&&r.D.GetObject(a,e=>{t.MeshLoaded(this,e),f()}),s&&r.D.GetObject(s,e=>{this.highDetail.children.push(e),f()}),r.D.GetObject("res:/dx9/model/worldobject/planet/planetzonly.red",e=>{this.zOnlyModel=e,f()})}},{key:"GetPlanetResources",value:function(e,t,n){if(!t.includes(e))if(t.push(e),!e||r.F.isUndefined(e.doNotPurge))for(let i in e)e.hasOwnProperty(i)&&r.F.isObjectLike(e[i])&&this.GetPlanetResources(e[i],t,n);else n.push(e)}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.highDetail&&this.highDetail.GetResources(e),this.effectHeight&&this.effectHeight.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(e){this.highDetail.UpdateViewDependentData(e),this.zOnlyModel&&(this.zOnlyModel.translation=this.highDetail.translation,this.zOnlyModel.scaling=this.highDetail.scaling,this.zOnlyModel.UpdateViewDependentData(e))}},{key:"Update",value:function(e){this.highDetail.Update(e)}},{key:"GetBatches",value:function(e,t){if(this.display&&this.heightDirty&&this.watchedResources.length&&""!==this.heightMapResPath1){for(let e=0;e<this.watchedResources.length;++e)if(this.watchedResources[e]&&!this.watchedResources[e].IsGood())return;this.watchedResources=[],this.heightMap.Set(),r.w.SetStandardStates(r.w.RM_FULLSCREEN),r.w.gl.clearColor(0,0,0,0),r.w.gl.clear(r.w.gl.COLOR_BUFFER_BIT),r.w.RenderFullScreenQuad(this.effectHeight),this.heightMap.Unset(),this.heightDirty=!1;for(let e=0;e<this.lockedResources.length;++e)this.lockedResources[e].doNotPurge--;const e=this.highDetail.children[0].mesh;let t=null;e.transparentAreas.length?t=e.transparentAreas[0].effect:e.opaqueAreas.length&&(t=e.opaqueAreas[0].effect),t&&(t.parameters.HeightMap.textureRes=this.heightMap.texture)}this.display&&this.highDetail.GetBatches(e,t)}},{key:"GetZOnlyBatches",value:function(e,t){this.display&&this.zOnlyModel&&this.zOnlyModel.GetBatches(e,t)}}])&&Ve(n.prototype,i),o&&Ve(n,o),t}();function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ke(e,t,n){return(Ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qe(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let et=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=Qe(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?$e(n):r,Je($e($e(e)),"boosters",null),Je($e($e(e)),"turretSets",[]),Je($e($e(e)),"boosterGain",1),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(t,_e),n=t,(r=[{key:"Initialize",value:function(){Ke(Qe(t.prototype),"Initialize",this).call(this),this.boosters&&this.RebuildBoosterSet()}},{key:"RebuildBoosterSet",value:function(){this.boosters&&this.boosters.UpdateItemsFromLocators(this.FindLocatorsByPrefix("locator_booster"))}},{key:"RebuildTurretPositions",value:function(){for(let e=0;e<this.turretSets.length;e++)this.RebuildTurretSet(e)}},{key:"RebuildTurretSet",value:function(e){if(void 0===this.turretSets[e])return;const t=this.turretSets[e],n=t.locatorName,r=this.GetLocatorCount(n),i=[];for(let e=0;e<r;++e){const t=n+String.fromCharCode("a".charCodeAt(0)+e),r=this.FindLocatorByName(t);r&&(r.FindBone(this.animation),i.push(r))}t.UpdateItemsFromLocators(i)}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;Ke(Qe(t.prototype),"GetResources",this).call(this,e,n);for(let t=0;t<this.turretSets.length;t++)this.turretSets[t].GetResources(e);return this.boosters&&this.boosters.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){Ke(Qe(t.prototype),"UpdateViewDependentData",this).call(this);for(let e=0;e<this.turretSets.length;++e)this.turretSets[e].UpdateViewDependentData()}},{key:"Update",value:function(e){Ke(Qe(t.prototype),"Update",this).call(this,e),this.boosters&&(this.boosters._locatorRebuildPending&&this.RebuildBoosterSet(),this.boosters.Update(e,this.transform));for(let t=0;t<this.turretSets.length;++t)this.turretSets[t]._locatorRebuildPending&&this.RebuildTurretSet(t),this.turretSets[t].Update(e,this.transform)}},{key:"GetBatches",value:function(e,n){if(this.display&&(Ke(Qe(t.prototype),"GetBatches",this).call(this,e,n),this._perObjectData.perObjectVSData.Get("Shipdata")[0]=this.boosterGain,this._perObjectData.perObjectPSData.Get("Shipdata")[0]=this.boosterGain,this.boosters&&this.visible.boosters&&this.boosters.GetBatches(e,n,this._perObjectData),this.visible.turretSets))if(this.lod>1)for(let t=0;t<this.turretSets.length;++t)this.turretSets[t].GetBatches(e,n,this._perObjectData,this.visible.firingEffects);else if(this.visible.firingEffects)for(let t=0;t<this.turretSets.length;++t)this.turretSets[t].firingEffect&&this.turretSets[t].firingEffect.GetBatches(e,n,this._perObjectData)}}])&&We(n.prototype,r),i&&We(n,i),t}();function tt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t,n){return t&&nt(e.prototype,t),n&&nt(e,n),e}function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ot=function(){function e(){tt(this,e),it(this,"_id",r.F.generateID()),it(this,"name",""),it(this,"display",!0),it(this,"_rebuildPending",!0),it(this,"_onModified",null)}return rt(e,[{key:"OnValueChanged",value:function(){this._rebuildPending=!0,this._onModified&&this._onModified(this)}}]),e}(),at=function(){function e(){tt(this,e),it(this,"_id",r.F.generateID()),it(this,"name",""),it(this,"display",!0),it(this,"items",[]),it(this,"_visibleItems",[]),it(this,"_rebuildPending",!1),it(this,"_onChildModified",e=>this.OnValueChanged(e))}return rt(e,[{key:"Initialize",value:function(){this.Rebuild()}},{key:"OnValueChanged",value:function(){this._rebuildPending=!0}},{key:"CreateItem",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.constructor.Item;if(t&&"create"in t){const n=t.create(e);return this.AddItem(n),n}return null}},{key:"AddItem",value:function(e){this.items.includes(e)||(e._onModified=this._onChildModified,this.items.push(e),this.OnValueChanged())}},{key:"RemoveItem",value:function(e){const t=this.items.indexOf(e);-1!==t&&(e._onModified=null,this.items.splice(t,1),this.OnValueChanged())}},{key:"ClearItems",value:function(){for(let e=0;e<this.items.length;e++)this.items[e]._onModified=null;this.items=[],this.OnValueChanged()}},{key:"FindItemByID",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e)for(let t=0;t<this.items.length;t++)if(this.items[t]._id===e)return this.items[t];return null}},{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this),this._rebuildPending=!1}},{key:"GetBatches",value:function(e,t,n){}},{key:"Render",value:function(){}}],[{key:"RebuildItems",value:function(e){e._visibleItems=[];for(let t=0;t<e.items.length;t++){const n=e.items[t];n._onModified=e._onChildModified,n._rebuildPending=!1,n.display&&e._visibleItems.push(n)}}}]),e}();function st(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lt(e,t,n){return t&&ut(e.prototype,t),n&&ut(e,n),e}function ct(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?pt(e):t}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ht(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}it(at,"Item",null),it(at,"global",{vec3_0:r.H.create(),vec3_1:r.H.create(),vec3_2:r.H.create(),vec4_0:r.I.create(),vec4_1:r.I.create(),mat4_0:r.z.create()});let yt=function(e){function t(){var e;st(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return mt(pt(pt(e=ct(this,ft(t).call(this,...r)))),"boosters",null),e}return ht(t,s["Tw2RenderBatch"]),lt(t,[{key:"Commit",value:function(e){this.boosters.Render(e)}}]),t}(),bt=function(e){function t(){var e;st(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return mt(pt(pt(e=ct(this,ft(t).call(this,...i)))),"visible",{glow:!0,symHalo:!0,halo:!0,trail:!0,customValues:!0}),mt(pt(pt(e)),"locatorName",null),mt(pt(pt(e)),"updateFromLocator",!1),mt(pt(pt(e)),"seed",7*Math.random()),mt(pt(pt(e)),"wavePhase",Math.random()),mt(pt(pt(e)),"atlas0",0),mt(pt(pt(e)),"atlas1",0),mt(pt(pt(e)),"transform",r.z.create()),mt(pt(pt(e)),"customValues",null),e}return ht(t,ot),lt(t,[{key:"GetPosition",value:function(e){return r.z.getTranslation(e,this.transform)}},{key:"GetDirection",value:function(e){r.H.set(e,this.transform[8],this.transform[9],this.transform[10]),r.H.normalize(e,e);const t=this.GetScale();return t<3&&r.H.scale(e,e,t/3),e}},{key:"GetScale",value:function(){const e=this.transform;return Math.max(r.H.length([e[0],e[1],e[2]]),r.H.length([e[4],e[5],e[6]]))}}],[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t.visible,e.visible,["glow","symHalo","halo","trail"]),r.F.assignIfExists(t,e,["name","display","seed","wavePhase","transform","locatorName","updateFromLocator","atlas0","atlas1"]),t}}]),t}(),vt=function(e){function t(){var e;st(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return mt(pt(pt(e=ct(this,ft(t).call(this,...i)))),"visible",{glows:!0,symHalos:!0,halos:!0,trails:!0}),mt(pt(pt(e)),"effect",null),mt(pt(pt(e)),"glows",null),mt(pt(pt(e)),"alwaysOn",!0),mt(pt(pt(e)),"maxVel",250),mt(pt(pt(e)),"glowDistance",2.5),mt(pt(pt(e)),"glowScale",1),mt(pt(pt(e)),"glowColor",r.I.create()),mt(pt(pt(e)),"warpGlowColor",r.I.create()),mt(pt(pt(e)),"haloDistance",3.01),mt(pt(pt(e)),"haloScaleX",1),mt(pt(pt(e)),"haloScaleY",1),mt(pt(pt(e)),"haloColor",r.I.create()),mt(pt(pt(e)),"warpHaloColor",r.I.create()),mt(pt(pt(e)),"symHaloDistance",3),mt(pt(pt(e)),"symHaloScale",1),mt(pt(pt(e)),"trailColor",r.I.create()),mt(pt(pt(e)),"trailSize",r.I.create()),mt(pt(pt(e)),"_parentTransform",r.z.create()),mt(pt(pt(e)),"_positions",null),mt(pt(pt(e)),"_decl",new s.Tw2VertexDeclaration(t.vertexDeclarations)),mt(pt(pt(e)),"_perObjectData",new s.Tw2PerObjectData(t.perObjectData)),mt(pt(pt(e)),"_locatorRebuildPending",!0),e}return ht(t,at),lt(t,[{key:"FindItemByLocatorName",value:function(e){for(let t=0;t<this.items.length;t++)if(this.items[t].locatorName&&this.items[t].locatorName===e)return this.items[t];return null}},{key:"UpdateItemsFromLocators",value:function(e){const t=Array.from(this.items);for(let n=0;n<e.length;n++){const i=e[n],o=i.name,a=i.transform,s=i.atlasIndex0,u=i.atlasIndex1;let l=this.FindItemByLocatorName(o);l?(t.splice(t.indexOf(l),1),l.updateFromLocator&&(r.z.copy(l.transform,a),l.atlas0=s,l.atlas1=u,l.OnValueChanged())):this.CreateItem({name:o,locatorName:o,updateFromLocator:!0,atlas0:s,atlas1:u,transform:a})}for(let e=0;e<t.length;e++)null!==t[e].locatorName&&(this.RemoveItem(t[e]),e--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),this.glows&&this.glows.effect.GetResources(e),e}},{key:"Update",value:function(e,t){r.z.copy(this._parentTransform,t),this._rebuildPending&&this.Rebuild(),this.glows&&this.glows.Update(e)}},{key:"Unload",value:function(){this._positions&&(r.w.gl.deleteBuffer(this._positions),this._positions=null),this.glows&&this.glows.Unload()}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this);const e=this._visibleItems.length;if(this._rebuildPending=!1,!e)return;const n=r.w,i=t._box,o=new Float32Array(e*i.length*6*28),a=[0,3,1,3,2,1];let s=0;for(let t=0;t<e;++t){const e=this._visibleItems[t];for(let t=0;t<i.length;++t)for(let n=0;n<a.length;++n)o[s++]=i[t][a[n]][0],o[s++]=i[t][a[n]][1],o[s++]=i[t][a[n]][2],o[s++]=0,o[s++]=0,o.set(e.transform,s),s+=16,o[s++]=0,o[s++]=1,o[s++]=1,o[s++]=1,o[s++]=e.wavePhase,o[s++]=e.atlas0,o[s++]=e.atlas1}this._positions=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._positions),n.gl.bufferData(n.gl.ARRAY_BUFFER,o,n.gl.STATIC_DRAW),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,null),this._positions.count=12*e*3,this.glows&&this.glows.Rebuild()}},{key:"GetBatches",value:function(e,t,n){if(this.display&&e===r.w.RM_ADDITIVE&&this._positions&&this._visibleItems.length){if(this.effect){const e=new yt;r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this._parentTransform),this._perObjectData.perObjectVSData.Set("Shipdata",n.perObjectVSData.Get("Shipdata")),this._perObjectData.perObjectPSData=n.perObjectPSData,e.perObjectData=this._perObjectData,e.boosters=this,e.renderMode=r.w.RM_ADDITIVE,t.Commit(e)}this.glows&&this.glows.GetBoosterGlowBatches(e,t,n,this._parentTransform,n.perObjectVSData.Get("Shipdata")[0],0)}}},{key:"Render",value:function(e){if(!this.effect||!this.effect.IsGood())return!1;r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,this._positions);for(let t=0;t<this.effect.GetPassCount(e);++t){if(this.effect.ApplyPass(e,t),!this._decl.SetDeclaration(this.effect.GetPassInput(e,t),112))return!1;r.w.ApplyShadowState(),r.w.gl.drawArrays(r.w.gl.TRIANGLES,0,this._positions.count)}return!0}}],[{key:"RebuildItems",value:function(e){const n=e.glows,i=t.global,o=i.vec3_0;n&&n.ClearItems(),e._visibleItems=[];for(let t=0;t<e.items.length;t++){const a=e.items[t];if(a._onModified=e._onChildModified,a.display){if(e._visibleItems.push(a),n){const t=a.customValues&&a.customValues.display?a.customValues:e,s=a.GetPosition(i.vec3_1),u=a.GetDirection(i.vec3_2),l=a.GetScale();e.visible.glows&&a.visible.glow&&n.CreateItem({name:a.name+"_glow",position:r.H.subtract(o,s,r.H.scale(o,u,t.glowDistance)),blinkRate:a.seed,blinkPhase:a.seed,minScale:t.glowScale*l,maxScale:t.glowScale*l,color:t.glowColor,warpColor:t.warpGlowColor}),e.visible.symHalos&&a.visible.symHalo&&n.CreateItem({name:a.name+"_symHalo",position:r.H.subtract(o,s,r.H.scale(o,u,t.symHaloDistance)),blinkRate:a.seed,blinkPhase:a.seed+1,minScale:t.symHaloScale*l,maxScale:t.symHaloScale*l,color:t.haloColor,warpColor:t.warpHaloColor}),e.visible.halos&&a.visible.halo&&n.CreateItem({name:a.name+"_halo",position:r.H.subtract(o,s,r.H.scale(o,u,t.haloDistance)),blinkRate:a.seed,blinkPhase:a.seed+1,minScale:t.haloScaleX*l,maxScale:t.haloScaleY*l,color:t.haloColor,warpColor:t.warpHaloColor})}a._rebuildPending=!1}}}}]),t}();function gt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wt(e,t,n){return t&&_t(e.prototype,t),n&&_t(e,n),e}function Et(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Ot(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&St(e,t)}function St(e,t){return(St=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}mt(vt,"Item",bt),mt(vt,"perObjectData",{VSData:[["WorldMat",16],["Shipdata",4]]}),mt(vt,"vertexDeclarations",[["POSITION",0,3],["TEXCOORD",0,2],["TEXCOORD",1,4],["TEXCOORD",2,4],["TEXCOORD",3,4],["TEXCOORD",4,4],["TEXCOORD",5,4],["TEXCOORD",6,1],["TEXCOORD",7,2]]),mt(vt,"_box",[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],[[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,-1,-1]],[[-1,-1,0],[-1,1,0],[-1,1,-1],[-1,-1,-1]],[[1,-1,0],[1,-1,-1],[1,1,-1],[1,1,0]],[[-1,-1,0],[-1,-1,-1],[1,-1,-1],[1,-1,0]],[[-1,1,0],[1,1,0],[1,1,-1],[-1,1,-1]]]);let At=function(e){function t(){var e;gt(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Pt(Ot(Ot(e=Et(this,Tt(t).call(this,...i)))),"type",t.Type.INVALID),Pt(Ot(Ot(e)),"position1",r.H.create()),Pt(Ot(Ot(e)),"color1",r.I.fromValues(1,1,1,1)),Pt(Ot(Ot(e)),"position2",r.H.create()),Pt(Ot(Ot(e)),"color2",r.I.fromValues(1,1,1,1)),Pt(Ot(Ot(e)),"intermediatePosition",r.H.create()),Pt(Ot(Ot(e)),"width",1),Pt(Ot(Ot(e)),"multiColor",r.I.fromValues(0,0,0,1)),Pt(Ot(Ot(e)),"multiColorBorder",-1),Pt(Ot(Ot(e)),"overlayColor",r.I.fromValues(0,0,0,1)),Pt(Ot(Ot(e)),"animationSpeed",0),Pt(Ot(Ot(e)),"animationScale",1),Pt(Ot(Ot(e)),"numOfSegments",1),e}return Rt(t,ot),wt(t,[{key:"ChangeColor",value:function(e,t){r.H.copy(this.color1,e),r.H.copy(this.color2,t),this.OnValueChanged()}},{key:"ChangeWidth",value:function(e){this.width=e,this.OnValueChanged()}},{key:"ChangeCartesian",value:function(e,t,n){r.H.copy(this.position1,e),r.H.copy(this.position2,t),r.H.copy(this.intermediatePosition,n),this.OnValueChanged()}},{key:"ChangePositionCartesian",value:function(e,t){r.H.copy(this.position1,e),r.H.copy(this.position2,t),this.OnValueChanged()}},{key:"ChangeIntermediateCartesian",value:function(e){r.H.copy(this.intermediatePosition,e),this.OnValueChanged()}},{key:"ChangeSpherical",value:function(e,t,n,i){r.H.fromSpherical(this.position1,e,i),r.H.fromSpherical(this.position2,t,i),r.H.fromSpherical(this.intermediatePosition,n,i),this.OnValueChanged()}},{key:"ChangePositionSpherical",value:function(e,t,n){r.H.fromSpherical(this.position1,e,n),r.H.fromSpherical(this.position2,t,n),this.OnValueChanged()}},{key:"ChangeIntermediateSpherical",value:function(e,t){r.H.fromSpherical(this.intermediatePosition,e,t),this.OnValueChanged()}},{key:"ChangeMultiColor",value:function(e,t){r.I.copy(this.multiColor,e),this.multiColorBorder=t,this.OnValueChanged()}},{key:"ChangeAnimation",value:function(e,t,n){r.I.copy(this.overlayColor,e),this.animationSpeed=t,this.animationScale=n,this.OnValueChanged()}},{key:"ChangeSegmentation",value:function(e){this.type!==t.Type.STRAIGHT&&(this.numOfSegments=e,this.OnValueChanged())}}],[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t,e,["name","display","type","position1","color1","position2","color2","intermediatePosition","width","multiColor","multiColorBorder","overlayColor","animationSpeed","animationScale","numOfSegments"]),t}}]),t}();Pt(At,"Type",{INVALID:0,STRAIGHT:1,SPHERED:2,CURVED:3}),Pt(At,"DEFAULT_CURVED_SEGMENTS",20),Pt(At,"DEFAULT_SPHERED_SEGMENTS",20);let It=function(e){function t(){var e;return gt(this,t),Pt(Ot(Ot(e=Et(this,Tt(t).call(this)))),"lineEffect",s.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/SpecialFX/Lines3D.fx",textures:{TexMap:"res:/texture/global/white.dds.0.png",OverlayTexMap:"res:/texture/global/white.dds.0.png"}})),Pt(Ot(Ot(e)),"pickEffect",null),Pt(Ot(Ot(e)),"lineWidthFactor",1),Pt(Ot(Ot(e)),"additive",!1),Pt(Ot(Ot(e)),"pickable",!0),Pt(Ot(Ot(e)),"depthOffset",0),Pt(Ot(Ot(e)),"translation",r.H.create()),Pt(Ot(Ot(e)),"rotation",r.C.create()),Pt(Ot(Ot(e)),"scaling",r.H.fromValues(1,1,1)),Pt(Ot(Ot(e)),"transform",r.z.create()),Pt(Ot(Ot(e)),"parentTransform",r.z.create()),Pt(Ot(Ot(e)),"_vertexSize",26),Pt(Ot(Ot(e)),"_vbSize",0),Pt(Ot(Ot(e)),"_vb",null),Pt(Ot(Ot(e)),"_perObjectData",new s.Tw2PerObjectData(t.perObjectData)),Pt(Ot(Ot(e)),"_decl",new s.Tw2VertexDeclaration(t.vertexDeclarations,4*e._vertexSize)),t.init(),e}return Rt(t,at),wt(t,[{key:"Initialize",value:function(){this.OnValueChanged(),this.Rebuild()}},{key:"AddStraightLine",value:function(e,t,n,r,i){return this.CreateItem({type:At.Type.STRAIGHT,position1:e,position2:t,color1:r,color2:i,width:n})}},{key:"AddCurvedLineCrt",value:function(e,t,n,r,i,o){return this.CreateItem({type:At.Type.CURVED,position1:e,position2:t,intermediatePosition:n,color1:i,color2:o,width:r,numOfSegments:At.DEFAULT_CURVED_SEGMENTS})}},{key:"AddCurvedLineSph",value:function(e,n,i,o,a,s,u){const l=t.global;return this.CreateItem({type:At.Type.CURVED,position1:r.H.fromSpherical(l.vec3_0,e,i),position2:r.H.fromSpherical(l.vec3_1,n,i),intermediatePosition:r.H.fromSpherical(l.vec3_2,o,i),color1:s,color2:u,width:a,numOfSegments:At.DEFAULT_CURVED_SEGMENTS})}},{key:"AddSpheredLineCrt",value:function(e,t,n,r,i,o){return this.CreateItem({type:At.Type.SPHERED,position1:e,position2:t,intermediatePosition:n,color1:i,color2:o,width:r,numOfSegments:At.DEFAULT_SPHERED_SEGMENTS})}},{key:"AddSpheredLineSph",value:function(e,n,i,o,a,s,u){const l=t.global;return this.CreateItem({type:At.Type.SPHERED,position1:r.H.fromSpherical(l.vec3_0,e,i),position2:r.H.fromSpherical(l.vec3_1,n,i),intermediatePosition:r.H.fromSpherical(l.vec3_2,o,i),color1:s,color2:u,width:a,numOfSegments:At.DEFAULT_SPHERED_SEGMENTS})}},{key:"OnValueChanged",value:function(){r.z.fromRotationTranslationScale(this.transform,this.rotation,this.translation,this.scaling),this._rebuildPending=!0}},{key:"UpdateViewDependentData",value:function(e){r.z.copy(this.parentTransform,e)}},{key:"Update",value:function(){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){this._vb&&(r.w.gl.deleteBuffer(this._vb),this._vb=null)}},{key:"Rebuild",value:function(){t.RebuildItems(this),this._vb=null,this._vbSize=this.lineCount,this._rebuildPending=!1;const e=this._visibleItems.length;if(!e)return;const n=t.global,i=new Float32Array(6*this._vbSize*this._vertexSize),o=n.vec3_0,a=n.vec3_1,s=n.vec3_2,u=n.vec3_3,l=n.vec3_4,c=n.vec3_5,f=n.vec3_6,h=n.mat4_0;let d,p=n.vec3_7,m=n.vec3_8,y=n.vec3_9,b=n.vec3_10,v=n.vec4_0,g=n.vec4_1,_=0;for(let n=0;n<e;++n){const e=this._visibleItems[n];switch(e.type){case At.Type.INVALID:break;case At.Type.STRAIGHT:t.WriteLineVerticesToBuffer(this,e.position1,e.color1,0,e.position2,e.color2,1,n,i,_),_+=6*this._vertexSize;break;case At.Type.SPHERED:r.H.subtract(o,e.position1,e.intermediatePosition),r.H.subtract(a,e.position2,e.intermediatePosition),r.H.normalize(s,o),r.H.normalize(u,a),r.H.cross(l,o,a);const w=Math.acos(r.H.dot(s,u))/e.numOfSegments;r.z.identity(h),r.z.rotate(h,h,w,l),r.H.copy(p,o),r.I.copy(v,e.color1);for(let o=0;o<this.lines[n].numOfSegments;++o){const a=(o+1)/e.numOfSegments;r.H.transformMat4(m,p,h),g[0]=e.color1[0]*(1-a)+e.color2[0]*a,g[1]=e.color1[1]*(1-a)+e.color2[1]*a,g[2]=e.color1[2]*(1-a)+e.color2[2]*a,g[3]=e.color1[3]*(1-a)+e.color2[3]*a,r.H.add(y,p,e.intermediatePosition),r.H.add(b,m,e.intermediatePosition),t.WriteLineVerticesToBuffer(this,y,v,o/e.numOfSegments,b,g,a,n,i,_),_+=6*this._vertexSize,d=p,p=m,m=d,d=v,v=g,g=d}break;case At.Type.CURVED:r.H.subtract(c,e.intermediatePosition,e.position1),r.H.subtract(f,e.position2,e.intermediatePosition),r.H.copy(y,e.position1),r.H.copy(v,e.color1);for(let o=0;o<e.numOfSegments;++o){const a=(o+1)/e.numOfSegments;r.H.hermite(b,e.position1,c,e.position2,f,a),g[0]=e.color1[0]*(1-a)+e.color2[0]*a,g[1]=e.color1[1]*(1-a)+e.color2[1]*a,g[2]=e.color1[2]*(1-a)+e.color2[2]*a,g[3]=e.color1[3]*(1-a)+e.color2[3]*a,t.WriteLineVerticesToBuffer(this,y,v,o/e.numOfSegments,b,g,a,n,i,_),_+=6*this._vertexSize,d=y,y=b,b=d,d=v,v=g,g=d}}}this._vb=r.w.gl.createBuffer(),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,this._vb),r.w.gl.bufferData(r.w.gl.ARRAY_BUFFER,i,r.w.gl.STATIC_DRAW),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,null)}},{key:"GetBatches",value:function(e,n){if(!this.display||!this._vb)return;let i;switch(e){case r.w.RM_TRANSPARENT:if(this.additive||!this.lineEffect)return;i=this.lineEffect;break;case r.w.RM_ADDITIVE:if(!this.additive||!this.lineEffect)return;i=this.lineEffect;break;case r.w.RM_PICKABLE:if(!this.pickable||!this.pickEffect)return;i=this.pickEffect}const o=new s.Tw2ForwardingRenderBatch,a=t.global.mat4_0;r.z.multiply(a,this.transform,this.parentTransform),r.z.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),a),r.z.transpose(this._perObjectData.perObjectPSData.Get("WorldMat"),a),o.perObjectData=this._perObjectData,o.geometryProvider=this,o.renderMode=e,o.effect=i,n.Commit(o)}},{key:"Render",value:function(e,t){if(!e.effect||!e.effect.IsGood())return!1;r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,this._vb);let n=e.effect.GetPassCount(t);for(let i=0;i<n;++i){e.effect.ApplyPass(t,i);let n=e.effect.GetPassInput(t,i);if(!this._decl.SetDeclaration(n,this._decl.stride))return!1;r.w.ApplyShadowState(),r.w.gl.drawArrays(r.w.gl.TRIANGLES,0,6*this._vbSize)}return!0}},{key:"lines",get:function(){return this.items},set:function(e){this.items=e}},{key:"lineCount",get:function(){let e=0;for(let t=0;t<this.items.length;t++)this.items[t].type!==At.Type.INVALID&&(e+=this.items[t].numOfSegments);return e}}],[{key:"FillColorVertices",value:function(e,t,n){return t[n++]=e.multiColor[0],t[n++]=e.multiColor[1],t[n++]=e.multiColor[2],t[n++]=e.multiColor[3],t[n++]=e.overlayColor[0],t[n++]=e.overlayColor[1],t[n++]=e.overlayColor[2],t[n++]=e.overlayColor[3],n}},{key:"WriteLineVerticesToBuffer",value:function(e,n,r,i,o,a,s,u,l,c){const f=e.items[u];l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=o[0]-n[0],l[c++]=o[1]-n[1],l[c++]=o[2]-n[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=t.FillColorVertices(f,l,c),l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=o[0]-n[0],l[c++]=o[1]-n[1],l[c++]=o[2]-n[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=t.FillColorVertices(f,l,c),l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=n[0]-o[0],l[c++]=n[1]-o[1],l[c++]=n[2]-o[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],c=t.FillColorVertices(f,l,c),l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=o[0]-n[0],l[c++]=o[1]-n[1],l[c++]=o[2]-n[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=r[3],c=t.FillColorVertices(f,l,c),l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=n[0]-o[0],l[c++]=n[1]-o[1],l[c++]=n[2]-o[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],c=t.FillColorVertices(f,l,c),l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=n[0]-o[0],l[c++]=n[1]-o[1],l[c++]=n[2]-o[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=a[3],t.FillColorVertices(f,l,c)}},{key:"init",value:function(){t.global||(t.global={vec3_0:r.H.create(),vec3_1:r.H.create(),vec3_2:r.H.create(),vec3_3:r.H.create(),vec3_4:r.H.create(),vec3_5:r.H.create(),vec3_6:r.H.create(),vec3_7:r.H.create(),vec3_8:r.H.create(),vec3_9:r.H.create(),vec3_10:r.H.create(),vec4_0:r.I.create(),vec4_1:r.I.create(),mat4_0:r.z.create()})}}]),t}();function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pt(It,"Item",At),Pt(It,"global",null),Pt(It,"perObjectData",{VSData:[["WorldMat",16]],PSData:[["WorldMat",16]]}),Pt(It,"vertexDeclarations",[["POSITION",0,3],["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,3],["COLOR",0,4],["COLOR",1,4],["COLOR",2,4]]);let Dt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Mt(this,"name",""),Mt(this,"transform",r.z.create()),Mt(this,"atlasIndex0",null),Mt(this,"atlasIndex1",null),Mt(this,"bone",null)}var t,n,i;return t=e,(n=[{key:"FindBone",value:function(e){this.bone=null;const t=e.FindModelForMesh(0);if(t)for(let e=0;e<t.bones.length;++e)if(t.bones[e].boneRes.name===this.name){this.bone=t.bones[e];break}return this.bone}}])&&Ct(t.prototype,n),i&&Ct(t,i),e}();function kt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e,t,n){return t&&xt(e.prototype,t),n&&xt(e,n),e}function jt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Ut(e):t}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Mt(Dt,"Prefix",{AUDIO:"locator_audio",ATTACH:"locator_attach",BOOSTER:"locator_booster",TURRET:"locator_turret",XL_TURRET:"locator_xl"});let Vt=function(e){function t(){var e;kt(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Nt(Ut(Ut(e=jt(this,Ft(t).call(this,...r)))),"planeSet",null),e}return Lt(t,s["Tw2RenderBatch"]),Gt(t,[{key:"Commit",value:function(e){this.planeSet.Render(e)}}]),t}(),Ht=function(e){function t(){var e;kt(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Nt(Ut(Ut(e=jt(this,Ft(t).call(this,...i)))),"boneIndex",0),Nt(Ut(Ut(e)),"groupIndex",-1),Nt(Ut(Ut(e)),"maskAtlasID",0),Nt(Ut(Ut(e)),"position",r.H.create()),Nt(Ut(Ut(e)),"scaling",r.H.fromValues(1,1,1)),Nt(Ut(Ut(e)),"rotation",r.C.create()),Nt(Ut(Ut(e)),"transform",r.z.create()),Nt(Ut(Ut(e)),"color",r.I.fromValues(1,1,1,1)),Nt(Ut(Ut(e)),"layer1Transform",r.I.fromValues(1,1,0,0)),Nt(Ut(Ut(e)),"layer2Transform",r.I.fromValues(1,1,0,0)),Nt(Ut(Ut(e)),"layer1Scroll",r.I.create()),Nt(Ut(Ut(e)),"layer2Scroll",r.I.create()),e}return Lt(t,ot),Gt(t,null,[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t,e,["name","display","boneIndex","groupIndex","maskAtlasID","position","scaling","rotation","transform","color","layer1Transform","layer2Transform","layer1Scroll","layer2Scroll"]),t}}]),t}(),zt=function(e){function t(){var e;kt(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Nt(Ut(Ut(e=jt(this,Ft(t).call(this,...r)))),"effect",null),Nt(Ut(Ut(e)),"hideOnLowQuality",!1),Nt(Ut(Ut(e)),"_time",0),Nt(Ut(Ut(e)),"_vertexBuffer",null),Nt(Ut(Ut(e)),"_indexBuffer",null),Nt(Ut(Ut(e)),"_decl",new s.Tw2VertexDeclaration(t.vertexDeclarations)),e}return Lt(t,at),Gt(t,[{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}},{key:"Update",value:function(e){this._time+=e,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){this._vertexBuffer&&(r.w.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(r.w.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;const e=this._visibleItems.length;if(!e)return;const n=t.global.mat4_0,i=new Float32Array(4*e*35);for(let t=0;t<e;++t){const e=this._visibleItems[t],o=4*t*35;i[o+35-3]=0,i[o+35+35-3]=1,i[o+70+35-3]=2,i[o+105+35-3]=3;const a=r.z.fromRotationTranslationScale(n,e.rotation,e.position,e.scaling);for(let t=0;t<4;++t){const n=o+35*t;i[n]=a[0],i[n+1]=a[4],i[n+2]=a[8],i[n+3]=a[12],i[n+4]=a[1],i[n+5]=a[5],i[n+6]=a[9],i[n+7]=a[13],i[n+8]=a[2],i[n+9]=a[6],i[n+10]=a[10],i[n+11]=a[14],i[n+12]=e.color[0],i[n+13]=e.color[1],i[n+14]=e.color[2],i[n+15]=e.color[3],i[n+16]=e.layer1Transform[0],i[n+17]=e.layer1Transform[1],i[n+18]=e.layer1Transform[2],i[n+19]=e.layer1Transform[3],i[n+20]=e.layer2Transform[0],i[n+21]=e.layer2Transform[1],i[n+22]=e.layer2Transform[2],i[n+23]=e.layer2Transform[3],i[n+24]=e.layer1Scroll[0],i[n+25]=e.layer1Scroll[1],i[n+26]=e.layer1Scroll[2],i[n+27]=e.layer1Scroll[3],i[n+28]=e.layer2Scroll[0],i[n+29]=e.layer2Scroll[1],i[n+30]=e.layer2Scroll[2],i[n+31]=e.layer2Scroll[3],i[n+33]=e.boneIndex,i[n+34]=e.maskAtlasID}}this._vertexBuffer=r.w.gl.createBuffer(),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,this._vertexBuffer),r.w.gl.bufferData(r.w.gl.ARRAY_BUFFER,i,r.w.gl.STATIC_DRAW),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,null);const o=new Uint16Array(6*e);for(let t=0;t<e;++t){const e=6*t,n=4*t;o[e]=n,o[e+1]=n+2,o[e+2]=n+1,o[e+3]=n,o[e+4]=n+3,o[e+5]=n+2}this._indexBuffer=r.w.gl.createBuffer(),r.w.gl.bindBuffer(r.w.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),r.w.gl.bufferData(r.w.gl.ELEMENT_ARRAY_BUFFER,o,r.w.gl.STATIC_DRAW),r.w.gl.bindBuffer(r.w.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*e}},{key:"GetBatches",value:function(e,t,n){if(this.display&&e===r.w.RM_ADDITIVE&&this._indexBuffer&&this._visibleItems.length){const e=new Vt;e.renderMode=r.w.RM_ADDITIVE,e.planeSet=this,e.perObjectData=n,t.Commit(e)}}},{key:"Render",value:function(e){if(!this.effect||!this.effect.IsGood())return!1;r.w.SetStandardStates(r.w.RM_ADDITIVE),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,this._vertexBuffer),r.w.gl.bindBuffer(r.w.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(let t=0;t<this.effect.GetPassCount(e);++t){if(this.effect.ApplyPass(e,t),!this._decl.SetDeclaration(this.effect.GetPassInput(e,t),140))return!1;r.w.ApplyShadowState(),r.w.gl.drawElements(r.w.gl.TRIANGLES,this._indexBuffer.count,r.w.gl.UNSIGNED_SHORT,0)}return!0}},{key:"planes",get:function(){return this.items},set:function(e){this.items=e}}]),t}();function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Nt(zt,"Item",Ht),Nt(zt,"vertexDeclarations",[["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,4],["COLOR",0,4],["TEXCOORD",3,4],["TEXCOORD",4,4],["TEXCOORD",5,4],["TEXCOORD",6,4],["TEXCOORD",7,3]]);let Yt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xt(this,"_id",r.F.generateID()),Xt(this,"name",""),Xt(this,"display",!0),Xt(this,"decalEffect",null),Xt(this,"pickEffect",null),Xt(this,"parentGeometry",null),Xt(this,"parentBoneIndex",-1),Xt(this,"groupIndex",-1),Xt(this,"pickable",!0),Xt(this,"position",r.H.create()),Xt(this,"rotation",r.C.create()),Xt(this,"scaling",r.H.create()),Xt(this,"decalMatrix",r.z.create()),Xt(this,"invDecalMatrix",r.z.create()),Xt(this,"indexBuffer",[]),Xt(this,"_indexBuffer",null),Xt(this,"_perObjectData",new s.Tw2PerObjectData(e.perObjectData))}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(){this.SetIndexBuffer(this.indexBuffer)}},{key:"OnValueChanged",value:function(){if(!this._indexBuffer&&this.indexBuffer){const e=r.w.gl,t=new Uint16Array(this.indexBuffer);this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}r.z.fromRotationTranslationScale(this.decalMatrix,this.rotation,this.position,this.scaling),r.z.invert(this.invDecalMatrix,this.decalMatrix)}},{key:"SetParentGeometry",value:function(e){this.parentGeometry=e}},{key:"SetIndexBuffer",value:function(e){this.indexBuffer=e,this.Unload(),this.OnValueChanged()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.parentGeometry&&!e.includes(this.parentGeometry)&&e.push(this.parentGeometry),this.decalEffect&&this.decalEffect.GetResources(e),this.pickEffect&&this.pickEffect.GetResources(e),e}},{key:"Unload",value:function(){this._indexBuffer&&(r.w.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"GetBatches",value:function(e,t,n,i){let o;switch(e){case r.w.RM_DECAL:o=this.decalEffect;break;case r.w.RM_PICKABLE:o=this.pickable?this.pickEffect:null}if(this.display&&o&&o.IsGood()&&this.indexBuffer.length&&this.parentGeometry&&this.parentGeometry.IsGood()){const a=new s.Tw2ForwardingRenderBatch;if(this._perObjectData.perObjectVSData.Set("worldMatrix",n.perObjectVSData.Get("WorldMat")),this.parentBoneIndex>=0){const e=n.perObjectVSData.Get("JointMat"),t=12*this.parentBoneIndex;if(e[t]||e[t+4]||e[t+8]){const n=this._perObjectData.perObjectVSData.Get("parentBoneMatrix");n[0]=e[t],n[1]=e[t+4],n[2]=e[t+8],n[3]=0,n[4]=e[t+1],n[5]=e[t+5],n[6]=e[t+9],n[7]=0,n[8]=e[t+2],n[9]=e[t+6],n[10]=e[t+10],n[11]=0,n[12]=e[t+3],n[13]=e[t+7],n[14]=e[t+11],n[15]=1,r.z.transpose(n,n)}}r.z.invert(this._perObjectData.perObjectVSData.Get("invWorldMatrix"),this._perObjectData.perObjectVSData.Get("worldMatrix")),r.z.transpose(this._perObjectData.perObjectVSData.Get("decalMatrix"),this.decalMatrix),r.z.transpose(this._perObjectData.perObjectVSData.Get("invDecalMatrix"),this.invDecalMatrix),this._perObjectData.perObjectPSData.Get("displayData")[0]=i||0,this._perObjectData.perObjectPSData.Set("shipData",n.perObjectPSData.data),a.perObjectData=this._perObjectData,a.geometryProvider=this,a.renderMode=e,a.effect=o,t.Commit(a)}}},{key:"Render",value:function(e,t){const n=this.parentGeometry.meshes[0].indexes,i=this.parentGeometry.meshes[0].areas[0].start,o=this.parentGeometry.meshes[0].areas[0].count,a=this.parentGeometry.meshes[0].indexType;r.E.SetVariableValue("u_DecalMatrix",this.decalMatrix),r.E.SetVariableValue("u_InvDecalMatrix",this.invDecalMatrix),this.parentGeometry.meshes[0].indexes=this._indexBuffer,this.parentGeometry.meshes[0].areas[0].start=0,this.parentGeometry.meshes[0].areas[0].count=this.indexBuffer.length,this.parentGeometry.meshes[0].indexType=r.w.gl.UNSIGNED_SHORT,this.parentGeometry.RenderAreas(0,0,1,e.effect,t),this.parentGeometry.meshes[0].indexes=n,this.parentGeometry.meshes[0].areas[0].start=i,this.parentGeometry.meshes[0].areas[0].count=o,this.parentGeometry.meshes[0].indexType=a}}])&&qt(t.prototype,n),i&&qt(t,i),e}();function Wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qt(e,t,n){return t&&Kt(e.prototype,t),n&&Kt(e,n),e}function Zt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?tn(e):t}function $t(e){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&en(e,t)}function en(e,t){return(en=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Xt(Yt,"perObjectData",{VSData:[["worldMatrix",16],["invWorldMatrix",16],["decalMatrix",16],["invDecalMatrix",16],["parentBoneMatrix",16,r.z.identity([])]],PSData:[["displayData",4],["shipData",12]]});let rn=function(e){function t(){var e;Wt(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return nn(tn(tn(e=Zt(this,$t(t).call(this,...r)))),"spotlightSet",null),e}return Jt(t,s["Tw2RenderBatch"]),Qt(t,[{key:"Commit",value:function(e){this.spotlightSet.RenderCones(e),this.spotlightSet.RenderGlow(e)}}]),t}(),on=function(e){function t(){var e;Wt(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return nn(tn(tn(e=Zt(this,$t(t).call(this,...i)))),"transform",r.z.create()),nn(tn(tn(e)),"coneColor",r.I.create()),nn(tn(tn(e)),"spriteColor",r.I.create()),nn(tn(tn(e)),"flareColor",r.I.create()),nn(tn(tn(e)),"spriteScale",r.H.fromValues(1,1,1)),nn(tn(tn(e)),"boosterGainInfluence",0),nn(tn(tn(e)),"boneIndex",0),nn(tn(tn(e)),"groupIndex",-1),nn(tn(tn(e)),"coneIntensity",0),nn(tn(tn(e)),"spriteIntensity",0),nn(tn(tn(e)),"flareIntensity",0),e}return Jt(t,ot),Qt(t,null,[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t,e,["name","display","boosterGainInfluence","boneIndex","groupIndex","coneIntensity","spriteIntensity","flareIntensity","transform","coneColor","spriteColor","flareColor","spriteScale"]),t}}]),t}(),an=function(e){function t(){var e;Wt(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return nn(tn(tn(e=Zt(this,$t(t).call(this,...r)))),"coneEffect",null),nn(tn(tn(e)),"glowEffect",null),nn(tn(tn(e)),"_coneVertexBuffer",null),nn(tn(tn(e)),"_spriteVertexBuffer",null),nn(tn(tn(e)),"_indexBuffer",null),nn(tn(tn(e)),"_decl",new s.Tw2VertexDeclaration(t.vertexDeclarations)),e}return Jt(t,at),Qt(t,[{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.coneEffect&&this.coneEffect.GetResources(e),this.glowEffect&&this.glowEffect.GetResources(e),e}},{key:"Unload",value:function(){this._coneVertexBuffer&&(r.w.gl.deleteBuffer(this._coneVertexBuffer),this._coneVertexBuffer=null),this._spriteVertexBuffer&&(r.w.gl.deleteBuffer(this._spriteVertexBuffer),this._spriteVertexBuffer=null),this._indexBuffer&&(r.w.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;const e=this._visibleItems.length;if(!e)return;const n=r.w,i=[1,0,2,3],o=new Float32Array(22*(4*e*4));for(let t=0;t<e;++t){const e=this._visibleItems[t];for(let n=0;n<4;++n)for(let r=0;r<4;++r){const a=22*(4*t*4+4*n+r);o[a]=e.coneColor[0]*e.coneIntensity,o[a+1]=e.coneColor[1]*e.coneIntensity,o[a+2]=e.coneColor[2]*e.coneIntensity,o[a+3]=e.coneColor[3],o[a+4]=e.transform[0],o[a+5]=e.transform[4],o[a+6]=e.transform[8],o[a+7]=e.transform[12],o[a+8]=e.transform[1],o[a+9]=e.transform[5],o[a+10]=e.transform[9],o[a+11]=e.transform[13],o[a+12]=e.transform[2],o[a+13]=e.transform[6],o[a+14]=e.transform[10],o[a+15]=e.transform[14],o[a+16]=1,o[a+17]=1,o[a+18]=1,o[a+19]=4*n+i[r],o[a+20]=e.boneIndex,o[a+21]=e.boosterGainInfluence?255:0}}this._coneVertexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._coneVertexBuffer),n.gl.bufferData(n.gl.ARRAY_BUFFER,o,n.gl.STATIC_DRAW),this._coneVertexBuffer.count=4*e*6;const a=new Float32Array(22*(2*e*4)),s=[1,0,2,3];for(let t=0;t<e;++t){const e=this._visibleItems[t];for(let n=0;n<2;++n)for(let r=0;r<4;++r){const i=22*(2*t*4+4*n+r);n%2==0?(a[i]=e.spriteColor[0]*e.spriteIntensity,a[i+1]=e.spriteColor[1]*e.spriteIntensity,a[i+2]=e.spriteColor[2]*e.spriteIntensity,a[i+3]=e.spriteColor[3],a[i+16]=e.spriteScale[0],a[i+17]=1,a[i+18]=1):(a[i]=e.flareColor[0]*e.flareIntensity,a[i+1]=e.flareColor[1]*e.flareIntensity,a[i+2]=e.flareColor[2]*e.flareIntensity,a[i+3]=e.flareColor[3],a[i+16]=1,a[i+17]=e.spriteScale[1],a[i+18]=e.spriteScale[2]),a[i+4]=e.transform[0],a[i+5]=e.transform[4],a[i+6]=e.transform[8],a[i+7]=e.transform[12],a[i+8]=e.transform[1],a[i+9]=e.transform[5],a[i+10]=e.transform[9],a[i+11]=e.transform[13],a[i+12]=e.transform[2],a[i+13]=e.transform[6],a[i+14]=e.transform[10],a[i+15]=e.transform[14],a[i+19]=4*n+s[r],a[i+20]=e.boneIndex,a[i+21]=e.boosterGainInfluence?255:0}}this._spriteVertexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._spriteVertexBuffer),n.gl.bufferData(n.gl.ARRAY_BUFFER,a,n.gl.STATIC_DRAW),this._spriteVertexBuffer.count=2*e*6;const u=new Uint16Array(4*e*6);for(let t=0;t<4*e;++t){const e=6*t,n=4*t;u[e]=n,u[e+1]=n+1,u[e+2]=n+2,u[e+3]=n+2,u[e+4]=n+3,u[e+5]=n}this._indexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,u,n.gl.STATIC_DRAW),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=e}},{key:"GetBatches",value:function(e,t,n){if(this.display&&e===r.w.RM_ADDITIVE&&this._indexBuffer&&this._indexBuffer.count){const e=new rn;e.renderMode=r.w.RM_ADDITIVE,e.spotlightSet=this,e.perObjectData=n,t.Commit(e)}}},{key:"RenderCones",value:function(e){return t.Render(this,this.coneEffect,e,this._coneVertexBuffer)}},{key:"RenderGlow",value:function(e){return t.Render(this,this.glowEffect,e,this._spriteVertexBuffer)}},{key:"spotlightItems",get:function(){return this.items},set:function(e){this.items=e}}],[{key:"Render",value:function(e,t,n,i){if(!t||!t.IsGood()||!i)return!1;r.w.SetStandardStates(r.w.RM_ADDITIVE),r.w.gl.bindBuffer(r.w.gl.ARRAY_BUFFER,i),r.w.gl.bindBuffer(r.w.gl.ELEMENT_ARRAY_BUFFER,e._indexBuffer);for(let o=0;o<t.GetPassCount(n);++o){if(t.ApplyPass(n,o),!e._decl.SetDeclaration(t.GetPassInput(n,o),88))return!1;r.w.ApplyShadowState(),r.w.gl.drawElements(r.w.gl.TRIANGLES,i.count,r.w.gl.UNSIGNED_SHORT,0)}return!0}}]),t}();function sn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ln(e,t,n){return t&&un(e.prototype,t),n&&un(e,n),e}function cn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?pn(e):t}function fn(e){return(fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nn(an,"Item",on),nn(an,"vertexDeclarations",[["COLOR",0,4],["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,4],["TEXCOORD",3,3],["TEXCOORD",4,3]]);let yn=function(e){function t(){var e;sn(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return mn(pn(pn(e=cn(this,fn(t).call(this,...r)))),"boosterGlow",!1),mn(pn(pn(e)),"spriteSet",null),mn(pn(pn(e)),"world",null),mn(pn(pn(e)),"boosterGain",0),mn(pn(pn(e)),"warpIntensity",0),e}return hn(t,s["Tw2RenderBatch"]),ln(t,[{key:"Commit",value:function(e){this.boosterGlow?this.spriteSet.RenderBoosterGlow(e,this.world,this.boosterGain,this.warpIntensity):this.spriteSet.Render(e,this.world,this.perObjectData)}}]),t}(),bn=function(e){function t(){var e;sn(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return mn(pn(pn(e=cn(this,fn(t).call(this,...i)))),"position",r.H.create()),mn(pn(pn(e)),"blinkRate",0),mn(pn(pn(e)),"blinkPhase",0),mn(pn(pn(e)),"minScale",1),mn(pn(pn(e)),"maxScale",1),mn(pn(pn(e)),"falloff",0),mn(pn(pn(e)),"color",r.I.create()),mn(pn(pn(e)),"warpColor",r.I.create()),mn(pn(pn(e)),"boneIndex",0),mn(pn(pn(e)),"groupIndex",-1),e}return hn(t,ot),ln(t,null,[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t,e,["name","display","blinkRate","blinkPhase","minScale","maxScale","falloff","boneIndex","groupIndex","position","color","warpColor"]),t}}]),t}(),vn=function(e){function t(){var e;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return sn(this,t),mn(pn(pn(e=cn(this,fn(t).call(this)))),"effect",null),mn(pn(pn(e)),"useQuads",null),mn(pn(pn(e)),"isSkinned",null),mn(pn(pn(e)),"_time",0),mn(pn(pn(e)),"_vertexBuffer",null),mn(pn(pn(e)),"_indexBuffer",null),mn(pn(pn(e)),"_instanceBuffer",null),mn(pn(pn(e)),"_decl",new s.Tw2VertexDeclaration),mn(pn(pn(e)),"_vdecl",new s.Tw2VertexDeclaration([["TEXCOORD",5,1]])),e.UseQuads(n,r),e}return hn(t,at),ln(t,[{key:"UseQuads",value:function(e,n){this.useQuads!==e&&(this.useQuads=e,this.isSkinned=n,this._decl.DeclareFromObject(e?t.quadVertexDeclarations:t.vertexDeclarations),this._rebuildPending=!0)}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}},{key:"Update",value:function(e){this._time+=e,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){const e=r.w.gl;this._vertexBuffer&&(e.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(e.deleteBuffer(this._indexBuffer),this._indexBuffer=null),this._instanceBuffer&&(e.deleteBuffer(this._instanceBuffer),this._instanceBuffer=null)}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this),this._rebuildPending=!1;const e=this._visibleItems.length;if(!e)return;const t=r.w.gl;if(this.useQuads)return this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,1,2,2,3,0]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),void(this._instanceBuffer=t.createBuffer());const n=new Float32Array(4*e*13);for(let t=0;t<e;++t){const e=this._visibleItems[t],r=4*t*13;n[r]=0,n[r+13]=1,n[r+26]=2,n[r+39]=3;for(let t=0;t<4;++t){const i=r+13*t;n[i+1]=e.boneIndex,n[i+2]=e.position[0],n[i+3]=e.position[1],n[i+4]=e.position[2],n[i+5]=e.color[0],n[i+6]=e.color[1],n[i+7]=e.color[2],n[i+8]=e.blinkPhase,n[i+9]=e.blinkRate,n[i+10]=e.minScale,n[i+11]=e.maxScale,n[i+12]=e.falloff}}this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);const i=new Uint16Array(6*e);for(let t=0;t<e;++t){const e=6*t,n=4*t;i[e]=n,i[e+1]=n+2,i[e+2]=n+1,i[e+3]=n,i[e+4]=n+3,i[e+5]=n+2}this._indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*e}},{key:"GetBatches",value:function(e,t,n,i){if(this.display&&e===r.w.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){const e=new yn;e.world=i,e.renderMode=r.w.RM_ADDITIVE,e.spriteSet=this,e.perObjectData=n,t.Commit(e)}}},{key:"GetBoosterGlowBatches",value:function(e,t,n,i,o,a){if(this.display&&e===r.w.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){const e=new yn;e.boosterGlow=!0,e.world=i,e.boosterGain=o,e.warpIntensity=a,e.renderMode=r.w.RM_ADDITIVE,e.spriteSet=this,e.perObjectData=n,t.Commit(e)}}},{key:"Render",value:function(e,t,n){if(this.useQuads)return this.RenderQuads(e,t,n);if(!this.effect||!this.effect.IsGood()||!this._indexBuffer)return!1;const i=r.w,o=i.gl;i.SetStandardStates(i.RM_ADDITIVE),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(let t=0;t<this.effect.GetPassCount(e);++t){if(this.effect.ApplyPass(e,t),!this._decl.SetDeclaration(this.effect.GetPassInput(e,t),52))return!1;i.ApplyShadowState(),o.drawElements(o.TRIANGLES,this._indexBuffer.count,o.UNSIGNED_SHORT,0)}return!0}},{key:"RenderBoosterGlow",value:function(e,t,n,i){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;const o=r.w,a=o.gl,s=at.global.vec3_0,u=this._visibleItems.length,l=new Float32Array(17*u);o.SetStandardStates(o.RM_ADDITIVE);let c=0;for(let e=0;e<u;++e){const o=this._visibleItems[e];r.H.transformMat4(s,o.position,t),l[c++]=s[0],l[c++]=s[1],l[c++]=s[2],l[c++]=t[8],l[c++]=o.blinkPhase,l[c++]=t[9],l[c++]=o.minScale,l[c++]=o.maxScale,l[c++]=t[10],l[c++]=o.color[0],l[c++]=o.color[1],l[c++]=o.color[2],l[c++]=n,l[c++]=o.warpColor[0],l[c++]=o.warpColor[1],l[c++]=o.warpColor[2],l[c++]=i}a.bindBuffer(a.ARRAY_BUFFER,this._instanceBuffer),a.bufferData(a.ARRAY_BUFFER,l,a.DYNAMIC_DRAW);for(let t=0;t<this.effect.GetPassCount(e);++t){this.effect.ApplyPass(e,t);const n=this.effect.GetPassInput(e,t);a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(n,4),a.bindBuffer(a.ARRAY_BUFFER,this._instanceBuffer);const r=this._decl.SetPartialDeclaration(n,68,0,1);o.ApplyShadowState(),o.ext.drawArraysInstanced(a.TRIANGLES,0,6,u),this._decl.ResetInstanceDivisors(r)}return!0}},{key:"RenderQuads",value:function(e,t,n){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;const i=r.w,o=i.gl,a=this._visibleItems.length,s=new Float32Array(17*a),u=at.global.vec3_0,l=n.perObjectVSData.Get("JointMat");i.SetStandardStates(i.RM_ADDITIVE);let c=0;for(let e=0;e<a;++e){const n=this._visibleItems[e];if(this.isSkinned){const e=12*n.boneIndex;u[0]=l[e]*n.position[0]+l[e+1]*n.position[1]+l[e+2]*n.position[2]+l[e+3],u[1]=l[e+4]*n.position[0]+l[e+5]*n.position[1]+l[e+6]*n.position[2]+l[e+7],u[2]=l[e+8]*n.position[0]+l[e+9]*n.position[1]+l[e+10]*n.position[2]+l[e+11],r.H.transformMat4(u,u,t)}else r.H.transformMat4(u,n.position,t);s[c++]=u[0],s[c++]=u[1],s[c++]=u[2],s[c++]=1,s[c++]=n.blinkPhase,s[c++]=n.blinkRate,s[c++]=n.minScale,s[c++]=n.maxScale,s[c++]=n.falloff,s[c++]=n.color[0],s[c++]=n.color[1],s[c++]=n.color[2],s[c++]=1,s[c++]=n.warpColor[0],s[c++]=n.warpColor[1],s[c++]=n.warpColor[2],s[c++]=1}o.bindBuffer(o.ARRAY_BUFFER,this._instanceBuffer),o.bufferData(o.ARRAY_BUFFER,s,o.DYNAMIC_DRAW);for(let t=0;t<this.effect.GetPassCount(e);++t){this.effect.ApplyPass(e,t);const n=this.effect.GetPassInput(e,t);o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(n,4),o.bindBuffer(o.ARRAY_BUFFER,this._instanceBuffer);const r=this._decl.SetPartialDeclaration(n,68,0,1);i.ApplyShadowState(),i.ext.drawArraysInstanced(o.TRIANGLES,0,6,a),this._decl.ResetInstanceDivisors(r)}return!0}},{key:"sprites",get:function(){return this.items},set:function(e){this.items=e}}]),t}();function gn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wn(e,t,n){return t&&_n(e.prototype,t),n&&_n(e,n),e}function En(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?On(e):t}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sn(e,t)}function Sn(e,t){return(Sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function On(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}mn(vn,"Item",bn),mn(vn,"vertexDeclarations",[["TEXCOORD",5,2],["POSITION",0,3],["COLOR",0,3],["TEXCOORD",0,1],["TEXCOORD",1,1],["TEXCOORD",2,1],["TEXCOORD",3,1],["TEXCOORD",4,1]]),mn(vn,"quadVertexDeclarations",[["POSITION",0,3],["TEXCOORD",0,4],["TEXCOORD",1,2],["COLOR",0,4],["COLOR",1,4]]);let An=function(e){function t(){var e;gn(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Pn(On(On(e=En(this,Tn(t).call(this,...i)))),"bone",null),Pn(On(On(e)),"locatorName",null),Pn(On(On(e)),"updateFromLocator",!1),Pn(On(On(e)),"canFireWhenHidden",!1),Pn(On(On(e)),"position",r.H.create()),Pn(On(On(e)),"rotation",r.C.create()),Pn(On(On(e)),"_localTransform",r.z.create()),Pn(On(On(e)),"_localRotation",r.C.create()),e}return Rn(t,ot),wn(t,[{key:"UpdateTransforms",value:function(){r.z.fromRotationTranslation(this._localTransform,this.rotation,this.position),this.bone?(r.z.multiply(this._localTransform,this.bone.offsetTransform,this._localTransform),r.z.getRotation(this._localRotation,this._localTransform)):r.C.copy(this._localRotation,this.rotation)}}],[{key:"create",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new this;return r.F.assignIfExists(t,e,["name","display","locatorName","updateFromLocator","position","rotation","bone","canFireWhenHidden"]),t.UpdateTransforms(),t}}]),t}(),In=function(e){function t(){var e;gn(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Pn(On(On(e=En(this,Tn(t).call(this,...i)))),"visible",{turrets:!0,firingEffects:!0}),Pn(On(On(e)),"activeAnimation",new s.Tw2AnimationController),Pn(On(On(e)),"inactiveAnimation",new s.Tw2AnimationController),Pn(On(On(e)),"geometryResPath",""),Pn(On(On(e)),"geometryResource",null),Pn(On(On(e)),"turretEffect",null),Pn(On(On(e)),"firingEffectResPath",""),Pn(On(On(e)),"firingEffect",null),Pn(On(On(e)),"fireCallback",null),Pn(On(On(e)),"fireCallbackPending",!1),Pn(On(On(e)),"state",t.State.IDLE),Pn(On(On(e)),"bottomClipHeight",0),Pn(On(On(e)),"locatorName",""),Pn(On(On(e)),"sysBoneHeight",0),Pn(On(On(e)),"hasCyclingFiringPos",!1),Pn(On(On(e)),"targetPosition",r.H.create()),Pn(On(On(e)),"parentMatrix",r.z.create()),Pn(On(On(e)),"boundingSphere",r.C.create()),Pn(On(On(e)),"_activeTurret",-1),Pn(On(On(e)),"_recheckTimeLeft",0),Pn(On(On(e)),"_currentCyclingFiresPos",0),Pn(On(On(e)),"_perObjectDataActive",new s.Tw2PerObjectData(t.perObjectData)),Pn(On(On(e)),"_perObjectDataInactive",new s.Tw2PerObjectData(t.perObjectData)),Pn(On(On(e)),"_locatorRebuildPending",!0),e}return Rn(t,at),wn(t,[{key:"Initialize",value:function(){this.turretEffect&&""!==this.geometryResPath&&(this.geometryResource=r.D.GetResource(this.geometryResPath),this.activeAnimation.SetGeometryResource(this.geometryResource),this.inactiveAnimation.SetGeometryResource(this.geometryResource),this.geometryResource&&this.geometryResource.RegisterNotification(this)),""!==this.firingEffectResPath&&r.D.GetObject(this.firingEffectResPath,e=>this.firingEffect=e),this.Rebuild()}},{key:"InitializeFiringEffect",value:function(){if(this.firingEffect&&this.geometryResource&&this.geometryResource.models.length){const e=this.geometryResource.models[0];for(let n=0;n<this.firingEffect.GetPerMuzzleEffectCount();++n)this.firingEffect.SetMuzzleBoneID(n,e.FindBoneByName(t.positionBoneSkeletonNames[n]))}}},{key:"GetClosestTurret",value:function(){let e=-1,n=-2;const i=t.global,o=i.vec3_0,a=i.vec4_0,s=i.vec4_1;for(let t=0;t<this.items.length;++t){const i=this.items[t];if(!i.display&&!i.canFireWhenHidden)continue;s[0]=i._localTransform[12],s[1]=i._localTransform[13],s[2]=i._localTransform[14],s[3]=1,r.I.transformMat4(s,s,this.parentMatrix),r.H.subtract(o,this.targetPosition,s),r.H.normalize(o,o),r.I.set(a,0,1,0,0),r.I.transformMat4(a,a,i._localTransform),r.I.transformMat4(a,a,this.parentMatrix);const u=r.H.dot(a,o);u>n&&(e=this.items.indexOf(i),n=u)}return e}},{key:"EnterStateDeactive",value:function(){this.state!==t.State.INACTIVE&&this.state!==t.State.PACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.activeAnimation.PlayAnimation("Pack",!1,()=>{this.state=t.State.INACTIVE,this.activeAnimation.PlayAnimation("Inactive",!0)}),this.inactiveAnimation.PlayAnimation("Pack",!1,()=>{this.state=t.State.INACTIVE,this.inactiveAnimation.PlayAnimation("Inactive",!0)}),this.state=t.State.PACKING):this.state=t.State.INACTIVE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateIdle",value:function(){this.state!==t.State.IDLE&&this.state!==t.State.UNPACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.FIRING?(this.activeAnimation.PlayAnimation("Active",!0),this.inactiveAnimation.PlayAnimation("Active",!0)):(this.activeAnimation.PlayAnimation("Deploy",!1,()=>{this.state=t.State.IDLE,this.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Deploy",!1,()=>{this.state=t.State.IDLE,this.inactiveAnimation.PlayAnimation("Active",!0)})),this.state=t.State.UNPACKING):this.state=t.State.IDLE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateFiring",value:function(){if(!this.turretEffect||this.state===t.State.FIRING)return t.DoStartFiring(this),void(this.turretEffect&&this.activeAnimation.PlayAnimation("Fire",!1,()=>{this.activeAnimation.PlayAnimation("Active",!0)}));this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.INACTIVE?(this.activeAnimation.PlayAnimation("Deploy",!1,()=>{t.DoStartFiring(this),this.activeAnimation.PlayAnimation("Fire",!1,()=>{this.activeAnimation.PlayAnimation("Active",!0)})}),this.inactiveAnimation.PlayAnimation("Deploy",!1,()=>{this.inactiveAnimation.PlayAnimation("Active",!0)}),this.state=t.State.UNPACKING):(t.DoStartFiring(this),this.activeAnimation.PlayAnimation("Fire",!1,()=>{this.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Active",!0))}},{key:"RebuildCachedData",value:function(){const e=new s.Tw2VertexElement(s.Tw2VertexDeclaration.Type.TEXCOORD,1,r.w.gl.FLOAT,2),n=this.geometryResource.meshes,i=this.activeAnimation,o=this.inactiveAnimation;for(let t=0;t<n.length;++t)n[t].declaration.elements.push(e),n[t].declaration.RebuildHash();switch(this.state){case t.State.INACTIVE:i.PlayAnimation("Inactive",!0),o.PlayAnimation("Inactive",!0);break;case t.State.IDLE:i.PlayAnimation("Active",!0),o.PlayAnimation("Active",!0);break;case t.State.FIRING:i.PlayAnimation("Fire",!1,()=>i.PlayAnimation("Active",!0)),o.PlayAnimation("Active",!0);break;case t.State.PACKING:this.EnterStateIdle();break;case t.State.UNPACKING:this.EnterStateDeactive()}}},{key:"FindItemByLocatorName",value:function(e){for(let t=0;t<this.items.length;t++)if(this.items[t].locatorName===e)return this.items[t];return null}},{key:"UpdateItemsFromLocators",value:function(e){const n=t.global,i=Array.from(this.items),o=n.mat4_0;for(let t=0;t<e.length;t++){const n=e[t],a=n.name,s=n.transform,u=n.bone,l=void 0===u?null:u;let c=this.FindItemByLocatorName(a);c?i.splice(i.indexOf(c),1):c=this.CreateItem({name:a,locatorName:a,updateFromLocator:!0}),c.updateFromLocator&&(c.bone=l,r.z.copy(o,s),r.H.normalize(o.subarray(0,3),o.subarray(0,3)),r.H.normalize(o.subarray(4,7),o.subarray(4,7)),r.H.normalize(o.subarray(8,11),o.subarray(8,11)),r.z.getRotation(c.rotation,o),r.z.getTranslation(c.position,o),c.OnValueChanged())}for(let e=0;e<i.length;e++)i[e].locatorName&&(this.RemoveItem(i[e]),e--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.geometryResource&&!e.includes(this.geometryResource)&&e.push(this.geometryResource),this.turretEffect&&this.turretEffect.GetResources(e),this.firingEffect&&this.firingEffect.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){this.firingEffect&&this.firingEffect.UpdateViewDependentData()}},{key:"Update",value:function(e,n){if(this._rebuildPending&&this.Rebuild(),this.turretEffect&&(this.activeAnimation.Update(e),this.inactiveAnimation.Update(e)),r.z.copy(this.parentMatrix,n),this.firingEffect&&this._visibleItems.length){if(-1!==this._activeTurret){this.firingEffect.isLoopFiring&&this.state===t.State.FIRING&&(this._recheckTimeLeft-=e,this._recheckTimeLeft<=0&&t.DoStartFiring(this));const i=this.items[this._activeTurret];if(this.activeAnimation.models.length){const e=this.activeAnimation.models[0].bonesByName;for(let o=0;o<this.firingEffect.GetPerMuzzleEffectCount();++o){const a=e[t.positionBoneSkeletonNames[o]].worldTransform,s=this.firingEffect.GetMuzzleTransform(o);r.z.multiply(s,i._localTransform,a),r.z.multiply(s,s,n)}}else for(let e=0;e<this.firingEffect.GetPerMuzzleEffectCount();++e)r.z.multiply(this.firingEffect.GetMuzzleTransform(e),n,i._localTransform);if(this.fireCallbackPending){if(this.fireCallback){const e=[];for(let t=0;t<this.firingEffect.GetPerMuzzleEffectCount();++t)e.push(this.firingEffect.GetMuzzleTransform(t));this.fireCallback(this,e)}this.fireCallbackPending=!1}}r.H.copy(this.firingEffect.endPosition,this.targetPosition),this.firingEffect.Update(e)}}},{key:"GetBatches",value:function(e,n,i,o){if(this.turretEffect&&this.geometryResource&&this.display&&this._visibleItems.length){if(e===r.w.RM_OPAQUE&&this.visible.turrets){const r=this.inactiveAnimation.GetBoneMatrices(0);if(0!==r.length){t.UpdatePerObjectData(this,this._perObjectDataInactive.perObjectVSData,r),this._perObjectDataInactive.perObjectPSData=i.perObjectPSData;const o=new s.Tw2ForwardingRenderBatch;if(o.renderMode=e,o.renderActive=!1,o.perObjectData=this._perObjectDataInactive,o.geometryProvider=this,n.Commit(o),this.state===t.State.FIRING){const e=this.activeAnimation.GetBoneMatrices(0);if(0!==e.length){t.UpdatePerObjectData(this,this._perObjectDataActive.perObjectVSData,e,!0),this._perObjectDataActive.perObjectPSData=i.perObjectPSData;const r=new s.Tw2ForwardingRenderBatch;r.renderActive=!0,r.perObjectData=this._perObjectDataActive,r.geometryProvider=this,n.Commit(r)}}}}this.GetFiringEffectBatches(e,n,i,o)}}},{key:"GetFiringEffectBatches",value:function(e,t,n,r){this.firingEffect&&this.display&&this._visibleItems.length&&this.visible.firingEffects&&!r&&this.firingEffect.GetBatches(e,t,n)}},{key:"Render",value:function(e,n){if(!this.turretEffect||!this.turretEffect.IsGood()||!this._visibleItems.length)return!1;let i=0;const o=function(e){r.w.gl.disableVertexAttribArray(e.location),r.w.gl.vertexAttrib2f(e.location,i,i)};for(let e=0;e<this.geometryResource.meshes.length;++e){this.geometryResource.meshes[e].declaration.FindUsage(s.Tw2VertexDeclaration.Type.TEXCOORD,1).customSetter=o}let a=0;for(;i<this.items.length;++i)if(this.items[i].display){const r=this.state===t.State.FIRING&&i===this._activeTurret;e.renderActive===r&&(this.geometryResource.RenderAreas(0,0,1,this.turretEffect,n),a++)}return!!a}},{key:"turrets",get:function(){return this.items},set:function(e){this.items=e}}],[{key:"RebuildItems",value:function(e){e._visibleItems=[];for(let t=0;t<e.items.length;t++){const n=e.items[t];n._onModified=e._onChildModified,n.display&&(e._visibleItems.push(n),n._rebuildPending&&(n.UpdateTransforms(),n._rebuildPending=!1))}}},{key:"UpdatePerObjectData",value:function(e,n,i,o){r.z.transpose(n.Get("shipMatrix"),e.parentMatrix);const a=i.length/12;n.Get("turretSetData")[0]=a,n.Get("baseCutoffData")[0]=e.bottomClipHeight;const s=n.Get("turretTranslation"),u=n.Get("turretRotation"),l=n.Get("turretPoseTransAndRot");for(let n=0;n<e._visibleItems.length;++n){const r=e._visibleItems[n];for(let e=0;e<a;++e)l[2*(n*a+e)*4]=i[12*e+3],l[2*(n*a+e)*4+1]=i[12*e+7],l[2*(n*a+e)*4+2]=i[12*e+11],l[2*(n*a+e)*4+3]=1,t.mat3x4toquat(i,e,l,2*(n*a+e)+1);r.bone&&!o&&r.UpdateTransforms(),s[4*n]=r._localTransform[12],s[4*n+1]=r._localTransform[13],s[4*n+2]=r._localTransform[14],s[4*n+3]=1,u[4*n]=r.rotation[0],u[4*n+1]=r.rotation[1],u[4*n+2]=r.rotation[2],u[4*n+3]=r.rotation[3]}}},{key:"DoStartFiring",value:function(e){e.hasCyclingFiringPos&&(e._currentCyclingFiresPos=1-e._currentCyclingFiresPos),e.firingEffect&&e.firingEffect.PrepareFiring(0,e.hasCyclingFiringPos?e._currentCyclingFiresPos:-1),e._activeTurret=e.GetClosestTurret(),e.state=t.State.FIRING,e._recheckTimeLeft=2,e.fireCallback&&(e.fireCallbackPending=!0)}}]),t}();function Cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pn(In,"Item",An),Pn(In,"State",{INACTIVE:0,IDLE:1,FIRING:2,PACKING:2,UNPACKING:4}),Pn(In,"worldNames",["turretWorld0","turretWorld1","turretWorld2"]),Pn(In,"positionBoneSkeletonNames",["Pos_Fire01","Pos_Fire02","Pos_Fire03","Pos_Fire04","Pos_Fire05","Pos_Fire06","Pos_Fire07","Pos_Fire08"]),Pn(In,"perObjectData",{VSData:[["baseCutoffData",4],["turretSetData",4],["shipMatrix",16],["turretTranslation",96],["turretRotation",96],["turretPoseTransAndRot",576]]}),Pn(In,"mat3x4toquat",function(){let e,t;return function(n,i,o,a){e||(e=r.z.create(),t=r.C.create()),i*=12,a*=4,e[0]=n[i],e[1]=n[i+4],e[2]=n[i+8],e[3]=0,e[4]=n[i+1],e[5]=n[i+5],e[6]=n[i+9],e[7]=0,e[8]=n[i+2],e[9]=n[i+6],e[10]=n[i+10],e[11]=0,e[12]=n[i+3],e[13]=n[i+7],e[14]=n[i+11],e[15]=1,r.z.getRotation(t,e),o[a]=t[0],o[a+1]=t[1],o[a+2]=t[2],o[a+3]=t[3]}}());let Dn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=r.F.generateID(),this.name="",this.display=!0,this.visible={},this.visible.lensflares=!0,this.visible.objects=!0,this.visible.planets=!0,this.visible.fog=!0,this.visible.clearColor=!0,this.visible.environmentReflection=!0,this.visible.environmentDiffuse=!0,this.visible.environmentBlur=!0,Object.defineProperty(this.visible,"environment",{get:()=>this.backgroundRenderingEnabled,set:e=>{this.backgroundRenderingEnabled=e?1:0}}),this.lensflares=[],this.objects=[],this.planets=[],this.nebulaIntensity=1,this.ambientColor=r.C.fromValues(.25,.25,.25,1),this.backgroundEffect=null,this.backgroundRenderingEnabled=1,this.clearColor=r.I.fromValues(0,0,0,0),this.lodEnabled=!1,this.fogStart=0,this.fogEnd=0,this.fogMax=0,this.fogType=0,this.fogBlur=0,this.fogColor=r.I.fromValues(.25,.25,.25,1),this.sunDirection=r.H.fromValues(1,-1,1),this.sunDiffuseColor=r.I.fromValues(1,1,1,1),this.envMapScaling=r.H.fromValues(1,1,1),this.envMapRotation=r.C.create(),this.envMapResPath="",this.envMap1ResPath="",this.envMap2ResPath="",this.envMap3ResPath="",this.envMapRes=null,this.envMap1Res=null,this.envMap2Res=null,this.envMap3Res=null,this.renderDebugInfo=!1,this._debugHelper=null,this._batches=new s.Tw2BatchAccumulator,this._perFrameVS=new s.Tw2RawData(e.perFrameData.VSData),this._perFramePS=new s.Tw2RawData(e.perFrameData.PSData),e.init()}var t,n,i;return t=e,i=[{key:"init",value:function(){e.global||(e.global={vec3_0:r.H.create(),vec4_0:r.I.create(),mat4_0:r.z.create(),mat4_1:r.z.create(),mat4_2:r.z.create(),mat4_ID:r.z.create(),frustum:new s.Tw2Frustum,emptyTexture:r.D.GetResource("res:/texture/global/black.dds.0.png")})}}],(n=[{key:"Initialize",value:function(){this.SetEnvMapPath(0,this.envMapResPath),this.SetEnvMapPath(1,this.envMap1ResPath),this.SetEnvMapPath(2,this.envMap2ResPath),this.SetEnvMapPath(3,this.envMap3ResPath)}},{key:"SetEnvMapReflection",value:function(e){this.SetEnvMapPath(0,e)}},{key:"SetEnvMapDiffuse",value:function(e){this.SetEnvMapPath(1,e)}},{key:"SetEnvMapBlur",value:function(e){this.SetEnvMapPath(2,e)}},{key:"SetEnvMapPath",value:function(e,t){const n=(e,t,n)=>(e=e.toLowerCase(),this[t]=e,this[n]=""===e?null:r.D.GetResource(e),!0);switch(e){case 0:return n(t,"envMapResPath","envMapRes");case 1:return n(t,"envMap1ResPath","envMap1Res");case 2:return n(t,"envMap2ResPath","envMap2Res");case 3:return n(t,"envMap3ResPath","envMap3Res")}return!1}},{key:"EnableLod",value:function(e){if(this.lodEnabled=e,!e)for(let e=0;e<this.objects.length;++e)this.objects[e].ResetLod&&this.objects[e].ResetLod()}},{key:"KeepAlive",value:function(){const e=this.GetResources();for(let t=0;t<e.length;t++)e[t].KeepAlive()}},{key:"GetResources",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(let t=0;t<this.lensflares.length;t++)this.lensflares[t].GetResources(e);if(this.backgroundEffect&&this.backgroundEffect.GetResources(e),this.envMapRes&&!e.includes(this.envMapRes)&&e.push(this.envMapRes),this.envMap1Res&&!e.includes(this.envMap1Res)&&e.push(this.envMapRes),this.envMap2Res&&!e.includes(this.envMap2Res)&&e.push(this.envMapRes),this.envMap3Res&&!e.includes(this.envMap3Res)&&e.push(this.envMapRes),!t){for(let t=0;t<this.planets.length;t++)this.planets[t].GetResources(e);for(let t=0;t<this.objects.length;t++)"GetResources"in this.objects[t]&&this.objects[t].GetResources(e)}return e}},{key:"Update",value:function(e){for(let t=0;t<this.planets.length;++t)"Update"in this.planets[t]&&this.planets[t].Update(e);for(let t=0;t<this.objects.length;++t)"Update"in this.objects[t]&&this.objects[t].Update(e)}},{key:"RenderBatches",value:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._batches;for(let r=0;r<t.length;++r)"GetBatches"in t[r]&&t[r].GetBatches(e,n)}},{key:"Render",value:function(){this.ApplyPerFrameData();const t=r.w,n=e.global,i=r.z.identity(n.mat4_ID),o=this.visible;if(o.environment&&this.backgroundEffect&&(t.SetStandardStates(t.RM_FULLSCREEN),t.RenderCameraSpaceQuad(this.backgroundEffect)),o.planets&&this.planets.length){const e=r.z.copy(n.mat4_0,t.projection),o=r.z.copy(n.mat4_1,t.projection),a=1e4,s=1e11;o[10]=s/(a-s),o[14]=s*a/(a-s),t.SetProjection(o,!0),this.ApplyPerFrameData();for(let e=0;e<this.planets.length;++e)this.planets[e].UpdateViewDependentData&&this.planets[e].UpdateViewDependentData(i);this._batches.Clear(),t.gl.depthRange(.9,1),this.RenderBatches(t.RM_OPAQUE,this.planets),this.RenderBatches(t.RM_DECAL,this.planets),this.RenderBatches(t.RM_TRANSPARENT,this.planets),this.RenderBatches(t.RM_ADDITIVE,this.planets),this._batches.Render(),t.SetProjection(e,!0),this.ApplyPerFrameData(),t.gl.depthRange(0,.9)}if(this.lodEnabled){n.frustum.Initialize(t.view,t.projection,t.viewportWidth,t.viewInverse,t.viewProjection);for(let e=0;e<this.objects.length;++e)this.objects[e].UpdateLod&&this.objects[e].UpdateLod(n.frustum)}if(o.objects)for(let e=0;e<this.objects.length;++e)this.objects[e].UpdateViewDependentData&&this.objects[e].UpdateViewDependentData(i);if(o.lensflares)for(let e=0;e<this.lensflares.length;++e)this.lensflares[e].PrepareRender();if(this._batches.Clear(),o.planets)for(let e=0;e<this.planets.length;++e)this.planets[e].GetZOnlyBatches(t.RM_OPAQUE,this._batches);if(o.objects&&(this.RenderBatches(t.RM_OPAQUE,this.objects),this.RenderBatches(t.RM_DECAL,this.objects),this.RenderBatches(t.RM_TRANSPARENT,this.objects),this.RenderBatches(t.RM_ADDITIVE,this.objects)),o.lensflares)for(let e=0;e<this.lensflares.length;++e)this.lensflares[e].GetBatches(t.RM_ADDITIVE,this._batches);if(this._batches.Render(),o.lensflares)for(let e=0;e<this.lensflares.length;++e)this.lensflares[e].UpdateOccluders();if(this.renderDebugInfo&&e.DebugRenderer){this._debugHelper||(this._debugHelper=new e.DebugRenderer);for(let e=0;e<this.objects.length;++e)this.objects[e].RenderDebugInfo&&this.objects[e].RenderDebugInfo(this._debugHelper);this._debugHelper.Render()}}},{key:"ApplyPerFrameData",value:function(){const t=r.w,n=e.global,i=n.mat4_2,o=n.vec3_0,a=this.visible;r.z.fromQuat(i,this.envMapRotation),r.z.scale(i,i,this.envMapScaling),r.z.transpose(i,i),r.H.negate(o,this.sunDirection),r.H.normalize(o,o);let s=this.fogEnd-this.fogStart;Math.abs(s)<1e-5&&(s=1e-5);const u=1/s,l=this._perFrameVS;l.Set("FogFactors",[this.fogEnd*u,u,this.visible.fog?this.fogMax:0,1]),l.Set("ViewportAdjustment",[1,1,1,1]),l.Set("MiscSettings",[t.currentTime,0,t.viewportWidth,t.viewportHeight]),l.Set("SunData.DirWorld",o),l.Set("SunData.DiffuseColor",this.sunDiffuseColor),l.Set("TargetResolution",t.targetResolution),l.Set("ViewInverseTransposeMat",t.viewInverse),l.Set("ViewProjectionMat",t.viewProjectionTranspose),l.Set("ViewMat",t.viewTranspose),l.Set("ProjectionMat",t.projectionTranspose),l.Set("EnvMapRotationMat",i),t.perFrameVSData=l;const c=this._perFramePS;c.Set("ViewInverseTransposeMat",t.viewInverse),c.Set("ViewMat",t.viewTranspose),c.Set("EnvMapRotationMat",i),c.Set("SunData.DirWorld",o),c.Set("SunData.DiffuseColor",this.sunDiffuseColor),c.Set("SceneData.AmbientColor",this.ambientColor),c.Set("MiscSettings",[t.currentTime,this.fogType,this.fogBlur,1]),c.Set("SceneData.FogColor",this.fogColor),c.Set("FovXY",[t.targetResolution[3],t.targetResolution[2]]),c.Set("ShadowMapSettings",[1,1,0,0]),c.Set("TargetResolution",t.targetResolution),c.Get("SceneData.NebulaIntensity")[0]=this.nebulaIntensity,c.Get("ViewportSize")[0]=t.viewportWidth,c.Get("ViewportSize")[1]=t.viewportHeight,c.Get("ShadowCameraRange")[0]=1,c.Get("ProjectionToView")[0]=-t.projection[14],c.Get("ProjectionToView")[1]=-t.projection[10]-1,t.perFramePSData=c;const f=this.envMapRes&&a.environmentReflection?this.envMapRes:n.emptyTexture,h=this.envMap1Res&&a.environmentDiffuse?this.envMap1Res:n.emptyTexture,d=this.envMap2Res&&a.environmentBlur?this.envMap2Res:n.emptyTexture,p=this.envMap3Res?this.envMap3Res:n.emptyTexture;r.E.GetVariable("EveSpaceSceneEnvMap").SetTextureRes(f),r.E.GetVariable("EnvMap1").SetTextureRes(h),r.E.GetVariable("EnvMap2").SetTextureRes(d),r.E.GetVariable("EnvMap3").SetTextureRes(p)}}])&&Cn(t.prototype,n),i&&Cn(t,i),e}();Mn(Dn,"perFrameData",{PSData:[["ViewInverseTransposeMat",16],["ViewMat",16],["EnvMapRotationMat",16],["SunData.DirWorld",4],["SunData.DiffuseColor",4],["SceneData.AmbientColor",3],["SceneData.NebulaIntensity",1],["SceneData.FogColor",4],["ViewportOffset",2],["ViewportSize",2],["TargetResolution",4],["ShadowMapSettings",4],["ShadowCameraRange",4],["ProjectionToView",2],["FovXY",2],["MiscSettings",4]],VSData:[["ViewInverseTransposeMat",16],["ViewProjectionMat",16],["ViewMat",16],["ProjectionMat",16],["ShadowViewMat",16],["ShadowViewProjectionMat",16],["EnvMapRotationMat",16],["SunData.DirWorld",4],["SunData.DiffuseColor",4],["FogFactors",4],["TargetResolution",4],["ViewportAdjustment",4],["MiscSettings",4]]}),Mn(Dn,"global",null),Mn(Dn,"DebugRenderer",window.Tw2DebugRenderer||null);var kn=n(12);function xn(){var e=null,t=null;function n(e,t,n){return t in e?e[t]:n}function i(t){return n(e.generic,t?"shaderPrefixAnimated":"shaderPrefix","")}function o(e,t,r,i,o){var a=null;if(n(i,"resPathInsert","").length&&(a=i.resPathInsert),"respathinsert"in o&&1===o.respathinsert.length){if("none"===o.respathinsert[0])return e;a=o.respathinsert[0]}if("MaterialMap"===t||"PaintMaskMap"===t||"PmdgMap"===t){var s=e.lastIndexOf("/"),u=e;if(s>=0&&(u=e.substr(0,s+1)+a+"/"+e.substr(s+1)),(s=u.lastIndexOf("_"))>=0){u=u.substr(0,s)+"_"+a+u.substr(s);var l=n(r,"textureOverrides",{});if(t in l&&i.name in l[t])return u}}return e}function a(e,t){for(var n=0;n<e.length;++n)if(t.substr(0,e[n].length)===e[n])return n;return null}function u(t,r,i,o){var s,u,l,c;return"mesh"in i&&null!==(u=a(s=e.generic.materialPrefixes,t))&&u<i.mesh.length&&0==(n(r,"blockedMaterials",0)&1<<u)&&(l=n(e.material,i.mesh[u],null))?(c=t.substr(s[u].length),n(l.parameters,c,void 0)):(u=a(s=e.generic.patternMaterialPrefixes,t),"pattern"in i&&null!==u&&1+u<i.pattern.length&&(l=n(e.material,i.pattern[1+u],null))?(c=t.substr(s[u].length),n(l.parameters,c,void 0)):null!==u&&(l=n(e.material,o.defaultPatternLayer1MaterialName,null))?(c=t.substr(s[u].length),n(l.parameters,c,void 0)):void 0)}function l(e){switch(e){case 2:return 4;case 1:return 3;default:return 1}}function c(t,r,a,c,f,h,d,p){for(var m,y,b,v,g=n(a,r,[]),_=0;_<g.length;++_){var w=g[_],E=new s.Tw2Effect;E.effectFilePath=e.generic.areaShaderLocation+(m=p||w.shader,y=a.isSkinned,b=void 0,v=void 0,b=i(y),v=(m="/"+m).lastIndexOf("/"),m.substr(0,v+1)+b+m.substr(v+1));for(var T=n(n(e.generic.areaShaders,w.shader,{}),"parameters",[]),R=0;R<T.length;++R){var S=T[R],O=u(S,w,d,f);(O=(O=(O=(O=O||n(n(n(e.generic.hullAreas,w.name,{}),"parameters",{}),S))||n(n(n(f.hullAreas,w.name,{}),"parameters",{}),S))||n(n(n(c.areas,w.name,{}),"parameters",{}),S))||n(n(w,"parameters",{}),S))&&(E.parameters[S]=new s.Tw2Vector4Parameter(S,O))}var P=n(w,"textures",[]);for(R in P)if(P.hasOwnProperty(R)){var A=P[R];A=o(A,R,w,c,d),E.parameters[R]=new s.Tw2TextureParameter(R,A)}for(R=0;R<h.layers.length;++R)if(h.layers[R]&&!(h.layers[R].textureName in E.parameters)){var I=new s.Tw2TextureParameter(h.layers[R].textureName);I.resourcePath=h.layers[R].textureResFilePath,I.useAllOverrides=!0,I.addressUMode=l(n(h.layers[R],"projectionTypeU",0)),I.addressVMode=l(n(h.layers[R],"projectionTypeV",0)),I.Initialize(),E.parameters[h.layers[R].textureName]=I}var C=n(n(e.generic.areaShaders,w.shader,{}),"defaultTextures",{});for(var M in C)C.hasOwnProperty(M)&&(M in E.parameters||(E.parameters[M]=new s.Tw2TextureParameter(M,C[M])));E.Initialize();var D=new s.Tw2MeshArea;D.name=w.name,D.effect=E,D.index=n(w,"index",0),D.count=n(w,"count",1),t.push(D)}}function f(e,t,n){n in t&&(e[n]=t[n])}function h(e,t,i,o){function a(t){return function(a){a.isEffectChild?e.effectChildren.push(a):e.children.push(a),r.H.copy(a.translation,n(t,"translation",[0,0,0])),r.C.copy(a.rotation,n(t,"rotation",[0,0,0,1])),r.H.copy(a.scaling,n(t,"scaling",[1,1,1]));var u=n(t,"id",-1);-1!==u&&o[u]&&function e(t,n,i){if(Array.isArray(t.particleEmitters)){for(var o=0;o<t.particleEmitters.length;++o)if("rate"in t.particleEmitters[o]){var a=new s.Tw2ValueBinding;a.sourceObject=i,a.sourceAttribute="currentValue",a.destinationObject=t.particleEmitters[o],a.destinationAttribute="rate",a.Initialize(),n.bindings.push(a)}for(o=0;o<t.children.length;++o)e(t.children[o],n,i)}else r.D.log({type:"warning",name:"Space object factory",message:`Unable to bind particle emitters: ${t.constructor.name}`})}(a,i,o[u])}}const u=n(t,"children",[]);for(let e=0;e<u.length;++e){const n=u[e].redFilePath;n?r.D.GetObject(n,a(u[e])):r.D.log({type:"warning",name:"Space object factory",message:`No resource path found for "${t.name}" child at index ${e}`})}}var d=!1,p=[];function m(o){for(var a=o.split(":"),u={},l=3;l<a.length;++l){var d=a[l].split("?");u[d[0]]=d[1].split(";")}var p=e.hull[a[0]],m=e.faction[a[1]],y=e.race[a[2]],b=new(2===n(p,"buildClass",0)?_e:et),v=function(t,r,i){var o={patterns:[],layers:[]};if("pattern"in i){for(var a={},s=0;s<e.pattern.length;++s)if(e.pattern[s].name===i.pattern[0]){a=e.pattern[s];break}var u=n(a,"layer1",null);u&&o.layers.push(u),(u=n(a,"layer2",null))&&o.layers.push(u);for(var l=n(a,"projections",[]),c=0;c<l.length;++c)l[c].name===t.name&&((u=n(a=l[c],"transformLayer1",null))&&o.patterns.push(u),(u=n(a,"transformLayer2",null))&&o.patterns.push(u))}else n(t,"defaultPattern")&&(a=n(t,"defaultPattern",{}),(u=n(a,"transformLayer1",null))&&o.patterns.push(u),(u=n(a,"transformLayer2",null))&&o.patterns.push(u),a=n(r,"defaultPattern",{}),(u=n(a,"layer1",null))&&o.layers.push(u),(u=n(a,"layer2",null))&&o.layers.push(u));return o}(p,y,u);!function(e,t,r,i,o,a){var u=new s.Tw2Mesh;u.geometryResPath=t.geometryResFilePath,e.boundingSphereCenter[0]=t.boundingSphere[0],e.boundingSphereCenter[1]=t.boundingSphere[1],e.boundingSphereCenter[2]=t.boundingSphere[2],e.boundingSphereRadius=t.boundingSphere[3],c(n(u,"opaqueAreas",[]),"opaqueAreas",t,r,i,a,o),c(n(u,"transparentAreas",[]),"transparentAreas",t,r,i,a,o),c(n(u,"additiveAreas",[]),"additiveAreas",t,r,i,a,o),c(n(u,"decalAreas",[]),"decalAreas",t,r,i,a,o),c(n(u,"depthAreas",[]),"depthAreas",t,r,i,a,o),u.Initialize(),e.mesh=u,"shapeEllipsoidCenter"in t&&(e.shapeEllipsoidCenter=t.shapeEllipsoidCenter),"shapeEllipsoidRadius"in t&&(e.shapeEllipsoidRadius=t.shapeEllipsoidRadius)}(b,p,m,y,u,v),function(e,t){for(var i=0;i<t.patterns.length;++i)if(t.patterns[i]&&t.layers[i]){var o=t.patterns[i],a=t.layers[i];e.AddCustomMask(n(o,"position",r.H.create()),n(o,"scaling",r.H.fromValues(1,1,1)),n(o,"rotation",r.C.create()),n(o,"isMirrored",!1),n(a,"materialSource",0),r.I.fromValues(n(a,"isTargetMtl1",!0)?1:0,n(a,"isTargetMtl2",!0)?1:0,n(a,"isTargetMtl3",!0)?1:0,n(a,"isTargetMtl4",!0)?1:0))}}(b,v),function(t,o,a){for(var u=n(o,"hullDecals",[]),l=0;l<u.length;++l){var c=u[l],f=null,h="group"+n(c,"groupIndex",-1);if(a.decals&&h in a.decals&&(f=a.decals[h]),!f||f.isVisible){var d=new s.Tw2Effect;if(f&&f.shader&&f.shader.length)d.effectFilePath=e.generic.decalShaderLocation+"/"+i(!1)+f.shader;else{if(!c.shader||!c.shader.length)continue;d.effectFilePath=e.generic.decalShaderLocation+"/"+i(!1)+c.shader}var p=n(c,"parameters",{});for(var m in p)p.hasOwnProperty(m)&&(d.parameters[m]=new s.Tw2Vector4Parameter(m,p[m]));var y=n(c,"textures",{});for(m in y)y.hasOwnProperty(m)&&(d.parameters[m]=new s.Tw2TextureParameter(m,y[m]));if(f){var b=n(f,"parameters",{});for(m in b)b.hasOwnProperty(m)&&(d.parameters[m]=new s.Tw2Vector4Parameter(m,b[m]));var v=n(f,"textures",{});for(m in v)!v.hasOwnProperty(m)||m in d.parameters||(d.parameters[m]=new s.Tw2TextureParameter(m,v[m]))}var g=n(n(e.generic.decalShaders,c.shader,{}),"defaultTextures",{});for(var _ in g)g.hasOwnProperty(_)&&(_ in d.parameters||(d.parameters[_]=new s.Tw2TextureParameter(_,g[_])));d.Initialize();var w=new Yt;r.H.copy(w.position,n(c,"position",[0,0,0])),r.C.copy(w.rotation,n(c,"rotation",[0,0,0,1])),r.H.copy(w.scaling,n(c,"scaling",[1,1,1])),w.parentBoneIndex=n(c,"boneIndex",-1),w.indexBuffer=new Uint16Array(c.indexBuffer),w.decalEffect=d,w.name=n(u[l],"name",""),"groupIndex"in u[l]&&(w.groupIndex=u[l].groupIndex),w.Initialize(),t.decals.push(w)}}}(b,p,m),function(e,i,o){for(var a=n(i,"spriteSets",[]),s=n(o,"spriteSets",{}),u=0;u<a.length;++u){var l=new vn(!0,!(!i.isSkinned||!a[u].skinned));l.name=n(a[u],"name",""),l.effect=t;for(var c=n(a[u],"items",[]),f=0;f<c.length;++f)if("group"+n(c[f],"groupIndex",-1)in s){var h=new bn;h.blinkPhase=n(c[f],"blinkPhase",0),h.blinkRate=n(c[f],"blinkRate",.1),h.boneIndex=n(c[f],"boneIndex",0),h.falloff=n(c[f],"falloff",0),h.maxScale=n(c[f],"maxScale",10),h.minScale=n(c[f],"minScale",1),h.name=n(c[f],"name",""),h.groupIndex=n(c[f],"groupIndex",-1),r.H.copy(h.position,n(c[f],"position",[0,0,0]));var d=s["group"+h.groupIndex];d&&(h.groupName=d.name,"color"in d&&r.I.copy(h.color,d.color)),l.sprites.push(h)}l.Initialize(),e.spriteSets.push(l)}}(b,p,m),function(e,t,i){for(var o=n(t,"spotlightSets",[]),a=n(i,"spotlightSets",{}),u=0;u<o.length;++u){var l=new an;l.name=n(o[u],"name",""),l.coneEffect=new s.Tw2Effect,l.glowEffect=new s.Tw2Effect,o[u].skinned?(l.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightcone.fx",l.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightglow.fx"):(l.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightcone.fx",l.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightglow.fx"),l.coneEffect.parameters.TextureMap=new s.Tw2TextureParameter("TextureMap",o[u].coneTextureResPath),l.glowEffect.parameters.TextureMap=new s.Tw2TextureParameter("TextureMap",o[u].glowTextureResPath),l.coneEffect.parameters.zOffset=new s.Tw2FloatParameter("zOffset",n(o[u],"zOffset",0)),l.coneEffect.Initialize(),l.glowEffect.Initialize();for(var c=n(o[u],"items",[]),f=0;f<c.length;++f){var h=new on;h.name=n(c[f],"name",""),h.groupIndex=n(c[f],"groupIndex",-1),h.boneIndex=n(c[f],"boneIndex",0),h.boosterGainInfluence=n(c[f],"boosterGainInfluence",0),h.coneIntensity=n(c[f],"coneIntensity",0),h.spriteIntensity=n(c[f],"spriteIntensity",0),h.flareIntensity=n(c[f],"flareIntensity",0);var d=a["group"+h.groupIndex];d&&(r.I.copy(h.coneColor,n(d,"coneColor",[0,0,0,0])),r.I.copy(h.spriteColor,n(d,"spriteColor",[0,0,0,0])),r.I.copy(h.flareColor,n(d,"flareColor",[0,0,0,0]))),r.H.copy(h.spriteScale,n(c[f],"spriteScale",[1,1,1])),"transform"in c[f]?r.z.copy(h.transform,c[f].transform):r.z.identity(h.transform),l.spotlightItems.push(h)}l.Initialize(),e.spotlightSets.push(l)}}(b,p,m),function(e,t,i){for(var o=n(t,"planeSets",[]),a=n(i,"planeSets",{}),u=0;u<o.length;++u){var l=new zt;l.name=n(o[u],"name",""),l.effect=new s.Tw2Effect,o[u].skinned?l.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_planeglow.fx":l.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/planeglow.fx",l.effect.parameters.Layer1Map=new s.Tw2TextureParameter("Layer1Map",o[u].layer1MapResPath),l.effect.parameters.Layer2Map=new s.Tw2TextureParameter("Layer2Map",o[u].layer2MapResPath),l.effect.parameters.MaskMap=new s.Tw2TextureParameter("MaskMap",o[u].maskMapResPath),l.effect.parameters.PlaneData=new s.Tw2Vector4Parameter("PlaneData",n(o[u],"planeData",[1,0,0,0])),l.effect.Initialize();for(var c=n(o[u],"items",[]),h=0;h<c.length;++h){var d=new Ht;f(d,c[h],"groupIndex"),f(d,c[h],"name"),d.boneIndex=n(c[h],"boneIndex",-1),d.maskAtlasID=n(c[h],"maskMapAtlasIndex",0),r.H.copy(d.position,n(c[h],"position",[0,0,0])),r.C.copy(d.rotation,n(c[h],"rotation",[0,0,0,1])),r.H.copy(d.scaling,n(c[h],"scaling",[1,1,1])),r.I.copy(d.color,n(c[h],"color",[0,0,0,0])),r.I.copy(d.layer1Transform,n(c[h],"layer1Transform",[0,0,0,0])),r.I.copy(d.layer1Scroll,n(c[h],"layer1Scroll",[0,0,0,0])),r.I.copy(d.layer2Transform,n(c[h],"layer2Transform",[0,0,0,0])),r.I.copy(d.layer2Scroll,n(c[h],"layer2Scroll",[0,0,0,0]));var p=a["group"+n(c[h],"groupIndex",-1)];p&&r.I.copy(d.color,n(p,"color",[0,0,0,0])),l.planes.push(d)}l.Initialize(),e.planeSets.push(l)}}(b,p,m),function(e,t,i){if("booster"in t){var o=new vt,a=t.booster,u=n(i,"booster",{});f(o,u,"glowScale"),f(o,u,"symHaloScale"),f(o,u,"haloScaleX"),f(o,u,"haloScaleY"),f(o,u,"haloColor"),r.I.copy(o.glowColor,n(u,"glowColor",[0,0,0,0])),r.I.copy(o.warpGlowColor,n(u,"warpGlowColor",[0,0,0,0])),r.I.copy(o.warpHaloColor,n(u,"warpHalpColor",[0,0,0,0])),r.I.copy(o.trailColor,n(u,"trailColor",[0,0,0,0])),r.I.copy(o.trailSize,n(u,"trailSize",[0,0,0,0])),o.effect=new s.Tw2Effect,o.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterVolumetric.fx",o.effect.parameters.NoiseFunction0=new s.Tw2FloatParameter("NoiseFunction0",n(u.shape0,"noiseFunction",0)),o.effect.parameters.NoiseSpeed0=new s.Tw2FloatParameter("NoiseSpeed0",n(u.shape0,"noiseSpeed",0)),o.effect.parameters.NoiseAmplitudeStart0=new s.Tw2Vector4Parameter("NoiseAmplitudeStart0",n(u.shape0,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.NoiseAmplitudeEnd0=new s.Tw2Vector4Parameter("NoiseAmplitudeEnd0",n(u.shape0,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.NoiseFrequency0=new s.Tw2Vector4Parameter("NoiseFrequency0",n(u.shape0,"noiseFrequency",[0,0,0,0])),o.effect.parameters.Color0=new s.Tw2Vector4Parameter("Color0",n(u.shape0,"color",[0,0,0,0])),o.effect.parameters.NoiseFunction1=new s.Tw2FloatParameter("NoiseFunction1",n(u.shape1,"noiseFunction",0)),o.effect.parameters.NoiseSpeed1=new s.Tw2FloatParameter("NoiseSpeed1",n(u.shape1,"noiseSpeed",0)),o.effect.parameters.NoiseAmplitudeStart1=new s.Tw2Vector4Parameter("NoiseAmplitudeStart1",n(u.shape1,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.NoiseAmplitudeEnd1=new s.Tw2Vector4Parameter("NoiseAmplitudeEnd1",n(u.shape1,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.NoiseFrequency1=new s.Tw2Vector4Parameter("NoiseFrequency1",n(u.shape1,"noiseFrequency",[0,0,0,0])),o.effect.parameters.Color1=new s.Tw2Vector4Parameter("Color1",n(u.shape1,"color",[0,0,0,0])),o.effect.parameters.WarpNoiseFunction0=new s.Tw2FloatParameter("WarpNoiseFunction0",n(u.warpShape0,"noiseFunction",0)),o.effect.parameters.WarpNoiseSpeed0=new s.Tw2FloatParameter("WarpNoiseSpeed0",n(u.warpShape0,"noiseSpeed",0)),o.effect.parameters.WarpNoiseAmplitudeStart0=new s.Tw2Vector4Parameter("WarpNoiseAmplitudeStart0",n(u.warpShape0,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.WarpNoiseAmplitudeEnd0=new s.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd0",n(u.warpShape0,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.WarpNoiseFrequency0=new s.Tw2Vector4Parameter("WarpNoiseFrequency0",n(u.warpShape0,"noiseFrequency",[0,0,0,0])),o.effect.parameters.WarpColor0=new s.Tw2Vector4Parameter("WarpColor0",n(u.warpShape0,"color",[0,0,0,0])),o.effect.parameters.WarpNoiseFunction1=new s.Tw2FloatParameter("WarpNoiseFunction1",n(u.warpShape1,"noiseFunction",0)),o.effect.parameters.WarpNoiseSpeed1=new s.Tw2FloatParameter("WarpNoiseSpeed1",n(u.warpShape1,"noiseSpeed",0)),o.effect.parameters.WarpNoiseAmplitudeStart1=new s.Tw2Vector4Parameter("WarpNoiseAmplitudeStart1",n(u.warpShape1,"noiseAmplitureStart",[0,0,0,0])),o.effect.parameters.WarpNoiseAmplitudeEnd1=new s.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd1",n(u.warpShape1,"noiseAmplitureEnd",[0,0,0,0])),o.effect.parameters.WarpNoiseFrequency1=new s.Tw2Vector4Parameter("WarpNoiseFrequency1",n(u.warpShape1,"noiseFrequency",[0,0,0,0])),o.effect.parameters.WarpColor1=new s.Tw2Vector4Parameter("WarpColor1",n(u.warpShape1,"color",[0,0,0,0])),o.effect.parameters.ShapeAtlasSize=new s.Tw2Vector4Parameter("ShapeAtlasSize",[n(u,"shapeAtlasHeight",0),n(u,"shapeAtlasCount",0),0,0]),o.effect.parameters.BoosterScale=new s.Tw2Vector4Parameter("BoosterScale",n(u,"scale",[1,1,1,1])),o.effect.parameters.ShapeMap=new s.Tw2TextureParameter("ShapeMap",u.shapeAtlasResPath),o.effect.parameters.GradientMap0=new s.Tw2TextureParameter("GradientMap0",u.gradient0ResPath),o.effect.parameters.GradientMap1=new s.Tw2TextureParameter("GradientMap1",u.gradient1ResPath),o.effect.parameters.NoiseMap=new s.Tw2TextureParameter("ShapeMap","res:/Texture/Global/noise32cube_volume.dds.0.png"),o.effect.Initialize(),o.glows=new vn(!0),o.glows.effect=new s.Tw2Effect,o.glows.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterGlowAnimated.fx",o.glows.effect.parameters.DiffuseMap=new s.Tw2TextureParameter("DiffuseMap","res:/Texture/Particle/whitesharp.dds.0.png"),o.glows.effect.parameters.NoiseMap=new s.Tw2TextureParameter("NoiseMap","res:/Texture/global/noise.dds.0.png"),o.glows.effect.Initialize();for(var l=n(a,"items",[]),c=0;c<l.length;++c){var h=new Dt;h.name="locator_booster_"+(c+1),"transform"in l[c]?r.z.copy(h.transform,l[c].transform):r.z.identity(h.transform),h.atlasIndex0=n(l[c],"atlasIndex0",0),h.atlasIndex1=n(l[c],"atlasIndex1",0),e.locators.push(h)}o.Initialize(),e.boosters=o}}(b,p,y),function(e,t){for(var i=n(t,"locatorTurrets",[]),o=0;o<i.length;++o){var a=new Dt;a.name=i[o].name,"transform"in i[o]?r.z.copy(a.transform,i[o].transform):r.z.identity(a.transform),e.locators.push(a)}}(b,p);var g=function(e,t){for(var r=[],i=null,o=n(t,"animations",[]),a=0;a<o.length;++a)if(-1!==n(o[a],"id",-1)&&-1!==n(o[a],"startRate",-1)){i||(i=new s.Tw2CurveSet);var u=new kn.Tw2ScalarCurve2;u.keys.push(new kn.Tw2ScalarKey2),u.keys.push(new kn.Tw2ScalarKey2),u.keys[0].value=n(o[a],"startRate",-1),u.keys[1].time=1,u.keys[1].value=n(o[a],"endRate",-1),u.Initialize(),i.curves.push(u),e.curveSets.push(i),r[n(o[a],"id",-1)]=u}return i&&i.Initialize(),[i,r]}(b,p);return h(b,p,g[0],g[1]),function(e,t,r,i,o,a){for(var u=n(t,"instancedMeshes",[]),l=0;l<u.length;++l){var f=u[l],h=new s.Tw2InstancedMesh;h.instanceGeometryResPath=f.instanceGeometryResPath,h.geometryResPath=f.geometryResPath,h.Initialize(),c(n(h,"opaqueAreas",[]),"opaqueAreas",t,r,i,a,o,f.shader);var d=new L;d.mesh=h,e.effectChildren.push(d)}}(b,p,m,y,u,v),b.Initialize(),b}function y(t,r,i){for(var o=-1,a=0;a<e.generic.materialPrefixes.length;++a)t.substr(0,e.generic.materialPrefixes[a].length)===e.generic.materialPrefixes[a]&&(o=a,t=t.substr(e.generic.materialPrefixes[a].length));if(-1!==o){var s=n(r,"materialUsageMtl"+(o+1),o);if(s>=0&&s<e.generic.materialPrefixes.length&&(t=e.generic.materialPrefixes[s]+t)in i.parameters)return i.parameters[t]}}this.LoadData=function(n){null===e?(n&&p.push(n),d||((t=new s.Tw2Effect).effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/blinkinglightspool.fx",t.parameters.MainIntensity=new s.Tw2FloatParameter("MainIntensity",1),t.parameters.GradientMap=new s.Tw2TextureParameter("GradientMap","res:/texture/particle/whitesharp_gradient.dds.0.png"),t.Initialize(),r.D.GetObject("res:/dx9/model/spaceobjectfactory/data.red",function(t){e=t;for(var n=0;n<p.length;++n)p[n]();p=[]}),d=!0)):n&&n()},this.BuildFromDNA=function(t,n){if(null===e)this.LoadData(function(){var e=m(t);n&&n(e)});else{var r=m(t);n&&n(r)}};var b=[0,0,0,0];function v(e,t,n,r){switch(r){case"overridable":return t||(n||b);case"half_overridable":return e.indexOf("GlowColor")>=0?n||b:t||(n||b);case"not_overridable":case"half_overridable_2":return n||b}return b}function g(t,n,i){var o=e.faction[n],a=e.faction[i],u=null;o&&o.areas&&"hull"in o.areas&&(u=o.areas.hull);var l=null;if(a&&a.areas&&"hull"in a.areas&&(l=a.areas.hull),(u||l)&&t.turretEffect){var c=t.turretEffect.parameters;for(var f in c)if(c.hasOwnProperty(f)){if(c[f].constructor.prototype!==s.Tw2Vector4Parameter.prototype)continue;var h=null,d=null;u&&(h=y(f,o,u)),l&&(d=y(f,o,u)),r.I.copy(c[f].value,v(f,h,d,t.turretEffect.name))}t.turretEffect.BindParameters()}}function _(t){if("all"!==t){var n={};for(var r in e[t])e[t].hasOwnProperty(r)&&(n[r]=e[t][r].description||"");return n}return e}this.SetupTurretMaterial=function(t,n,r,i){null===e?this.LoadData(function(){g(t,n,r),i&&i()}):(g(t,n,r),i&&i())},this.GetHullNames=function(e){this.LoadData(function(){e(_("hull"))})},this.GetFactionNames=function(e){this.LoadData(function(){e(_("faction"))})},this.GetRaceNames=function(e){this.LoadData(function(){e(_("race"))})},this.GetSofData=function(e){this.LoadData(function(){e(_("all"))})}}n.d(t,"EveChild",function(){return a}),n.d(t,"EveChildBillboard",function(){return p}),n.d(t,"EveChildCloud",function(){return v}),n.d(t,"EveChildContainer",function(){return A}),n.d(t,"EveChildExplosion",function(){return D}),n.d(t,"EveChildMesh",function(){return L}),n.d(t,"EveChildParticleSystem",function(){return q}),n.d(t,"EveLensflare",function(){return Z}),n.d(t,"EveMeshOverlayEffect",function(){return ee}),n.d(t,"EveOccluder",function(){return W}),n.d(t,"EveStretch",function(){return re}),n.d(t,"EvePerMuzzleData",function(){return ue}),n.d(t,"EveTurretFiringFX",function(){return le}),n.d(t,"EveStarfield",function(){return fe}),n.d(t,"EveObject",function(){return pe}),n.d(t,"EveEffectRoot",function(){return Oe}),n.d(t,"EveMissileWarhead",function(){return xe}),n.d(t,"EveMissile",function(){return Ge}),n.d(t,"EvePlanet",function(){return Ye}),n.d(t,"EveShip",function(){return et}),n.d(t,"EveSpaceObject",function(){return _e}),n.d(t,"EveStation",function(){return _e}),n.d(t,"EveTransform",function(){return Ne}),n.d(t,"EveObjectSetItem",function(){return ot}),n.d(t,"EveObjectSet",function(){return at}),n.d(t,"EveBoosterBatch",function(){return yt}),n.d(t,"EveBoosterSetItem",function(){return bt}),n.d(t,"EveBoosterSet",function(){return vt}),n.d(t,"EveCurveLineSetItem",function(){return At}),n.d(t,"EveCurveLineSet",function(){return It}),n.d(t,"EveLocator",function(){return Dt}),n.d(t,"EvePlaneSetBatch",function(){return Vt}),n.d(t,"EvePlaneSetItem",function(){return Ht}),n.d(t,"EvePlaneSet",function(){return zt}),n.d(t,"EveSpaceObjectDecal",function(){return Yt}),n.d(t,"EveSpotlightSetBatch",function(){return rn}),n.d(t,"EveSpotlightSetItem",function(){return on}),n.d(t,"EveSpotlightSet",function(){return an}),n.d(t,"EveSpriteSetBatch",function(){return yn}),n.d(t,"EveSpriteSetItem",function(){return bn}),n.d(t,"EveSpriteSet",function(){return vn}),n.d(t,"EveTurretSetItem",function(){return An}),n.d(t,"EveTurretSet",function(){return In}),n.d(t,"EveSpaceScene",function(){return Dn}),n.d(t,"EveSOF",function(){return xn})},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(1),o=n(19),a=n(5);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"_id",r.F.generateID()),u(this,"name",""),u(this,"aliveCount",0),u(this,"maxParticleCount",0),u(this,"emitParticleOnDeathEmitter",null),u(this,"emitParticleDuringLifeEmitter",null),u(this,"elements",[]),u(this,"isValid",!1),u(this,"requiresSorting",!1),u(this,"updateSimulation",!0),u(this,"applyForce",!0),u(this,"applyAging",!0),u(this,"isGlobal",!1),u(this,"forces",[]),u(this,"constraints",[]),u(this,"updateBoundingBox",!1),u(this,"aabbMin",r.H.create()),u(this,"aabbMax",r.H.create()),u(this,"peakAliveCount",0),u(this,"bufferDirty",!1),u(this,"_vb",null),u(this,"_declaration",null),u(this,"_stdElements",[null,null,null,null]),u(this,"_elements",[]),u(this,"instanceStride",[null,null]),u(this,"vertexStride",[null,null]),u(this,"buffers",[null,null]),e.init()}var t,n,l;return t=e,l=[{key:"init",value:function(){e.global||(e.global={vec3_0:r.H.create(),mat4_0:r.z.create()})}}],(n=[{key:"Initialize",value:function(){this.UpdateElementDeclaration()}},{key:"UpdateElementDeclaration",value:function(){this.isValid=!1;const e=r.w.gl;if(this._vb&&(e.deleteBuffer(this._vb),this._vb=null),this._declaration=null,this.aliveCount=0,0!==this.elements.length){this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[0,0],this.vertexStride=[0,0],this._declaration=new i.Tw2VertexDeclaration,this.buffers=[null,null];for(let e=0;e<this.elements.length;++e){const t=this.elements[e].usedByGPU?0:1,n=new o.a(this.elements[e]);if(n.startOffset=this.vertexStride[t],n.offset=n.startOffset,this.elements[e].elementType!==a.a.Type.CUSTOM&&(this._stdElements[this.elements[e].elementType]=n),this.vertexStride[t]+=n.dimension,this._elements.push(n),0===t){const t=this.elements[e].GetDeclaration();t.offset=4*n.startOffset,this._declaration.elements.push(t)}}this._declaration.RebuildHash();for(let e=0;e<this._elements.length;++e){const t=this._elements[e].usedByGPU?0:1;this._elements[e].vertexStride=this.vertexStride[t]}this.instanceStride[0]=4*this.vertexStride[0],this.instanceStride[1]=4*this.vertexStride[1];for(let e=0;e<this._elements.length;++e){const t=this._elements[e].usedByGPU?0:1;this._elements[e].instanceStride=this.instanceStride[t]}this.buffers=[null,null],this.instanceStride[0]&&this.maxParticleCount&&(this.buffers[0]=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._vb=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferData(e.ARRAY_BUFFER,this.buffers[0].length,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)),this.instanceStride[1]&&(this.buffers[1]=new Float32Array(this.instanceStride[1]*this.maxParticleCount));for(let e=0;e<this._elements.length;++e){const t=this._elements[e].usedByGPU?0:1;this._elements[e].buffer=this.buffers[t]}this.requiresSorting&&(this._sortedIndexes=new Array(this.maxParticleCount),this._sortedBuffer=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._distancesBuffer=new Float32Array(this.maxParticleCount)),this.isValid=!0,this.bufferDirty=!0}}},{key:"HasElement",value:function(e){return null!==this._stdElements[e]}},{key:"GetElement",value:function(e){return this._stdElements[e]&&(this._stdElements[e].offset=this._stdElements[e].startOffset),this._stdElements[e]}},{key:"BeginSpawnParticle",value:function(){return!this.isValid||this.aliveCount>=this.maxParticleCount?null:this.aliveCount++}},{key:"EndSpawnParticle",value:function(){this.bufferDirty=!0}},{key:"Update",value:function(t){if(t=Math.min(t,.1),this.applyAging&&this.HasElement(a.a.Type.LIFETIME)){const e=this.GetElement(a.a.Type.LIFETIME),n=this.emitParticleOnDeathEmitter?this.GetElement(a.a.Type.POSITION):null,r=this.emitParticleOnDeathEmitter?this.GetElement(a.a.Type.VELOCITY):null;for(let i=0;i<this.aliveCount;++i)if(e.buffer[e.offset]+=t/e.buffer[e.offset+1],e.buffer[e.offset]>1){if(this.emitParticleOnDeathEmitter&&this.emitParticleOnDeathEmitter.SpawnParticles(n,r,1),this.aliveCount--,i<this.aliveCount){for(let e=0;e<2;++e)this.buffers[e]&&this.buffers[e].set(this.buffers[e].subarray(this.instanceStride[e]*this.aliveCount,this.instanceStride[e]*this.aliveCount+this.instanceStride[e]),i*this.instanceStride[e]);--i,this.bufferDirty=!0}}else e.offset+=e.instanceStride,n&&(n.offset+=n.instanceStride),r&&(r.offset+=r.instanceStride);e.dirty=!0}const n=e.global.vec3_0;if(this.updateSimulation&&this.HasElement(a.a.Type.POSITION)&&this.HasElement(a.a.Type.VELOCITY)){const e=this.applyForce&&this.forces.length;for(let e=0;e<this.forces.length;++e)this.forces[e].Update(t);const i=this.GetElement(a.a.Type.POSITION),o=this.GetElement(a.a.Type.VELOCITY),s=e?this.GetElement(a.a.Type.MASS):null;for(let a=0;a<this.aliveCount;++a){if(e){const e=s?s.buffer[s.offset]:1,a=r.H.set(n,0,0,0);for(let n=0;n<this.forces.length;++n)this.forces[n].ApplyForce(i,o,a,t,e);s&&r.H.scale(a,a,1/s.buffer[s.offset]),o.buffer[o.offset]+=a[0]*t,o.buffer[o.offset+1]+=a[1]*t,o.buffer[o.offset+2]+=a[2]*t}i.buffer[i.offset]+=o.buffer[o.offset]*t,i.buffer[i.offset+1]+=o.buffer[o.offset+1]*t,i.buffer[i.offset+2]+=o.buffer[o.offset+2]*t,this.emitParticleDuringLifeEmitter&&this.emitParticleDuringLifeEmitter.SpawnParticles(i,o,t),i.offset+=i.instanceStride,o.offset+=o.instanceStride,s&&(s.offset+=s.instanceStride)}i.dirty=!0,o.dirty=!0}if(this.updateSimulation&&this.constraints.length)for(let e=0;e<this.constraints.length;++e)this.constraints[e].ApplyConstraint(this.buffers,this.instanceStride,this.aliveCount,t);if(this.updateBoundingBox&&this.GetBoundingBox(this.aabbMin,this.aabbMax),this.emitParticleDuringLifeEmitter&&(!this.HasElement(a.a.Type.POSITION)||!this.HasElement(a.a.Type.VELOCITY))&&this.updateSimulation){const e=this.GetElement(a.a.Type.POSITION),t=this.GetElement(a.a.Type.VELOCITY);for(let n=0;n<this.aliveCount;++n)this.emitParticleDuringLifeEmitter.SpawnParticles(e,t,1),e&&(e.offset+=e.instanceStride),t&&(t.offset+=t.instanceStride)}for(let e=0;e<this._elements.length;++e){const t=this._elements[e];t.offset=t.startOffset,t.dirty&&(this.bufferDirty=!0,t.dirty=!1)}}},{key:"GetBoundingBox",value:function(e,t){if(this.aliveCount&&this.HasElement(a.a.Type.POSITION)){const n=this.GetElement(a.a.Type.POSITION);e[0]=n.buffer[n.offset],e[1]=n.buffer[n.offset+1],e[2]=n.buffer[n.offset+2],t[0]=n.buffer[n.offset],t[1]=n.buffer[n.offset+1],t[2]=n.buffer[n.offset+2];for(let r=0;r<this.aliveCount;++r)e[0]=Math.min(e[0],n.buffer[n.offset]),e[1]=Math.min(e[1],n.buffer[n.offset+1]),e[2]=Math.min(e[2],n.buffer[n.offset+2]),t[0]=Math.max(t[0],n.buffer[n.offset]),t[1]=Math.max(t[1],n.buffer[n.offset+1]),t[2]=Math.max(t[2],n.buffer[n.offset+2]),n.offset+=n.instanceStride;return!0}return!1}},{key:"_Sort",value:function(){const t=r.z.multiply(e.global.mat4_0,r.w.projection,r.w.view),n=this.GetElement(a.a.Type.POSITION),i=this.aliveCount,o=this._distancesBuffer;for(let e=0;e<i;++e){const r=n.offset+n.instanceStride*e;let i=n.buffer[r]-t[12],a=i*i;a+=(i=n.buffer[r+1]-t[13])*i,a+=(i=n.buffer[r+2]-t[14])*i,o[e]=a}for(let e=0;e<this.maxParticleCount;++e)this._sortedIndexes[e]=e;this._sortedIndexes.sort(function(e,t){if(e>=i&&t>=i)return e<t?-1:e>t?1:0;if(e>=i)return 1;if(t>=i)return-1;const n=o[e],r=o[t];return n<r?1:n>r?-1:0})}},{key:"GetInstanceBuffer",value:function(){if(0===this.aliveCount)return;const e=r.w.gl;if(this.requiresSorting&&this.HasElement(a.a.Type.POSITION)&&this.buffers){this._Sort();const t=this.instanceStride[0],n=this.buffers[0];for(let e=0;e<this.aliveCount;++e){const r=e*t,i=this._sortedIndexes[e]*t;for(let e=0;e<t;++e)this._sortedBuffer[r+e]=n[e+i]}e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferSubData(e.ARRAY_BUFFER,0,this._sortedBuffer.subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1}else this.bufferDirty&&(e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferSubData(e.ARRAY_BUFFER,0,this.buffers[0].subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1);return this._vb}},{key:"GetInstanceDeclaration",value:function(){return this._declaration}},{key:"GetInstanceStride",value:function(){return this.instanceStride[0]}},{key:"GetInstanceCount",value:function(){return this.aliveCount}}])&&s(t.prototype,n),l&&s(t,l),e}();u(l,"global",null)},function(e,t,n){"use strict";var r=n(0);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"_id",r.F.generateID()),o(this,"name","")}var t,n,a;return t=e,(n=[{key:"ApplyForce",value:function(e,t,n,r,i){}},{key:"Update",value:function(e){}}])&&i(t.prototype,n),a&&i(t,a),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}o(a,"global",{vec3_0:r.H.create(),vec3_1:r.H.create(),vec4_0:r.I.create()});let h=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=u(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?c(n):i,f(c(c(e)),"magnitude",0),f(c(c(e)),"position",r.H.create()),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a),n=t,(i=[{key:"ApplyForce",value:function(e,t,n){const i=a.global.vec3_0;i[0]=this.position[0]-e.buffer[e.offset],i[1]=this.position[1]-e.buffer[e.offset+1],i[2]=this.position[2]-e.buffer[e.offset+2],r.H.normalize(i,i),r.H.scale(i,i,this.magnitude),r.H.add(n,n,i)}}])&&s(n.prototype,i),o&&s(n,o),t}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let b=function(e){function t(){var e,n,i,o,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,l=new Array(u),c=0;c<u;c++)l[c]=arguments[c];return n=this,e=!(i=p(t).call(this,...l))||"object"!=typeof i&&"function"!=typeof i?y(n):i,o=y(y(e)),a="force",s=r.H.create(),a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,a),n=t,(i=[{key:"ApplyForce",value:function(e,t,n){r.H.add(n,n,this.force)}}])&&d(n.prototype,i),o&&d(n,o),t}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let E=function(e){function t(){var e,n,r,i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=this,e=!(r=g(t).call(this,...u))||"object"!=typeof r&&"function"!=typeof r?w(n):r,i=w(w(e)),a=.1,(o="drag")in i?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,a),n=t,(r=[{key:"ApplyForce",value:function(e,t,n){n[0]+=t.buffer[t.offset]*-this.drag,n[1]+=t.buffer[t.offset+1]*-this.drag,n[2]+=t.buffer[t.offset+2]*-this.drag}}])&&v(n.prototype,r),i&&v(n,i),t}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}let P=function(e){function t(){var e,n,r,i,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=this,e=!(r=R(t).call(this,...u))||"object"!=typeof r&&"function"!=typeof r?O(n):r,i=O(O(e)),a=.1,(o="drag")in i?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,a),n=t,(i=[{key:"ApplyForce",value:function(e,t,n,i,o){const s=a.global.vec3_0,u=a.global.vec3_1,l=Math.sqrt(t.buffer[t.offset]*t.buffer[t.offset]+t.buffer[t.offset+1]*t.buffer[t.offset+1]+t.buffer[t.offset+2]*t.buffer[t.offset+2]);s[0]=t.buffer[t.offset]*-l*this.drag,s[1]=t.buffer[t.offset+1]*-l*this.drag,s[2]=t.buffer[t.offset+2]*-l*this.drag,r.H.scale(u,s,i*o),u[0]+=t.buffer[t.offset],u[1]+=t.buffer[t.offset+1],u[2]+=t.buffer[t.offset+2],t.buffer[t.offset]*u[0]+t.buffer[t.offset+1]*u[1]+t.buffer[t.offset+2]*u[2]<0?(n[0]=-t.buffer[t.offset]/i/o,n[1]=-t.buffer[t.offset+1]/i/o,n[2]=-t.buffer[t.offset+2]/i/o):r.H.copy(n,s)}}])&&T(n.prototype,i),o&&T(n,o),t}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let k=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=I(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?M(n):i,D(M(M(e)),"springConstant",0),D(M(M(e)),"position",r.H.create()),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,a),n=t,(i=[{key:"ApplyForce",value:function(e,t,n){n[0]+=(this.position[0]-e.buffer[e.offset])*this.springConstant,n[1]+=(this.position[1]-e.buffer[e.offset+1])*this.springConstant,n[2]+=(this.position[2]-e.buffer[e.offset+2])*this.springConstant}}])&&A(n.prototype,i),o&&A(n,o),t}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let B=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=G(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?F(n):i,L(F(F(e)),"noiseLevel",3),L(F(F(e)),"noiseRatio",.5),L(F(F(e)),"amplitude",r.H.fromValues(1,1,1)),L(F(F(e)),"frequency",r.I.fromValues(1,1,1,1)),L(F(F(e)),"_time",0),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,a),n=t,(i=[{key:"ApplyForce",value:function(e,t,n){if(0===this.noiseLevel)return;let i=e.buffer[e.offset]*this.frequency[0],o=e.buffer[e.offset+1]*this.frequency[1],s=e.buffer[e.offset+2]*this.frequency[2],u=this._time*this.frequency[3],l=0,c=.5,f=1/this.noiseRatio;const h=r.I.set(a.global.vec4_0,0,0,0,0);for(let e=0;e<this.noiseLevel;++e)r.A.turbulence(h,i,o,s,u,c),l+=c,i*=f,o*=f,s*=f,u*=f,c*=this.noiseRatio;n[0]+=h[0]*this.amplitude[0]*l,n[1]+=h[1]*this.amplitude[1]*l,n[2]+=h[2]*this.amplitude[2]*l}},{key:"Update",value:function(e){this._time+=e}}])&&x(n.prototype,i),o&&x(n,o),t}();n.d(t,"a",function(){return h}),n.d(t,"b",function(){return b}),n.d(t,"c",function(){return E}),n.d(t,"d",function(){return P}),n.d(t,"e",function(){return k}),n.d(t,"f",function(){return B})},function(e,t,n){"use strict";var r=n(0),i=n(1);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"_id",r.F.generateID()),a(this,"name",""),a(this,"particleSystem",null)}var t,n,i;return t=e,(n=[{key:"Initialize",value:function(){}},{key:"Update",value:function(e){}}])&&o(t.prototype,n),i&&o(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let d=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=l(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?f(n):r,h(f(f(e)),"geometryResourcePath",""),h(f(f(e)),"geometryResource",null),h(f(f(e)),"geometryIndex",0),h(f(f(e)),"_spawned",!1),e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,s),n=t,(o=[{key:"Initialize",value:function(){""!==this.geometryResourcePath&&(this.geometryResource=r.D.GetResource(this.geometryResourcePath),this.geometryResource.systemMirror=!0,this.geometryResource.RegisterNotification(this)),this._spawned=!1}},{key:"RebuildCachedData",value:function(){this.geometryResource&&this.geometryResource.meshes.length&&(this.geometryResource.meshes[0].bufferData||(this.geometryResource.systemMirror=!0,this.geometryResource.Reload()))}},{key:"Update",value:function(){const e=this.geometryResource;if(!this._spawned&&this.particleSystem&&e&&e.IsGood()&&e.meshes.length>this.geometryIndex&&e.meshes[this.geometryIndex].bufferData){this._spawned=!0;const t=e.meshes[this.geometryIndex],n=this.particleSystem.elements,r=new Array(n.length);for(let o=0;o<n.length;++o){const a=n[o].GetDeclaration(),s=t.declaration.FindUsage(a.usage,a.usageIndex-8);if(null===s)return void e.OnError(new i.ErrGeometryMeshMissingParticleElement({path:e.path,elementUsage:a.usage,elementUsageIndex:a.usageIndex}));if(s.elements<a.elements)return void e.OnError(new i.ErrGeometryMeshElementComponentsMissing({path:e.path,inputCount:s.elements,elementCount:a.elements,elementUsage:a.usage,elementUsageIndex:a.usageIndex}));r[o]=s.offset/4}const o=t.bufferData.length/t.declaration.stride*4;for(let e=0;e<o;++e){const n=this.particleSystem.BeginSpawnParticle();if(null===n)break;for(let i=0;i<this.particleSystem._elements.length;++i){const o=this.particleSystem._elements[i];for(let a=0;a<o.dimension;++a)o.buffer[o.instanceStride*n+o.startOffset+a]=t.bufferData[r[i]+a+e*t.declaration.stride/4]}this.particleSystem.EndSpawnParticle()}}}}])&&u(n.prototype,o),a&&u(n,a),t}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let g=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=this,e=!(r=m(t).call(this,...o))||"object"!=typeof r&&"function"!=typeof r?b(n):r,v(b(b(e)),"rate",0),v(b(b(e)),"isValid",!1),v(b(b(e)),"_accumulatedRate",0),v(b(b(e)),"generators",[]),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,s),n=t,(r=[{key:"Initialize",value:function(){this.Rebind()}},{key:"Update",value:function(e){this.SpawnParticles(null,null,Math.min(e,.1))}},{key:"Rebind",value:function(){if(this.isValid=!1,this.particleSystem){for(let e=0;e<this.generators.length;++e)if(!this.generators[e].Bind(this.particleSystem))return;this.isValid=!0}}},{key:"SpawnParticles",value:function(e,t,n){if(!this.isValid)return;this._accumulatedRate+=this.rate*n;const r=Math.floor(this._accumulatedRate);this._accumulatedRate-=r;for(let n=0;n<r;++n){const n=this.particleSystem.BeginSpawnParticle();if(null===n)break;for(let r=0;r<this.generators.length;++r)this.generators[r].Generate(e,t,n);this.particleSystem.EndSpawnParticle()}}}])&&p(n.prototype,r),i&&p(n,i),t}();function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let R=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=_(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?E(n):i,T(E(E(e)),"angle",0),T(E(E(e)),"innerAngle",0),T(E(E(e)),"drag",0),T(E(E(e)),"rate",0),T(E(E(e)),"radius",0),T(E(E(e)),"gravity",0),T(E(E(e)),"maxSpeed",0),T(E(E(e)),"minSpeed",0),T(E(E(e)),"minLifeTime",0),T(E(E(e)),"maxLifeTime",0),T(E(E(e)),"sizeVariance",0),T(E(E(e)),"attractorPosition",r.H.create()),T(E(E(e)),"attractorStrength",0),T(E(E(e)),"turbulenceAmplitude",0),T(E(E(e)),"turbulenceFrequency",0),T(E(E(e)),"textureIndex",0),T(E(E(e)),"sizes",r.H.create()),T(E(E(e)),"position",r.H.create()),T(E(E(e)),"color0",r.I.create()),T(E(E(e)),"color1",r.I.create()),T(E(E(e)),"color2",r.I.create()),T(E(E(e)),"color3",r.I.create()),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,s),t}();T(R,"partialImplementation",!0),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return g}),n.d(t,"b",function(){return R})},function(e,t,n){"use strict";var r=n(0),i=n(5);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"_id",r.F.generateID()),a(this,"name","")}var t,n,i;return t=e,(n=[{key:"Bind",value:function(e){return!1}},{key:"Generate",value:function(e,t,n){}}])&&o(t.prototype,n),i&&o(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}a(s,"global",{vec3_0:r.H.create()});let d=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return n=this,e=!(o=l(t).call(this,...s))||"object"!=typeof o&&"function"!=typeof o?f(n):o,h(f(f(e)),"elementType",i.a.Type.CUSTOM),h(f(f(e)),"customName",""),h(f(f(e)),"minRange",r.I.create()),h(f(f(e)),"maxRange",r.I.create()),h(f(f(e)),"_element",null),e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,s),n=t,(o=[{key:"Bind",value:function(e){for(let t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==i.a.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,n){for(let e=0;e<this._element.dimension;++e)this._element.buffer[this._element.instanceStride*n+this._element.startOffset+e]=Math.floor(this.minRange[e]+Math.random()*(this.maxRange[e]-this.minRange[e])+.5)}}])&&u(n.prototype,o),a&&u(n,a),t}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let g=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return n=this,e=!(o=m(t).call(this,...s))||"object"!=typeof o&&"function"!=typeof o?b(n):o,v(b(b(e)),"elementType",i.a.Type.CUSTOM),v(b(b(e)),"customName",""),v(b(b(e)),"minRange",r.I.create()),v(b(b(e)),"maxRange",r.I.create()),v(b(b(e)),"_element",null),e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,s),n=t,(o=[{key:"Bind",value:function(e){for(let t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==i.a.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,n){for(let e=0;e<this._element.dimension;++e)this._element.buffer[this._element.instanceStride*n+this._element.startOffset+e]=this.minRange[e]+Math.random()*(this.maxRange[e]-this.minRange[e])}}])&&p(n.prototype,o),a&&p(n,a),t}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let S=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=this,e=!(i=w(t).call(this,...a))||"object"!=typeof i&&"function"!=typeof i?T(n):i,R(T(T(e)),"minRadius",0),R(T(T(e)),"maxRadius",0),R(T(T(e)),"minPhi",0),R(T(T(e)),"maxPhi",360),R(T(T(e)),"minTheta",0),R(T(T(e)),"maxTheta",360),R(T(T(e)),"controlPosition",!0),R(T(T(e)),"controlVelocity",!0),R(T(T(e)),"minSpeed",0),R(T(T(e)),"maxSpeed",0),R(T(T(e)),"parentVelocityFactor",1),R(T(T(e)),"position",r.H.create()),R(T(T(e)),"rotation",r.C.create()),R(T(T(e)),"_position",null),R(T(T(e)),"_velocity",null),e}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,s),n=t,(o=[{key:"Bind",value:function(e){this._position=null,this._velocity=null;for(let t=0;t<e._elements.length;++t)e._elements[t].elementType===i.a.Type.POSITION&&this.controlPosition?this._position=e._elements[t]:e._elements[t].elementType===i.a.Type.VELOCITY&&this.controlVelocity&&(this._velocity=e._elements[t]);return!(this.controlPosition&&null===this._position||this.controlVelocity&&null===this._velocity)}},{key:"Generate",value:function(e,t,n){const i=(this.minPhi+Math.random()*(this.maxPhi-this.minPhi))/180*Math.PI,o=(this.minTheta+Math.random()*(this.maxTheta-this.minTheta))/180*Math.PI,a=s.global.vec3_0;if(a[0]=Math.sin(i)*Math.cos(o),a[1]=-Math.cos(i),a[2]=Math.sin(i)*Math.sin(o),r.H.transformQuat(a,a,this.rotation),this._velocity){const e=this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed),r=this._velocity.instanceStride*n+this._velocity.startOffset;this._velocity.buffer[r]=a[0]*e,this._velocity.buffer[r+1]=a[1]*e,this._velocity.buffer[r+2]=a[2]*e,t&&(this._velocity.buffer[r]+=t.buffer[t.offset]*this.parentVelocityFactor,this._velocity.buffer[r+1]+=t.buffer[t.offset+1]*this.parentVelocityFactor,this._velocity.buffer[r+2]+=t.buffer[t.offset+2]*this.parentVelocityFactor)}if(this._position){r.H.scale(a,a,this.minRadius+Math.random()*(this.maxRadius-this.minRadius)),r.H.add(a,a,this.position),e&&(a[0]+=e.buffer[e.offset],a[1]+=e.buffer[e.offset+1],a[2]+=e.buffer[e.offset+2]);const t=this._position.instanceStride*n+this._position.startOffset;this._position.buffer[t]=a[0],this._position.buffer[t+1]=a[1],this._position.buffer[t+2]=a[2]}}}])&&_(n.prototype,o),a&&_(n,a),t}();n.d(t,"a",function(){return d}),n.d(t,"b",function(){return g}),n.d(t,"c",function(){return S})},function(e,t,n){"use strict";n.r(t);var r=n(4);n.d(t,"math",function(){return r});var i=n(1),o=n(12),a=n(20),s=n(18),u=n(0);for(var l in n.d(t,"util",function(){return u.F}),n.d(t,"device",function(){return u.w}),n.d(t,"store",function(){return u.E}),n.d(t,"resMan",function(){return u.D}),n.d(t,"logger",function(){return u.x}),n.d(t,"consts",function(){return u.u}),n.d(t,"Tw2Error",function(){return i.Tw2Error}),n.d(t,"ErrHTTPRequest",function(){return i.ErrHTTPRequest}),n.d(t,"ErrHTTPRequestSend",function(){return i.ErrHTTPRequestSend}),n.d(t,"ErrHTTPInstance",function(){return i.ErrHTTPInstance}),n.d(t,"ErrHTTPStatus",function(){return i.ErrHTTPStatus}),n.d(t,"ErrHTTPReadyState",function(){return i.ErrHTTPReadyState}),n.d(t,"ErrXMLBinaryFormat",function(){return i.ErrXMLBinaryFormat}),n.d(t,"ErrXMLObjectTypeUndefined",function(){return i.ErrXMLObjectTypeUndefined}),n.d(t,"ErrGeometryMeshMissingParticleElement",function(){return i.ErrGeometryMeshMissingParticleElement}),n.d(t,"ErrGeometryMeshElementComponentsMissing",function(){return i.ErrGeometryMeshElementComponentsMissing}),n.d(t,"ErrGeometryMeshBoneNameInvalid",function(){return i.ErrGeometryMeshBoneNameInvalid}),n.d(t,"ErrGeometryMeshEffectBinding",function(){return i.ErrGeometryMeshEffectBinding}),n.d(t,"ErrGeometryFileType",function(){return i.ErrGeometryFileType}),n.d(t,"ErrResourcePrefixUnregistered",function(){return i.ErrResourcePrefixUnregistered}),n.d(t,"ErrResourcePrefixUndefined",function(){return i.ErrResourcePrefixUndefined}),n.d(t,"ErrResourceExtensionUnregistered",function(){return i.ErrResourceExtensionUnregistered}),n.d(t,"ErrResourceExtensionUndefined",function(){return i.ErrResourceExtensionUndefined}),n.d(t,"ErrResourceFormat",function(){return i.ErrResourceFormat}),n.d(t,"ErrShaderVersion",function(){return i.ErrShaderVersion}),n.d(t,"ErrShaderHeaderSize",function(){return i.ErrShaderHeaderSize}),n.d(t,"ErrShaderPermutationValue",function(){return i.ErrShaderPermutationValue}),n.d(t,"ErrShaderCompile",function(){return i.ErrShaderCompile}),n.d(t,"ErrShaderLink",function(){return i.ErrShaderLink}),n.d(t,"ErrDeclarationValueType",function(){return i.ErrDeclarationValueType}),n.d(t,"ErrSingletonInstantiation",function(){return i.ErrSingletonInstantiation}),n.d(t,"ErrAbstractClassMethod",function(){return i.ErrAbstractClassMethod}),n.d(t,"ErrFeatureNotImplemented",function(){return i.ErrFeatureNotImplemented}),n.d(t,"ErrIndexBounds",function(){return i.ErrIndexBounds}),n.d(t,"Tw2EventEmitter",function(){return i.Tw2EventEmitter}),n.d(t,"Tw2Float",function(){return i.Tw2Float}),n.d(t,"Tw2Frustum",function(){return i.Tw2Frustum}),n.d(t,"Tw2RenderTarget",function(){return i.Tw2RenderTarget}),n.d(t,"Tw2BatchAccumulator",function(){return i.Tw2BatchAccumulator}),n.d(t,"Tw2ForwardingRenderBatch",function(){return i.Tw2ForwardingRenderBatch}),n.d(t,"Tw2GeometryBatch",function(){return i.Tw2GeometryBatch}),n.d(t,"Tw2GeometryLineBatch",function(){return i.Tw2GeometryLineBatch}),n.d(t,"Tw2RenderBatch",function(){return i.Tw2RenderBatch}),n.d(t,"Tw2InstancedMeshBatch",function(){return i.Tw2InstancedMeshBatch}),n.d(t,"Tw2CurveSet",function(){return i.Tw2CurveSet}),n.d(t,"Tw2ValueBinding",function(){return i.Tw2ValueBinding}),n.d(t,"Tw2BasicPerObjectData",function(){return i.Tw2BasicPerObjectData}),n.d(t,"EveBasicPerObjectData",function(){return i.EveBasicPerObjectData}),n.d(t,"Tw2PerObjectData",function(){return i.Tw2PerObjectData}),n.d(t,"Tw2RawData",function(){return i.Tw2RawData}),n.d(t,"Tw2BlendShapeData",function(){return i.Tw2BlendShapeData}),n.d(t,"Tw2GeometryAnimation",function(){return i.Tw2GeometryAnimation}),n.d(t,"Tw2GeometryBone",function(){return i.Tw2GeometryBone}),n.d(t,"Tw2GeometryCurve",function(){return i.Tw2GeometryCurve}),n.d(t,"Tw2GeometryMesh",function(){return i.Tw2GeometryMesh}),n.d(t,"Tw2GeometryMeshArea",function(){return i.Tw2GeometryMeshArea}),n.d(t,"Tw2GeometryMeshBinding",function(){return i.Tw2GeometryMeshBinding}),n.d(t,"Tw2GeometryModel",function(){return i.Tw2GeometryModel}),n.d(t,"Tw2GeometrySkeleton",function(){return i.Tw2GeometrySkeleton}),n.d(t,"Tw2GeometryTrackGroup",function(){return i.Tw2GeometryTrackGroup}),n.d(t,"Tw2GeometryTransformTrack",function(){return i.Tw2GeometryTransformTrack}),n.d(t,"Tw2Effect",function(){return i.Tw2Effect}),n.d(t,"Tw2InstancedMesh",function(){return i.Tw2InstancedMesh}),n.d(t,"Tw2Mesh",function(){return i.Tw2Mesh}),n.d(t,"Tw2MeshArea",function(){return i.Tw2MeshArea}),n.d(t,"Tw2MeshLineArea",function(){return i.Tw2MeshLineArea}),n.d(t,"Tw2Animation",function(){return i.Tw2Animation}),n.d(t,"Tw2AnimationController",function(){return i.Tw2AnimationController}),n.d(t,"Tw2Bone",function(){return i.Tw2Bone}),n.d(t,"Tw2Model",function(){return i.Tw2Model}),n.d(t,"Tw2Track",function(){return i.Tw2Track}),n.d(t,"Tw2TrackGroup",function(){return i.Tw2TrackGroup}),n.d(t,"Tw2Parameter",function(){return i.Tw2Parameter}),n.d(t,"Tw2VectorParameter",function(){return i.Tw2VectorParameter}),n.d(t,"Tw2FloatParameter",function(){return i.Tw2FloatParameter}),n.d(t,"Tw2MatrixParameter",function(){return i.Tw2MatrixParameter}),n.d(t,"Tw2TransformParameter",function(){return i.Tw2TransformParameter}),n.d(t,"Tw2VariableParameter",function(){return i.Tw2VariableParameter}),n.d(t,"Tw2Vector2Parameter",function(){return i.Tw2Vector2Parameter}),n.d(t,"Tw2Vector3Parameter",function(){return i.Tw2Vector3Parameter}),n.d(t,"Tw2Vector4Parameter",function(){return i.Tw2Vector4Parameter}),n.d(t,"Tw2TextureParameter",function(){return i.Tw2TextureParameter}),n.d(t,"Tw2PostEffect",function(){return i.Tw2PostEffect}),n.d(t,"Tw2PostEffectManager",function(){return i.Tw2PostEffectManager}),n.d(t,"Tw2PostEffectStep",function(){return i.Tw2PostEffectStep}),n.d(t,"Tw2PostProcess",function(){return i.Tw2PostProcess}),n.d(t,"Tw2BinaryReader",function(){return i.Tw2BinaryReader}),n.d(t,"Tw2ObjectReader",function(){return i.Tw2ObjectReader}),n.d(t,"Tw2EffectRes",function(){return i.Tw2EffectRes}),n.d(t,"Tw2GeometryRes",function(){return i.Tw2GeometryRes}),n.d(t,"Tw2LoadingObject",function(){return i.Tw2LoadingObject}),n.d(t,"Tw2Resource",function(){return i.Tw2Resource}),n.d(t,"Tw2TextureRes",function(){return i.Tw2TextureRes}),n.d(t,"Tw2VideoRes",function(){return i.Tw2VideoRes}),n.d(t,"Tw2SamplerState",function(){return i.Tw2SamplerState}),n.d(t,"Tw2SamplerOverride",function(){return i.Tw2SamplerOverride}),n.d(t,"Tw2VertexDeclaration",function(){return i.Tw2VertexDeclaration}),n.d(t,"Tw2VertexElement",function(){return i.Tw2VertexElement}),n.d(t,"Tw2CurveKey",function(){return o.Tw2CurveKey}),n.d(t,"Tw2Curve",function(){return o.Tw2Curve}),n.d(t,"Tw2ColorKey",function(){return o.Tw2ColorKey}),n.d(t,"Tw2ColorCurve",function(){return o.Tw2ColorCurve}),n.d(t,"Tw2ColorKey2",function(){return o.Tw2ColorKey2}),n.d(t,"Tw2ColorCurve2",function(){return o.Tw2ColorCurve2}),n.d(t,"Tw2EventKey",function(){return o.Tw2EventKey}),n.d(t,"Tw2EventCurve",function(){return o.Tw2EventCurve}),n.d(t,"Tw2PerlinCurve",function(){return o.Tw2PerlinCurve}),n.d(t,"Tw2QuaternionKey2",function(){return o.Tw2QuaternionKey2}),n.d(t,"Tw2QuaternionCurve",function(){return o.Tw2QuaternionCurve}),n.d(t,"Tw2RandomConstantCurve",function(){return o.Tw2RandomConstantCurve}),n.d(t,"Tw2Torque",function(){return o.Tw2Torque}),n.d(t,"Tw2RigidOrientation",function(){return o.Tw2RigidOrientation}),n.d(t,"Tw2QuaternionKey",function(){return o.Tw2QuaternionKey}),n.d(t,"Tw2RotationCurve",function(){return o.Tw2RotationCurve}),n.d(t,"Tw2ScalarKey",function(){return o.Tw2ScalarKey}),n.d(t,"Tw2ScalarCurve",function(){return o.Tw2ScalarCurve}),n.d(t,"Tw2ScalarKey2",function(){return o.Tw2ScalarKey2}),n.d(t,"Tw2ScalarCurve2",function(){return o.Tw2ScalarCurve2}),n.d(t,"Tw2SineCurve",function(){return o.Tw2SineCurve}),n.d(t,"Tw2Vector2Key",function(){return o.Tw2Vector2Key}),n.d(t,"Tw2Vector2Curve",function(){return o.Tw2Vector2Curve}),n.d(t,"Tw2Vector3Key",function(){return o.Tw2Vector3Key}),n.d(t,"Tw2Vector3Curve",function(){return o.Tw2Vector3Curve}),n.d(t,"Tw2VectorKey",function(){return o.Tw2VectorKey}),n.d(t,"Tw2VectorCurve",function(){return o.Tw2VectorCurve}),n.d(t,"Tw2ColorSequencer",function(){return o.Tw2ColorSequencer}),n.d(t,"Tw2EulerRotation",function(){return o.Tw2EulerRotation}),n.d(t,"Tw2QuaternionSequencer",function(){return o.Tw2QuaternionSequencer}),n.d(t,"Tw2RGBAScalarSequencer",function(){return o.Tw2RGBAScalarSequencer}),n.d(t,"Tw2ScalarSequencer",function(){return o.Tw2ScalarSequencer}),n.d(t,"Tw2VectorSequencer",function(){return o.Tw2VectorSequencer}),n.d(t,"Tw2XYZScalarSequencer",function(){return o.Tw2XYZScalarSequencer}),n.d(t,"Tw2YPRSequencer",function(){return o.Tw2YPRSequencer}),n.d(t,"Tw2WbgTrack",function(){return o.Tw2WbgTrack}),n.d(t,"Tw2WbgTransformTrack",function(){return o.Tw2WbgTransformTrack}),n.d(t,"Tw2TransformTrack",function(){return o.Tw2TransformTrack}),n.d(t,"Tw2MayaEulerRotationCurve",function(){return o.Tw2MayaEulerRotationCurve}),n.d(t,"Tw2MayaScalarCurve",function(){return o.Tw2MayaScalarCurve}),n.d(t,"Tw2MayaVector3Curve",function(){return o.Tw2MayaVector3Curve}),n.d(t,"Tw2MayaAnimationEngine",function(){return o.Tw2MayaAnimationEngine}),n.d(t,"EveSpaceScene",function(){return a.EveSpaceScene}),n.d(t,"EveSOF",function(){return a.EveSOF}),n.d(t,"EveChild",function(){return a.EveChild}),n.d(t,"EveChildBillboard",function(){return a.EveChildBillboard}),n.d(t,"EveChildCloud",function(){return a.EveChildCloud}),n.d(t,"EveChildContainer",function(){return a.EveChildContainer}),n.d(t,"EveChildExplosion",function(){return a.EveChildExplosion}),n.d(t,"EveChildMesh",function(){return a.EveChildMesh}),n.d(t,"EveChildParticleSystem",function(){return a.EveChildParticleSystem}),n.d(t,"EveLensflare",function(){return a.EveLensflare}),n.d(t,"EveMeshOverlayEffect",function(){return a.EveMeshOverlayEffect}),n.d(t,"EveOccluder",function(){return a.EveOccluder}),n.d(t,"EveStretch",function(){return a.EveStretch}),n.d(t,"EvePerMuzzleData",function(){return a.EvePerMuzzleData}),n.d(t,"EveTurretFiringFX",function(){return a.EveTurretFiringFX}),n.d(t,"EveStarfield",function(){return a.EveStarfield}),n.d(t,"EveObject",function(){return a.EveObject}),n.d(t,"EveEffectRoot",function(){return a.EveEffectRoot}),n.d(t,"EveMissileWarhead",function(){return a.EveMissileWarhead}),n.d(t,"EveMissile",function(){return a.EveMissile}),n.d(t,"EvePlanet",function(){return a.EvePlanet}),n.d(t,"EveShip",function(){return a.EveShip}),n.d(t,"EveSpaceObject",function(){return a.EveSpaceObject}),n.d(t,"EveStation",function(){return a.EveStation}),n.d(t,"EveTransform",function(){return a.EveTransform}),n.d(t,"EveObjectSetItem",function(){return a.EveObjectSetItem}),n.d(t,"EveObjectSet",function(){return a.EveObjectSet}),n.d(t,"EveBoosterBatch",function(){return a.EveBoosterBatch}),n.d(t,"EveBoosterSetItem",function(){return a.EveBoosterSetItem}),n.d(t,"EveBoosterSet",function(){return a.EveBoosterSet}),n.d(t,"EveCurveLineSetItem",function(){return a.EveCurveLineSetItem}),n.d(t,"EveCurveLineSet",function(){return a.EveCurveLineSet}),n.d(t,"EveLocator",function(){return a.EveLocator}),n.d(t,"EvePlaneSetBatch",function(){return a.EvePlaneSetBatch}),n.d(t,"EvePlaneSetItem",function(){return a.EvePlaneSetItem}),n.d(t,"EvePlaneSet",function(){return a.EvePlaneSet}),n.d(t,"EveSpaceObjectDecal",function(){return a.EveSpaceObjectDecal}),n.d(t,"EveSpotlightSetBatch",function(){return a.EveSpotlightSetBatch}),n.d(t,"EveSpotlightSetItem",function(){return a.EveSpotlightSetItem}),n.d(t,"EveSpotlightSet",function(){return a.EveSpotlightSet}),n.d(t,"EveSpriteSetBatch",function(){return a.EveSpriteSetBatch}),n.d(t,"EveSpriteSetItem",function(){return a.EveSpriteSetItem}),n.d(t,"EveSpriteSet",function(){return a.EveSpriteSet}),n.d(t,"EveTurretSetItem",function(){return a.EveTurretSetItem}),n.d(t,"EveTurretSet",function(){return a.EveTurretSet}),s)["math","util","device","store","resMan","logger","consts","Tw2Error","ErrHTTPRequest","ErrHTTPRequestSend","ErrHTTPInstance","ErrHTTPStatus","ErrHTTPReadyState","ErrXMLBinaryFormat","ErrXMLObjectTypeUndefined","ErrGeometryMeshMissingParticleElement","ErrGeometryMeshElementComponentsMissing","ErrGeometryMeshBoneNameInvalid","ErrGeometryMeshEffectBinding","ErrGeometryFileType","ErrResourcePrefixUnregistered","ErrResourcePrefixUndefined","ErrResourceExtensionUnregistered","ErrResourceExtensionUndefined","ErrResourceFormat","ErrShaderVersion","ErrShaderHeaderSize","ErrShaderPermutationValue","ErrShaderCompile","ErrShaderLink","ErrDeclarationValueType","ErrSingletonInstantiation","ErrAbstractClassMethod","ErrFeatureNotImplemented","ErrIndexBounds","Tw2EventEmitter","Tw2Float","Tw2Frustum","Tw2RenderTarget","Tw2BatchAccumulator","Tw2ForwardingRenderBatch","Tw2GeometryBatch","Tw2GeometryLineBatch","Tw2RenderBatch","Tw2InstancedMeshBatch","Tw2CurveSet","Tw2ValueBinding","Tw2BasicPerObjectData","EveBasicPerObjectData","Tw2PerObjectData","Tw2RawData","Tw2BlendShapeData","Tw2GeometryAnimation","Tw2GeometryBone","Tw2GeometryCurve","Tw2GeometryMesh","Tw2GeometryMeshArea","Tw2GeometryMeshBinding","Tw2GeometryModel","Tw2GeometrySkeleton","Tw2GeometryTrackGroup","Tw2GeometryTransformTrack","Tw2Effect","Tw2InstancedMesh","Tw2Mesh","Tw2MeshArea","Tw2MeshLineArea","Tw2Animation","Tw2AnimationController","Tw2Bone","Tw2Model","Tw2Track","Tw2TrackGroup","Tw2Parameter","Tw2VectorParameter","Tw2FloatParameter","Tw2MatrixParameter","Tw2TransformParameter","Tw2VariableParameter","Tw2Vector2Parameter","Tw2Vector3Parameter","Tw2Vector4Parameter","Tw2TextureParameter","Tw2PostEffect","Tw2PostEffectManager","Tw2PostEffectStep","Tw2PostProcess","Tw2BinaryReader","Tw2ObjectReader","Tw2EffectRes","Tw2GeometryRes","Tw2LoadingObject","Tw2Resource","Tw2TextureRes","Tw2VideoRes","Tw2SamplerState","Tw2SamplerOverride","Tw2VertexDeclaration","Tw2VertexElement","Tw2CurveKey","Tw2Curve","Tw2ColorKey","Tw2ColorCurve","Tw2ColorKey2","Tw2ColorCurve2","Tw2EventKey","Tw2EventCurve","Tw2PerlinCurve","Tw2QuaternionKey2","Tw2QuaternionCurve","Tw2RandomConstantCurve","Tw2Torque","Tw2RigidOrientation","Tw2QuaternionKey","Tw2RotationCurve","Tw2ScalarKey","Tw2ScalarCurve","Tw2ScalarKey2","Tw2ScalarCurve2","Tw2SineCurve","Tw2Vector2Key","Tw2Vector2Curve","Tw2Vector3Key","Tw2Vector3Curve","Tw2VectorKey","Tw2VectorCurve","Tw2ColorSequencer","Tw2EulerRotation","Tw2QuaternionSequencer","Tw2RGBAScalarSequencer","Tw2ScalarSequencer","Tw2VectorSequencer","Tw2XYZScalarSequencer","Tw2YPRSequencer","Tw2WbgTrack","Tw2WbgTransformTrack","Tw2TransformTrack","Tw2MayaEulerRotationCurve","Tw2MayaScalarCurve","Tw2MayaVector3Curve","Tw2MayaAnimationEngine","EveSpaceScene","EveSOF","EveChild","EveChildBillboard","EveChildCloud","EveChildContainer","EveChildExplosion","EveChildMesh","EveChildParticleSystem","EveLensflare","EveMeshOverlayEffect","EveOccluder","EveStretch","EvePerMuzzleData","EveTurretFiringFX","EveStarfield","EveObject","EveEffectRoot","EveMissileWarhead","EveMissile","EvePlanet","EveShip","EveSpaceObject","EveStation","EveTransform","EveObjectSetItem","EveObjectSet","EveBoosterBatch","EveBoosterSetItem","EveBoosterSet","EveCurveLineSetItem","EveCurveLineSet","EveLocator","EvePlaneSetBatch","EvePlaneSetItem","EvePlaneSet","EveSpaceObjectDecal","EveSpotlightSetBatch","EveSpotlightSetItem","EveSpotlightSet","EveSpriteSetBatch","EveSpriteSetItem","EveSpriteSet","EveTurretSetItem","EveTurretSet","default"].indexOf(l)<0&&function(e){n.d(t,e,function(){return s[e]})}(l);const c=r.vec4,f=r.mat4;u.E.Register({resMan:{systemMirror:!1,autoPurgeResources:!0,purgeTime:60,maxPrepareTime:.05},logger:{name:"CCPWGL",history:50,throttle:10,display:!0,visible:{error:!0,warning:!0,log:!0,info:!1,debug:!1}},paths:{res:"https://developers.eveonline.com/ccpwgl/assetpath/1097993/"},extensions:{sm_hi:i.Tw2EffectRes,sm_lo:i.Tw2EffectRes,wbg:i.Tw2GeometryRes,png:i.Tw2TextureRes,dds:i.Tw2TextureRes,cube:i.Tw2TextureRes,mp4:i.Tw2VideoRes,ogg:i.Tw2VideoRes,webm:i.Tw2VideoRes},classes:[i,o,a,s],types:{float:i.Tw2FloatParameter,number:i.Tw2FloatParameter,texture:i.Tw2TextureParameter,vector2:i.Tw2Vector2Parameter,vector3:i.Tw2Vector3Parameter,vector4:i.Tw2Vector4Parameter,matrix4:i.Tw2MatrixParameter},variables:{WorldMat:f.create(),ViewMat:f.create(),ProjectionMat:f.create(),ViewProjectionMat:f.create(),ViewportSize:c.create(),Time:c.create(),u_DecalMatrix:f.create(),u_InvDecalMatrix:f.create(),EveSpaceSceneEnvMap:"",EnvMap1:"",EnvMap2:"",EnvMap3:"",ShadowLightness:0,OccluderValue:c.fromValues(1,1,0,0),LensflareFxOccScale:c.fromValues(1,1,0,0),LensflareFxDirectionScale:c.create()}})},,,,function(e,t,n){(function(t){WebGLDebugUtils=function(){var e;void 0===e&&(e=t);var n=function(t){e.console&&e.console.error?e.console.error(t):function(t){e.console&&e.console.log&&e.console.log(t)}(t)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},i=null,o=null;function a(e){if(null==i)for(var t in i={},o={},e)"number"==typeof e[t]&&(i[e[t]]=t,o[t]=e[t])}function s(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function u(e){s();var t=i[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function l(e,t,n,i){var a;if(void 0!==(a=r[e])&&(void 0!==(a=a[t])&&a[n])){if("object"==typeof a[n]&&void 0!==a[n].enumBitwiseOr){for(var s=a[n].enumBitwiseOr,l=0,c=[],f=0;f<s.length;++f){var h=o[s[f]];0!=(i&h)&&(l|=h,c.push(u(h)))}return l===i?c.join(" | "):u(i)}return u(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function c(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function f(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<n;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0),t&&e.vertexAttribDivisor(i,0);e.deleteBuffer(r);var o=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<o;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(i,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var a=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(i=0;i<a;++i)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i,null);var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(i=0;i<s;++i)e.bindBufferBase(e.UNIFORM_BUFFER,i,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:a,mightBeEnum:function(e){return s(),void 0!==i[e]},glEnumToString:u,glFunctionArgToString:l,glFunctionArgsToString:function(e,t){for(var n="",r=t.length,i=0;i<r;++i)n+=(0==i?"":", ")+l(e,r,i,t[i]);return n},makeDebugContext:function e(t,r,i,o){o=o||t,a(t),r=r||function(e,t,r){for(var i="",o=r.length,a=0;a<o;++a)i+=(0==a?"":", ")+l(t,o,a,r[a]);n("WebGL error "+u(e)+" in "+t+"("+i+")")};var s={};function f(e,t){return function(){i&&i(t,arguments);var n=e[t].apply(e,arguments),a=o.getError();return 0!=a&&(s[a]=!0,r(a,t,arguments)),n}}var h={};for(var d in t)if("function"==typeof t[d])if("getExtension"!=d)h[d]=f(t,d);else{var p=f(t,d);h[d]=function(){var n=p.apply(t,arguments);return n?e(n,r,i,o):null}}else c(h,t,d);return h.getError=function(){for(var e in s)if(s.hasOwnProperty(e)&&s[e])return s[e]=!1,e;return t.NO_ERROR},h},makeLostContextSimulatingCanvas:function(t){var n,r,i,o=[],a=[],s={},u=1,l=!1,h=[],d=0,p=0,m=!1,y=0,b={};function v(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}t.getContext=(i=t.getContext,function(){var o=i.apply(t,arguments);if(o instanceof WebGLRenderingContext||e.WebGL2RenderingContext&&o instanceof WebGL2RenderingContext){if(o!=n){if(n)throw"got different context";r=e.WebGL2RenderingContext&&o instanceof WebGL2RenderingContext,s=function(e){for(var t in e)"function"==typeof e[t]?s[t]=E(e,t):c(s,e,t);s.getError=function(){if(w(),!l)for(;e=n.getError();)b[e]=!0;for(var e in b)if(b[e])return delete b[e],e;return s.NO_ERROR};var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];r&&i.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var o=0;o<i.length;++o){var a=i[o];s[a]=function(t){return function(){if(w(),l)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=u,h.push(n),n}}(e[a])}var f=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];r&&f.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var o=0;o<f.length;++o){var a=f[o];s[a]=function(t){return function(){return w(),l?null:t.apply(e,arguments)}}(s[a])}var d,p=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];r&&p.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var o=0;o<p.length;++o){var a=p[o];s[a]=function(t){return function(){return w(),!l&&t.apply(e,arguments)}}(s[a])}return s.checkFramebufferStatus=(d=s.checkFramebufferStatus,function(){return w(),l?s.FRAMEBUFFER_UNSUPPORTED:d.apply(e,arguments)}),s.getAttribLocation=function(t){return function(){return w(),l?-1:t.apply(e,arguments)}}(s.getAttribLocation),s.getVertexAttribOffset=function(t){return function(){return w(),l?0:t.apply(e,arguments)}}(s.getVertexAttribOffset),s.isContextLost=function(){return l},r&&(s.getFragDataLocation=function(t){return function(){return w(),l?-1:t.apply(e,arguments)}}(s.getFragDataLocation),s.clientWaitSync=function(t){return function(){return w(),l?s.WAIT_FAILED:t.apply(e,arguments)}}(s.clientWaitSync),s.getUniformBlockIndex=function(t){return function(){return w(),l?s.INVALID_INDEX:t.apply(e,arguments)}}(s.getUniformBlockIndex)),s}(n=o)}return s}return o});var g=function(e){o.push(v(e))},_=function(e){a.push(v(e))};function w(){++p,l||d==p&&t.loseContext()}function E(e,t){var n=e[t];return function(){if(w(),!l)return n.apply(e,arguments)}}function T(e){return{statusMessage:e,preventDefault:function(){m=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":g(r);break;case"webglcontextrestored":_(r);break;default:t.apply(e,arguments)}}}(t),t.loseContext=function(){if(!l){for(l=!0,d=0,++u;n.getError(););!function(){for(var e=Object.keys(b),t=0;t<e.length;++t)delete b[e[t]]}(),b[n.CONTEXT_LOST_WEBGL]=!0;var e=T("context lost"),r=o.slice();setTimeout(function(){for(var n=0;n<r.length;++n)r[n](e);y>=0&&setTimeout(function(){t.restoreContext()},y)},0)}},t.restoreContext=function(){l&&a.length&&setTimeout(function(){if(!m)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<h.length;++e){var t=h[e];t instanceof WebGLBuffer?n.deleteBuffer(t):t instanceof WebGLFramebuffer?n.deleteFramebuffer(t):t instanceof WebGLProgram?n.deleteProgram(t):t instanceof WebGLRenderbuffer?n.deleteRenderbuffer(t):t instanceof WebGLShader?n.deleteShader(t):t instanceof WebGLTexture?n.deleteTexture(t):r&&(t instanceof WebGLQuery?n.deleteQuery(t):t instanceof WebGLSampler?n.deleteSampler(t):t instanceof WebGLSync?n.deleteSync(t):t instanceof WebGLTransformFeedback?n.deleteTransformFeedback(t):t instanceof WebGLVertexArrayObject&&n.deleteVertexArray(t))}}(),f(n),l=!1,p=0,m=!1;for(var e=a.slice(),t=T("context restored"),i=0;i<e.length;++i)e[i](t)},0)},t.loseContextInNCalls=function(e){if(l)throw"You can not ask a lost contet to be lost";d=p+e},t.getNumCalls=function(){return p},t.setRestoreTimeout=function(e){y=e},t},resetToInitialState:f}}(),e.exports=WebGLDebugUtils}).call(this,n(31))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}])});